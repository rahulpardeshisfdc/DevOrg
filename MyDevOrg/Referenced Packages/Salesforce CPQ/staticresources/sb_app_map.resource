{"version":3,"sources":["app.js","labels_en.js","org.local.js","ajax/ajax.js","assets/assets.5.js","assets/assets.routes.js","common/Util.js","common/common.js","docgen/docgen.routes.js","favorites/favorites.5.js","favorites/favorites.routes.js","quotes/quotes.5.js","quotes/quotes.routes.js","products/products.5.js","products/products.routes.js","subscriptions/subscriptions.5.js","subscriptions/subscriptions.routes.js","common/behaviors/DeviceBehavior.js","common/behaviors/LookupBehavior.js","common/core/AppContext.js","common/core/Navigator.js","common/core/Page.js","common/forms/DependentPicklistBuilder.js","common/forms/Locale.js","common/forms/NumberFormatter.js","common/forms/NumberParser.js","common/oauth/OAuth.js","common/oauth/oauth.local.js","common/relationship/RelationshipFieldManager.js","common/signal/AbstractFocusSignaler.js","common/signal/RowFocusSignaler.js","docgen/sb-docgen-preview/DocgenPreview.js","favorites/sb-favorite-lookup/FavoriteLookup.js","favorites/sb-favorite-share-dialog/FavoriteShareDialog.js","quotes/models/Constants.js","quotes/models/CustomActionModel.js","quotes/models/DiscountTierModel.js","quotes/models/DiscountTiersValidator.js","quotes/models/DragDropModel.js","quotes/models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/JSQCNotifier.js","quotes/models/LineModel.js","quotes/models/MDQSegmentHelper.js","quotes/models/QuoteMessenger.js","quotes/models/QuoteModel.js","quotes/models/SortLinesHandler.js","quotes/precaching/IdConverter.js","quotes/precaching/JSQCPrecacheWorker.js","quotes/precaching/JSQCPrecacheWorkerManager.js","quotes/precaching/PrecacheRestClient.js","quotes/sb-le-custom-action-services/LECustomActionServices.js","quotes/sb-line-sort/QuoteLineSort.js","products/localization/LocalizeFields.js","common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","common/core/sb-i18n/I18n.js","common/core/sb-loading-spinner/LoadingSpinner.js","common/core/sb-page-container/PageContainer.js","common/core/sb-router/Router.js","common/core/sb-page-header/PageHeader.js","common/core/sb-toast/Toast.js","common/data/cache/Cache.js","common/data/client/OAuthClient.js","common/data/client/RemoteClient.js","common/data/client/RemoteOAuth.js","common/data/client/RemoteSession.js","common/data/client/RestClient.js","common/data/client/ServiceClient.js","common/data/format/DataBuilder.js","common/data/format/ErrorFormatter.js","common/data/format/JsonFormatter.js","common/data/sb-describe/Describe.js","common/data/sb-service/Service.js","common/filter/searcher/Searcher.js","common/layout/data/RecordGrouper.js","common/layout/fields/FieldHider.js","common/layout/fields/FieldSetHandler.js","common/layout/sb-actions/Actions.js","common/layout/sb-badge/Badge.js","common/layout/sb-dialog/Dialog.js","common/layout/sb-div/Div.js","common/layout/sb-drawer/Drawer.js","common/layout/sb-field-item/FieldItem.js","common/layout/sb-field-table/FieldTable.js","common/layout/sb-filter-item/FilterItem.js","common/layout/sb-filter-layout/FilterLayout.js","common/layout/sb-group/Group.js","common/layout/sb-html/Html.js","common/layout/sb-lookup-layout/LookupLayout.js","common/layout/sb-popup/Popup.js","common/layout/sb-side-panel/SidePanel.js","common/layout/sb-swipe-container/SwipeContainer.js","common/layout/sb-table-cell/TableCell.js","common/layout/sb-table-cell-select/TableCellSelect.js","common/layout/sb-table-header/TableHeader.js","common/layout/sb-table-row/TableRow.js","common/layout/sb-tabs/Tabs.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/TableClassBuilder.js","common/forms/sb-checkbox/Checkbox.js","common/forms/sb-datepicker/Datepicker.js","common/forms/sb-discount/Discount.js","common/forms/sb-field/Field.js","common/forms/sb-input/Input.js","common/forms/sb-lookup/Lookup.js","common/forms/sb-lookup-dialog/LookupDialog.js","common/forms/sb-multi-lookup/MultiLookup.js","common/forms/sb-pagination/Pagination.js","common/forms/sb-rte/RichTextEditor.js","common/forms/sb-select/Select.js","common/forms/sb-textarea/Textarea.js","common/forms/sb-typeahead/Typeahead.js","common/services/sb-job-checker/JobChecker.js","common/services/sb-field-md/FieldMetadata.js","common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js","common/services/sb-line-editor-read/LineEditorReader.js","common/services/sb-search-model-load/SearchModelLoader.js","common/services/sb-search-model-select/SearchModelSelector.js","quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js","quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js","quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js","quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js","quotes/layout/sb-cse-table-cell/CSETableCell.js","quotes/layout/sb-custom-action/CustomAction.js","quotes/layout/sb-ds-table-cell/DSTableCell.js","quotes/layout/sb-ds-tiers/DSTiers.js","quotes/layout/sb-field-set-table/FieldSetTable.js","quotes/layout/sb-field-set-table-item/FieldSetTableItem.js","quotes/layout/sb-le-footer/LEFooter.js","quotes/layout/sb-le-group/LEGroup.js","quotes/layout/sb-le-group-layout/LEGroupLayout.js","quotes/layout/sb-le-summary-row/LESummaryRow.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/layout/sb-le-table-cell/LETableCell.js","quotes/layout/sb-le-table-cell/Localizer.js","quotes/layout/sb-le-table-cell/QuoteLineUpgradeHandler.js","quotes/layout/sb-le-table-cell/Swiper.js","quotes/layout/sb-le-table-header/LETableHeader.js","quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js","quotes/layout/sb-le-table-row/LETableRow.js","quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js","quotes/md/sb-le-field-md/LEFieldMD.js","quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js","quotes/pages/sb-line-editor/LineEditor.js","quotes/precaching/PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/MetadataSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/OptionSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/PriceRuleSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/ProductSequenceRunner.js","quotes/precaching/PrecacheSequenceRunners/RelatedRecordSequenceRunner.js","quotes/tables/sb-segmented-lines/SegmentedLines.js","quotes/tables/sb-standard-lines/StandardLines.js","products/config/message/ProductMessenger.js","products/config/search/ConfiguratorSearch.js","products/config/viewmodel/ProductViewModel.js","products/prototype/sb-product-search/ProductSearch.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","products/resources/optionConstraints/OptionConstraintsHandler.js","products/resources/reconfigure/ProductReconfigurer.js","products/resources/rules/RuleProcessor.js","products/resources/sb-product-alert/ProductAlert.js","products/resources/tree/ConfigTree.js","assets/selection/routes/sb-asset-lookup/AssetLookup.js","assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js","common/forms/sb-checkbox/factory/CheckboxFactory.js","common/forms/sb-datepicker/factory/DatePickerFactory.js","common/forms/sb-discount/factory/DiscountFactory.js","common/forms/sb-field/factory/FieldFactory.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-field/factory/NumericFieldFactory.js","common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/TextFieldFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-lookup/factory/LookupFactory.js","common/forms/sb-lookup/map/LookupNameMapper.js","common/forms/sb-lookup/query/LookupQueryBuilder.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/forms/sb-rte/factory/RichTextEditorFactory.js","common/forms/sb-select/factory/SelectFactory.js","common/forms/sb-textarea/factory/TextareaFactory.js","quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js","quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js","quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js","products/config/actions/sb-custom-actions/CustomActions.js","products/config/attribute/sb-attribute-item/AttributeItem.js","products/config/attribute/sb-attribute-table/AttributeTable.js","products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js","products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js","products/config/feature/sb-product-feature/ProductFeature.js","products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js","products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js","products/config/feature/sb-product-feature-list/ProductFeatureList.js","products/config/option/sb-option-cell/OptionCell.js","products/config/option/sb-product-option-table/ProductOptionTable.js","products/config/routes/sb-dynamic-lookup/DynamicLookup.js","products/config/routes/sb-option-lookup/OptionLookup.js","products/config/routes/sb-product-config/ProductConfig.js","products/prototype/notify/sb-one/one.js","products/prototype/notify/sb-three/three.js","products/prototype/notify/sb-two/two.js","products/resources/model/nestedOptions/NestedOptionsModel.js","products/selection/filter/sb-suggester/Suggester.js","products/selection/routes/sb-product-lookup/ProductLookup.js","subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js","products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js","products/config/routes/services/sb-pc-option-save/OptionSaver.js","products/config/routes/services/sb-pc-product-load/ProductLoader.js","products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js"],"names":["docgen","quotes","assets","subscriptions","products","favorites","AppContext","I18n","Router","RichTextEditorDialog","App","pageContainer","dbName","settingsObj","urls","r","PREFIX","ROUTES","allRoutes","setBaseUrl","tinymce","Promise","all","init","_initIntlLocale","intl","locale","url","res","rej","xhr","XMLHttpRequest","open","onerror","e","Error","ontimeout","onload","responseText","data","JSON","parse","addLocaleData","Intl","__addLocaleData","statusText","send","LABELS","settings","developerPrefix","isMultiCurrencyOrg","calculateImmediately","language","defaultCurrency","currencySymbol","currencyDecimalScale","fullName","userName","userId","device","isOAuth","window","SB","ajax","require","comp","mod","Util","n","width","z","length","Array","join","d","Date","getUTCFullYear","pad","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","ctxComponent","object","strProp","Object","keys","prop","notifyPath","fieldValue","filterValue","operator","toLowerCase","val","startsWith","endsWith","includes","Map","prototype","get","set","frame","document","createElement","body","appendChild","contentWindow","parentNode","removeChild","HOLD_THRESHOLD","Polymer","holdTimer","Gestures","register","name","deps","flow","start","end","emits","mouseup","up","touchend","changedTouches","clearTimeout","mousedown","down","touchstart","preventer","setTimeout","fire","findOriginalTarget","x","clientX","y","clientY","sourceEvent","totalTime","totalComponents","currentTime","deviceClasses","checkPerformance","quiet","DeviceBehavior","startPerformanceCheck","deviceNodes","dom","root","querySelectorAll","getDeviceClasses","deviceClass","toggleClass","deviceNode","stopPerformanceCheck","console","warn","tagName","isPhone","isTablet","performance","now","time","toFixed","log","CommonBehaviors","LookupBehavior","handleProductsLoadServerResponse","handleHideSearchFilterIfNoSearchColumnsDisplayed","bindFilterEnterCallBacks","addEventListener","removeFilter","bind","labels","org","md","user","i18n","sb","ui","common","core","buildUserAndOrgFromSettings","navigator","userAgent","match","i18nClass","resolve","reject","System","import","then","m","userLabels","ret","catch","lang","id","fullname","username","hasQuoteEditPermission","prefix","undefined","quantityScale","orgUrl","siteUrl","apiVersion","ua","indexOf","app","type","value","deviceContext","isDesktop","isMobile","obj","version","Navigator","queryParams","pathParams","newWin","component","u","pLen","pKeys","kLen","i","encodeURIComponent","location","hash","PageContainer","SIZE_S","SIZE_M","SIZE_L","SIZE_XL","Page","nav","Base","extend","ctx","viewport","getViewport","properties","DependentPicklistBuilder","controlledPicklist","controllingValue","options","picklistValues","validOptions","forEach","option","_testBit","atob","validFor","_getControllingValueIndex","push","controllingOptions","controllingField","l","controllingValueIndex","byteToCheck","Math","floor","bit","pow","charCodeAt","Locale","COMMA_DECIMAL_LOCALES","NumberFormatter","editable","metadata","appContext","allowCurrency","opts","scale","minimumFractionDigits","maximumFractionDigits","_setCurrencyFormatOptions","isCommaDecimal","useGrouping","isNil","formattedValue","format","err","isNaN","style","currency","CurrencyIsoCode","currencyDisplay","NumberParser","isCommaDecimalLocale","numberStr","removeUnusualSeparators","removeNonDecimalCommas","removeDecimalSepartors","replaceCommaDecimalWithPeriod","parseFloat","replace","RegExp","OAUTH_KEY","OAUTH_SECRET","port","oauth2","clientId","clientSecret","redirectUri","proxyUrl","OAuth","tokens","_getNoOAuthClientKeyMessage","storeTokens","jsforce","browser","Client","_storeTokens","params","localStorage","setItem","_prefix","refresh_token","removeTokens","_removeTokens","removeItem","getTokens","_getTokens","refreshToken","getItem","isLoggedIn","connection","getTime","cookie","login","once","conn","createRequestParams","apex","_createRequestParams","method","path","headers","instanceUrl","userInfo","accessToken","_getParameterByName","instance_url","access_token","issued_at","regex","results","exec","decodeURIComponent","LookupNameMapper","RelationshipFieldManager","field","record","getRelationship","relationshipField","getRelationshipField","nameField","relationship","_getLookupName","display","tableName","buildRelationship","Id","getNameField","relationshipTable","attributes","idField","substring","AbstractFocusSignaler","element","focusEvents","blurEvents","signalName","unregister","fireFocusSignal","_fireSignal","fireBlurSignal","focusEvent","removeEventListener","blurEvent","focused","_fireSignals","lastSignaler","_getLastSignaler","_setLastSignaler","_toggleDisabled","_isDisabled","fireSignal","targets","getSignalTargets","target","signaler","last","disabled","RowFocusSignaler","row","groupId","cellName","rowId","fields","group","$$","cells","cell","signal","detail","templates","title","DocgenPreview","is","DataBuilder","ErrorFormatter","FavoriteLookup","lineEditorModel","favoriteModel","selectedFavorites","actions","errors","notify","error","qId","String","groupKey","Number","Boolean","aId","parseInt","_isMobileViewport","$","le","_setMetaData","fm","_setSelected","addFavorite","quote","_toggleSelected","addMore","header","selected","shareFavorites","model","addQuote","add","groups","users","build","_handleOneFavoriteSelected","_handleAllFavoritesSelected","cols","resultFieldNames","colsDisplay","fieldLabels","numFields","label","primaryMobileCols","favorite","recordId","bool","rows","tbody","deleteFavorite","shareFavorite","dialog","toggle","onSelect","validations","truncate","FavoriteShareDialog","favdUsers","favdGroups","favoriteCallback","Function","_favoriteCallbackFunction","iconMap","User","Group","onCancel","searchValue","multilookup","updateTable","service","uid","context","menuItemLabels","_parseResults","numGroups","numUsers","Name","j","concat","selectedIdsByItems","items","map","k","numItems","_clearFavdLists","clear","Constants","QUOTE","QUOTE_LINE","QUOTE_LINE_GROUP","ACCOUNT_FIELD","ACCOUNT_ID_FIELD","ACTION_FIELD","ADDITIONAL_DISCOUNT_AMOUNT_FIELD","ADDITIONAL_DISCOUNT_FIELD","ADDITIONAL_DISCOUNT_RATE_FIELD","ADDITIONAL_QUANTITY_FIELD","BATCH_QUANTITY","BUNDLE_FIELD","BUNDLED_FIELD","BUNDLED_QUANTITY_FIELD","CLASS_FIELD","COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD","COMPONENT_LIST_TOTAL_FIELD","COMPONENT_SUBSCRIPTION_SCOPE_FIELD","COMPONENT_VISIBILITY_FIELD","CONDITIONS_MET_FIELD","COST_EDITABLE_FIELD","CUSTOM_ACTION_CONDITIONS_FIELD","CUSTOMER_AMOUNT_FIELD","CUSTOMER_PRICE_FIELD","DEFAULT_SUBSCRIPTION_TERM_FIELD","DEFAULT_FIELD","DESCRIPTION_FIELD","DIMENSION_FIELD","DISCOUNT_AMOUNT_FIELD","DISCOUNT_SCHEDULE_FIELD","DISCOUNT_SCHEDULE_TYPE_FIELD","DISCOUNT_TIER_FIELD","DISCOUNT_TIERS_FIELD","DISCOUNT_UNIT_FIELD","DISTRIBUTOR_DISCOUNT_FIELD","EFFECTIVE_QUANTITY","END_DATE_FIELD","EVENT_HANDLER_NAME_FIELD","EXISTING_FIELD","FAVORITE_ID_FIELD","FIELD_FIELD","FILTER_VALUE_FIELD","GROUP_LINE_ITEMS_FIELD","ICON_CLASS_FIELD","LABEL_FIELD","LIST_PRICE_FIELD","LOCATION_FIELD","LONG_TEXT_AREA_FIELD","LOWER_BOUND_FIELD","MARKUP_AMOUNT_FIELD","MARKUP_FIELD","MARKUP_RATE_FIELD","NET_AMOUNT_FIELD","NET_PRICE_FIELD","NET_TOTAL_FIELD","NON_DISCOUNTABLE_FIELD","NON_PARTNER_DISCOUNTABLE_FIELD","NUMBER_FIELD","OPERATOR_FIELD","OPPORTUNITY_FIELD","OPPORTUNITY_ID_FIELD","OPTION_LEVEL_FIELD","OPTION_TYPE_FIELD","OPTIONAL_FIELD","ORIGINAL_SCHEDULE_FIELD","OVERRIDE_BEHAVIOR_FIELD","PAGE_FIELD","PARENT_CUSTOM_ACTION_FIELD","PARTNER_DISCOUNT_FIELD","PARTNER_PRICE_FIELD","PRICE_EDITABLE_FIELD","PRICEBOOK_ID_FIELD","PRICING_METHOD_EDITABLE_FIELD","PRICING_METHOD_FIELD","PRIMARY_FIELD","BRAND_BUTTON_FIELD","PRIOR_QUANTITY_FIELD","PRODUCT","PRODUCT_CODE_FIELD","PRODUCT_NAME_FIELD","PRORATE_MULTIPLIER_FIELD","QUANTITY_FIELD","QUOTE_PROCESS_FIELD","QUOTE_PROCESS_ID_FIELD","REGULAR_PRICE_FIELD","RENEWAL_CHECKBOX","RENEWED_ASSET_ID_FIELD","REQUIRED_BY_FIELD","RICH_TEXT_AREA_FIELD","SEGMENT_INDEX_FIELD","SEGMENT_KEY_FIELD","SEGMENT_LABEL_FIELD","SOURCE_FIELD","SPECIAL_PRICE_FIELD","START_DATE_FIELD","SUBSCRIBED_ASSET_IDS_FIELD","SUBSCRIPTION_BASE_FIELD","SUBSCRIPTION_PRICING_FIELD","SUBSCRIPTION_SCOPE_FIELD","SUBSCRIPTION_TERM_FIELD","TARGET_OBJECT_FIELD","TEXT_FIELD","TEXT_AREA_FIELD","TYPE_FIELD","UNIT_COST_FIELD","UPGRADE_CONVERSION_RATE","UPGRADED_ASSET_FIELD","UPGRADED_QUANTITY","UPGRADED_SUBSCRIPTION_FIELD","UPLIFT_FIELD","UPPER_BOUND_FIELD","URL_TARGET_FIELD","URL_FIELD","RETURN_URL_FIELD","USE_PRICE_FOR_AMOUNT_FIELD","USER_DEFINED_FIELD","CUSTOM_VALUE","QUANTITY_FIELDS","Set","UNIT_PRICE_FIELDS","CustomActionModel","editorModel","customAction","customActionModelsByParentId","renderLocation","icon","constants","class","caClass","eventHandlerName","isSeparator","primary","urlTarget","_customActionsConditionsMet","existing","lineVO","parentItemKey","configurable","productHasDimensions","segmented","bundle","getField","quoteModel","grouped","toggleOptionalShown","allOptional","renewSubscriptionsButtonRendered","isAmendment","upgradeAssetsButtonRendered","multiLineDeleteEnabled","evaluateCondition","condition","productVO","arithmeticOperatorConversion","quoteVO","meetAllConditions","conditions","records","children","isHidden","isDefault","DiscountTierModel","discountTierRecord","discountScheduleRecord","template","discountSchedule","hidden","tiers","DiscountTiersValidator","schedule","unitPriceScale","priceScale","lastTier","customLabels","number","lowerBound","upperBound","lastUpperBound","discountUnit","discount","Price","formatLabel","msg_missing_lower_bound_tier","msg_unequal_lower_upper_bounds_tier","toUpperCase","msg_missing_discount_tier","msg_upper_greater_tier","tier","discountFormatted","msg_missing_discount_amount_tier_currency","msg_missing_discount_amount_tier","args","toString","_pauseEvent","stopPropagation","preventDefault","_addTopBorderClass","node","classList","topBorderHighlightClass","_addBottomBorderClass","bottomBorderHighlightClass","DEFAULT_GHOST_X_OFFSET","DEFAULT_GHOST_Y_OFFSET","dragging","DragDropModel","host","keepBundle","draggable","validTargets","dragFunc","trackFunc","dropFunc","ghostXOffset","ghostYOffset","keepBundleTogether","sourceElement","hoverOver","placeHolderComp","ghostField","targetClass","dropBefore","usePlaceholder","highlightTargetPosition","highlightableElements","enableHighLight","lineEditor","querySelector","linesByParentKey","linesByParentItemKey","standardLinesByParentKey","standardLinesByParentItemKey","segmentedLinesByParentKey","segmentedLinesByParentItemKey","ghost","handleDrag","handleTrack","handleDrop","mouseX","mouseY","state","abs","dx","dy","localTarget","sourceBox","getBoundingClientRect","sourceWidth","sourceHeight","height","_appendGhostImage","_moveGhost","hoverOverComp","event","hover","contains","_hideGhost","_showGhost","debounce","RenderStatus","afterNextRender","_removePlaceholder","previousHoverOverComp","_removeHighlightHover","_usePlaceholder","_highlightHover","toggleAttribute","removeAttribute","_removeGhost","ghostElement","_clonePolymerElement","loadingSpinner","remove","gX","gY","left","top","visibility","innerHTML","el","_ifParentIsValidTarget","localName","domHost","_findTableRowValidTarget","drag","lineModel","dimensionType","groupModel","navItems","hoverElement","ref","previousElementSibling","nextElementSibling","lineKey","key","isComponent","ifLineElementsShareParent","ifLineElementsAreParentChild","selector","nodeName","rootNode","_findParentCustomElement","parentElement","classArr","from","len","has","boundBox","midHeight","phLoc","removeTopBottomBorderClass","elements","create","setAttribute","backgroundColor","targetHost","insertBefore","hasAttribute","getAttribute","clonedElement","cloneNode","removeTableRowBorderClass","rowComp","tds","getElementsByClassName","eL1","eL2","QuoteModel","EditorModel","fieldsetMap","_createFieldsetMap","fieldNameSet","fieldsMap","quoteLineObjectName","required","actionsOnTheLeft","actionsColumnPlacement","createQuoteModel","summarized","summaries","standardPrimaryMobileCols","segmentedPrimaryMobileCols","segmentedDetailsPrimaryMobileCols","_isToggleOptionalShown","customActionsByLocation","customActionsByLocationMobile","groupMobileMenuButtonAction","_initCustomActions","customActions","quoteCustomActions","Quote","lineCustomActions","Line","styleQuoteAndGroupActionButtons","communityPrefix","_getCommunityPrefix","styleActionButtons","first","lastCustomAction","pathname","idx","fieldsetList","_createFieldsetList","fieldset","table","containsOptional_Field","lineFieldNames","multiSegmentLineFieldNames","defaultCustomActions","validLocations","customActionsByParentId","addGroupCustomActionModel","addToLocation","customActionModel","default","parentId","childCustomActions","solutionGroupsEnabled","solutionGroups","addGroupChildren","sgL","solutionGroupAction","LineModel","GroupModel","groupVO","standardLines","segmentedLines","dimensions","dimensionsMap","segmentedLinesByDimension","segmentedLinesBySegmentKey","segmentedLineKeysBySegmentKey","standardSubscriptionScopeEditable","segmentedSubscriptionScopeEditable","groupObjectName","multiSegmentColumnTotals","netMultiSegmentTotal","hasVisibleStandardLines","hasVisibleSegmentedLines","lineModelsByKey","_addStandardLine","_addSegmentedLine","segments","addToLinesByParentItemKey","visible","indexByGroupKey","parentGroupKey","indexByLineKey","subscriptionScopeEditable","lineRecord","segmentKey","segmentLabel","dimension","multiSegmentKeys","segmentedLineKey","segmentsByLabel","firstSegment","setDimensionProperties","addToSegmentsArray","addToSegmentsByLabel","indexBySegmentKey","dim","splice","stdMap","mdqMap","line","newLineVO","stringify","clone","removable","discountEditable","nextKey","cloneLine","multiSegmentRowTotals","clonedSegment","result","s","removedLine","lineItems","favIds","JSQCNotifier","lineEditorComponent","pathsToNotify","originalPathValues","pathsToSet","groupModels","lineGroups","modelVO","previous","groupIndex","lineIndex","split","pop","index","notifySpecificPath","parentQuote","segmentIndex","localizedMultiSegmentColumns","dimensionsLength","columns","columnKeys","columnsLength","hasOwnProperty","expandedIconClass","_getExpansionClass","isVisibleInLineEditor","fieldNames","fieldName","expanded","getFieldMD","updateable","quantityEditable","listPriceEditable","discountable","nonPartnerDiscountable","upliftable","unitCostEditable","pricingMethodCustom","pricingMethodDisabled","bundled","pricingMethodCost","descriptionLocked","PACKAGE_PRODUCT_CODE_FIELD","PRORATED_LIST_PRICE_FIELD","subscription","fieldEditability","fieldVisibility","extraTypeInfo","componentVisibility","renewedAssetId","renewedAssetsHiddenWhenEditing","dynamic","productPullIns","hasConfiguration","hasConfigurationAttributes","renewalQuotesWithoutAssetsAllowed","legacySupport","productQuantityEditable","costEditable","dynamicSubscription","nonDiscountable","componentDiscountedByPackage","rootPackage","reconfigurationDisabled","configurationType","configurationEvent","pricingMethodList","segmentsLength","updateCustomSegments","scheduleId","MDQSegmentHelper","groupModelsByKey","MONTHLY_DIM","YEARLY_DIM","QUARTERLY_DIM","LINES_GROUPED_FIELD","FIRST_SEGMENT_END_DATE_FIELD","_segmentsChanged","_hasMultiSegmentLines","lineItemGroups","_adjustSegments","lineCount","term","_calculateSubscriptionTerm","lines","filter","_calculateSegmentDeltasAndModifySegments","startDateFieldValue","endDateFieldValue","subscriptionTermValue","startDate","endDate","firstSegEndDateFieldValue","firstSegEndDate","subscriptionTermUnitIsDay","setUTCDate","addMonths","firstSegPlusOneDay","setDate","getDate","daysBetween","monthsBetweenRoundPartialUp","dimType","segmentDeltasBySegmentKey","_calculateSegmentDeltas","size","_modifySegmentsBasedOnDelta","termIsDay","segmentCountsBySegmentKey","mapSegmentCountsBySegmentKeys","trueSegmentCount","determineDesiredNumberOfSegments","currentSegCount","segKey","lineSegKey","termStartDate","quoteEndDate","monthsBetween","setUTCMonth","ceil","deltaMap","delta","lastSegment","_getLastSegmentFromQuote","noDelta","amendmentLine","lastSegStartDateFieldValue","lastSegEndDateFieldValue","lastSegStartDate","lastSegEndDate","startDateBeforeEndDate","newSegmentVO","_createNewSegment","addLine","_removeSegment","lineItem","maxIndex","sourceSegment","offset","whitespace","segmentToRemove","slice","deletedLineIds","QuoteMessenger","targetRecord","message","action","groupsByKey","isPrimary","isRenewal","groupRecord","multiSegmentColumns","lineVOs","deepRenumber","renumberStandardIndexes","renumberSegmentedIndexes","SortLinesHandler","lineSortField","sort","a","b","lineSortValue","difference","aSecondary","bSecondary","convertTo18","part1","convertToDigit","part2","part3","reverseString","str","reverse","replaceWithBinary","string","seg","CONVERSION_TABLE","module","exports","getRunnerConstructor","sequence","requiredModulesBySequence","getArgumentList","resultPoster","accountId","referencedFieldMap","lookupFieldMap","referencedFields","apexFactory","client","read","provider","load","setOptions","mdType","mdItems","promiseArray","promisesNeeded","dataArray","combinedDataArray","arr","self","startTime","importScripts","Connection","OAuth2","precacheSequence","runnerConstructor","postMessage","failure","msg","close","argumentList","runner","apply","executeSequence","RemoteOAuth","JSQCPrecacheWorkerManager","filePath","_getAccessToken","_spoolWorkers","oauth","getAccessTokenBypassingCache","priceRuleWorker","_createWorker","priceRuleContext","_createWorkerContext","metadataWorker","metadataContext","discountWorker","discountContext","relatedRecordWorker","quoteLookups","groupLookups","lineLookups","allLineLookups","nonstandardLineLookups","fieldPrefix","relatedRecordContext","productWorker","productContext","optionWorker","optionContext","extrasMap","baseContext","wrkr","Worker","precachingFn","_precache","successful","JSQCPrecacher","precacher","precacheValue","restClient","proxy","restProxy","endpoint","getEndpoint","patch","request","OAuthClient","JsonFormatter","LECustomActionServices","eventDetail","response","pseudoServiceModel","serviceModel","_usesClientCalculator","sortLines","_reorderLineItems","_reorderGroups","quoteJSON","numOfGroups","numOfDimensions","numOfLines","numOfSegments","_executeServiceAction","favName","_executeCustomURLAction","parsedURL","_parseURL","_handlePopup","_navigateToURL","calculateResponse","jobId","_onJobChecker","_updateQuote","updateQuote","saverResponse","guidedMessages","handleProductRuleAlertModal","showSpinner","navigateToReturnUrl","messages","sobjectId","returnUrl","_isLightningExperience","sforce","one","navigateToSObject","parent","href","destampGroups","rawData","quoteEditorModelResponse","toggleGroupResponse","destroyTabs","_extendSolutionGroupRecord","rightSideButton","buildQuoteTabs","quoteHasNoLines","popupResponse","onSave","onQuickSave","reload","popup","messenger","targetModel","splitValues","objectName","shift","navigateToURL","updateQuoteRequired","_jsqcCalculate","calculationRequired","sortLineItems","_createEditorModel","sortRequired","updateAfterJSQC","notifier","alertModal","displayContinueButton","cancelCB","alerts","calculateService","background","saveService","_save","quickSaveService","_navigateToLookup","_retrieveKeysOfSelected","selectedSolutionGroup","_addGroup","standardLineVO","segmentedLine","w","segmentLineVO","toggleOptionalBoolean","confirm","ignoreCache","_openDialog","originalLine","clonedLines","clonedSegmentedLines","Year","Quarter","Month","Custom","_addParentAndAllChildLineItems","cloneSegmentedLine","components","_addClonedLines","bundleKeptTogether","clonedLine","_addClonedSegmentedLines","segmentedLinesToSplice","lastSegmentedLineKey","segmentedLineModelToSplice","renumber","renumberIndexes","usesClientCalculator","JSQC","oauthClient","displayedLookupMap","getDisplayedLookupNames","mdqHelper","segmentsChanged","updateSegments","qc","connectionPromiseArray","getConnection","connections","setConnection","setCustomerOnlyConnection","promise","onCalc","successQuote","lineFields","groupFields","quoteFields","job","jobType","jobchecker","useSpinner","payload","backgroundCalculatePending","saveServiceAfterBackgroundCalc","usesBackgroundCalculator","onFlagCalculate","lookupName","customActionId","gmLength","standardLinesLength","segmentedLinesLength","defaultQuoteProcessId","dialogName","favDialog","favoritedLine","groupLines","favoritedGroup","depthFirstTraversal","tree","byOrder","callback","sortLinesAscByKey","sortLinesAscByField","sortLinesDescByField","makeLineItemsTree","A","lookupNameField","sortByField","B","isABundled","isBBundled","localizationByFieldByProductId","aLocalizedValue","Localizer","getLocalizedValue","bLocalizedValue","updateFieldFormat","reorderLineNumbers","lowestVisibleNumber","lowestInvisibleNumber","array","isBundled","getStartingNumbers","lineNumber","depthFirstLineItemsTreeSort","startingNumbers","LocalizeFields","searchModel","localizedProducts","localizedFields","Product2Id","localizedValue","Product2","product","localized","localizedFeatureName","untranslatedRecord","localizationByFieldName","localizedOptionField","features","feature","AssetUpgradeQuantityCalculator","upgradeHandler","source","upgrade","isSourceLine","getLine","_getUpgrade","_getSource","setSourceAndUpgrade","_setAutomaticQuantity","getSourceOrUpgrade","didUserChangeSourceQuantity","upgradeRatio","_getUpgradeRatio","getSourceIdField","getUpgradeConversionRateField","sourceCurrentQty","getSourceCurrentQuantityField","upgradeCurrentQty","getUpgradeCurrentQuantityField","sourceRate","upgradeRate","sourceQtyAfterUpdate","upgradeQtyAfterUpdate","sourcePriorQty","getSourcePriorQuantity","invalidQuantity","validQuantity","didSourceQuantityChange","didUpgradeQuantityChange","isSelected","setUpdatedQuantity","sourceIdField","upgradeConversionRateField","sourceId","upgradeSourcesBySourceProductId","dateFormatCache","numberFormatCache","localeData","values","test","_replaceWildcards","isDate","f","loc","c","stringKey","DateTimeFormat","NumberFormat","v","date","fmt","_getFormat","pos","parts","ymd","additionalCurrencyFormat","containsDash","additionalContent","LoadingSpinner","show","position","bpXS","bpS","bpM","bpL","bpXL","mqXS","matchMedia","mqSOnly","mqMOnly","mqLOnly","mqXL","route","observer","_buildViewport","matches","xs","xl","XS","S","M","L","XL","current","only","_setupViewportListeners","sender","html","content","_viewportChanged","updateStyles","originalErr","view","go","nv","router","addListener","domId","container","getContainer","private_router","routes","PATH_PARAM_REGEX","autoHash","readOnly","modules","modulePaths","p","paramNames","paramMap","on","call","arguments","paramsLen","routeHandler","qsParams","queryString","ov","same","dispatch","PageHeader","showMenu","menuClosed","hideFullTitle","textContent","fullTitle","innerText","opacity","_closeMenu","buttons","rootTarget","changeMenu","lookup","invoker","rte","targetElement","openClass","toggler","rect","currentTarget","bs","bottom","right","innerWidth","Toast","hasMessages","messagesModel","repeatHandlers","errorMsgs","msgs","successMsgs","warningMsgs","infoMsgs","numMessages","messagesSplit","removeRepeatedMessages","repeat","isMessageRepeated","toggleRepeatClass","msg1","msg2","ll","removeAnimationListeners","addAnimationListeners","handler","removeRepeatClass","__data__","Cache","emitter","createEvent","initEvent","dispatchEvent","Visualforce","RemoteSession","RestClient","RemoteClient","VF_MAX_INPUT","_restClient","_getConnection","reader","_remote","loader","contextString","uidLen","saver","modelString","save","fullNames","sObject","vfSessionId","describe","soql","query","input","_getAction","remoting","Manager","invokeAction","_callback","escape","_getPrefix","status","_parse","refreshTokenRemoteAction","getTokenRemoteAction","cacheToken","token","sessionStorage","getCachedToken","sessionId","_getApex","_getEndpoint","_handleResult","post","_handleProxyResult","proxyResult","_handleProxyErrorResult","_adjustProxyErrorMessage","errorMessage","ServiceClient","pretty","omitRelationships","addObject","omitNull","int","topLine","_replacer","Describe","objects","cache","ordered","_describe","waiting","objectFields","allFields","controlledFields","mdFields","controllerName","controlledField","controllingFieldName","controllingPicklist","promises","Service","transient","waitId","waitFor","_returnPromiseIfCachedResponse","_response","_responseAll","_describeResponse","_shouldWait","_read","_load","_md","_query","spinner","waitForPromise","cachedResponse","cachedPromise","newPromise","executeWaiting","_createError","addWaitFor","constructor","escapedValidations","validationsArray","Searcher","searchFilterData","targetObjectName","hasCustomSearchFilters","targetFieldName","searchFilterModel","searchFilters","isLookupType","queryLookupFilterName","stringValue","referenceTo","handleDynamicSearchFilters","responses","searchFilter","dynamicSearchFilters","filters","numFilters","filterValues","_id","NOT_GROUPED_NAME","RecordGrouper","groupField","groupedRecordFields","recordPath","itemProperties","itemPropertiesByGroup","groupProperties","groupCountPath","groupFieldType","groupFieldTypePath","orderdGroups","itemsByGroup","item","_get","notGrouped","groupedItems","groupie","grouper","_setProperties","_sortItemsByGroup","orderedGroups","groupItem","groupCount","property","groupFieldMd","propertiesKey","FieldHider","hide","types","FieldSetHandler","fieldSets","desktop","tablet","phone","desktopFields","tabletFields","phoneFields","_getPhoneFieldSet","_getTabletFieldSet","_getDesktopFieldSet","fieldSet","Actions","rowActions","addedManually","disabledData","dataIndex","onTapFunction","shouldDisable","invisible","iconTitle","configured","configurationRequired","Badge","for","_updateTarget","_setVisibility","_target","updatePosition","isAttached","targetRect","thisRect","ownerRoot","Dialog","modal","appendedClass","cancelText","Type","closeDialog","hideCloseIcon","hideCancelButton","mobile","mobileDropDown","tapDialog","_appendMobileClasses","observeNodes","mobileButtons","dropDownButton","isIE","footer","numChildren","dropDownMenu","dateContainer","datepicker","dateContainerBoundingClientRect","contentBoundingClientRect","Div","Drawer","listeners","isRight","renderHeader","arrows","sideText","activeElement","blur","drawer","rightDrawer","closeDrawer","isOpen","FieldItem","helpText","inlineHelpText","editing","rfm","hasRelationship","getRelationshipName","FieldTable","numColumns","column1Group","column2Group","column3Group","columnOneWidth","columnTwoWidth","columnThreeWidth","setColumns","firstColumn","secondColumn","thirdColumn","FilterItem","handleKeyPress","handleLabelChange","refDisplay","keyCode","itemType","process","filterItem","FilterLayout","filterPath","filterKey","filterDelegator","groupItems","serviceLoader","enterCallback","translationCallback","mdResponse","handleEnterKeyPressed","searchModelInitialized","eval","isArray","getSearchTable","duplicateHidden","getGroupKey","buildFields","setFilterValueMap","groupKeys","fieldsByObject","setDefaultFilterValues","panel","applyFocusToItem","actionId","resultLimit","pageNumber","getFilterContext","getAdditionalProperties","localizer","localizeSearchModel","groupClass","itemClass","groupDisplay","primaryItems","numPrimary","includePrimaryInSecondary","pathPrefix","focusIndex","itemClassMap","itemEditableMap","columnWidths","initInternalGroupAndPrimaryItems","_group","_updateColumnWidths","buildItems","g","info","addedNodes","bindElementEvents","childNodes","flush","_setColumnWidths","minWidth","maxWidth","_primaryItems","_normalizeWithTemplateGroup","secondary","doc","ownerDocument","classes","div","firstChild","numElements","updateFocusIndex","propagateValueToParent","internal","childToParentExtension","propagateFromParentToChildOverride","_propagateFromParentToChild","primaryEventsResistered","itemField","renderReadOnly","bubbles","dateRow","offsetParent","dateRowRect","dateContainerRect","offsetWidth","DEFAULT_WIDTH","DEFAULT_HEIGHT","CHECKBOX","CHECKBOX_DIRTY","CHECKBOX_CHECKED","CHECKBOX_CHECKED_DIRTY","Html","link","booleanValue","isDirty","tabindex","reflectToAttribute","blankImage","useImage","me","checkboxBase64","sanitizeHtmlText","trim","handleDefaultSizeIfImage","imageNoWidth","imageNoHeight","_registeredTabIndexEvents","clearTabIndex","restoreTabIndex","_tabindex","ImageCellSizer","TableClassBuilder","LookupLayout","selectedRows","totalCount","hasTotalCount","selectionIdDataPath","parentAttributesPath","additionalFields","groupByField","groupByFieldType","_primaryMobileColumns","computed","handleAllRowsSelected","handleOneRowSelected","handleMetaDataResponse","hiddenByGroup","initRecordKeysFieldLabelsAndTypeMap","fieldMetadataInitialized","fieldSetHandler","setFieldMetadata","getByViewport","metadataFields","recordKeys","fieldLabelMap","typeMap","labelTypeMap","itemTypeMap","currencyIsoCode","isMobileViewport","imageWidth","getImageWidth","headerClassMap","rowClassMap","toggleRowSelections","UnitPrice","rowData","invalid","viewResults","getViewResults","hasGroupedField","expandAll","setGroupExpandedHandler","groupFieldNames","groupRow","grouperExpanded","followed","isGrouped","groupExpandedHandler","expandGroupedViewResults","Popup","channel","responseMessage","closePopup","autoLaunched","_initRpc","_sendMessage","_handleAutoLaunch","_close","_getRedirectDetails","redirectDetails","rpc","destroy","redirect","easyXDM","Rpc","remote","local","_receiveMessage","outgoing","getRequest","incoming","getResponse","received","_logReceivedMessage","auto","SidePanel","SwipeContainer","disableSwipe","preventSwipe","isRequiredRowNotSelected","groupExpanded","swipeHeader","swipeMenu","swipeItems","swipeItemWidth","_preventSwipe","mutations","_findSwipeHeaderAndMenu","nodeType","Node","TEXT_NODE","COMMENT_NODE","_initSwipeHeader","_initSwipeMenu","swipeHeaderStyle","listen","setScrollDirection","swipeContainer","_animate","_closeMenuWhenTapped","swipeItem","allNodesOfSwipeMenu","swipeMenuItems","shadowRoot","currentNode","_isValidSwipeMenuItem","swipeItemsLen","speed","transition","_setSwipeItemStyles","swipeItemStyle","webkitBackfaceVisibility","borderRadius","track","_trackMove","blah","direction","cho","getComputedStyle","nag","toPrecision","distance","transform","dist","originalPosition","trans","fav","TableCell","setDisabled","setHidden","setRecordId","setSuffix","setFieldMetadataFromModel","suffix","fullWidthItem","TableCellSelect","isRadio","_setDisabled","_setHidden","hider","applyTo","TableHeader","selectable","selectionType","headerActions","hideHiddenSelectable","col","selection","selectionData","hideSelection","TableRow","routeSource","requiresModel","parentIdDataPath","repeatPrimaryMobileCols","ignoreViewportChange","editFirstWhenSelected","expandDisabled","selectionClass","leftClass","highlightRowOnFocus","setPrimaryMobileColumnsIfMobileViewport","changed","editFirst","fireSetSelectionEvent","itemToEdit","edit","bundleId","constrained","defaultHidden","hasDeleteAction","selectionContainer","selectionDisabled","tableRow","isGrouper","rowDiv","setGrouperToggle","_toggleGroupHandler","toggleGroupHandler","expected","expand","eventTarget","isExpanded","setGrouperClasses","_configurationRequired","added","signalOnFocus","Tabs","tabs","pageComponent","pageData","commonData","selectedTabIndex","selectedPageIndex","tabsClass","usePagination","paginationClass","tabLimit","rendered","overflowTab","overflowTabClass","overflowTabMenuClass","menuMaskClass","bindingData","hideTabs","pageElements","_enforceValidTabSelected","_buildTabs","paperTabs","pages","_initTemplateData","_buildPages","templateBindData","_bind","tab","page","elem","CaseMap","camelToDashCase","attr","appendBindData","_addComplexObserverEffect","requiresTemplateBindData","selectedTab","tabLength","_displayOverflowTabName","getElementsByTagName","pageIndex","isMenuItemSelected","selectedPage","isInteger","_deselectPreviouslySelectedTab","iconId","iconSpan","closeMenu","firedEventName","tabToDisplay","pagination","tabClassName","tabIndex","hideIcon","overflowIconSpan","className","fireTabSelected","overflowTabMenu","_handleOverFlow","dashKey","dashBind","TableLayoutBuilder","parentElWidth","hasSelection","layout","availableWidth","_getAvailableWidth","totalWidth","numOfCols","widthPerCol","imageCols","colWidth","_getMultiplier","totalColsWidth","diff","numberOfColsDivisor","totalAdjustedWidth","isImageColumn","adjustedWidth","_getStaticColsWidth","labelMultiplier","padding","_getImageWidth","max","hasInvalidWidth","_warnInvalidWidthParameter","imageFunctionStartIndex","_getImageFunctionStart","imageFunctionEndIndex","_getImageFunctionEnd","imageFunction","calculatedFormula","_getWidthFromImageFunctionArgs","headerWidth","formula","numOpenParenthesis","numClosedParenthesis","firstLastClassSuffix","typeByColumnMap","allColumnClasses","classMap","_appendTypeClass","_appendFirstAndLastColumnClasses","_appendAllColumnClasses","_addWidthStyles","prevNumeric","isNumeric","_isNumericType","isBoolean","_isBooleanType","_appendClass","firstInnerClass","lastInnerClass","secondInnerClass","column","columnClass","typeAndWidth","_setWidthStyle","classToAppend","existingClass","Checkbox","focusOnAttached","applyFocus","focus","checkbox","Datepicker","selectedDate","isBlank","range","getLocaleData","isActive","weeks","weekDays","calendars","gregory","days","short","months","long","year","getFullYear","month","getMonth","monthName","day","parseDateTimePattern","dateFormatted","initialized","_selectedDateChanged","dateObj","updateVariables","toLocaleDateString","ensureProperYearInSelectedAndShowCalendar","haveEnsured","_showCalendar","years","yearsCreated","_createOptionElements","yearSelection","selectedOptions","select","optionEl","updateCalendar","datePicker","updateYearPicklist","text","selectedYear","hideCalendar","increment","firstDay","getDay","numOfDays","week","dayIdx","dateTimeFormat","formats","dateFormats","yMd","dateTimeFormatSimple","separator","dateTimeElements","dateIdx","monthIdx","yearIdx","noblur","dateString","dateInput","emptyDate","localeDate","getLocaleDate","dateChanged","monthEnd","hasSelectedDate","invalidInput","selectDay","validateInput","escaped","updateDate","showCalendar","highlight","setSelectionRange","Discount","discountDetails","unitChanged","numberParser","formatter","displayValue","original","setDiscountValue","deferBlur","tabBlur","discountUnits","convertDiscountValue","blurred","tabBlurred","blurDiscount","isInput","resetToOriginal","blurDirection","shiftKey","directBlur","_blur","oldValue","unitValue","selectUnit","unit","selectedIndex","FieldFactory","KEY_READ_ONLY","BLUR_READ_ONLY","CHANGE","HIDE_FIELD","REF_DISPLAY","APPLY_FOCUS","Field","refObjects","_wasEverEditable","objAndRefObjects","objKey","refObjectsKey","refTable","originalFormattedValue","hideFormattedValue","preventNumericAlignment","handleRowFocusSignal","isInternalObject","isReadOnly","updateTemplateData","_render","ff","createBaseElement","onChange","onKeyupReadOnly","onBlurReadOnly","formField","getFormField","originalValue","getFormattedValue","_onChange","getEventTarget","isNumericType","getType","toISOString","fireCustomChangeEvents","fireControllingSelectChangeEvent","CustomEvent","keepNewValue","setPreviouslyFormattedValue","previouslyFormatted","isLookup","enableSignals","defaultValue","addFormattedValueClasses","numeric","setFormattedDetails","attachTo","isEditable","selectOptions","getSelectOptions","referenceDetails","refDisplayName","factory","newFormField","formatted","isBool","isEmpty","disable","enable","toggleRowFocus","attached","referenceTable","clickEdit","_nodes","invertValueIfInlineBoolean","signalRowFocus","ex","returnTrueIfEverEditable","controllerSelectHandler","sameRecord","equals","valueCleared","buildSelectOptions","_selectOptions","clearInvalidValue","getValue","clearValueIfNotAnOption","clearValue","setValue","Input","inputType","showClear","_hideClearIfEmpty","fireChangeOnBlur","newValue","changeOnNextBlur","fireChangeEvent","LookupQueryBuilder","Lookup","limit","labelName","selectedLabel","lookupCallback","lookupResultsCallback","hideInputAndShowPill","hideCancelIcon","inDialog","blurDisabled","focusDisabled","tableLabel","placeholder","searchText","showSearchIcon","fieldFullName","hasFilter","currentRecordFilters","deferredLookupQuery","setTableLabel","typeahead","handleEnterPressed","initCurrentRecordFilters","setCurrentRecordFilters","disableFilterAndWarnNoOAuth","labelPlural","customCallback","queryLookupResults","queryBuilder","q","apiVersionString","search","__md__","clearAfterSelection","noFocusAfterSelection","tableParts","tableLabelPartIndex","searchLabel","handleSearchResults","totalSize","disableFilterAndWarnCurrentRecordFiltersNotSupported","_setLabel","setSelectedItem","getLabel","selectedItem","setHideInputAndShowPill","_handleSelectedItemChanged","handleSelectedItemChanged","applySearchValue","fireLookupValueChanged","querySearchResults","forceSuggest","labelsByValue","setOriginalSelected","suggest","deletePill","previousBlurDisabled","buildSearchText","_clearAndSave","clearAndSave","_applySearchValue","filterItems","lookupFilter","filterItemsArray","valueField","lookupFieldTable","currentRecordFilterWarning","oauthWarning","currentRecordFiltersKeys","LookupDialog","fieldLabel","numResults","openSpinner","recordSpinner","hideCancel","cancel","setValues","processSearchLayoutFields","getMetadataNoOAuth","fs","processCPQLayoutFields","processListFields","updateLookup","setResultsHeight","dialogOpened","hasList","labelValue","itemLabel","syncSelection","deferredClose","dialogClosed","reset","clearSelected","destroyGroup","getSelectedLabelValueById","getMetadata","initMobileMetadata","lookupFields","getCpqLookupFields","warnUserAboutCPQLayoutFieldSet","sr","searchLayouts","searchResultsAdditionalFields","searchResults","getSearchResultsAdditionalFields","ensureNameField","fieldTypeByName","fieldTypeObjByName","fieldTypeByLabel","fieldsOfTypeLookup","plus","min","getResults","overflow","isMobileWithSpotlight","mobileSpotlight","offsetBottom","offsetTop","documentElement","clientHeight","scrollHeight","mask","marginLeft","df","displayedFields","displayedField","dbFieldName","dbParts","dbPart","charAt","setSelected","saveAndDeferredClose","MultiLookup","iconName","selectedItems","customCallBack","_addItem","_animateDuplicate","unshift","pills","selectedContainer","dataValue","lookupContainer","resultsTable","Pagination","pageSize","firePageEvent","numPages","pageWindow","nextDisabled","previousDisabled","pageNum","RichTextEditor","Select","isRequired","noneLabel","multiSelect","_multiple","_options","noneSelected","_getValues","getValues","Textarea","textarea","wildCards","Typeahead","itemsCallback","debounceDelay","itemsList","delimiter","savedLabelValue","invalidLabel","hasLabel","optionIndex","revertOnEscape","calculateListPosition","showListNoSuggestion","showListOnFocus","hideInput","observers","_directInputFocus","_directInputBlur","updateItemsList","valueAttr","originalSelected","numOfOptions","numOfLabels","updateItem","hideList","forceSuggestOnFocus","clearSelection","focusOrBlurAfterSelection","highlighted","numOfItems","cloneItem","noBlur","selectAdjacentItem","showList","preventBlur","focusing","_showListOnFocus","force","leftOffset","COMPLETED","FAILED","ABORTED","JobChecker","asyncNumList","firstStatusTime","lastStatusTime","_setLoadingSpinner","_checkStatus","_useSpinner","Status","_isFinished","_getStatusMessages","asyncNum","async","_ping","cancelAsync","waitTime","_isFailure","FieldMetadata","doNotFixObjectName","fieldSplit","buildFieldList","LineEditorCacheSaver","LineEditorReader","quoteId","SearchModelLoader","processId","SearchModelSelector","selectedProducts","selectedProductList","targetGroupKey","quoteProcess","useCache","selectionArray","DiscountScheduleDialog","dialogTapped","discountUnitField","_calculateDiscountAmounts","discountTiers","buildRowData","_handleDialogTap","_handleDialogMouseEvents","currencyCode","fieldSetName","loadDiscountScheduleService","_setConstants","overrideBehaviorField","savedTiers","usePriceForAmountField","_setDSFields","showRevertBtn","originalScheduleField","tierModels","buildTiers","buildFieldData","_createActions","_toggleEditableClasses","_buildTabData","newScheduleId","discountScheduleResponse","discountScheduleField","segmentKeyField","changedRecord","discountTierRecords","_retrieveRecords","previousLowerBound","lowerBoundField","fieldsMD","fieldTableData","fieldsArray","discountScheduleModalFieldNames","tierField","priceLabel","lbl_price","prefixedFieldsByFields","discountAmountField","prefixedFieldsArray","_isFieldShown","fieldMD","numberField","_retrieveSchedule","_createBlankTierRecord","tierModel","_createRowActions","_renumberLines","_selectCheckboxes","_processForSaving","userDefinedField","quoteLineField","discountScheduleJSON","tiersJSON","ignoreValidate","discountScheduleUpdaterService","discountScheduleClonerService","dialogOverlapping","discountScheduleId","hiddenTiers","_sortTiers","visibleTiers","_updateActions","_createTiers","validator","validate","tiersField","discountRateField","quantityField","specialPriceField","upperBoundField","errorsArray","rowNumber","currentQuantity","userDefined","lastPositionIndex","lowestBound","highestBound","_retrieveVisibleRecords","disabledDiscountTier","specialPrice","behavior","lowerBoundList","tiersByLowerBound","sortedTiers","msg_identical_lower_bounds","isoCodes","currencyIsoCodes","isoCode","_createMultiCurrencyRecord","_toggleDialogClasses","applyClasses","sbDialog","fieldsEditable","AccountId","tId","GHOST_X_OFFSET","GHOST_Y_OFFSET","visibilityHidden","CustomSegmentDialog","dataLineModels","lineModels","deletedLineKeys","headerSelected","targetRowElement","dragDrop","segmentRows","onTrack","lineModelByStartDate","currentLineModel","newLineModel","startDates","_buildDialog","resetData","errorResponse","_onAddByIndex","toggleMenu","segmentGroup","newRows","click","_onDeleteLineData","_resetProperties","_validateCustomSegmentLabels","_validateCustomSegmentDates","hasInvalidSegmentDates","msg_invalid_custom_segment_dates","hasInvalidSegmentLabels","msg_invalid_custom_segment_labels","hasNonConsecutiveDates","msg_nonsequential_custom_segment_dates","hasOverlappingSegments","msg_overlapping_custom_segment_dates","updateSegmentMap","_getCustomSegmentUpdates","updatedLineKeys","endDates","segmentLabels","UpdateCustomSegmentsService","_buildFieldsMD","_toggleAllCheckBoxes","_buildRowData","_buildHeaderActions","quoteLineMD","fieldsLength","rightAction","addAction","lbl_add_segment","deleteAction","lbl_delete_custom_segments","dataMap","lineModelsLength","_updateData","updates","customSegmentLabels","segment","segmentStartDate","segmentEndDate","segStartDate","segEndDate","hasInvalidDateFormat","prevSegment","dayAfterEndDate","allowsNonConsecutiveCustomSegments","FavoriteDialog","favoriteKeys","numGroupLines","PricebookDialog","pricebooks","selectedPricebook","pricebookLoaderService","pricebookSaverService","CSETableCell","render","tableCols","quoteLineFieldsMD","CustomAction","actionHidden","button","span","horizontalAlign","horizontalOffset","verticalOffset","_toggleButton","showAction","hasMenu","menuButton","_setButtonClassAndLabel","buttonClass","groupAction","menuClass","DSTableCell","handleOriginalValues","DSTiers","FieldSetTable","fieldsObject","quoteObjectName","quoteFieldNames","FieldSetTableItem","datepickerHeight","offsetHeight","datepickerWidth","windowHeight","innerHeight","windowWidth","distanceFromBottom","distanceFromRight","_updateLookupDisplayValue","addRelationshipName","LEFooter","quoteTotal","quoteTotalMd","_setTotalWidth","lineEditorTotalsField","_setQuoteTotal","showQuoteTotal","total","totalsField","applyAdditionalDiscountLast","customerTotal","netTotal","LEGroup","subtotal","subtotalMd","descriptionMd","groupLevelTabs","favorited","_updateTableProperties","_updatePageData","_setIsButton","buildGroupTabs","isButton","groupHasStandardProducts","_groupHasStandardProducts","groupHasSegmentedProducts","_groupHasSegmentedProducts","groupedAndHasNoLineItems","_groupHasLineItems","groupHasBothProducts","_groupHasBothProducts","_showSubtotal","_setGroupDescription","localizedDimensionNames","iconClass","iconEvent","groupMDQTabs","groupModelKey","_getDescriptionMd","groupObjMd","lineEditorGroupSubtotalsField","_getSubtotal","showSubtotal","subtotalField","namesForGroupLayout","_renderTabs","tabName","sourceIndex","upgradeIndex","sourceLineVO","upgradeLineVO","_notifyQuantityChanged","index1","index2","invalidQuantityCheck","validQuantityCheck","internalUpdate","removeDimensionProperties","_onTrack","dragElement","dragLineModel","dragGroupModel","dragKey","dragIndex","dd","_updateMDQTableRowHoverOverObject","dropElement","dropElementBefore","dropKey","dropIndex","dropGroupModel","dropLeGroup","dropSegLinesTable","_updateSegmentedSubscriptionScopeEditable","_getFields","addSegmentedLineToEmptyTable","dropGroupId","groupContainer","addSegmentedLineToExistingTab","removeSegmentedLine","LEGroupLayout","noHeader","layoutLink","layoutWidth","layoutLeft","drawerState","lastSelectedGroup","_resize","_buildLayout","splicedRecords","indexSplices","addedCount","addedIndex","addedKey","observersAttached","_attachObservers","closePanel","openPanel","drawerPanel","mainPanel","paddingLeft","multiDeleteEnabled","hasLines","_getMaxTableWidth","colWidths","_calculateColWidths","getElementById","clientWidth","tableLayoutBuilder","_getQuoteStandardFields","getTotalWidth","multiSegmentFieldNames","_getQuoteSegmentedFields","_getGroupStandardFields","getLeftOffset","_getSegmentedFieldNames","subsScope","_getStandardFields","multiSegmentSummaryFieldNames","multiSegmentLineSummaryFieldNames","colNames","summaryFields","_observeNodes","removedNodes","processNewGroups","processRemovedGroups","toggleSelectedAndScroll","unobserveNodes","groupElement","_scrollIntoView","scrollIntoView","scrollTop","groupLayout","sbDroppableSidePanelGroups","_findSidePanelGroupValidTarget","sideGrp","LESummaryRow","DiscountConverter","isAdditionalDiscountField","_pullValueFromModel","_determineUnitAndDisplayValue","_displayValue","units","additionalDiscountUnitOptions","activeUnits","nextActiveUnitValue","_getFirstActiveUnitValue","targetCustomerAmount","targetCustomerTotal","defaultAdditionalDiscountUnit","markupUnitOptions","defaultMarkupUnit","setAdditionalDiscountValues","unproratedDiscount","amountDiscountProrated","setMarkupValues","previousDisplayValue","changeAdditionalDiscountUnit","price","nullifyAll","amountMultiplier","effectiveQuantity","changeMarkupUnit","cost","markup","rawDiscount","modifier","quantity","priorQuantity","actualQuantity","Swiper","QuoteLineUpgradeHandler","ICON_CLASS","TOP_LEVEL_CLASS","OPTION_CLASS","INDENT_CLASS","LETableCell","fieldClass","detailsOnHover","wasModelIsChangedCalledBeforeAttached","_modelIsChanged","quoteLineUpgradeHandler","getSourceLineVO","getUpgradeLineVO","_quantityChanged","assetUpgradeQuantityCalculator","_setEditable","_setFieldMD","_setFieldClassAndFieldContent","dependentPicklist","_transient_","originalRecord","userChangedLookupValue","_updateRelationshipName","productQuantityScale","assign","productHierarchyVisualized","overrideValue","setQuantitiesByRatio","indexes","getIndexes","lineModelKeys","lineModelKeysLength","_getLineModel","productLocalization","productFieldLocalization","sourceOrUpgradeLineVO","_findLineWithTargetAssetId","seekExistingLine","targetAssetId","key2","didUserChangeSourceLine","SWIPE_DISTANCE","OPEN_DISTANCE","SWIPE_MARGIN","swiping","primaryCells","leTableRow","classFollows","pcLength","LETableHeader","fieldLabelsMap","fieldClasses","fieldsRenderedAsNumber","columnNames","columnName","isStandard","expansionIconClass","LETableHeaderCell","showSortableHeader","overflowTrue","headerCell","headerNode","bundlesVisualized","newSort","_getKeyByValue","order","LETableRow","mobileCols","isDesktopAndHasNoActionsOnTheLeft","isDesktopAndHasActionsOnTheLeft","mdqFields","showCheckbox","isFieldRendered","totalsByColumns","invalidPricebookEntry","validPricebookEntryExists","opportunityWarning","opportunityLineItemExists","invalidEntryWarning","widths","evt","_visibilityChanged","_editabilityChanged","handleListPriceEditability","enableEditableFields","toggleLineExpansion","editableMap","mobileDrawerOpened","SegmentedDetailRow","segmentModel","detailFieldNames","firstIndex","lastIndex","segmentNumber","_pathRefersToMySegmentRecord","segmentRecord","referencedSegmentVO","referencedKey","referencedIndex","referencedLabel","mySegmentKey","mySegmentIndex","mySegmentLabel","LEFieldMD","unitPriceFields","quantityFields","objName","SegmentedLineDetails","detailFieldNamesWithLabel","labelColWidth","fieldNamesColWidth","totalColWidth","LineEditor","quoteLevelTabs","pageLoaded","mdObjects","customActionName","hasPermission","needsInit","cmd","customActionServices","_updateFieldLabelsMap","_handleGroupCustomActions","_getGroupModels","hasQuoteFieldSet","_executeCmd","_handleMissingPricebook","_executeDefaultCustomAction","groupCustomActions","retUrl","userType","pricebookDialog","localizedDimensions","localizedSegments","invisibleIdx","quoteActions","_executeCustomAction","namesForQuoteLayout","buildUngroupedSegmentedTabs","ungroupedMDQTabs","quoteMDQTabs","groupedQuoteHasNoGroups","ungroupedQuoteHasNoLines","shouldNotify","inVFPage","beginPrecaching","onLoad","fieldNamesByObjectNames","numOfFields","ln","lineEditorSubtotalsField","o","cseDialog","segmentsArray","standardPrimaryMobileColsLength","segmentedPrimaryMobileColsLength","isMobileRendered","isDesktopRendered","serviceType","productAlertModal","continueCB","runnerFactory","scheduleMap","extractScheduleMapFromQuote","volumeDiscountField","termDiscountField","productField","vId","cId","costScheduleId","determineMetadataFullNames","mdResults","objectPrefix","lineType","quoteType","groupType","typeName","optionIds","getOptionIdsFromLines","uniquenessMap","loadPriceRules","ruleRecords","loadSummaryVariables","svRecords","loadAssetsAndSubscriptions","assetAndSubRecs","neededIds","getSummaryVariableIds","svContext","recordPrefix","filterVarField","testedVarField","sourceVarField","condRelationship","actionRelationship","svIds","condIdCollector","condRecord","actionIdCollector","rule","targetObjectField","filterField","constraintField","aggregateField","assetFields","subscriptionFields","svId","svRec","productIds","getProductIdsFromLines","pricebookFilter","currencyFilter","sweepModelsForLookupIds","models","targetType","convertedId","queryInfo","SegmentedLines","quoteLineFields","currencyMd","_onSortLinesByHeader","isCurrentDimension","spliceChanges","removed","linkPaths","headerColumnNames","netMultiSegmentTotalField","_setSubtotalColumnWidth","subtotalColWidth","_getPriceScale","_getNetTotalFieldMd","lineSortRelationshipField","StandardLines","_setFieldNames","lastColWidth","reduce","prev","curr","dragKeys","dragStandardIndexes","dragMdqIndexesByDim","dragLineModels","_getBundleWithChildren","lm","_getLineIndexFromKey","dragTargetElementIndex","_updateTableRowHoverOverObject","dragLeGroup","indH","_updateStandardSubscriptionScopeEditable","segmentType","mdqLm","keyArray","_getStandardLineIndexFromKey","changeRecord","ProductViewModel","ProductMessenger","extender","_initializeProduct","configuredProductId","configuration","lineItemId","lineItemKey","configurationAttributes","_createConfigAttributesMap","optionConfigurations","_createFeatureOptionsMap","configurationData","_appendReadOnlyProperties","clones","_cloneProduct","_extendResponseQuote","_extendResponseProduct","_extendResponseProducts","optionNotifications","_getResponseOptionPaths","config","_getMatchingQuoteLine","featuresMap","featureName","_createPseudoOptionConfiguration","optionConfiguration","pseudoOptionConfig","optionId","ProductCode","ProductName","Quantity","responseQuote","_sanitizeObject","responseProduct","productKey","_extendResponseConfigurationData","_extendResponseConfigurationAttributes","_extendResponseOptionConfigurations","responseConfigurationData","externalConfigurationData","responseConfigurationAttributes","responseOptionConfigurations","parentProductKey","responseOptionConfigurationsByOptionId","featureOptionConfigurations","sourceOption","responseProducts","_resetFeatureOptionConfiguration","_buildProductKey","_enableSaveToLineEditor","productId","ConfiguratorSearch","featureInput","allFiltered","numOptions","hasFilterValues","hiddenByRule","configAttributes","configAttributesByFeatureId","configAttr","filtered","isUpgrade","searchKeys","fId","featureLookupId","optionsById","optionIndexById","optionsByFeatureId","featuresWithOptionsOrConfigAttr","featureIdsWithOptionsOrConfigAttr","featureIdsWithSelectionMethodAdd","featureIdsWithSelectionMethodClick","featureIdsWIthSelectionMethodDynamic","configurationAttributeValueMap","configurationAttributeModelMap","configurationAttributeTargetFieldMap","configurationAttributeApplyToOptionMap","optionActionsByOptionId","attributeValueMap","productRulesActions","originalDataByOptionIds","optionDataByOptionIds","featureIdByOptionId","productOptionConfigurationsMap","initializeProduct","featureId","find","isOptionLookupViewModel","dummy","getFeature","optionSelectionMethod","maxOptions","isClick","attribute","optionLayout","featureCategoryLabels","featuresWithoutCategory","tabFeaturesMap","featuresLength","featureCategories","featureCategory","category","appliedImmediately","getOption","localizeProduct","featureLabel","initConfigAttributesById","initConfigurationAttributeMap","initOptionInfo","buildOptionConfigurationMap","getOptionSelectionMethod","initFeatureOptionConfigurations","configuredOption","visibleSelected","opt","setOptionDisabledData","quantityLabel","minQuantityLabel","recordSelected","recordRequired","unitPrice","setConfigurationAttributesToOptions","valueChanged","mappedFeaturelessOptions","createOtherOptionsFeature","virtualFeatureTitle","recordHasQuantity","addToOptionByFeatureId","discountAmount","discountRate","addOptionButtonLabel","addOptionDialogTitle","instructionsText","duplicate","displayRadio","notInitialized","isDynamic","unsortedOptionConfigs","initOptionActions","initReconfiguredOption","sortAndAddOptionConfigs","getProductOptionConfigurationData","isNotClick","mobileDisabled","numAttributes","featureless","configurationAttributeValue","myId","autoSelect","shownValues","hiddenValues","ids","applyToProductOptions","configsArray","requiredOptionAdded","clonedOption","productOption","setOptionProductConfigurationData","setOptionConfigurations","optionData","containsUpgrades","unsorted","optionConfig","constraintsByConstrained","optionConstraintsByConstrained","createConstraintHoverMessage","constraint","constraintMessage","ungroupedConstraints","ungrouped","constraining","groupName","statement","groupedOption","Requires","requirement","Excludes","exclusion","flatten","flat","cats","level","indent","kids","TILE","ProductSearch","categories","flatcats","searchcats","searchContext","showTiles","_loadCategoryMenu","_loadProducts","categoryId","cat","code","desc","OptionUpgradeHandler","priorBundledQuantity","sourceOp","upgradeOp","upgradeOption","sourceProductIds","didUserChangeSourceOption","upgradedAssetId","OptionConstraintsHandler","setOptionConstraints","constraints","constraintType","constrainedOption","constrainingOption","constraintGroup","byConstraining","byConstrained","constrainedId","constrainingId","optionConstraints","changedOptionId","addedOrSelected","disabledState","optionIsConstrained","hasGroupConstraints","constraintObj","isConstrainedByUngrouped","isConstrainedByGrouped","getUnaffectedDisabledState","requiredConditionMet","excludedConstrained","requiredConstrained","associatedOption","associatedType","constrainedByDependency","constrainedByExclusion","constrainedWithinGroup","len2","priorOptionExists","optId","isDependency","hasUngroupedConstraints","hasGroupedConstraints","NestedOptionsModel","ProductReconfigurer","nestedOptionModel","buildOptionConfiguration","isDynamicOption","optionConfigs","segmentedMap","isSegmented","buildStrippedOptionData","productConfiguration","newConfiguration","RuleProcessor","validationMessages","initValidationMessages","initProductRulesActions","initOptionDataByOptionIds","configuredProducts","selectedOptionIds","disabledOptionIds","hiddenOptionIds","deselectOptions","showOptions","hideOptions","enableOptions","disableOptions","serverOption","disabledOption","hiddenOption","assignProductRules","optionNotInPricebook","handleProductActions","listPrice","positiveAction","negativeAction","systemLabel","rulesProcessed","selectedByRule","indices","parentInfo","childInfo","handleDescendantRules","ProductAlert","_onCancel","ConfigTree","idProperties","buildSubtree","_buildNode","getChildren","child","currentLevel","_findOnLevel","nodeId","_buildId","AssetLookup","preLoadObjects","qo","smLoadService","primaryMobileColumn","searcher","togglePanel","lookupLayout","deSelectAll","navigateToAssetUpgradeRoute","pIds","af","runService","runSearcher","filterData","clearFields","assetLookupObjects","AssetUpgrade","upgrades","upgradeSourceMap","upgradeTargetMap","assetHeaderSelectable","initializeServiceSpinners","initializeProperties","handleUpgradeSelected","handleAddProductResponse","handleLineEditorModelResponse","handleSelectionResponse","addProducts","smSelectService","getSelectedUpgrades","upgradeSelected","availableUpgrades","upgradeTarget","upgradeProduct2Id","sourceProducts","sourceProductObject","upgradeResults","navigateToLineEditor","selectedUpgrades","getUpgrades","addProductsArray","targetProduct","sourceProductId","sourceProduct","ifRadioSelectedClearOtherRadioSelections","handleConfigurableProducts","configProductIds","getConfigProductIds","pId","getSelectedProducts","assetUpgradeObjects","availableUpgrade","FormField","CheckboxFactory","addAttribute","SimpleFieldFactory","InputFactory","DatePickerFactory","newFormattedDate","newMobileDatePicker","newDatePicker","readOnlyKeyEvent","readOnlyBlurEvent","changeEvent","setFormattedValue","formattedDate","DiscountFactory","pattern","numberFormatter","getDiscountUnit","NumericFieldFactory","LookupFactory","SelectFactory","TextFieldFactory","FRONT_BINDING","BACK_BINDING","events","binding","variable","readOnlyKeyHandler","readOnlyBlurHandler","changeHandler","hiddenField","_html","_formattedValue","_defaultValue","_readOnlyKeyEvent","_readOnlyBlurEvent","_changeEvent","_numeric","inputClass","formattedValueAllowCurrency","TextareaFactory","RichTextEditorFactory","maxLength","newInput","newReferenceLink","newLookup","filteredLookupInfo","setInnerText","addEvent","origin","lastIndexOf","refObj","refType","nameProp","extractRefDisplay","NAME_MAP","Contract","Case","searchField","lookupFieldFullName","resultsLimit","currentRecordFields","currentRecord","applyMruOptimization","selectFields","_buildFields","searchCriteria","noWildcardSearchValue","scope","getScope","scopeClause","orderByClause","currentRecordField","omitField","getBindValue","searchValueLength","relationships","lookupField","inline","font_formats","forced_root_block","menubar","toolbar1","toolbar2","plugins","FONTS","baseURL","sheets","head","editors","editor","setContent","getContent","_initialize","newRichTextEditor","useNoneLabel","newSelectList","restrictedPicklist","precision","newTextarea","LESummaryCell","lc","GroupTabs","isGroupFieldPage","isSegmentedLinesPage","isStandardLinesPage","pageType","QuoteTabs","isQuoteFieldPage","isGroupsPage","handleResize","resize","segmentedTabs","tabHeight","layoutHeight","API_FIELD_NAME_MAP","CustomActions","isClassic","productIndex","firstItem","remainingItems","customActionsExist","moreThanOneCustomActionsExist","buttonsCollapsed","launchExternalName","showExternalAction","urlKey","labelKey","targetKey","labelUrlMap","checkCustomActionsConditionsMet","targetItem","handlePopup","handleNav","conditionsKey","fieldKey","operatorKey","filterValueKey","some","AttributeItem","attributeMD","isValidValue","attributeField","targetField","getPicklistValues","defaultValues","attributeFieldMD","attributeItem","AttributeTable","addedClass","showTable","optionFieldMetadata","setMD","attributeFields","attributeModelData","featureAttributes","featureAttributesByFieldName","targetAttribute","processed","featureAttributeIds","columnOrder","normalizeData","bundleAttributes","bundleAttribute","featureAttribute","overridePropagateFromParentToChild","captureCallBack","setFromChildToParentExtension","attributeId","elementId","ProductBundlesFilterItem","ProductBundlesLayout","setToSections","hasSelected","hasMultipleBundles","searchValuesByFilter","searchFieldMD","configSearch","handlePanelSlide","handlePanelEvents","handleMD","applyFilters","selectBundle","numBundles","getProductId","toggleTransition","configuredProductIndex","sfSidebar","_setBundleContainerWidth","navWidth","buildPanelIfMultipleBundesAndNotMobile","targetId","panelWidth","isDrawerOpen","bundleContainer","_transition","underscorePrefix","clearPrevious","removeAllSelected","navItem","numConfiguredProducts","ProductFeature","fieldSetKey","tabNames","hasConfigAttributes","mobileHasConfigAttributes","hasOptions","mobileHasOptions","hasOptionsAndConfigAttributes","mobileHasOptionsAndConfigAttributes","hasInstructions","mobileHasInstructions","hasSelectedOptions","featureIndex","hasUpgradeOptions","mobileRendering","mobileExpanded","getHasUpgradeOptions","setFeatureAndOptionSelectionMethod","setOptionsDetails","setFieldSetHandler","renderFeatureInDesktopOrMobileView","initSelectedOptions","handleDeleteOptions","handleOptionChangedByRule","optionsTab","attributesTab","optionFieldSets","isClickSelection","configurationFieldSet","setFieldSetFromViewport","additionalInstructions","featureOptions","getOptionsByFeatureId","containsFeature","ProductFeatureCategoryList","categoryNamesOrFeatures","hasCategories","checkAtLeastOneFeatureHasCategory","getTabFeaturesMap","categoryName","ProductFeatureLayout","vp","hasFeaturelessConfigAttributes","isMobileAndHasConfigAttributes","isSectionLayout","isPaginationRequired","tabsForFeatureLayout","tabsForTabsAndWizardLayout","optionConstraintsHandler","disabledStateMap","listenersAttached","featurelessConfigAttributes","getOptionLayout","buildFeatureLayoutTabs","handleOptionSelectionChanged","buildTabsAndWizardLayoutTabs","featuresTab","featureKeys","handleOptionConstraints","hasSameOptionAdded","fireSelectionStatesForAddFeatures","disabledStateChanges","change","optionSystemOrRequired","optionShouldBeDisabled","handleShownAndHiddenOptions","hideOption","checkVisibleOptions","featureContainsOneVisibleOptions","featureContainsNoVisibleOptions","findIndex","visibleOptions","noVisibleOptions","_setConfigAttributes","createConstraintsHoverMessages","ProductFeatureList","handleTabSelected","filterFeatureHandler","numFeatures","filterFeatureByIndex","filterFeatureById","setOptionVisibility","hasRequiredConfigAttributes","selectionMethod","allOptionsHiddenByRule","maxOptionsMet","hasVisibleOptions","nodes","renderComponent","renderingComponent","OptionCell","initQuantityCell","initUnitPriceCell","initCell","getFieldRecordValue","fieldDetails","hasDimension","mdqWarningIcon","getQuantityEditable","attachQuantityChangeCallback","getPriceEditable","quoteLineHasField","setDisplayIfRelationshipItem","attachValueChangedCallback","getBundleId","syncValueChangeWithOptionConfiguration","optionCell","ProductOptionTable","showAddOptionsButton","primaryMobileCol","showUpgradeOptions","upgradeOptionButtonText","handleSelectionChanged","handleMetadataChanged","handleDeleteOption","handleConfigureOption","_actionsProcessed","setOptionSelected","getOptionIndex","_displayAvailableRowActions","changedOption","priceRule","_handleOptionUpgrades","actionsHidden","fieldMetaData","initFieldMetadata","optionUpgradeHandler","assetUpgradeQauntityCalculator","getSourceOption","getUpgradeOption","sourceOptionIndex","upgradeOptionIndex","_notifyQuantityChange","mdItem","_isMobile","isQuantity","paths","optionShouldChange","changeOptionDisabled","newVal","deleteOption","_collections","delete","deleteMultiple","copy","sameOptionAdded","showOrHideAddOptionsButton","sameOption","entries","getTabIndex","optionalSKU","optionCount","configuredOptions","setUnaddedOptionsRulesActions","setDisplayedOptionsRulesActions","addedOptions","h","fireOptionChangedByRule","priceActions","_getPriceActions","priceAction","_calculateUnitPrice","getPrefix","upgradeOptions","DynamicLookup","redirectUrl","defaultFilters","refocus","handleDrawerClosed","_createQueryParams","featureOptionIds","productLoader","syncConfigurationAttributesToProduct","autoSelectAttributes","oId","productIdx","headerSubtitle","convertProductsToOptions","orgPrefix","filtersLoaded","valueObject","layoutFieldSet","productFieldSets","buildDelegator","dynamicFieldSet","panelHeader","pf","focusFirstField","clearfilter","lastSubmit","orderedSelectedProductIds","id1","id2","orderedSelectedProducts","selectedProductId","OptionLookup","topLevelBundle","currentProductModel","_handleLineEditorModelResponse","_handleProductLoadResponse","handleOptionConfiguratorResponse","_handleOptionSelection","_validateMaximumOptionsNotExceeded","_addSelected","_routeToConfig","lineEditorRead","productLoad","optionConfigure","processor","setCurrentProductModel","optionTable","displayDelete","_createConstraintsHoverMessages","_fireSelectionStatesForOtherFeatures","_toggleOptionSelection","_handleOptionConstraints","addedOption","previouslySelected","optionLookupObjects","ProductConfig","productSelectionModel","headerTitle","isMobileAndHasMultipleBundles","preventPreLoadObjects","handleProductLoadResponse","handleOptionSaveResponse","handleProductRulesInvokerResponse","handleCustomActionsCollapsed","handleOnAddOptionClick","handleBundlePanelClick","handleChangeEvents","handleBundleNameChange","handleExternalConfiguration","handleConfigureOptionEvent","optionSave","productRulesInvoke","handleProductConfigurationInitializer","returnToQuote","productAlerts","setOptionConfigurationDetails","loadedModelIsReconfigure","reconfigure","prod","getConfiguredOptionsFromPath","multipleBundlesView","getProductIndex","SearchFilters","filterMap","bundles","checkForExternalConfiguration","ruleProcessor","getValidationMessages","afterSaveNavigate","latestData","getLastFromPath","popFromPathAndGetNextSKU","initDescendantLevelRules","createPathParams","createQueryParams","configuredProductKey","currentProduct","getProductRulesActions","getOptionDataByOptionIds","changeAllActions","handleChangeEvent","isReconfigure","c_product","o_config","configurationAttributesValid","getConfigurationAttributeMissingFeaturesMessage","configuredProduct","prepareProductForServer","addedProducts","getConfiguredProductsToSave","getSelectedProductsToSave","productsToSave","configuredProductsById","productToSave","selectedProduct","externalKey","externalURL","externalConfiguratorUrl","visitedExternal","eventContext","getProductById","handleApplyImmediatelyProductRules","isAppliedImmediately","_updateProductConfigurationHiddenOptions","upgradeAssetId","optionIsHidden","optionWasHiddenIndex","optionWasHidden","applyImmediatelyContext","prepareProductForNestedConfigure","nested","currentIndex","addToPath","nestedProduct","hasDynamicFeature","descendLevel","configure","getCurrentLevel","applyImmediately","minimalProduct","getSelectedOptions","skipValidations","selectedOptionList","setUpgradedAssetId","buildOptionForLineEditor","getAllProductIds","requiredConfigAttributes","productConfigAttributes","requiredProductConfigAttributes","productConfigAttribute","requiredConfigurations","getRequiredConfigurationAttributes","missingAttributes","productConfigData","productRequiredConfigAttributes","requiredConfigurationAttributeValid","requiredAttributeMissingValue","featuresWithRequiredMissingAttributes","attrs","getFeatureNameFromId","featureNames","feat","toggleSearch","configuratorObjects","One","sbTwo","Three","Two","configTree","_setConfiguredOptionsObject","_getPreviousLevel","_appendSubtree","staged","optionsToAdd","_setConfigured","_removeSubtree","_removeConfiguration","configPath","configsToAdd","getFromPath","existingConfigs","existingConfig","configToAdd","sku","optionInfo","_buildPathString","_addConfigsToConfigurationObject","nestedConfig","existingObj","_addIndexProperty","childIndex","_getChildIndexAndAdjustIndices","childId","_alterIndexPropertyAndNodeId","prevId","includeLast","Suggester","filterContext","gsfields","inputs","processInputValues","evaluateProcessInputConditions","numPass","masterProcessInput","masterProcessInputValue","Ids","ProductLookup","modalActive","hasQuoteProcess","selectionSaver","panelSuggester","suggester","panelGroupItems","handleAutoSelect","setUsePagination","handleClearSelected","handleScrollEvent","handleSelectButtonClickedServerResponseAndNavigation","handlePaginationChanged","handleLabelChanged","selectionReader","runOnLoad","runSuggester","inputField","quoteProcessId","productResultsGroupFieldName","handleTransientCache","handleNonConfigurableProducts","navigateToSelf","updateSearchFilterData","modalGroup","gs","cleargs","saveCache","paginationBar","getOrderedSelectedProducts","actionIdQueryString","plSelectMore","lookupObjects","SubscriptionLookup","sf","subscriptionLookupObjects","OptionConfigurator","optionConfiguratorResponse","serverProduct","inheritedConfigurationAttributes","inheritedConfigurationData","OptionSaver","psmResponse","warningCallback","builder","ProductLoader","productLoadModel","ProductRulesInvoker","configResponse"],"mappings":"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","file":"sb_app_js.resource","sourcesContent":["import * as docgen from 'docgen/docgen.routes.js';\nimport * as quotes from 'quotes/quotes.routes.js';\nimport * as assets from 'assets/assets.routes.js';\nimport * as subscriptions from 'subscriptions/subscriptions.routes.js';\nimport * as products from 'products/products.routes.js';\nimport * as favorites from 'favorites/favorites.routes.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\nimport {Router} from 'common/core/sb-router/Router.js';\nimport {RichTextEditorDialog} from 'common/forms/sb-rte/dialog/RichTextEditorDialog.js';\n\n// import the \"bootstrap\" modules from all feature folders\n// they are here just so we don't have to explicitly call System.import() on individual modules.\nimport 'common/common.js';\nimport 'quotes/quotes.js';\nimport 'products/products.js';\nimport 'favorites/favorites.js';\nimport 'assets/assets.js';\nimport 'subscriptions/subscriptions.js';\n\nexport class App {\n\tstatic init( pageContainer, dbName, /*Obj*/ settingsObj, urls ) {\n\n\t\tlet r = {};\n\t\tr[docgen.PREFIX] = docgen.ROUTES;\n\t\tr[quotes.PREFIX] = quotes.ROUTES;\n\t\tr[products.PREFIX] = products.ROUTES;\n\t\tr[favorites.PREFIX] = favorites.ROUTES;\n\t\tr[assets.PREFIX] = assets.ROUTES;\n\t\tr[subscriptions.PREFIX] = subscriptions.ROUTES;\n\n\t\t// initialize app with all URL routes\n\t\tpageContainer.allRoutes = r;\n\n\t\tRichTextEditorDialog.setBaseUrl( urls.tinymce );\n\n\t\treturn Promise.all([\n\t\t\tAppContext.init( settingsObj ),\n\t\t\t// Db.adapter.open( dbName || 'sbcpq' ),\n\t\t\tApp._initIntlLocale( urls.intl, settingsObj.locale )\n\t\t]);\n\t}\n\n\t/**\n\t * Load the CLDR data for the user's locale.  We can't pre-load all locales - too many/too much data in memory.\n\t * We need this data for the Intl polyfill as well as other internal needs.\n\t *\n\t * @param url {String} the base url to the cldr data file (staticresource or bower)\n\t * @param locale {String} the user's locale (e.g. en-US)\n\t * @return {Promise} resolves with the json object when loaded\n\t */\n\tstatic _initIntlLocale( url, locale ) {\n\n\t\treturn new Promise( function( res, rej ) {\n\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\txhr.open( 'GET', url + '/locale-data/json/' + locale + '.json' );\n\n\t\t\txhr.onerror = function(e) {\n\t\t\t\trej( new Error( 'Cannot get locale data: ' + e ) );\n\t\t\t}\n\n\t\t\txhr.ontimeout = function(e) {\n\t\t\t\trej( new Error( 'Timeout for locale data' ) );\n\t\t\t}\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif( xhr.responseText ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet data = JSON.parse( xhr.responseText );\n\t\t\t\t\t\tI18n.addLocaleData( data );  // save for other components to use, e.g. DatePicker\n\t\t\t\t\t\tif( Intl && Intl.__addLocaleData ) {\n\t\t\t\t\t\t\tIntl.__addLocaleData( JSON.parse( xhr.responseText ) );  // have to parse again as Intl polyfill changes source locale object when added\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres( data );\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\trej( new Error( 'Cannot parse locale data' ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\trej( new Error( 'Cannot understand locale data: ' + xhr.statusText ) );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\txhr.send();\n\t\t});\n\t}\n}\n","// THIS FILE IS GENERATED.  DO NOT EDIT!!!!\nexport const LABELS = {\"Apply\":\"Apply\",\"Asset Selection\":\"Asset Selection\",\"Cancel\":\"Cancel\",\"Clear Fields\":\"Clear Fields\",\"Filter\":\"Filter\",\"Select\":\"Select\",\"numResults\":\"{0} Results\",\"Save\":\"Save\",\"Edit Description\":\"Edit Description\",\"Popup\":\"Popup\",\"Quote Template\":\"Quote Template\",\"Add Products\":\"Add Products\",\"Delete\":\"Delete\",\"Favorite Lookup\":\"Favorite Lookup\",\"Share\":\"Share\",\"Select & Add More\":\"Select & Add More\",\"Share Favorites\":\"Share Favorites\",\"showAvailableUpgrades\":\"This feature has products available for upgrade, click the Show Available Upgrades button at the bottom of the feature to select upgrade options.\",\"No visible options in feature\":\"No visible options in feature '{0}'\",\"Add Options\":\"Add Options\",\"Add\":\"Add\",\"Configure Products\":\"Configure Products\",\"Alert\":\"Alert\",\"Continue\":\"Continue\",\"Product Selection\":\"Product Selection\",\"Guided Selling\":\"Guided Selling\",\"Favorites\":\"Favorites\",\"Product Filter\":\"Product Filter\",\"Suggest\":\"Suggest\",\"Custom Segments\":\"Custom Segments\",\"Discount Schedule Editor\":\"Discount Schedule Editor\",\"Update\":\"Update\",\"Add to Favorites\":\"Add to Favorites\",\"Favorite Name\":\"Favorite Name\",\"Choose Price Book\":\"Choose Price Book\",\"Quote Total\":\"Quote Total\",\"Remove From Favorites\":\"Remove From Favorites\",\"Standard Products\":\"Standard Products\",\"Segmented Products\":\"Segmented Products\",\"Add To Favorite\":\"Add To Favorite\",\"Renew Subscriptions\":\"Renew Subscriptions\",\"Subtotal\":\"Subtotal\",\"emptyLinesMsg\":\"This group has no line items. Click on Add Products button or drag lines from other groups.\",\"mobileEmptyLinesMsg\":\"This group has no line items. Click on Add Products button to add a product.\",\"invalidPricebookEntry\":\"There is not a valid price book entry for this line item.\",\"missingOpportunityLineItem\":\"This product will not sync to the opportunity because a valid pricebook entry does not exist.\",\"Edit Quote\":\"Edit Quote\",\"emptyGroupedQuoteMsg\":\"This quote has no line items. Click on Add Group button to select products.\",\"emptyQuoteMsg\":\"This quote has no line items. Click on Add Products button to select products.\",\"Subscription Selection\":\"Subscription Selection\"};","export const settings = {developerPrefix:'SBQQ',isMultiCurrencyOrg:false,calculateImmediately:false,locale:'en-US',language:'en',defaultCurrency:'USD',currencySymbol:'',currencyDecimalScale:2,fullName:'Admin User',userName:'admin-user@steelbrick.com',userId:'0XXX1',device:'',isOAuth:true}","if (typeof window !== 'undefined' && window) {\n\twindow.SB = window.SB || {};\n\twindow.SB.ajax = require(\"./../calc/Utils/ApexUtils.js\");\n}","\"use strict\";\n\nSystem.register(\"assets/assets.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhc3NldHMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/asset';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-asset-lookup', mod: 'assets/selection/routes/sb-asset-lookup/AssetLookup.js'},\n\t'/upgrade': {comp: 'sb-asset-upgrade', mod: 'assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js'}\n};\n","/**\n * A collection of javascript utility functions\n */\nexport class Util {\n\t/**\n\t * Pad a number with left zeros\n\t * @param  {Integer} n     the numeric value\n\t * @param  {Integer} width the number of zeros to pad\n\t * @param  {String} z     the pad character, defaults to '0'\n\t * @return {String}       the padded number\n\t */\n\tstatic pad( n, width, z ) {\n\t\tz = z || '0';\n\t\tn = n + '';\n\t\treturn n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n\t}\n\n\t/**\n\t * Returns an \"ISO date string\" in RFC 3339 format\n\t * @param  {Number|Date} d the number of milliseconds from epoch or Date object\n\t * @return {String}   the RFC 3339 date string\n\t */\n\tstatic toIsoDate(d) {\n\t\td = typeof d === 'number' ? new Date(d) : d;\n\t\treturn d.getUTCFullYear() + '-'\n\t\t\t\t+ Util.pad( d.getUTCMonth()+1, 2 ) + '-'\n\t\t\t\t+ Util.pad( d.getUTCDate(), 2 ) + 'T'\n\t\t\t\t+ Util.pad( d.getUTCHours(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCMinutes(), 2 ) + ':'\n\t\t\t\t+ Util.pad( d.getUTCSeconds(), 2 ) + 'Z'\n\t}\n\n\tstatic notifyTopObjects(ctxComponent, object, strProp) {\n\t\tfor (let prop of Object.keys(object)) {\n\t\t\tctxComponent.notifyPath(strProp + '.' + prop, object[prop]);\n\t\t}\n\t}\n\n\tstatic arithmeticOperatorConversion(fieldValue, filterValue, operator) {\n\t\tif(typeof fieldValue === 'boolean') {\n\t\t\tif (filterValue.toLowerCase() === 'true') {\n\t\t\t\tfilterValue = true;\n\t\t\t} else if (filterValue.toLowerCase() === 'false') {\n\t\t\t\tfilterValue = false;\n\t\t\t}\n\t\t}\n\n\t\tswitch (operator) {\n\t\t\tcase 'equals':\n\t\t\t\tlet val = (fieldValue === filterValue);\n\t\t\t\treturn val;\n\t\t\tcase 'not equals':\n\t\t\t\treturn fieldValue != filterValue;\n\t\t\tcase 'less than':\n\t\t\t\treturn fieldValue < filterValue;\n\t\t\tcase 'less or equals':\n\t\t\t\treturn fieldValue <= filterValue;\n\t\t\tcase 'greater than':\n\t\t\t\treturn fieldValue > filterValue;\n\t\t\tcase 'greater or equals':\n\t\t\t\treturn fieldValue >= filterValue;\n\t\t\tcase 'starts with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().startsWith(filterValue.toLowerCase());\n\t\t\tcase 'ends with':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().endsWith(filterValue.toLowerCase());\n\t\t\tcase 'contains':\n\t\t\t\tfieldValue = fieldValue ? fieldValue : '';\n\t\t\t\treturn fieldValue.toLowerCase().includes(filterValue.toLowerCase());\n\t\t}\n\t}\n\t\n}\n\n/**\n * SF Aloha UI creates its own Map object in the global namespace and it is anywhere near standards compliant\n * This is a stupid hack that checks for their dumb implemenation and gets the real Map class if needed.\n */\nUtil.Map = Map;\nif( !Map || !Map.prototype.get || !Map.prototype.set ) {\n\tlet frame = document.createElement( 'iframe' );\n\tdocument.body.appendChild( frame );\n\tUtil.Map = frame.contentWindow.Map;\n\tframe.parentNode.removeChild( frame );\n}","// import common behaviors first\nimport 'common/behaviors/DeviceBehavior.js';\nimport 'common/behaviors/LookupBehavior.js';\n\n// these imports are rather dumb.  they are here just so we don't have to explicitly call System.import() on them.\nimport 'common/core/sb-i18n/I18n.js';\nimport 'common/core/sb-loading-spinner/LoadingSpinner.js'\nimport 'common/core/sb-page-container/PageContainer.js';\nimport 'common/core/sb-toast/Toast.js';\nimport 'common/core/sb-page-header/PageHeader.js';\nimport 'common/data/sb-service/Service.js';\nimport 'common/filter/searcher/Searcher.js';\nimport 'common/forms/sb-field/Field.js';\nimport 'common/forms/sb-typeahead/Typeahead.js';\nimport 'common/forms/sb-lookup/Lookup.js';\nimport 'common/forms/sb-lookup-dialog/LookupDialog.js';\nimport 'common/forms/sb-datepicker/Datepicker.js';\nimport 'common/forms/sb-discount/Discount.js';\nimport 'common/forms/sb-pagination/Pagination.js';\nimport 'common/forms/sb-rte/dialog/RichTextEditorDialog.js';\nimport 'common/forms/sb-rte/RichTextEditor.js';\nimport 'common/layout/sb-actions/Actions.js';\nimport 'common/forms/sb-input/Input.js';\nimport 'common/forms/sb-select/Select.js';\nimport 'common/forms/sb-textarea/Textarea.js';\nimport 'common/forms/sb-checkbox/Checkbox.js';\nimport 'common/forms/sb-multi-lookup/MultiLookup.js';\nimport 'common/layout/sb-div/Div.js';\nimport 'common/layout/sb-drawer/Drawer.js';\nimport 'common/layout/sb-field-item/FieldItem.js';\nimport 'common/layout/sb-field-table/FieldTable.js';\nimport 'common/layout/sb-group/Group.js';\nimport 'common/layout/sb-html/Html.js';\nimport 'common/layout/sb-side-panel/SidePanel.js';\nimport 'common/layout/sb-swipe-container/SwipeContainer.js';\nimport 'common/layout/sb-table-cell/TableCell.js';\nimport 'common/layout/sb-table-cell-select/TableCellSelect.js';\nimport 'common/layout/sb-table-header/TableHeader.js';\nimport 'common/layout/sb-table-row/TableRow.js';\nimport 'common/layout/sb-tabs/Tabs.js';\nimport 'common/layout/sb-badge/Badge.js';\nimport 'common/layout/sb-dialog/Dialog.js';\nimport 'common/layout/sb-popup/Popup.js';\nimport 'common/layout/sb-lookup-layout/LookupLayout.js';\nimport 'common/layout/sb-filter-layout/FilterLayout.js';\nimport 'common/layout/sb-filter-item/FilterItem.js';\nimport 'common/services/sb-line-editor-read/LineEditorReader.js';\nimport 'common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js';\nimport 'common/services/sb-job-checker/JobChecker.js';\nimport 'common/services/sb-field-md/FieldMetadata.js'\nimport 'common/services/sb-search-model-load/SearchModelLoader.js'\nimport 'common/services/sb-search-model-select/SearchModelSelector.js'\nimport 'common/data/sb-describe/Describe.js';\n\n// amount of time needed to trigger a \"on-hold\" event\nlet HOLD_THRESHOLD = 1000;\n\n// Register a custom \"hold\" event.  Polymer doesn't natively support this.\nif( Polymer ) {\n\tlet holdTimer = null;\n\n\tPolymer.Gestures.register({\n\t\tname: 'hold',\n\t\tdeps: ['mousedown', 'mouseup', 'touchstart', 'touchend'],\n\t\tflow: {\n\t\t\tstart: ['mousedown', 'touchstart'],\n\t\t\tend: ['mouseup', 'touchend']\n\t\t},\n\t\temits: ['hold'],\n\t\tmouseup: function(e) {\n\t\t\treturn this.up(e);\n\t\t},\n\t\ttouchend: function(e) {\n\t\t\treturn this.up(e.changedTouches[0], e);\n\t\t},\n\t\tup: function(e) {\n\t\t\tclearTimeout( holdTimer );\n\t\t\treturn false;\n\t\t},\n\t\tmousedown: function(e) {\n\t\t\treturn this.down(e);\n\t\t},\n\t\ttouchstart: function(e) {\n\t\t\treturn this.down(e.changedTouches[0], e);\n\t\t},\n\t\tdown: function(e, preventer) {\n\t\t\tholdTimer = setTimeout( function() {\n\t\t\t\tPolymer.Gestures.fire( Polymer.Gestures.findOriginalTarget(e), 'hold', {\n\t\t\t\t\tx: e.clientX,\n\t\t\t\t\ty: e.clientY,\n\t\t\t\t\tsourceEvent: e,\n\t\t\t\t\tpreventer: preventer\n\t\t\t\t});\n\t\t\t}, HOLD_THRESHOLD );\n\t\t\treturn false;\n\t\t}\n\t});\n}\n","export const PREFIX = '/docgen';\nexport const ROUTES = {\n\t'/preview': { comp: 'sb-docgen-preview', mod: 'docgen/sb-docgen-preview/DocgenPreview.js' }\n}\n","'use strict';\n\nSystem.register('favorites/favorites.js', ['favorites/sb-favorite-lookup/FavoriteLookup.js', 'favorites/sb-favorite-share-dialog/FavoriteShareDialog.js'], function (_export, _context) {\n  return {\n    setters: [function (_favoritesSbFavoriteLookupFavoriteLookupJs) {}, function (_favoritesSbFavoriteShareDialogFavoriteShareDialogJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJmYXZvcml0ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/favorite';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-favorite-lookup', mod: 'favorites/sb-favorite-lookup/FavoriteLookup.js'},\n};\n","'use strict';\n\nSystem.register('quotes/quotes.js', ['quotes/pages/sb-line-editor/LineEditor.js', 'quotes/sb-le-custom-action-services/LECustomActionServices.js', 'quotes/md/sb-le-field-md/LEFieldMD.js', 'quotes/layout/sb-le-group/LEGroup.js', 'quotes/tables/sb-standard-lines/StandardLines.js', 'quotes/tables/sb-segmented-lines/SegmentedLines.js', 'quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js', 'quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js', 'quotes/layout/sb-le-table-row/LETableRow.js', 'quotes/layout/sb-le-table-cell/LETableCell.js', 'quotes/layout/sb-ds-table-cell/DSTableCell.js', 'quotes/layout/sb-ds-tiers/DSTiers.js', 'quotes/layout/sb-le-table-header/LETableHeader.js', 'quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js', 'quotes/layout/sb-le-footer/LEFooter.js', 'quotes/layout/sb-le-group-layout/LEGroupLayout.js', 'quotes/layout/sb-field-set-table-item/FieldSetTableItem.js', 'quotes/layout/sb-field-set-table/FieldSetTable.js', 'quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js', 'quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js', 'quotes/layout/sb-custom-action/CustomAction.js', 'quotes/layout/sb-le-summary-row/LESummaryRow.js', 'quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js', 'quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js', 'quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js', 'quotes/layout/sb-cse-table-cell/CSETableCell.js', 'quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js', 'quotes/models/DragDropModel.js', 'quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js'], function (_export, _context) {\n  return {\n    setters: [function (_quotesPagesSbLineEditorLineEditorJs) {}, function (_quotesSbLeCustomActionServicesLECustomActionServicesJs) {}, function (_quotesMdSbLeFieldMdLEFieldMDJs) {}, function (_quotesLayoutSbLeGroupLEGroupJs) {}, function (_quotesTablesSbStandardLinesStandardLinesJs) {}, function (_quotesTablesSbSegmentedLinesSegmentedLinesJs) {}, function (_quotesLayoutSbSegmentedLineDetailsSegmentedLineDetailsJs) {}, function (_quotesLayoutSbSegmentedDetailRowSegmentedDetailRowJs) {}, function (_quotesLayoutSbLeTableRowLETableRowJs) {}, function (_quotesLayoutSbLeTableCellLETableCellJs) {}, function (_quotesLayoutSbDsTableCellDSTableCellJs) {}, function (_quotesLayoutSbDsTiersDSTiersJs) {}, function (_quotesLayoutSbLeTableHeaderLETableHeaderJs) {}, function (_quotesLayoutSbLeTableHeaderCellLETableHeaderCellJs) {}, function (_quotesLayoutSbLeFooterLEFooterJs) {}, function (_quotesLayoutSbLeGroupLayoutLEGroupLayoutJs) {}, function (_quotesLayoutSbFieldSetTableItemFieldSetTableItemJs) {}, function (_quotesLayoutSbFieldSetTableFieldSetTableJs) {}, function (_quotesLayoutSbLineEditorTabsSbQuoteTabsQuoteTabsJs) {}, function (_quotesLayoutSbLineEditorTabsSbGroupTabsGroupTabsJs) {}, function (_quotesLayoutSbCustomActionCustomActionJs) {}, function (_quotesLayoutSbLeSummaryRowLESummaryRowJs) {}, function (_quotesLayoutSbLeSummaryRowSbLeSummaryCellLESummaryCellJs) {}, function (_quotesDialogsSbFavoriteDialogFavoriteDialogJs) {}, function (_quotesDialogsSbCustomSegmentDialogCustomSegmentDialogJs) {}, function (_quotesLayoutSbCseTableCellCSETableCellJs) {}, function (_quotesDialogsSbPricebookDialogPricebookDialogJs) {}, function (_quotesModelsDragDropModelJs) {}, function (_quotesDialogsSbDiscountScheduleDialogDiscountScheduleDialogJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJxdW90ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6W119","export const PREFIX = '/quote';\nexport const ROUTES = {\n\t'/le': { comp: 'sb-line-editor', mod: 'quotes/pages/sb-line-editor/LineEditor.js' }\n}\n","'use strict';\n\nSystem.register('products/products.js', ['products/config/attribute/sb-attribute-item/AttributeItem.js', 'products/config/attribute/sb-attribute-table/AttributeTable.js', 'products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js', 'products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js', 'products/config/feature/sb-product-feature/ProductFeature.js', 'products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js', 'products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js', 'products/config/feature/sb-product-feature-list/ProductFeatureList.js', 'products/config/option/sb-product-option-table/ProductOptionTable.js', 'products/config/option/sb-option-cell/OptionCell.js', 'products/config/routes/services/sb-pc-product-load/ProductLoader.js', 'products/config/routes/services/sb-pc-option-save/OptionSaver.js', 'products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js', 'products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js', 'products/config/actions/sb-custom-actions/CustomActions.js', 'products/localization/LocalizeFields.js', 'products/resources/sb-product-alert/ProductAlert.js'], function (_export, _context) {\n  return {\n    setters: [function (_productsConfigAttributeSbAttributeItemAttributeItemJs) {}, function (_productsConfigAttributeSbAttributeTableAttributeTableJs) {}, function (_productsConfigBundlesSbProductBundlesLayoutProductBundlesLayoutJs) {}, function (_productsConfigBundlesSbProductBundlesFilterItemProductBundlesFilterItemJs) {}, function (_productsConfigFeatureSbProductFeatureProductFeatureJs) {}, function (_productsConfigFeatureSbProductFeatureLayoutProductFeatureLayoutJs) {}, function (_productsConfigFeatureSbProductFeatureCategoryListProductFeatureCategoryListJs) {}, function (_productsConfigFeatureSbProductFeatureListProductFeatureListJs) {}, function (_productsConfigOptionSbProductOptionTableProductOptionTableJs) {}, function (_productsConfigOptionSbOptionCellOptionCellJs) {}, function (_productsConfigRoutesServicesSbPcProductLoadProductLoaderJs) {}, function (_productsConfigRoutesServicesSbPcOptionSaveOptionSaverJs) {}, function (_productsConfigRoutesServicesSbProductRulesInvokeProductRulesInvokerJs) {}, function (_productsConfigRoutesServicesSbPcOptionConfigureOptionConfiguratorJs) {}, function (_productsConfigActionsSbCustomActionsCustomActionsJs) {}, function (_productsLocalizationLocalizeFieldsJs) {}, function (_productsResourcesSbProductAlertProductAlertJs) {}],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcm9kdWN0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbXX0=","export const PREFIX = '/product';\nexport const ROUTES = {\n\t'/dl': {comp: 'sb-dynamic-lookup', mod: 'products/config/routes/sb-dynamic-lookup/DynamicLookup.js'},\n\t'/lookup': {comp: 'sb-product-lookup', mod: 'products/selection/routes/sb-product-lookup/ProductLookup.js'},\n\t'/ol': {comp: 'sb-option-lookup', mod: 'products/config/routes/sb-option-lookup/OptionLookup.js'},\n\t'/pc': {comp: 'sb-product-config', mod: 'products/config/routes/sb-product-config/ProductConfig.js'},\n\t'/search': {comp: 'sb-product-search', mod: 'products/prototype/sb-product-search/ProductSearch.js'}\n};\n","\"use strict\";\n\nSystem.register(\"subscriptions/subscriptions.js\", [], function (_export, _context) {\n  return {\n    setters: [],\n    execute: function () {}\n  };\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzdWJzY3JpcHRpb25zLmpzIiwic291cmNlc0NvbnRlbnQiOltdfQ==","export const PREFIX = '/subscription';\nexport const ROUTES = {\n\t'/lookup': {comp: 'sb-subscription-lookup', mod: 'subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js'}\n};","import {AppContext} from 'common/core/AppContext.js';\n\nlet totalTime = 0;\nlet totalComponents = 0;\nlet currentTime;\nlet deviceClasses;\nlet checkPerformance = false;\nlet quiet = true;\n\nexport class DeviceBehavior {\n\n\tready() {\n\t\tif (checkPerformance)\n\t\t\tthis.startPerformanceCheck();\n\n\t\t// toggle the device classes to the component itself and to all of its \"device\" annotated elements\n\t\tlet deviceNodes = Polymer.dom(this.root).querySelectorAll('*[device]') || [];\n\t\tlet deviceClasses = this.getDeviceClasses();\n\t\tfor (let deviceClass of deviceClasses) {\n\t\t\tthis.toggleClass(deviceClass, true, this);\n\t\t\tfor(let deviceNode of deviceNodes)\n\t\t\t\tthis.toggleClass(deviceClass, true, deviceNode);\n\t\t}\n\n\t\t// add joined device classes as property on the component in case it needs to applied via class attribute interpolation\n\t\t// class$=\"[[deviceClasses]]\"\n\t\tthis['deviceClasses'] = deviceClasses.join(' ');\n\n\t\tif(checkPerformance)\n\t\t\tthis.stopPerformanceCheck(this);\n\n\t\tif(!quiet && deviceNodes.length === 0)\n\t\t\tconsole.warn(`${this.tagName.toLowerCase()}.html is missing an element with the device attribute`);\n\t}\n\n\tgetDeviceClasses() {\n\t\tif(deviceClasses)\n\t\t\treturn deviceClasses;\n\n\t\tif(AppContext.isPhone) deviceClasses = ['--phone', '--mobile'];\n\t\telse if(AppContext.isTablet) deviceClasses = ['--tablet','--mobile'];\n\t\telse deviceClasses = ['--desktop'];\n\n\t\treturn deviceClasses;\n\t}\n\n\tstartPerformanceCheck() {\n\t\tcurrentTime = performance.now();\n\t}\n\n\tstopPerformanceCheck() {\n\t\tvar time =  performance.now() - currentTime;\n\t\ttotalTime += time;\n\t\ttotalComponents++;\n\t\tif(time > 1) console.warn(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t\telse console.log(`total (${totalTime.toFixed(2)}ms) | current (${time.toFixed(2)}ms) | totalComponents (${totalComponents}) | component (${this.tagName.toLowerCase()})`);\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.DeviceBehavior = DeviceBehavior.prototype;","import {AppContext} from 'common/core/AppContext.js';\n\nexport class LookupBehavior {\n\tready() {\n\t\tthis.handleProductsLoadServerResponse();\n\t\tthis.handleHideSearchFilterIfNoSearchColumnsDisplayed();\n\t\tthis.bindFilterEnterCallBacks();\n\t}\n\n\thandleHideSearchFilterIfNoSearchColumnsDisplayed() {\n\t\tthis.addEventListener('no-displayed-filters', function () {\n\t\t\tthis.removeFilter();\n\t\t}.bind(this));\n\t}\n}\nwindow.CommonBehaviors = window.CommonBehaviors || {};\nwindow.CommonBehaviors.LookupBehavior = LookupBehavior.prototype;","// Singleton/instance data exposed by this class\nlet labels = {},\n\t\torg = {},\n\t\tmd = {},\n\t\tuser = {},\n\t\tdevice = {},\n\t\ti18n = {};  // instance of I18n.js, which we can't import normally due to circular dependency\n\nlet sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\n/**\n * A \"context\" class for the entire Application.  It knows how to initialize/get all the common stuff\n * that any page of the application might need.  This includes:\n *\n * User settings (language, locale, timezone, fullname, email, etc)\n * Localized labels\n * Org settings\n * Org Metadata\n * UI Themes\n *\n * It exposes these as both static and instance properties so that regular javascript can reference\n * in either way, and we can also use class inheritence so Polymer properties can be data bound.\n */\n\nexport class AppContext {\n\n\t/**\n\t * Initialize the application context data.  This needs to be called (at least once) before\n\t * other methods are used to access instance data.\n\t * @param  {Object} settingsObj details about the org and the user\n\t * @return {Promise}\n\t */\n\tstatic init(settingsObj) {\n\t\tAppContext.buildUserAndOrgFromSettings(settingsObj);\n\t\tAppContext.device = 'desktop';\n\n\t\t// For ipad, other tablets and Android tablet device, but not a windows hybrid\n\t\tif ( (navigator.userAgent.match(/Tablet|iPad|iPod/i) && !navigator.userAgent.match(/Tablet PC/i)) || (navigator.userAgent.match(/Android/i) && !navigator.userAgent.match(/Mobi/i)) ) {\n\t\t\tAppContext.device = 'tablet';\n\t\t} else if (navigator.userAgent.match(/Mobi/i)) {\n\t\t\tAppContext.device = 'phone';\n\t\t}\n\n\t\tlet i18nClass = null;\n\t\treturn new Promise( function(resolve, reject) {\n\t\t\tSystem.import( 'common/core/sb-i18n/I18n.js' ).then( function(n) {\n\t\t\t\ti18nClass = n.I18n;\n\t\t\t\tSystem.import( 'labels_en.js' ).then( function(m) {\n\t\t\t\t\tlet userLabels = m.LABELS; // default to our built English file\n\t\t\t\t\tif( sb.labels ) {\n\t\t\t\t\t\tuserLabels = window.sb.labels;  // labels from production org or other language\n\t\t\t\t\t}\n\n\t\t\t\t\tlabels = userLabels;\n\t\t\t\t\tlet ret = { labels: userLabels, user: user };\n\n\t\t\t\t\tif( i18nClass )\n\t\t\t\t\t\ti18n = new i18nClass( ret );  // create singleton instance\n\n\t\t\t\t\tresolve( ret );\n\t\t\t\t}).catch( function(e) {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic buildUserAndOrgFromSettings(settingsObj) {\n\t\tif (!settingsObj)\n\t\t\treturn;\n\n\t\tAppContext.user = {\n\t\t\tlang: settingsObj.language,\n\t\t\tlocale: settingsObj.locale,\n\t\t\tid: settingsObj.userId,\n\t\t\tfullname: settingsObj.fullName,\n\t\t\tusername: settingsObj.userName,\n\t\t\tdevice: settingsObj.device,\n\t\t\thasQuoteEditPermission: settingsObj.hasQuoteEditPermission\n\t\t};\n\n\t\tAppContext.org = {\n\t\t\tprefix: settingsObj.developerPrefix !== undefined ? settingsObj.developerPrefix : 'SBQQ',\n\t\t\tisMultiCurrencyOrg: settingsObj.isMultiCurrencyOrg,\n\t\t\tcalculateImmediately: settingsObj.calculateImmediately,\n\t\t\tdefaultCurrency: settingsObj.defaultCurrency,\n\t\t\tcurrencySymbol: settingsObj.currencySymbol,\n\t\t\tcurrencyDecimalScale: settingsObj.currencyDecimalScale,\n\t\t\tquantityScale: settingsObj.quantityScale,\n\t\t\tisOAuth: settingsObj.isOAuth,\n\t\t\torgUrl: settingsObj.orgUrl,\n\t\t\tsiteUrl: settingsObj.siteUrl,\n\t\t\tapiVersion : 39\n\t\t};\n\t}\n\n\t/**\n\t * The properties object, in Polymer format, that can be inherited by other components/classes.\n\t * @return {Object} a common set of properties for all components/classes in our app.\n\t */\n\tstatic get properties() {\n\t\treturn {\n\t\t\tapp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {\n\t\t\t\t\tuser: user,\n\t\t\t\t\tlabels: labels,\n\t\t\t\t\torg: org,\n\t\t\t\t\tdeviceContext: {\n\t\t\t\t\t\tisDesktop: AppContext.isDesktop,\n\t\t\t\t\t\tisTablet: AppContext.isTablet,\n\t\t\t\t\t\tisPhone: AppContext.isPhone,\n\t\t\t\t\t\tisMobile: AppContext.isPhone || AppContext.isTablet\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t},\n\t\t\t/** A instance of sb-i18n in pure ES6 class form, for direct programmatic access in any inherited component */\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return i18n; }\n\t\t\t}\n\t\t};\n\t}\n\n\tget user() {\n\t\treturn user;\n\t}\n\n\tget labels() {\n\t\treturn labels;\n\t}\n\n\tget org() {\n\t\treturn org;\n\t}\n\n\tstatic get user() {\n\t\treturn user;\n\t}\n\n\tstatic get labels() {\n\t\treturn labels;\n\t}\n\n\tstatic get org() {\n\t\treturn org;\n\t}\n\n\tstatic get device() {\n\t\treturn device;\n\t}\n\n\tstatic set user(obj) {\n\t\tuser = obj;\n\t}\n\n\tstatic set org(obj) {\n\t\torg = obj;\n\t}\n\n\tstatic set device(obj) {\n\t\tdevice = obj;\n\t}\n\n\tstatic get isDesktop() {\n\t\treturn user.device ? user.device === 'desktop' : device === 'desktop';\n\t}\n\n\tstatic get isTablet() {\n\t\treturn user.device ? user.device === 'tablet' : device === 'tablet';\n\t}\n\n\tstatic get isPhone() {\n\t\treturn user.device  ? user.device === 'phone' : device === 'phone';\n\t}\n\n\tstatic isIE() {\n\t\tlet ua = window.navigator.userAgent;\n\t\t// Checks are for IE10 and below, IE11, and Edge respectively\n\t\treturn (ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0);\n\t}\n\n\tstatic isChrome() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Chrome') >= 0;\n\t}\n\n\tstatic isFirefox() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Firefox') >= 0;\n\t}\n\n\tstatic isSafari() {\n\t\tlet ua = window.navigator.userAgent;\n\t\treturn ua.indexOf('Safari') >= 0 && ua.indexOf('Chrome') < 0;\n\t}\n\n\tstatic get apiVersion() {\n\t\treturn AppContext.org.apiVersion;\n\t}\n\n\tstatic get apiVersionString() {\n\t\treturn AppContext.org.apiVersion + '.0';\n\t}\n\n\tstatic set apiVersion(version) {\n\t\tAppContext.org.apiVersion = version;\n\t}\n}\n\n\n// expose an instance of AppContext as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.AppContext = AppContext.prototype;\n","\nexport class Navigator {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         the relative URL to navigate to\n\t * @param  {Object} queryParams a map of query parameters to append to the URL\n\t * @param  {Object} pathParams  array of path strings to append to the URL\n\t * @param  {boolean} newWin     true to open in a new browser window\n\t * @return {null}\n\t */\n\tstatic nav( url, queryParams, pathParams, newWin, component ) {\n\t\tlet u = url,\n\t\t\tpLen = pathParams ? pathParams.length : 0,\n\t\t\tpKeys = queryParams ? Object.keys( queryParams ) : [],\n\t\t\tkLen = pKeys.length;\n\n\t\tif( pathParams ) {\n\t\t\tfor ( var i = 0; i < pLen; i++ ) {\n\t\t\t\tif ( pathParams[ i ] != null && pathParams[ i ] != undefined && pathParams[ i ] != '' )\n\t\t\t\t\tu += '/' + encodeURIComponent( pathParams[ i ] );\n\t\t\t}\n\t\t}\n\n\t\tfor( let i = 0; i < kLen; i++ ) {\n\t\t\tu += i == 0 ? '?' : '&';\n\t\t\tu += encodeURIComponent( pKeys[ i ] ) + '=' + encodeURIComponent( queryParams[ pKeys[ i ] ] );\n\t\t}\n\n\t\tcomponent.fire('iron-signal', { name: 'sb-navigation-changed', data: { url: url, location: u } });\n\t\twindow.location.hash = u;\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Navigator} from 'common/core/Navigator.js';\n\nvar sb = window ? window.sb || {} : {};\nsb.ui = sb.ui || {};\nsb.common = sb.common || {};\nsb.common.core = sb.common.core || {};\nwindow.sb = sb;\n\n// Screen-ish / viewport sizes\nexport const SIZE_S = 'S';\nexport const SIZE_M = 'M';\nexport const SIZE_L = 'L';\nexport const SIZE_XL = 'XL';\n\n/**\n * The common base class for all Page objects.  A Page is a physical landing point of content when a user navigates in the app.\n */\nexport class Page extends AppContext {\n\n\t/**\n\t * A navigate function for imperative nagivgation events \"inside\" our application.\n\t * @param  {String} url         the relative URL to navigate to\n\t * @param  {Object} queryParams a map of query parameters to append to the URL\n\t * @param  {Object} pathParams  array of path strings to append to the URL\n\t * @param  {boolean} newWin     true to open in a new browser window\n\t * @return {null}\n\t */\n\tnav( url, queryParams, pathParams, newWin ) {\n\t\tNavigator.nav(url, queryParams, pathParams, newWin, this);\n\t}\n\n\t/**\n\t * The base properties object, in Polymer format, that all Pages have in common\n\t * @return {Object} a common set of properties for all pages\n\t */\n\tstatic get properties() {\n\t\treturn Polymer.Base.extend({\n\t\t\tctx: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {} }\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n}\n\n// expose an instance of Page as global object so it can be used as a Polymer behaviors\n// Polymer doesn't create instances of ES6 class, just regular ES5 objects :(\nsb.common.core.Page = Page.prototype;\n","export class DependentPicklistBuilder {\n\n    constructor(controlledPicklist, controllingValue) {\n        this.controlledPicklist = controlledPicklist;\n        this.controllingValue = controllingValue;\n    }\n\n    build() {\n        let options = this.controlledPicklist.picklistValues;\n        let validOptions = [];\n        options.forEach( function(option) {\n            if (this._testBit(atob(option.validFor), this._getControllingValueIndex(this.controllingValue))) {\n                validOptions.push(option);\n            }\n        }.bind(this));\n        return validOptions;\n    }\n\n    _getControllingValueIndex(value) {\n        let controllingOptions = this.controlledPicklist.controllingField.picklistValues;\n        for (let i = 0, l = controllingOptions.length; i < l; i++) {\n            if (controllingOptions[i].value == value) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    _testBit(validFor, controllingValueIndex) {\n        var byteToCheck = Math.floor(controllingValueIndex / 8);\n        var bit = 7 - (controllingValueIndex % 8);\n        return ((Math.pow(2, bit) & validFor.charCodeAt(byteToCheck)) >> bit) == 1;\n    }\n\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Locale {\n\n\tstatic get() {\n\t\treturn AppContext.user ? (AppContext.user.locale || 'en-US' ) : 'en-US';\n\t}\n\n\tstatic isCommaDecimal(locale) {\n\t\treturn COMMA_DECIMAL_LOCALES.indexOf(locale || Locale.get()) !== -1;\n\t}\n}\n\n\n// The below list was compiled from\n// https://help.salesforce.com/apex/HTViewHelpDoc?id=admin_supported_locales.htm&language=en_US\n\n// commented out entries are locales that conflict with our client-side formatter (Intl.NumberFormatter):\n// (*)  formats with period decimal which contradicts SalesForce documentation above\n// (**) unsupported locale in our client formatter\n\nexport const COMMA_DECIMAL_LOCALES = [\n\t//'sq-AL', // Albania (*)\n\t//'hy-AM', // Armenia (*)\n\t//'az-AZ', // Azerbaijani (*)\n\t//'eu-ES', // Basque (Spain) (*)\n\t//'be-BY', // Belarusian (Belarus) (*)\n\t//'bs-BA', // Bosnian (Bosnia and Herzegovina) (*)\n\t'bg-BG', // Bulgarian (Bulgaria)\n\t//'ca-ES-EURO', // Catalan (Spain, Euro) (**)\n\t'ca-ES', // Catalan (Spain)\n\t'hr-HR', // Croatian (Croatia)\n\t'cs-CZ', // Czech (Czech Republic)\n\t'da-DK', // Danish (Denmark)\n\t'nl-AW', // Dutch (Aruba)\n\t'nl-BE', // Dutch (Belgium)\n\t'nl-NL', // Dutch (Netherlands)\n\t'nl-SR', // Dutch (Suriname)\n\t'et-EE', // Estonian (Estonia)\n\t//'fi-FI-EURO', // Finnish (Finland, Euro) (**)\n\t'fi-FI', // Finnish (Finland)\n\t'fr-BE', // French (Belgium)\n\t'fr-CA', // French (Canada)\n\t'fr-KM', // French (Comoros)\n\t//'fr-FR-EURO', // French (France, Euro) (**)\n\t'fr-FR', // French (France)\n\t'fr-GN', // French (Guinea)\n\t'fr-HT', // French (Haiti)\n\t'fr-LU', // French (Luxembourg)\n\t'fr-MR', // French (Mauritania)\n\t'fr-MC', // French (Monaco)\n\t//'fr-CH', // French (Switzerland) (*)\n\t'fr-WF', // French (Wallis and Futuna)\n\t//'ka-GE', // Georgian (Georgia) (*)\n\t//'de-AT-EURO', // German (Austria, Euro) (**)\n\t'de-AT', // German (Austria)\n\t//'de-DE-EURO', // German (Germany, Euro) (**)\n\t'de-DE', // German (Germany)\n\t//'de-LU-EURO', // German (Luxembourg, Euro) (**)\n\t'de-LU', // German (Luxembourg)\n\t'el-GR', // Greek (Greece)\n\t'hu-HU', // Hungarian (Hungary)\n\t//'is-IS', // Icelandic (Iceland) (*)\n\t'in-ID', // Indonesian (Indonesia)\n\t'it-IT', // Italian (Italy)\n\t//'kk-KZ', // Kazakh (Kazakhstan) (*)\n\t//'km-KH', // Khmer (Cambodia) (*)\n\t'lv-LV', // Latvian (Latvia)\n\t'lt-LT', // Lithuanian (Lithuania)\n\t//'mk-MK', // Macedonian (Macedonia) (*)\n\t//'ms-BN', // Malay (Brunei) (*)\n\t//'no-NO', // Norwegian (Norway) (*)\n\t'pl-PL', // Polish (Poland)\n\t'pt-AO', // Portuguese (Angola)\n\t'pt-BR', // Portuguese (Brazil)\n\t'pt-CV', // Portuguese (Cape Verde)\n\t'pt-MZ', // Portuguese (Mozambique)\n\t'pt-PT', // Portuguese (Portugal)\n\t'pt-ST', // Portuguese (São Tomé and Príncipe)\n\t'ro-MD', // Romanian (Moldova)\n\t'ro-RO', // Romanian (Romania)\n\t'ru-RU', // Russian (Russia)\n\t'sr-BA', // Serbian (Bosnia and Herzegovina)\n\t'sr-RS', // Serbian (Serbia)\n\t'sr-CS', // Serbian (Serbia and Montenegro)\n\t//'sh-BA', // Serbo-Croatian (Bosnia and Herzegovina) (*)\n\t//'sh-ME', // Serbo-Croatian (Montenegro) (*)\n\t//'sh-CS', // Serbo-Croatian (Serbia and Montenegro) (*)\n\t'sk-SK', // Slovak (Slovakia)\n\t'sl-SI', // Slovenian (Slovenia)\n\t'es-AR', // Spanish (Argentina)\n\t'es-BO', // Spanish (Bolivia)\n\t'es-CL', // Spanish (Chile)\n\t'es-CO', // Spanish (Colombia)\n\t'es-CU', // Spanish (Cuba)\n\t'es-EC', // Spanish (Ecuador)\n\t'es-PY', // Spanish (Paraguay)\n\t'es-PE', // Spanish (Peru),\n\t//'es-ES-EURO', // Spanish (Spain, Euro) (**)\n\t'es-ES', // Spanish (Spain)\n\t'es-UY', // Spanish (Uruguay)\n\t'es-VE', // Spanish (Venezuela)\n\t'sv-SE', // Swedish (Sweden)\n\t'tr-TR', // Turkish (Turkey)\n\t'uk-UA', // Ukrainian (Ukraine)\n\t'vi-VN' // Vietnamese (Vietnam)\n];","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport class NumberFormatter {\n\n\tconstructor(editable, metadata, i18n, type, viewport) {\n\t\tthis.editable = editable;\n\t\tthis.metadata = metadata;\n\t\tthis.i18n = i18n;\n\t\tthis.type = type;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t\tthis.appContext = AppContext;\n\t}\n\n\tformat(value, allowCurrency) {\n\t\tlet opts = {};\n\t\tif (this.metadata.scale != undefined && this.metadata.scale >= 0) {\n\t\t\topts.minimumFractionDigits = this.metadata.scale;\n\t\t\topts.maximumFractionDigits = this.metadata.scale;\n\t\t}\n\n\t\tif (this.type === 'currency' && allowCurrency)\n\t\t\tthis._setCurrencyFormatOptions(opts);\n\n\t\t// if editable, in mobile, and the number locale does not use a comma as a decimal\n\t\t// then omit the separators (comma or spaces) so we can display this editable number value in an input field of type number\n\t\t// so that the mobile device will leverage its number keyboard instead of its text keyboard\n\t\tif(this.editable && this.isMobile() && !Locale.isCommaDecimal())\n\t\t\topts.useGrouping = false;\n\n\t\tif(this.isNil(value))\n\t\t\treturn null;\n\n\t\ttry {\n\t\t\tlet formattedValue = this.i18n.format(value, opts);\n\t\t\tif (formattedValue === 'NaN')\n\t\t\t\tthrow new Error(`${value} is not a number`);\n\t\t\treturn formattedValue;\n\t\t} catch (err) {\n\t\t\treturn value;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || isNaN(value);\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t_setCurrencyFormatOptions (opts) {\n\t\topts.style = 'currency';\n\t\tif (this.appContext.org.isMultiCurrencyOrg) {\n\t\t\topts.currency = (this.metadata && this.metadata.CurrencyIsoCode) ? this.metadata.CurrencyIsoCode  : this.appContext.org.defaultCurrency;\n\t\t\topts.currencyDisplay = 'code';\n\t\t} else {\n\t\t\topts.currencyDisplay = 'symbol';\n\t\t\tif (!this.appContext.org.currencySymbol) {\n\t\t\t\topts.currency = this.appContext.org.defaultCurrency;\n\t\t\t} else {\n\t\t\t\topts.currency = 'XXX';  // International symbol for No Currency\n\t\t\t}\n\t\t}\n\t}\n}","import {Locale} from 'common/forms/Locale.js';\n\nexport class NumberParser {\n\tconstructor(locale) {\n\t\tthis.locale = locale || Locale.get();\n\t\tthis.isCommaDecimalLocale = Locale.isCommaDecimal(this.locale);\n\t}\n\n\tparse(numberStr) {\n\t\tif(typeof numberStr !== 'string')\n\t\t\treturn numberStr; // if numberStr is not a string, then nothing to parse\n\n\t\t// some locales uses unusual separators such as spaces or apostrophes, so lets remove them\n\t\tnumberStr = this.removeUnusualSeparators(numberStr);\n\n\t\t// 4,200.50 in US becomes 4200.50, but 4.200,50 in French stays 4.200,50\n\t\tnumberStr = this.removeNonDecimalCommas(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4.200,50 in French becomes 4200,50\n\t\tnumberStr =\tthis.removeDecimalSepartors(numberStr);\n\n\t\t// 4200.50 in US stays 4200.50, but 4200,50 in French becomes 4200.50\n\t\tnumberStr = this.replaceCommaDecimalWithPeriod(numberStr);\n\n\t\treturn parseFloat(numberStr);\n\t}\n\n\tremoveUnusualSeparators(numberStr) {\n\t\treturn numberStr.replace(new RegExp('[\\\\\\s]+', 'g'), '').replace(new RegExp(\"'\", 'g'), '');\n\t}\n\n\tremoveNonDecimalCommas(numberStr) {\n\t\treturn !this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '') : numberStr;\n\t}\n\n\tremoveDecimalSepartors(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp('[.]', 'g'), '') : numberStr\n\t}\n\n\treplaceCommaDecimalWithPeriod(numberStr) {\n\t\treturn this.isCommaDecimalLocale ? numberStr.replace(new RegExp(',', 'g'), '.') : numberStr;\n\t}\n}","import {OAUTH_KEY} from 'common/oauth/oauth.local.js';\nimport {OAUTH_SECRET} from 'common/oauth/oauth.local.js';\n\nlet url = 'http://localhost:' + location.port + '/common/oauth';\nlet oauth2 = {\n    clientId : OAUTH_KEY,\n    clientSecret: OAUTH_SECRET,\n    redirectUri: url + '/callback',\n    proxyUrl: 'https://brick-rest-proxy.herokuapp.com/proxy/'\n};\n\nexport class OAuth {\n\n    constructor(tokens) {\n        if(!oauth2.clientId || !oauth2.clientSecret)\n            throw Error(this._getNoOAuthClientKeyMessage());\n\n        // Below we override jsforce.browser functions around token management to include the refresh token\n        var storeTokens = jsforce.browser.Client.prototype._storeTokens.bind(jsforce.browser);\n        jsforce.browser.Client.prototype._storeTokens = function(params) {\n            storeTokens(params);\n            localStorage.setItem(this._prefix + '_refresh_token', params.refresh_token);\n        }.bind(jsforce.browser);\n\n        var removeTokens = jsforce.browser.Client.prototype._removeTokens.bind(jsforce.browser);\n        jsforce.browser.Client.prototype._removeTokens = function() {\n            removeTokens();\n            localStorage.removeItem(this._prefix + '_refresh_token');\n        }.bind(jsforce.browser);\n\n        var getTokens = jsforce.browser.Client.prototype._getTokens.bind(jsforce.browser);\n        jsforce.browser.Client.prototype._getTokens = function() {\n            var tokens = getTokens();\n            if(tokens)\n                tokens.refreshToken = localStorage.getItem(this._prefix + '_refresh_token');\n            return tokens;\n        }.bind(jsforce.browser);\n\n        var isLoggedIn = jsforce.browser.Client.prototype.isLoggedIn.bind(jsforce.browser);\n        jsforce.browser.Client.prototype.isLoggedIn = function() {\n            if(!isLoggedIn())\n                return false;\n           return this.connection.refreshToken;\n        }.bind(jsforce.browser);\n\n        // update the issued at to current date since we don't need to reauthorize since we have a never expire refresh token\n        (function() {\n             localStorage.setItem(this._prefix + '_issued_at', new Date().getTime());\n             document.cookie = this._prefix + '_loggedin=true;';\n        }).bind(jsforce.browser)();\n\n        if(tokens)\n            jsforce.browser._storeTokens(tokens);\n\n        // initialize with the OAUTH credentials\n        jsforce.browser.init(oauth2);\n    }\n\n    login() {\n        jsforce.browser.login();\n    }\n\n    getConnection() {\n        if(!jsforce.browser.isLoggedIn())\n            return Promise.reject('Please login before establishing a connection at http://localhost:' + location.port + '/common/oauth');\n\n        return new Promise(function(resolve, reject) {\n            jsforce.browser.once('connect', function(conn) {\n               var createRequestParams = conn.apex._createRequestParams.bind(conn.apex);\n               conn.apex._createRequestParams = function(method, path, body) {\n                    var params = createRequestParams(method, path, body);\n                    params.headers = params.headers || {};\n                    params.headers['X-Authorization'] = conn.refreshToken;\n                    return params;\n               };\n               resolve(conn);\n            });\n            jsforce.browser.init(oauth2);\n        });\n    }\n\n    set accessToken(accessToken) {\n        localStorage.setItem(jsforce.browser._prefix + '_access_token', accessToken);\n    }\n\n    get tokens() {\n        return jsforce.browser._getTokens();\n    }\n\n    set tokens(tokens) {\n        jsforce.browser._storeTokens(tokens);\n    }\n\n    _getNoOAuthClientKeyMessage() {\n        return 'Need to add a \\'.env.json\\' file in the CPQ dir whose contents contains the Consumer Key and Consumer Secret of the Salesforce CPQ Connected App, and then execute a gulp compile.\\n' +\n                '{\"oauth_key\": \"<Consumer Key>, \"oauth_secret\": \"<Consumer Secret>\"}'\n    }\n\n    encodeTokenUrl() {\n        let tokens = jsforce.browser._getTokens();\n        let refreshToken = tokens.refreshToken;\n        let orgUrl = encodeURIComponent(tokens.instanceUrl);\n        let id = encodeURIComponent(tokens.userInfo.url);\n        return url + '?rt=' + refreshToken + '&org=' + orgUrl + '&id=' + id;\n    }\n\n    static decodeTokenUrl(url) {\n        if(!url) return;\n        var refreshToken = OAuth._getParameterByName('rt', url);\n        var orgUrl = OAuth._getParameterByName('org', url);\n        var id = OAuth._getParameterByName('id', url);\n        if(refreshToken && orgUrl && id)\n            return { refresh_token: refreshToken, instance_url: orgUrl, id: id, access_token: 'xyz', issued_at: new Date().getTime() };\n    }\n\n    static _getParameterByName(name, url) {\n        name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n        var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n            results = regex.exec(url);\n        if (!results) return null;\n        if (!results[2]) return '';\n        return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n    }\n}","export const OAUTH_KEY = 'undefined';\nexport const OAUTH_SECRET = 'undefined';","import {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class RelationshipFieldManager {\n\n\tconstructor(field, record) {\n\t\tthis.field = field;\n\t\tthis.record = record;\n\t}\n\n\thasRelationship() {\n\t\treturn !!(this.getRelationship());\n\t}\n\n\tgetRelationship() {\n\t\tlet relationshipField = RelationshipFieldManager.getRelationshipField(this.field);\n\t\tif(!relationshipField)\n\t\t\treturn;\n\n\t\tif(typeof this.record === 'function')\n\t\t\treturn this.record(relationshipField);\n\n\t\treturn this.record[relationshipField];\n\t}\n\n\tgetRelationshipName(nameField) {\n\t\tlet relationship = this.getRelationship();\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tlet name = nameField || this._getLookupName(relationship);\n\t\treturn relationship[name];\n\t}\n\n\taddRelationshipName(id, display, tableName) {\n\t\tlet relationship = this.buildRelationship(id, display, tableName);\n\t\tif (!relationship.value.Id) {\n\t\t\trelationship.value = null;\n\t\t}\n\t\tif(!relationship)\n\t\t\treturn;\n\n\t\tif(typeof this.record === 'function')\n\t\t\treturn this.record(relationship.field, relationship.value);\n\n\t\tthis.record[relationship.field] = relationship.value;\n\t}\n\n\tbuildRelationship(id, display, tableName) {\n\t\tlet relationshipField = (RelationshipFieldManager.getRelationshipField(this.field));\n\t\tif (!relationshipField)\n\t\t\treturn;\n\n\t\tlet relationship = this.getRelationship() || {};\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\n\t\trelationship.Id = id;\n\t\trelationship[nameField] = display;\n\t\treturn { value: relationship, field: relationshipField };\n\t}\n\n\t_getLookupName(relationship) {\n\t\tlet relationshipTable = relationship.attributes ? relationship.attributes.type : '';\n\t\treturn new LookupNameMapper(relationshipTable).getNameField();\n\t}\n\n\tstatic getRelationshipField(idField, tableName) {\n\t\tlet relationshipField;\n\t\tif(idField.endsWith('__c'))\n\t\t\trelationshipField = idField.replace(/__c$/, '__r');\n\t\telse if(idField.endsWith('Id'))\n\t\t\trelationshipField = idField.substring(0, idField.length - 2);\n\n\t\tif(!relationshipField || !tableName)\n\t\t\treturn relationshipField;\n\n\t\tlet nameField = new LookupNameMapper(tableName).getNameField();\n\t\treturn relationshipField + '.' + nameField;\n\t}\n}","export class AbstractFocusSignaler {\n\n\tconstructor(element, focusEvents, blurEvents) {\n\t\tthis.element = element;\n\t\tthis.focusEvents = focusEvents;\n\t\tthis.blurEvents = blurEvents;\n\t}\n\n\tsignalOnFocus(signalName, unregister) {\n\t\tthis.fireFocusSignal = this.fireFocusSignal || this._fireSignal.bind(this, signalName, true);\n\t\tthis.fireBlurSignal = this.fireBlurSignal || this._fireSignal.bind(this, signalName, false);\n\n\t\tfor(let focusEvent of this.focusEvents) {\n\t\t\tthis.element.removeEventListener(focusEvent, this.fireFocusSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(focusEvent, this.fireFocusSignal);\n\t\t}\n\n\t\tfor(let blurEvent of this.blurEvents) {\n\t\t\tthis.element.removeEventListener(blurEvent, this.fireBlurSignal);\n\t\t\tif(!unregister)\n\t\t\t\tthis.element.addEventListener(blurEvent, this.fireBlurSignal);\n\t\t}\n\t}\n\n\tfireSignal(signalName, focused) {\n\t\tthis._fireSignals(signalName, focused);\n\n\t\tlet lastSignaler = this._getLastSignaler();\n\t\tif(lastSignaler === this)\n\t\t\treturn;\n\n\t\t// if we have a last signaler that is not this, then ensure it fires a signal with focus as false\n\t\tif(lastSignaler)\n\t\t\tlastSignaler._fireSignals(signalName, false);\n\n\t\t// set this as the last signaler\n\t\tthis._setLastSignaler();\n\t}\n\n\t/* abstract */ getSignalTargets() {\n\t\treturn [];\n\t}\n\n\tdisable() {\n\t\tthis._toggleDisabled(true);\n\t}\n\n\tenable() {\n\t\tthis._toggleDisabled(false);\n\t}\n\n\t_fireSignal(signalName, focused) {\n\t\tif(!this._isDisabled())\n\t\t\tthis.fireSignal(signalName, focused);\n\t}\n\n\t_fireSignals(signalName, focused) {\n\t\tlet targets = this.getSignalTargets();\n\t\tfor(let target of targets)\n\t\t\ttarget.fire( signalName,  { focused: focused, signaler: this } );\n\t}\n\n\t_getLastSignaler() {\n\t\treturn window && window.signaler ? window.signaler.last : null;\n\t}\n\n\t_isDisabled() {\n\t\treturn window && window.signaler && window.signaler.disabled;\n\t}\n\n\t_setLastSignaler() {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.last = this;\n\t\twindow.signaler = signaler;\n\t}\n\n\t_toggleDisabled(disabled) {\n\t\tlet signaler = window.signaler || {};\n\t\tsignaler.disabled = disabled;\n\t\twindow.signaler = signaler;\n\t}\n}","import {AbstractFocusSignaler} from 'common/signal/AbstractFocusSignaler.js';\n\nexport class RowFocusSignaler extends AbstractFocusSignaler {\n\n\tconstructor(row, groupId, cellName, rowId) {\n\t\tsuper(row, ['focus', 'tap', 'mouseenter'], ['mouseleave']);\n\t\tthis.groupId = groupId;\n\t\tthis.cellName = cellName;\n\t\tthis.rowId = rowId;\n\t}\n\n\tgetSignalTargets() {\n\t\tif(this.fields)\n\t\t\treturn this.fields;\n\n\t\tlet group = this.element.$$('#' + this.groupId);\n\t\tif(!group) return [];\n\n\t\tthis.fields = [];\n\t\tlet cells = Polymer.dom(group.root).querySelectorAll(this.cellName);\n\t\tfor(let cell of cells)\n\t\t\tthis.fields.push(cell.$$('sb-field'));\n\n\t\treturn this.fields;\n\t}\n\n\ttoggleRowFocus(signal) {\n\t\tif(signal.detail.focused && !this.element.focused) {\n\t\t\tthis.element.focused = true;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', true, this.element.$$('#' + this.rowId));\n\n\t\t} else if(!signal.detail.focused && this.element.focused) {\n\t\t\tthis.element.focused = false;\n\t\t\tif(this.rowId)\n\t\t\t\tthis.element.toggleClass('focused', false, this.element.$$('#' + this.rowId));\n\t\t}\n\t}\n}","import {Page} from '../../common/core/Page.js';\n\n// TODO: remove prototype data\nvar templates = [\n\t{ name: 't1', title: 'My Favorite Template' },\n\t{ name: 't2', title: 'Okay Template' },\n\t{ name: 't3', title: 'Super Template' },\n\t{ name: 't4', title: 'Nasty Template' },\n\t{ name: 't5', title: 'Don\\'t Go Here' }\n];\n\nexport class DocgenPreview extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-docgen-preview';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: {  // object instance\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; }\n\t\t\t},\n\t\t\ttemplates: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return templates; }\n\t\t\t}\n\t\t}, Page.properties );\n\t}\n\n\tcancel() {\n\t\tthis.nav( '/entities/quote/detail?id=' + this.ctx.params.id );\n\t}\n\n\tpreview() {\n\t\tthis.nav( '/docgen/preview?id=' + this.ctx.params.id );\n\t}\n\n}\n\nPolymer( DocgenPreview );\n","import {Page} from 'common/core/Page.js';\nimport {Navigator} from 'common/core/Navigator.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class FavoriteLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-lookup';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tlineEditorModel: Object,\n\t\t\tfavoriteModel: Object,\n\t\t\tselectedFavorites: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tactions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tqId: String,\n\t\t\tgroupKey: Number,\n\t\t\tisMobile: Boolean\n\t\t}, Page.properties );\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.qId = this.qId || this.ctx.params.qId;\n\t\tthis.aId = this.aId || this.ctx.params.aId;\n\t\tthis.groupKey = parseInt(this.groupKey || this.ctx.params.groupKey) || null;\n\t\tthis.isMobile = this._isMobileViewport();\n\n\t\tthis.$.le.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t}.bind(this));\n\n\t\tthis.$.md.addEventListener('md-changed', function(e) {\n\t\t\tthis._setMetaData(e.detail.value.fields);\n\t\t}.bind(this));\n\n\t\tthis.$.fm.addEventListener('response-changed', function() {\n\t\t\tthis._setSelected();\n\t\t}.bind(this));\n\n\t\tthis.$.addFavorite.addEventListener('response-changed', function(e) {\n\t\t\tthis.lineEditorModel.quote = e.detail.value;\n\t\t\tthis._toggleSelected();\n\t\t\tif (!this.addMore)\n\t\t\t\tNavigator.nav('#', {qId : this.qId}, ['quote', 'le'], false, this);\n\n\t\t\tthis.$.header.selected = false;\n\t\t\tthis.addMore = false;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('favorite-shared', function(e) {\n\t\t\tthis.$.shareFavorites.addEventListener('response-changed', function() {\n\t\t\t\tthis._toggleSelected();\n\t\t\t}.bind(this));\n\n\t\t\tlet model = new DataBuilder()\n\t\t\t\t.addQuote('quoteJSON', this.le.quote)\n\t\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t\t.add('groupIds', e.detail.groups)\n\t\t\t\t.add('userIds', e.detail.users)\n\t\t\t\t.build();\n\n\t\t\tthis.$.shareFavorites.model = model;\n\t\t}.bind(this));\n\n\t\tthis._handleOneFavoriteSelected();\n\t\tthis._handleAllFavoritesSelected();\n\t}\n\n\t_setMetaData(fields) {\n\t\t// used to set up the table row to display appropriate data\n\t\tthis.cols = this.favoriteModel.resultFieldNames;\n\t\tlet model = {};\n\t\tlet colsDisplay = {};\n\t\tlet fieldLabels = [];\n\t\tlet numFields = fields.length;\n\t\tfor (let i=0; i<numFields; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tmodel[field.name] = {type: field.type};\n\t\t\tcolsDisplay[field.name] = field.label;\n\t\t\tfieldLabels.push(field.label);\n\t\t}\n\t\tthis.model = model;\n\t\tthis.primaryMobileCols = ['Name', 'SBQQ__Description__c'];\n\t\tthis.colsDisplay = colsDisplay;\n\t\tthis.fieldLabels = fieldLabels;\n\t}\n\n\t_setSelected() {\n\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\tfavorite.selected = false;\n\t\t});\n\t}\n\n\t_handleOneFavoriteSelected() {\n\t\t// listen for selection changes to the favorite list\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tlet record = e.detail;\n\t\t\tlet selected = record.selected; // true if selected, false if unselected\n\t\t\tlet recordId = record.Id; // the id of the record that was just selected or unselected\n\n\t\t\tif (selected)\n\t\t\t\tthis.selectedFavorites[recordId] = record;\n\t\t\telse\n\t\t\t\tdelete this.selectedFavorites[recordId];\n\n\t\t}.bind(this));\n\t}\n\n\t_handleAllFavoritesSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function(e) {\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\n\t\t\tif (selected) {\n\t\t\t\tthis._toggleSelected(true);\n\t\t\t\tthis.favoriteModel.favorites.forEach(function(favorite) {\n\t\t\t\t\tthis.selectedFavorites[favorite.record.Id] = favorite.record;\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\tthis._toggleSelected(false);\n\t\t\t\tthis.selectedFavorites = {};\n\t\t\t}\n\n\t\t}.bind(this));\n\t}\n\n\t_toggleSelected(bool) {\n\t\tlet selected = bool ? bool : false;\n\t\tthis.$.header.selected = selected;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\trow.selected = selected;\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeSelections() {\n\t\tthis.selectedFavorites = {};\n\t\tthis._setSelected();\n\t}\n\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tonDeleteFavorite() {\n\t\tlet model = new DataBuilder()\n\t\t\t.addQuote('quoteJSON', this.le.quote)\n\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t.build();\n\n\t\tthis.$.deleteFavorite.model = model;\n\t}\n\n\ttoggleAddProducts() {\n\t\tthis._toggleSelected();\n\t\tlet params = {qId : this.qId};\n\t\tif(this.groupKey != null)\n\t\t\tparams.groupKey = this.groupKey;\n\t\tif(this.aId)\n\t\t\tparams.aId = this.aId;\n\t\tNavigator.nav('#', params, ['product', 'lookup'], false, this);\n\t}\n\n\tonShareFavorite() {\n\t\tif (Object.keys(this.selectedFavorites).length === 0) {\n\t\t\tthis.error = [\"Please select at least one favorite to share.\"]; //TODO: custom label with sb18n\n\t\t\treturn;\n\t\t}\n\t\tthis.$.shareFavorite.$.dialog.toggle();\n\t}\n\n\tonSelect() {\n\t\tlet model = new DataBuilder()\n\t\t\t.addQuote('quoteJSON', this.le.quote)\n\t\t\t.add('groupKey', this.groupKey)\n\t\t\t.add('favIds', Object.keys(this.selectedFavorites))\n\t\t\t.build();\n\n\t\tthis.$.addFavorite.model = model;\n\t}\n\n\tonSelectMore() {\n\t\tthis.addMore = true; // used to stay on page after adding favorites\n\t\tthis.onSelect();\n\t}\n\n\tonCancel() {\n\t\tNavigator.nav('#', {qId : this.qId}, ['quote', 'le'], false, this);\n\t}\n\n\tclearStackTrace() {\n\t\tif (this.errors.validations && this.errors.validations.length > 0) {\n\t\t\tthis.error = this.errors.validations;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t}\n}\n\nPolymer( FavoriteLookup );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FavoriteShareDialog{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-share-dialog';\n\t\tthis.properties = {\n\t\t\tfavdUsers: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavdGroups: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tfavoriteCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._favoriteCallbackFunction.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\ticonMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\tUser: 'sf-icon-user',\n\t\t\t\t\tGroup: 'sf-icon-groups'\n\t\t\t\t}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-share-fav', this.onCancel);\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis.toggleClass('mobile', true, this.$.dialog);\n\t}\n\n\t_favoriteCallbackFunction(searchValue) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (searchValue.length < 2) {\n\t\t\t\tthis.viewport.isMobile() ? this.$.multilookup.updateTable([]) : resolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\n\n\t\t\tthis.$.service.uid = '';\n\t\t\tthis.$.service.context = searchValue;\n\t\t\tthis.$.multilookup.menuItemLabels = ['label'];\n\n\t\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\t\tlet results =  this._parseResults(e.detail.value);\n\t\t\t\tif (this.viewport.isMobile()) { // mobile => multilookup will handle results\n\t\t\t\t\tthis.$.multilookup.updateTable(results);\n\t\t\t\t} else { // desktop => send results to typeahead\n\t\t\t\t\tresolve(results);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\t\treject(e.detail.value);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t_parseResults(results) {\n\t\tlet groups = results.groups,\n\t\t\tnumGroups = groups.length,\n\t\t\tusers = results.users,\n\t\t\tnumUsers = users.length;\n\n\t\tfor (let i=0; i<numGroups; i++) {\n\t\t\tgroups[i].type = 'Group';\n\t\t\tgroups[i].label = `Group - ${groups[i].Name}`;\n\t\t}\n\n\t\tfor (let j=0; j<numUsers; j++) {\n\t\t\tusers[j].type = 'User';\n\t\t\tusers[j].label = `User - ${users[j].Name}`;\n\t\t}\n\t\treturn users.concat(groups);\n\t}\n\n\tonShare() {\n\t\tlet selected = this.$.multilookup.selectedIdsByItems,\n\t\t\titems = Object.keys(selected).map(function(k) {\n\t\t\t\treturn selected[k];\n\t\t\t}),\n\t\t\tnumItems = items.length;\n\n\t\tfor (let i=0; i<numItems; i++) {\n\t\t\tlet type = items[i].type === 'Group' ? 'favdGroups' : 'favdUsers';\n\t\t\tthis.push(type, items[i].Id);\n\t\t}\n\n\t\tthis.fire('favorite-shared', { groups: this.favdGroups, users: this.favdUsers });\n\n\t\tthis.$.dialog.toggle();\n\t\tthis._clearFavdLists();\n\t}\n\n\tonCancel() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t_clearFavdLists() {\n\t\tthis.set('favdUsers', []);\n\t\tthis.set('favdGroups', []);\n\t\tthis.$.multilookup.clear();\n\t}\n}\n\nPolymer( FavoriteShareDialog );","export function Constants(prefix) {\n\t//object names\n\tthis.QUOTE = `${prefix}Quote__c`;\n\tthis.QUOTE_LINE = `${prefix}QuoteLine__c`;\n\tthis.QUOTE_LINE_GROUP = `${prefix}QuoteLineGroup__c`;\n\n\t//field names\n\tthis.ACCOUNT_FIELD = `${prefix}Account__r`;\n\tthis.ACCOUNT_ID_FIELD = `${prefix}Account__c`;\n\tthis.ACTION_FIELD = `${prefix}Action__c`;\n\tthis.ADDITIONAL_DISCOUNT_AMOUNT_FIELD = `${prefix}AdditionalDiscountAmount__c`;\n\tthis.ADDITIONAL_DISCOUNT_FIELD = `${prefix}AdditionalDiscount__c`;\n\tthis.ADDITIONAL_DISCOUNT_RATE_FIELD = `${prefix}Discount__c`;\n\tthis.ADDITIONAL_QUANTITY_FIELD = `${prefix}AdditionalQuantity__c`;\n\tthis.BATCH_QUANTITY = `${prefix}BatchQuantity__c`;\n\tthis.BUNDLE_FIELD = `${prefix}Bundle__c`;\n\tthis.BUNDLED_FIELD = `${prefix}Bundled__c`;\n\tthis.BUNDLED_QUANTITY_FIELD = `${prefix}BundledQuantity__c`;\n\tthis.CLASS_FIELD = `${prefix}Class__c`;\n\tthis.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD = `${prefix}ComponentDiscountedByPackage__c`;\n\tthis.COMPONENT_LIST_TOTAL_FIELD = `${prefix}ComponentListTotal__c`;\n\tthis.COMPONENT_SUBSCRIPTION_SCOPE_FIELD = `${prefix}ComponentSubscriptionScope__c`;\n\tthis.COMPONENT_VISIBILITY_FIELD = `${prefix}ComponentVisibility__c`;\n\tthis.CONDITIONS_MET_FIELD = `${prefix}ConditionsMet__c`;\n\tthis.COST_EDITABLE_FIELD = `${prefix}CostEditable__c`;\n\tthis.CUSTOM_ACTION_CONDITIONS_FIELD = `${prefix}Custom_Action_Conditions__r`;\n\tthis.CUSTOMER_AMOUNT_FIELD = `${prefix}CustomerAmount__c`;\n\tthis.CUSTOMER_PRICE_FIELD = `${prefix}CustomerPrice__c`;\n\tthis.DEFAULT_SUBSCRIPTION_TERM_FIELD = `${prefix}DefaultSubscriptionTerm__c`;\n\tthis.DEFAULT_FIELD = `${prefix}Default__c`;\n\tthis.DESCRIPTION_FIELD = `${prefix}Description__c`;\n\tthis.DIMENSION_FIELD = `${prefix}Dimension__r`;\n\tthis.DISCOUNT_AMOUNT_FIELD = `${prefix}DiscountAmount__c`;\n\tthis.DISCOUNT_SCHEDULE_FIELD = `${prefix}DiscountSchedule__c`;\n\tthis.DISCOUNT_SCHEDULE_TYPE_FIELD = `${prefix}DiscountScheduleType__c`;\n\tthis.DISCOUNT_TIER_FIELD = `${prefix}DiscountTier__c`;\n\tthis.DISCOUNT_TIERS_FIELD = `${prefix}DiscountTiers__r`;\n\tthis.DISCOUNT_UNIT_FIELD = `${prefix}DiscountUnit__c`;\n\tthis.DISTRIBUTOR_DISCOUNT_FIELD = `${prefix}DistributorDiscount__c`;\n\tthis.DISTRIBUTOR_DISCOUNT_FIELD = `${prefix}DistributorDiscount__c`;\n\tthis.EFFECTIVE_QUANTITY = `${prefix}EffectiveQuantity__c`;\n\tthis.END_DATE_FIELD = `${prefix}EndDate__c`;\n\tthis.EVENT_HANDLER_NAME_FIELD = `${prefix}EventHandlerName__c`;\n\tthis.EXISTING_FIELD = `${prefix}Existing__c`;\n\tthis.FAVORITE_ID_FIELD= `${prefix}Favorite__c`;\n\tthis.FIELD_FIELD = `${prefix}Field__c`;\n\tthis.FILTER_VALUE_FIELD = `${prefix}FilterValue__c`;\n\tthis.GROUP_LINE_ITEMS_FIELD = `${prefix}LineItemsGrouped__c`;\n\tthis.ICON_CLASS_FIELD = `${prefix}IconClass__c`;\n\tthis.LABEL_FIELD = `${prefix}Label__c`;\n\tthis.LIST_PRICE_FIELD = `${prefix}ListPrice__c`;\n\tthis.LOCATION_FIELD = `${prefix}Location__c`;\n\tthis.LONG_TEXT_AREA_FIELD = `${prefix}LongTextArea__c`;\n\tthis.LOWER_BOUND_FIELD = `${prefix}LowerBound__c`;\n\tthis.MARKUP_AMOUNT_FIELD = `${prefix}MarkupAmount__c`;\n\tthis.MARKUP_FIELD = `${prefix}Markup__c`;\n\tthis.MARKUP_RATE_FIELD = `${prefix}MarkupRate__c`;\n\tthis.NET_AMOUNT_FIELD = `${prefix}NetAmount__c`;\n\tthis.NET_PRICE_FIELD = `${prefix}NetPrice__c`;\n\tthis.NET_TOTAL_FIELD = `${prefix}NetTotal__c`;\n\tthis.NON_DISCOUNTABLE_FIELD = `${prefix}NonDiscountable__c`;\n\tthis.NON_PARTNER_DISCOUNTABLE_FIELD = `${prefix}NonPartnerDiscountable__c`;\n\tthis.NUMBER_FIELD = `${prefix}Number__c`;\n\tthis.OPERATOR_FIELD = `${prefix}Operator__c`;\n\tthis.OPPORTUNITY_FIELD = `${prefix}Opportunity2__r`;\n\tthis.OPPORTUNITY_ID_FIELD = `${prefix}Opportunity2__c`;\n\tthis.OPTION_LEVEL_FIELD = `${prefix}OptionLevel__c`;\n\tthis.OPTION_TYPE_FIELD = `${prefix}OptionType__c`;\n\tthis.OPTIONAL_FIELD = `${prefix}Optional__c`;\n\tthis.ORIGINAL_SCHEDULE_FIELD = `${prefix}OriginalDiscountSchedule__c`;\n\tthis.OVERRIDE_BEHAVIOR_FIELD = `${prefix}OverrideBehavior__c`;\n\tthis.PAGE_FIELD = `${prefix}Page__c`;\n\tthis.PARENT_CUSTOM_ACTION_FIELD = `${prefix}ParentCustomAction__c`;\n\tthis.PARTNER_DISCOUNT_FIELD = `${prefix}PartnerDiscount__c`;\n\tthis.PARTNER_PRICE_FIELD = `${prefix}PartnerPrice__c`;\n\tthis.PRICE_EDITABLE_FIELD = `${prefix}PriceEditable__c`;\n\tthis.PRICEBOOK_ID_FIELD = `${prefix}PricebookId__c`;\n\tthis.PRICING_METHOD_EDITABLE_FIELD = `${prefix}PricingMethodEditable__c`;\n\tthis.PRICING_METHOD_FIELD = `${prefix}PricingMethod__c`;\n\tthis.PRIMARY_FIELD = `${prefix}Primary__c`;\n\tthis.BRAND_BUTTON_FIELD = `${prefix}BrandButton__c`;\n\tthis.PRIOR_QUANTITY_FIELD= `${prefix}PriorQuantity__c`;\n\tthis.PRODUCT = `${prefix}Product__c`;\n\tthis.PRODUCT_CODE_FIELD = `${prefix}ProductCode__c`;\n\tthis.PRODUCT_NAME_FIELD = `${prefix}ProductName__c`;\n\tthis.PRORATE_MULTIPLIER_FIELD = `${prefix}ProrateMultiplier__c`;\n\tthis.QUANTITY_FIELD = `${prefix}Quantity__c`;\n\tthis.QUOTE_PROCESS_FIELD = `${prefix}QuoteProcess__c`;\n\tthis.QUOTE_PROCESS_ID_FIELD = `${prefix}QuoteProcessId__c`;\n\tthis.REGULAR_PRICE_FIELD = `${prefix}RegularPrice__c`;\n\tthis.RENEWAL_CHECKBOX = `${prefix}Renewal__c`;\n\tthis.RENEWED_ASSET_ID_FIELD = `${prefix}RenewedAsset__c`;\n\tthis.REQUIRED_BY_FIELD = `${prefix}RequiredBy__c`;\n\tthis.RICH_TEXT_AREA_FIELD = `${prefix}RichTextArea__c`;\n\tthis.SEGMENT_INDEX_FIELD = `${prefix}SegmentIndex__c`;\n\tthis.SEGMENT_KEY_FIELD = `${prefix}SegmentKey__c`;\n\tthis.SEGMENT_LABEL_FIELD = `${prefix}SegmentLabel__c`;\n\tthis.SOURCE_FIELD = `${prefix}Source__c`;\n\tthis.SPECIAL_PRICE_FIELD = `${prefix}SpecialPrice__c`;\n\tthis.START_DATE_FIELD = `${prefix}StartDate__c`;\n\tthis.SUBSCRIBED_ASSET_IDS_FIELD = `${prefix}SubscribedAssetIds__c`;\n\tthis.SUBSCRIPTION_BASE_FIELD = `${prefix}SubscriptionBase__c`;\n\tthis.SUBSCRIPTION_PRICING_FIELD = `${prefix}SubscriptionPricing__c`;\n\tthis.SUBSCRIPTION_SCOPE_FIELD = `${prefix}SubscriptionScope__c`;\n\tthis.SUBSCRIPTION_TERM_FIELD = `${prefix}SubscriptionTerm__c`;\n\tthis.TARGET_OBJECT_FIELD = `${prefix}TargetObject__c`;\n\tthis.TEXT_FIELD = `${prefix}Text__c`;\n\tthis.TEXT_AREA_FIELD = `${prefix}TextArea__c`;\n\tthis.TYPE_FIELD = `${prefix}Type__c`;\n\tthis.UNIT_COST_FIELD = `${prefix}UnitCost__c`;\n\tthis.UPGRADE_CONVERSION_RATE = `${prefix}UpgradeConversionRate__c`;\n\tthis.UPGRADED_ASSET_FIELD = `${prefix}UpgradedAsset__c`;\n\tthis.UPGRADED_QUANTITY = `${prefix}UpgradedQuantity__c`;\n\tthis.UPGRADED_SUBSCRIPTION_FIELD = `${prefix}UpgradedSubscription__c`;\n\tthis.UPLIFT_FIELD = `${prefix}Uplift__c`;\n\tthis.UPPER_BOUND_FIELD = `${prefix}UpperBound__c`;\n\tthis.URL_TARGET_FIELD = `${prefix}URLTarget__c`;\n\tthis.URL_FIELD = `${prefix}URL__c`;\n\tthis.RETURN_URL_FIELD = `${prefix}ReturnURL__c`;\n\tthis.USE_PRICE_FOR_AMOUNT_FIELD = `${prefix}UsePriceForAmount__c`;\n\tthis.USER_DEFINED_FIELD = `${prefix}UserDefined__c`;\n\n\t// Value\n\tthis.CUSTOM_VALUE = 'Custom';\n\n\t// Groups\n\tthis.QUANTITY_FIELDS = new Set([\n\t\tthis.ADDITIONAL_QUANTITY_FIELD,\n\t\tthis.BATCH_QUANTITY,\n\t\tthis.BUNDLED_QUANTITY_FIELD,\n\t\tthis.EFFECTIVE_QUANTITY,\n\t\tthis.PRIOR_QUANTITY_FIELD,\n\t\tthis.QUANTITY_FIELD,\n\t\tthis.UPGRADED_QUANTITY\n\t]);\n\tthis.UNIT_PRICE_FIELDS = new Set([\n\t\tthis.ADDITIONAL_DISCOUNT_FIELD,\n\t\tthis.CUSTOMER_PRICE_FIELD,\n\t\tthis.LIST_PRICE_FIELD,\n\t\tthis.MARKUP_AMOUNT_FIELD,\n\t\tthis.NET_PRICE_FIELD,\n\t\tthis.PARTNER_PRICE_FIELD,\n\t\tthis.REGULAR_PRICE_FIELD,\n\t\tthis.SPECIAL_PRICE_FIELD,\n\t\tthis.UNIT_COST_FIELD\n\t]);\n}","import {Util} from 'common/Util.js';\n\n\nexport class CustomActionModel {\n\tconstructor(editorModel, customAction, customActionModelsByParentId, renderLocation) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.record = customAction; // CustomAction__c\n\t\tthis.customActionModelsByParentId = customActionModelsByParentId;\n\t\tthis.renderLocation = renderLocation;\n\t\tthis.model // set when the hidden attribute on the sb-custom-action component is calculated through the isHidden method\n\n\t\tif (this.record) {\n\t\t\tthis.icon = this.record[this.editorModel.constants.ICON_CLASS_FIELD];\n\t\t\tthis.class = (this.icon ? this.icon : '');\n\t\t\tthis.caClass = this.record[this.editorModel.constants.CLASS_FIELD];\n\t\t\tthis.location = this.record[this.editorModel.constants.LOCATION_FIELD];\n\t\t\tthis.eventHandlerName = this.record[this.editorModel.constants.EVENT_HANDLER_NAME_FIELD];\n\t\t\tthis.label = this.record[this.editorModel.constants.LABEL_FIELD];\n\t\t\tthis.title = this.icon ? this.record[this.editorModel.constants.LABEL_FIELD] : null;\n\t\t\tthis.type = this.record[this.editorModel.constants.TYPE_FIELD];\n\t\t\tthis.isSeparator = (this.type === 'Separator');\n\t\t\tthis.primary = this.record[this.editorModel.constants.BRAND_BUTTON_FIELD];\n\t\t\tthis.urlTarget = this.record[this.editorModel.constants.URL_TARGET_FIELD];\n\t\t\tthis.url = this.record[this.editorModel.constants.URL_FIELD];\n\t\t}\n\n\t\tif (this.renderLocation === 'Line') {\n\t\t\tthis.class = `${this.class} ${this.eventHandlerName} lineAction`;\n\t\t}\n\t}\n\n\tisHidden(model) {\n\t\tif (model) {\n\t\t\tthis.model = model;\n\t\t}\n\t\tif (this.model && !this._customActionsConditionsMet) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.renderLocation === 'Line' && this.model) {\n\t\t\tif (!this.model) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onAddToFavorites\":\n\t\t\t\t\treturn this.model.favorite || this.model.component || this.model.existing;\n\t\t\t\tcase \"onRemoveFromFavorites\":\n\t\t\t\t\treturn !this.model.favorite || this.model.existing;\n\t\t\t\tcase \"onDeleteLine\":\n\t\t\t\t\treturn this.model.component || this.model.existing;\n\t\t\t\tcase \"onCloneLine\":\n\t\t\t\t\treturn this.model.component;\n\t\t\t\tcase \"onReconfigureLine\":\n\t\t\t\t\treturn !(this.model.lineVO.parentItemKey == null && this.model.configurable);\n\t\t\t\tcase \"onResegmentLine\":\n\t\t\t\t\treturn !this.model.lineVO.productHasDimensions || this.model.segmented || this.model.existing || this.model.bundle;\n\t\t\t\tcase \"onDesegmentLine\":\n\t\t\t\t\treturn !this.model.lineVO.productHasDimensions || !this.model.segmented || this.model.existing || this.model.bundle;\n\t\t\t\tcase \"showDSModal\":\n\t\t\t\t\treturn !this.model.getField(this.editorModel.constants.DISCOUNT_SCHEDULE_FIELD);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.renderLocation === 'Quote' && this.location === 'Quote/Group' && this.editorModel.quoteModel.grouped)\n\t\t\t\treturn true;\n\t\t\tswitch (this.eventHandlerName) {\n\t\t\t\tcase \"onUngroup\":\n\t\t\t\t\treturn !this.editorModel.quoteModel.grouped;\n\t\t\t\tcase \"updateLineOptional\":\n\t\t\t\t\tif (!this.editorModel.toggleOptionalShown) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn (this.caClass === 'optionalAllBtn') === this.editorModel.quoteModel.allOptional;\n\t\t\t\t\t}\n\t\t\t\tcase \"onRenewSubscriptions\":\n\t\t\t\t\treturn !this.editorModel.data.settings.renewSubscriptionsButtonRendered || this.editorModel.quoteModel.isAmendment;\n\t\t\t\tcase \"onUpgradeAssets\":\n\t\t\t\t\treturn !this.editorModel.data.settings.upgradeAssetsButtonRendered;\n\t\t\t\tcase \"onDeleteLines\":\n\t\t\t\t\treturn !this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget _customActionsConditionsMet() {\n\t\tlet constants = this.editorModel.constants;\n\t\tif (!this.record || !this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD]) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet evaluateCondition = (condition) => {\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Product') {\n\t\t\t\tif (!this.model.productVO) return true; // not enough information to say condition is not met\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.model.productVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\n\t\t\tif (condition[constants.TARGET_OBJECT_FIELD] === 'Quote') {\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.editorModel.quoteModel.quoteVO.record[condition[constants.FIELD_FIELD]],\n\t\t\t\t\tcondition[constants.FILTER_VALUE_FIELD], condition[constants.OPERATOR_FIELD]);\n\t\t\t}\n\t\t\treturn true; // if a target object isn't set, then there isn't enough information to say condition is not met\n\t\t}\n\n\t\tlet meetAllConditions = this.record[constants.CONDITIONS_MET_FIELD] !== 'Any';\n\t\tlet conditions = this.record[constants.CUSTOM_ACTION_CONDITIONS_FIELD].records;\n\n\t\tfor (let i = 0, l = conditions.length; i < l; i++) {\n\t\t\tif (evaluateCondition(conditions[i])) {\n\t\t\t\tif (!meetAllConditions) return true;\n\t\t\t} else {\n\t\t\t\tif (meetAllConditions) return false;\n\t\t\t}\n\t\t};\n\n\t\treturn meetAllConditions;\n\t}\n\n\tget hasMenu() {\n\t\tif (!this.children) {\n\t\t\tthis.children = this.customActionModelsByParentId ? this.customActionModelsByParentId[this.record.Id] : null;\n\t\t}\n\t\tif (this.type === \"Menu\" && this.children && this.children.length > 0) {\n\t\t\tfor (let i = 0, l = this.children.length; i < l; i++) {\n\t\t\t\tif (!this.children[i].isHidden(this.model))\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tget default() {\n\t\tlet isDefault = this.record[this.editorModel.constants.DEFAULT_FIELD];\n\t\tthis.record[this.editorModel.constants.DEFAULT_FIELD] = false;\n\t\treturn isDefault;\n\t}\n\n\tget customActionId() {\n\t\treturn this.record.Id;\n\t}\n}","export class DiscountTierModel {\n\tconstructor(discountTierRecord, discountScheduleRecord) {\n\t\tthis.template = discountTierRecord;\n\t\tthis.discountSchedule = discountScheduleRecord;\n\t\tthis.selected = false;\n\t\tthis.hidden = false;\n\t\tthis.disabled = false;\n\t\tthis.tiers = [];\n\t}\n}","export class DiscountTiersValidator {\n\n\tconstructor(discountSchedule, editorModel) {\n\t\tthis.schedule = discountSchedule;\n\t\tthis.editorModel = editorModel;\n\t\tthis.constants = editorModel.constants;\n\t\tthis.unitPriceScale = editorModel.data.settings.priceScale;\n\t\tthis.isMultiCurrencyOrg = editorModel.data.settings.isMultiCurrencyOrg;\n\t}\n\n\tvalidate(rows) {\n\t\tlet errors = new Map();\n\t\tlet lastTier = null;\n\t\tlet label = this.editorModel.data.customLabels;\n\t\tlet schedule = this.schedule;\n\t\trows.forEach(function(row) {\n\t\t\tlet error = null;\n\t\t\tlet number = row.template[this.constants.NUMBER_FIELD];\n\t\t\tlet lowerBound = row.template[this.constants.LOWER_BOUND_FIELD];\n\t\t\tlet upperBound = row.template[this.constants.UPPER_BOUND_FIELD];\n\t\t\tlet lastUpperBound = lastTier != null ? lastTier[this.constants.UPPER_BOUND_FIELD] : null;\n\t\t\tlet discountUnit = schedule[this.constants.DISCOUNT_UNIT_FIELD];\n\t\t\tlet discount = row.template[this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD];\n\t\t\t// Price is added to record for discount schedule modal so remove it here\n\t\t\tdelete row.template.Price;\n\t\t\tif (lowerBound == null) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_lower_bound_tier, [number]);\n\t\t\t} else if ( lastTier != null && lowerBound != lastUpperBound) {\n\t\t\t\terror = this.formatLabel(label.msg_unequal_lower_upper_bounds_tier, [number]);\n\t\t\t} else if ( discount == null && ( discountUnit == null || discountUnit.toUpperCase() === 'PERCENT')) {\n\t\t\t\terror = this.formatLabel(label.msg_missing_discount_tier, [number]);\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound ) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t} else if ( discountUnit && discountUnit.toUpperCase() === 'AMOUNT') {\n\t\t\t\trow.tiers.forEach(function(tier) {\n\t\t\t\t\tif (this.discountFormatted(tier) === null) {\n\t\t\t\t\t\tif (this.isMultiCurrencyOrg) {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier_currency, [number, row.CurrencyIsoCode]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\terror = this.formatLabel(label.msg_missing_discount_amount_tier, [number]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\t\t\t} else if ( upperBound != null && upperBound != \"\" && upperBound <= lowerBound) {\n\t\t\t\terror = this.formatLabel(label.msg_upper_greater_tier, [number]);\n\t\t\t}\n\t\t\tif (error != null) {\n\t\t\t\terrors.set(Number(number), error);\n\t\t\t}\n\t\t\tlastTier = row.template;\n\t\t}.bind(this));\n\t\treturn errors;\n\t}\n\n\tdiscountFormatted(tier) {\n\t\treturn tier[this.constants.DISCOUNT_AMOUNT_FIELD] == null ? null : (Number(tier[this.constants.DISCOUNT_AMOUNT_FIELD]).toFixed(this.unitPriceScale));\n\t}\n\n\tformatLabel(label, args) {\n\t\tfor (let i = 0, l = args.length; i < l; i++) {\n\t\t\tlabel = label.replace('{' + i + '}', args[i].toString());\n\t\t}\n\t\treturn label;\n\t}\n}","/**\n *  DragDropModel class - To create instances of the dragDrop model which holds data to be used during drag and drop of\n *  components in the line editor page.\n *\n *  Features:\n *      - Instantiate this model in the direct parent component where elements will be dragged and dropped.\n *      - Method to handle the three states of drag and drop: start, track, and stop.\n *      - Appends a placeholder component to the dom should the setting be enabled.\n *      - Uses a ghost element to indicate to the user that dragging is in progress.\n *      - Optional highlighting of drop zone is possible where appropriate.\n **/\n\nconst topBorderHighlightClass = 'droppableTopBorder';\nconst bottomBorderHighlightClass = 'droppableBottomBorder';\nconst DEFAULT_GHOST_X_OFFSET = 60;\nconst DEFAULT_GHOST_Y_OFFSET = 23;\n\nlet dragging = false;\n\nexport class DragDropModel {\n    constructor(/*Host component direct parent to draggable*/ host,\n                /*Boolean, keep bundle together setting*/ keepBundle,\n                /*Draggable element name*/ draggable,\n                /*Array of container elements that draggable can target based on element name & class*/ validTargets,\n                /*Function to handle 'start' state*/ dragFunc,\n                /*Function to handle 'track' state*/ trackFunc,\n                /*Function to handle 'end' state*/ dropFunc,\n                /*Integer*/ ghostXOffset,\n                /*Integer*/ ghostYOffset) {\n\n        this.host = host;                           //{Element} The component implementing the DragDropModel class\n        this.keepBundleTogether = keepBundle;       //{Boolean} Keep bundle together setting that determines how bundles are treated\n        this.draggable = draggable;                 //{String} Name of the draggable element\n        this.validTargets = validTargets;           //{Set(String)} Set of classnames for drop targets\n        this.sourceElement;                         //{Element} The component/element being dragged\n        this.hoverOver;                             //{Element} Element that the mouse is hovering over.\n        this.placeHolderComp = null;                //{Element} Element acting as placeholder appended before or after a\n                                                    //          valid drop target to indicate where dropping would occur\n        this.ghostField;\n        this.targetClass;                           //{String} Classname of the valid drop area.\n        this.dropBefore;                            //{Boolean} Whether to drop before a valid drop target\n        this.usePlaceholder;                        //{Boolean} If a placeholder is to be used.\n        this.highlightTargetPosition;               //{Boolean} If want to highlight target component border\n        this.highlightableElements = [];            //{Elements} Array of elements whose border can be highlighted on hover.\n        this.enableHighLight;                       //{Boolean} If a drop zone is to be highlighted.\n        this.lineEditor = document.body.querySelector('sb-page-container') ? Polymer.dom(document.body.querySelector('sb-page-container').root).querySelector('sb-line-editor') : document.body.querySelector('sb-line-editor');\n        this.linesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.linesByParentItemKey : null;\n        this.standardLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.standardLinesByParentItemKey : null;\n        this.segmentedLinesByParentKey = this.lineEditor && this.lineEditor.editorModel ? this.lineEditor.editorModel.quoteModel.segmentedLinesByParentItemKey : null;\n\n        /**\n         * Ghost information:\n         * */\n        this.ghost = null;\n        this.ghostXOffset = (ghostXOffset == null) ? DEFAULT_GHOST_X_OFFSET : ghostXOffset;\n        this.ghostYOffset = (ghostYOffset == null) ? DEFAULT_GHOST_Y_OFFSET : ghostYOffset;\n\n        /**\n        * Call back functions passed from the host element\n        * Allows user to define custom drag, track, and drop logic\n        */\n\n        this.handleDrag = dragFunc;\n        this.handleTrack = trackFunc;\n        this.handleDrop = dropFunc;\n    }\n\n    /**\n     * Primary method that handles the three states ('start, 'track', 'stop) of Polymer 'track' gesture events.\n     * Called by the 'onTrack' event on the component that is using the DragDropModel Class.\n     * @private\n     */\n\n    _onTrack(e) {\n        // Check viewport, if mobile then return\n        let mouseX = e.detail.x,\n            mouseY = e.detail.y;\n\n        _pauseEvent(e);\n        switch(e.detail.state) {\n            case 'start':\n                if (Math.abs(e.detail.dx) < 9 && Math.abs(e.detail.dy) < 4) return;\n                dragging = true;\n                //Disable text highlighting in Line Editor during drag and drop.\n                this.lineEditor.toggleClass('disable-selection', true);\n\n                this.sourceElement = Polymer.dom(e).localTarget;\n                let sourceBox = this.sourceElement.getBoundingClientRect();\n                this.sourceWidth = sourceBox.width;\n                this.sourceHeight = sourceBox.height;\n                this.handleDrag(this.sourceElement, e);\n                this._appendGhostImage(mouseX, mouseY);\n\n                break;\n\n            case 'track':\n                if(!dragging) return;\n\n                try{\n                    // Have ghost track mouseremoveTableRowBorderClass position\n                    this._moveGhost(mouseX, mouseY);\n                    // Component that mouse is hovering over.\n                    let hoverOverComp = Polymer.dom(e).event.detail.hover();\n                    if (this.draggable === 'sb-le-table-row' && (hoverOverComp.id === 'panel' || hoverOverComp.classList.contains('nav-item'))) {\n                        this._hideGhost();\n                    } else {\n                        this._showGhost();\n                    }\n                    // Call handleTrack function for custom logic during track phase\n                    this.handleTrack(hoverOverComp);\n                    this.host.debounce('Cursor flipping', function() {\n                        Polymer.RenderStatus.afterNextRender(this.lineEditor, () => {\n                            if (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n                                this.lineEditor.toggleClass('dropCursor', false);\n                                this._removePlaceholder();\n                            } else {\n                                if (hoverOverComp !== this.previousHoverOverComp){\n                                    this.lineEditor.toggleClass('dropCursor',true);\n                                }\n                                this.previousHoverOverComp = this.hoverOver.comp;\n                            }\n                        });\n                    }.bind(this), 15);\n\n                    // Return early if hoverOver object is null, which represents invalid drop target\n                    if (!this.hoverOver || Object.keys(this.hoverOver).length == 0) {\n                        this._removeHighlightHover(this.previousHoverOverComp);\n                        return;\n                    }\n                    // if 'usePlaceholder' is truthy, append placeholder to new position.\n                    this.host.debounce('Apply Placeholder', function() {\n                        this._removePlaceholder();\n                        if (this.usePlaceholder && this.hoverOver && Object.keys(this.hoverOver).length != 0) {\n                            this._usePlaceholder(mouseX, mouseY);\n                        }\n                    }.bind(this), 22);\n                    // if 'enableHighlight' of drop zone is truthy,remove previously highlighted background and highlight\n                    // current element's background.\n                    if (this.enableHighLight) {\n                        this._removeHighlightHover(this.previousHoverOverComp);\n                        this._highlightHover(this.hoverOver.comp);\n                    }\n                } catch (e){\n                    //  Revert dom changes if error is encountered\n                    this.sourceElement.toggleAttribute ? this.sourceElement.toggleAttribute('hidden', false) :\n                        this.sourceElement.removeAttribute('hidden');\n                    this._removeGhost();\n                    this._removePlaceholder();\n                    this.lineEditor.toggleClass('dropCursor', false);\n                }\n\n                break;\n\n            case 'end':\n                if(!dragging) return;\n\n                this._removePlaceholder();\n                this._removeGhost();\n\n                if(this.hoverOver){\n                    this.handleDrop(this.sourceElement, this.hoverOver.comp, this.targetClass, this.dropBefore);\n                    this._removeHighlightHover(this.hoverOver.comp);\n                } else {\n                    this.handleDrop(this.sourceElement, null, this.targetClass, this.dropBefore);\n                }\n\n                this.lineEditor.toggleClass('dropCursor', false);\n                this.sourceElement = null;\n                this.previousHoverOverComp = null;\n                this.hoverOver = {};\n                dragging = false;\n\n                //Re-enable text highlighting in Line Editor.\n                this.lineEditor.toggleClass('disable-selection', false);\n                break;\n        }\n    }\n\n    /**\n     * Method that fires an event that affects the ghost element.\n     * @param {Number} x - real number.\n     * @param {Number} y - real number.\n     * @private\n     *\n     * Fires an event to sb-line-editor component to add a ghost element to the page.\n     * @event changed-ghost\n     * @param {String} - sends a string of 'add' to indicate that a ghost will be added.\n     * @param {String} - x location in terms of number of pixels.\n     * @param {String} - y location in terms of nuber of pixels.\n     * @param {String} - width in terms of number of pixels.\n     * @param {String} - height in terms of number of pixels.\n     */\n\n    _appendGhostImage(x, y) {\n        let ghostElement = this._clonePolymerElement(this.sourceElement);\n        let loadingSpinner = ghostElement.querySelector('.loadingSpinner');\n        if (loadingSpinner) loadingSpinner.remove();\n\n        ghostElement.hidden = false;\n        let gX = (x - this.ghostXOffset) + 'px';\n        let gY = (y - this.ghostYOffset) + 'px';\n        this.ghost.style.width = this.sourceWidth + 'px';\n        this.ghost.style.height = this.sourceHeight + 'px';\n        this.ghost.style.left = gX;\n        this.ghost.style.top = gY;\n        this.ghost.style.visibility = 'visible';\n        this.ghost.appendChild(ghostElement);\n    }\n\n    /**\n     * Method that takes mouse location as parameter and moves the ghost.\n     * @param {Number} x - real number.\n     * @param {Number} y - real number.\n     * @private\n     *\n\n     */\n\n    _moveGhost(x, y) {\n        //let xOffset = (this.sourceWidth + 15)/2;\n        let gX = (x - this.ghostXOffset) + 'px',\n            gY = (y - this.ghostYOffset) + 'px';\n\n        this.ghost.style.left = gX;\n        this.ghost.style.top = gY;\n    }\n\n    /**\n     * Method that removes the ghost from page.\n     * @param {Number} x - real number.\n     * @param {Number} y - real number.\n     * @private\n     *\n     */\n\n    _removeGhost() {\n        this.ghost.innerHTML = '';\n        this.ghost.style.left = '';\n        this.ghost.style.top = '';\n        this.ghost.style.width = '';\n        this.ghost.style.height = '';\n        this.ghost.style.visibility = 'hidden';\n    }\n\n    /**\n     * Method that hides the ghost.\n     * @private\n     *\n     */\n    _hideGhost() {\n        this.ghost.style.visibility = 'hidden';\n    }\n\n    /**\n     * Method that shows the ghost.\n     * @private\n     *\n     */\n    _showGhost() {\n        this.ghost.style.visibility = 'visible';\n    }\n\n    /**\n     * Recursive method to find the droppable component where the draggable element is standard lines.\n     * During hover, the mouse may target a non-valid element. Method will recursively look for domHost, host or\n     * parentNode to find a valid drop target. If none is found, then null is returned.\n     * @param {Element} el - element that the mouse is hovering over during tracking.\n     * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n     * before, after, or both.\n     * @private\n     */\n\n    _findTableRowValidTarget(el) {\n        if (!el) return null;\n        if (this._ifParentIsValidTarget(el) && !el.classList.contains('tfoot') && el.id !== 'header'\n            && el.localName !== 'template' && el.localName !== 'sb-le-summary-row') {\n            //  Exceptions needed for standard lines to exclude footer and summary row.\n            return el;\n        }\n        if (el.domHost){\n            return this._findTableRowValidTarget(el.domHost);\n        } else if (el.host){    // For Safari and FF\n            return this._findTableRowValidTarget(el.host);\n        } else if (el.parentNode) {\n            return this._findTableRowValidTarget(el.parentNode);\n        } else {\n            return null;\n        }\n    }\n\n    _updateMDQTableRowHoverOverObject(drag, hover){\n        if (hover.lineModel.dimensionType !== drag.lineModel.dimensionType) {\n            this.hoverOver = null;\n        }else if(!this.keepBundleTogether) {\n            this.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n        } else if (drag.lineModel.component && hover.lineModel.groupModel.groupKey !== drag.lineModel.groupModel.groupKey) {\n            this.hoverOver = null;\n        } else {\n            this.hoverOver = {\"comp\": hover, \"phLoc\": 'both'};\n        }\n    }\n\n    /**\n     * Method to find the valid droppable element if the draggable element is a side panel group.\n     * @param {Object} el - object that contains the element targed on hover. Check if it's a valid drop target.\n     * @returns {Object} - Return an object that contains the valid element for dropping and whether it can be dropped\n     * before, after, or both.\n     * @private\n     */\n    _findSidePanelGroupValidTarget(el) {\n        if( this._ifParentIsValidTarget(el) ) {\n            return el;\n        } else if(el.id === 'panel') {\n            let navItems = el.querySelectorAll('.nav-item');\n            return navItems[navItems.length - 1];\n        }\n        return null;\n    }\n\n    _updateTableRowHoverOverObject(hoverElement, last) {\n        if (!hoverElement) {return;}\n        if(hoverElement.id === 'placeholder') {\n            hoverElement = hoverElement.ref === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n        }\n        if (!this.keepBundleTogether) {\n            this.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n        } else if (hoverElement.lineModel) {\n            let lineKey = hoverElement.lineModel.lineVO.key;\n            if (!isComponent(this.sourceElement) ){\n                if (!this.standardLinesByParentKey[lineKey] && !hoverElement.lineModel.component){\n                    this.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n                } else if ( hoverElement.lineModel.bundle && !hoverElement.lineModel.component ){\n                    this.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n                } else {\n                    this.hoverOver = null;\n                    return;\n                }\n            } else if (isComponent(this.sourceElement) ){\n                if (ifLineElementsShareParent(hoverElement, this.sourceElement) && ifLineElementsAreParentChild(hoverElement, hoverElement.nextElementSibling)){\n                    this.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'before'};\n                } else if (ifLineElementsShareParent(hoverElement, this.sourceElement)){\n                    this.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n                } else {\n                    this.hoverOver = null;\n                    return;\n                }\n            }\n        } else if(hoverElement.classList.contains('tfoot')){\n            this.hoverOver = null;\n        } else {\n            this.hoverOver = null;\n        }\n    }\n\n    /**\n     * Recursive method to find the dom custom element given the element's name.\n     * @param {String} nodeName - element name.\n     * @param {String} value of select; could be a value representing 'id', 'class', 'nodeName'\n     * @param {String} selector - selector used to fine element valid entries ('id', 'class', 'nodeName').\n     * @returns {Object} - Return the element if found.\n     * @public\n     */\n\n    _findParentCustomElement(el, value, selector) {\n        if (!el) return null;\n        switch(selector) {\n            case 'id':\n                if (el.id === value) {\n                    return el;\n                }\n                break;\n            case 'class':\n                if (el.classList.contains(value)) {\n                    return el;\n                }\n                break;\n            case 'nodeName':\n                if (el.nodeName === value) {\n                    return el;\n                }\n                break;\n        }\n\n        if (el.rootNode){\n            return this._findParentCustomElement(el.rootNode, value, selector);\n        } else if (el.host){\n            return this._findParentCustomElement(el.host, value, selector);\n        } else if (el.parentNode) {\n            return this._findParentCustomElement(el.parentNode, value, selector);\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n     * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n     * @private\n     */\n    _highlightHover(selected) {\n        this.host.toggleClass('hoverover', true, selected);\n    }\n\n    /**\n     * Helper method to determine whether the element being passed is a valid target.\n     * Criteria is whether the element's parent has a css class we're looking for.\n     * @param {Element} element.\n     * @private\n     */\n\n    _ifParentIsValidTarget(element) {\n        if (!element || !element.parentElement) return false;\n        let classArr = Array.from(element.parentElement.classList);\n        for (let i = 0, len = classArr.length; i < len; i ++){\n            if (this.validTargets.has(classArr[i])){\n                this.targetClass = classArr[i];\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n     * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n     * @private\n     */\n\n    _removePlaceholder() {\n        if (this.placeHolderComp && this.placeHolderComp.parentElement) {\n            this.placeHolderComp.parentElement.removeChild(this.placeHolderComp);\n            this.placeHolderComp = null;\n        }\n    }\n\n    /**\n     * If 'enableHighLight' property is truthy, apply a css class to highlight the hoverOver element during tracking.\n     * @param {Element} selected - Component that has been ascertained to be a valid drop target.\n     * @private\n     */\n    _removeHighlightHover(selected) {\n        if (!selected || !selected.parentNode) return;\n        Polymer.dom(selected.parentNode).querySelectorAll(selected.localName).forEach(\n            (node) => {\n                this.host.toggleClass('hoverover', false, node);\n            }\n        )\n    }\n\n    /**\n     * If 'highlightTargetPosition' property is truthy, css class to highlight the top or bottom highlightableElements\n     * element border during tracking.\n     * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n     * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n     * @private\n     */\n\n    _highlightDroppableBorder(x, y) {\n        let boundBox = this.hoverOver.comp.getBoundingClientRect(),\n            midHeight = boundBox.top + boundBox.height / 2,\n            results = this.highlightableElements;\n\n        switch (this.hoverOver.phLoc) {\n\n            case 'both':\n                if (y < midHeight) {\n                    for (let m = 0, l = results.length; m < l; m++) {\n                        removeTopBottomBorderClass(results[m]);\n                        _addTopBorderClass(results[m]);\n                    }\n                    this.dropBefore = true;\n                } else if (y > midHeight) {\n                    for (let m = 0, l = results.length; m < l; m++) {\n                        removeTopBottomBorderClass(results[m]);\n                        _addBottomBorderClass(results[m]);\n                    }\n                    this.dropBefore = false;\n                }\n                break;\n            case 'before':\n                for (let m = 0, l = results.length; m < l; m++) {\n                    removeTopBottomBorderClass(results[m]);\n                    _addTopBorderClass(results[m]);\n                }\n                this.dropBefore = true;\n                break;\n            case 'after':\n                for (let m = 0, l = results.length; m < l; m++) {\n                    removeTopBottomBorderClass(results[m]);\n                    _addBottomBorderClass(results[m]);\n                }\n                this.dropBefore = false;\n                break;\n        }\n    }\n\n    /**\n     * Remove the css class used to highlight the top or bottom previous highlightableElements border during tracking.\n     * @private\n     */\n\n    _removeHighlightDroppableBorder(elements) {\n        if (!elements) {return;}\n\n        for (let m = 0, l = elements.length; m < l; m++) {\n            removeTopBottomBorderClass(elements[m]);\n        }\n    }\n\n    /**\n     * If 'usePlaceholder' property is truthy, apply a placeholder to indicate to user a valid drop area.\n     * @param {Number} mouseX - mouse x position where 0 is left edge of screen.\n     * @param {Number} mouseY - mouse y position where 0 is top edge of screen.\n     * @private\n     */\n\n    _usePlaceholder(mouseX, mouseY) {\n        //Target hoverOver only if element is valid, not the same as source element, and not the placeholder.\n        if (this.hoverOver && this.hoverOver.comp !== this.placeHolderComp){\n            let boundBox = this.hoverOver.comp.getBoundingClientRect(),\n                midHeight = boundBox.top + boundBox.height/ 2;\n            if(!this.placeHolderComp){\n                this.placeHolderComp = this.host.create( this.draggable );\n                this.placeHolderComp.setAttribute('id', 'placeholder');\n                this.placeHolderComp.$$ ? this.placeHolderComp.toggleClass('placeholder', true, this.placeHolderComp.$$('.tr')) : null;\n                for (let x in this.sourceElement.properties) {\n                    if (x === 'data') {\n                        continue;\n                    }\n                    try{\n                        this.placeHolderComp[x] = this.sourceElement[x];\n                    }catch(e){/* Just catch the exception in case property is read-only*/};\n                }\n                this.placeHolderComp['data'] = this.sourceElement['data'];   // Ensure data is set last\n                this.placeHolderComp.style.width = boundBox.width + 'px';\n                this.placeHolderComp.style.height = boundBox.height + 'px';\n                this.placeHolderComp.style.backgroundColor = '#d8dde6';\n            }\n\n            switch(this.hoverOver.phLoc) {\n                case 'both':\n                    if (mouseY < midHeight){\n                        Polymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n                        this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n                        this.placeHolderComp.setAttribute('ref', 'after');\n                        this.dropBefore = true;\n                    } else if (mouseY > midHeight){\n                        Polymer.dom(this.targetHost.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n                        this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n                        this.placeHolderComp.setAttribute('ref', 'before');\n                        this.dropBefore = false;\n                    }\n                    break;\n\n                case 'before':\n                    Polymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n                    this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp);\n                    this.placeHolderComp.setAttribute('ref', 'after');\n                    this.dropBefore = true;\n                    break;\n\n                case 'after':\n                    Polymer.dom(this.host.root).querySelector('.' + this.targetClass).appendChild(this.placeHolderComp);\n                    this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp, this.hoverOver.comp.nextElementSibling);\n                    this.placeHolderComp.setAttribute('ref', 'before');\n                    this.dropBefore = false;\n                    break;\n            }\n        } else if (this.hoverOver && this.hoverOver.comp === this.placeHolderComp){\n            if (!this.placeHolderComp.hasAttribute('ref')) return;\n            if (this.placeHolderComp.getAttribute('ref') === 'before'){\n                this.hoverOver.comp = this.hoverOver.comp.previousElementSibling;\n                this.dropBefore = false;\n            } else if (this.placeHolderComp.getAttribute('ref') === 'after'){\n                this.hoverOver.comp = this.hoverOver.comp.nextElementSibling;\n                this.dropBefore = true;\n            }\n        }\n    }\n\n    _clonePolymerElement(node) {\n        let clonedElement = node.cloneNode(true);\n        for (let x in node.properties) {\n            if (x === 'data') {\n                continue;\n            }\n            try{\n                clonedElement[x] = node[x];\n            }catch(e){/* Just catch the exception in case property is read-only*/};\n        }\n        clonedElement['data'] = node['data'];   // Ensure data is set last\n        return clonedElement;\n    }\n\n}\n\n/**\n * Helper method that receives an event object and prevents further propagation of the event.\n * @param {Event} e - event object from the track event.\n * @private\n */\n\nfunction _pauseEvent(/* Event */e){\n    if(e.stopPropagation) e.stopPropagation();\n    if(e.preventDefault) e.preventDefault();\n    return false;\n}\n\n/**\n * Helper method that receives node and toggles style of the top border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addTopBorderClass(node) {\n    node.classList.add(topBorderHighlightClass);\n}\n\n/**\n * Helper method that receives node and toggles style of the bottom border.\n * @param {Element} node - DOM node.\n * @private\n */\n\nfunction _addBottomBorderClass(node) {\n    node.classList.add(bottomBorderHighlightClass);\n}\n\nexport function removeTableRowBorderClass(rowComp){\n    let tds =[];\n    tds = Array.from(Polymer.dom(rowComp.root).querySelector('.tr').getElementsByClassName('td'));\n    for (let m = 0, l = tds.length; m < l; m++) {\n        removeTopBottomBorderClass(tds[m]);\n    }\n}\n\n/**\n * Helper method that removes border style of the top and bottom border if exists.\n * @param {Element} node - DOM node.\n * @private\n */\n\nexport function removeTopBottomBorderClass(node) {\n    if (node.classList.contains(topBorderHighlightClass)) {\n        node.classList.remove(topBorderHighlightClass);\n    }\n    if (node.classList.contains(bottomBorderHighlightClass)) {\n        node.classList.remove(bottomBorderHighlightClass);\n    }\n}\n\n/**\n * Helper method check if a sb-le-table-row element is a component.\n * Check's the element's lineModel.component property.\n * @param {Element} el - checks whether element is a sb-le-table-row.\n * @public\n */\n\nexport function isComponent(/* 'sb-le-table-row' element*/ el) {\n    if (!el || !el.lineModel) return;\n    return el.lineModel.component;\n}\n\n/**\n * Helper method to determine whether two sb-le-table-row's share a common parent line item.\n * @param {Element} eL1 - first sb-le-table-row element for comparison.\n * @param {Element} eL2 - second sb-le-table-row element for comparison.\n * @public\n */\n\nexport function ifLineElementsShareParent(/* 'sb-le-table-row' element*/eL1, /* 'sb-le-table-row' element*/ eL2) {\n    if (!eL1.lineModel || !eL2.lineModel) return;\n    return eL1.lineModel.lineVO.parentItemKey === eL2.lineModel.lineVO.parentItemKey;\n}\n\n/**\n * Helper method to determine whether the one sb-le-table-row is the parent of the other.\n * @param {Element} eL1 - first sb-le-table-row element for comparison.\n * @param {Element} eL2 - second sb-le-table-row element for comparison.\n * @public\n */\n\nexport function ifLineElementsAreParentChild(/* 'sb-le-table-row' element*/eL1, /* 'sb-le-table-row' element*/ eL2) {\n    if (!eL1.lineModel || !eL2.lineModel) return;\n    return eL1.lineModel.lineVO.key === eL2.lineModel.lineVO.parentItemKey\n}\n","import {QuoteModel} from 'quotes/models/QuoteModel.js';\nimport {Constants} from 'quotes/models/Constants.js';\nimport {CustomActionModel} from 'quotes/models/CustomActionModel.js';\n\n/**\n * EditorModel class - To create a editorModel which contains the basic informaiton and reference which are used in clients \n *\n */\nexport class EditorModel {\n\tconstructor(data, md, lineEditor) {\n\t\tthis.data = data; // editorModel returned from the server\n\t\tthis.md = md;\n\t\tthis.fieldsetMap = _createFieldsetMap(this.data, this.md);\n\t\tthis.constants = new Constants(data.developerPrefix);\n\t\tthis.deviceContext = lineEditor ? lineEditor.app.deviceContext : {};\n\t\tthis.fieldNameSet = lineEditor ? lineEditor.fieldNameSet : {};\n\t\t// Sets the required property of the field md so that the \"--None--\" picklist value won't show up.\n\t\tthis.md.fieldsMap[this.data.quoteLineObjectName][this.constants.SUBSCRIPTION_SCOPE_FIELD].required = true;\n\n\t\tthis.actionsOnTheLeft = data.settings.actionsColumnPlacement === 'Left';\n\t\tthis.createQuoteModel(data.quote);\n\t\tthis.summarized = data.quote.summaries && Object.keys(data.quote.summaries).length > 0;\n\n\t\tthis.standardPrimaryMobileCols = [];\n\t\tthis.segmentedPrimaryMobileCols = [];\n\t\tthis.segmentedDetailsPrimaryMobileCols = [];\n\n\t\tthis.toggleOptionalShown = _isToggleOptionalShown(this);\n\n\t\tif (lineEditor && lineEditor.editorModel) {\n\t\t\tthis.customActionsByLocation = lineEditor.editorModel.customActionsByLocation;\n\t\t\tthis.customActionsByLocationMobile = lineEditor.editorModel.customActionsByLocationMobile;\n\t\t\tthis.groupMobileMenuButtonAction = lineEditor.editorModel.groupMobileMenuButtonAction;\n\t\t} else {\n\t\t\t_initCustomActions(data.customActions, this);\n\t\t}\n\t\tthis.quoteCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Quote : this.customActionsByLocation.Quote;\n\t\tthis.lineCustomActions = this.deviceContext.isMobile ? this.customActionsByLocationMobile.Line : this.customActionsByLocation.Line;\n\t\tthis.styleQuoteAndGroupActionButtons();\n\t\tthis.communityPrefix = this._getCommunityPrefix();\n\t}\n\n\n\t/**\n\t * To create a new quote model when new QuoteVO is coming from the server\n\t *\n\t * @param quoteVO\n\t */\n\tcreateQuoteModel(quote) {\n\t\tthis.quoteModel = new QuoteModel(quote, this);\n\t}\n\n\tstyleQuoteAndGroupActionButtons() {\n\t\tlet styleActionButtons = (location) => {\n\t\t\tlet first = true;\n\t\t\tlet actions = this.customActionsByLocation[location];\n\t\t\tlet lastCustomAction = actions[0];\n\t\t\tfor (let i = 0, l = actions.length; i < l; i++) {\n\t\t\t\tif (actions[i].isHidden(this.quoteModel)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tactions[i].first = first;\n\t\t\t\tif (actions[i].isSeparator) {\n\t\t\t\t\tfirst = true;\n\t\t\t\t\tlastCustomAction.last = true;\n\t\t\t\t} else {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tlastCustomAction = actions[i];\n\t\t\t\t\tlastCustomAction.last = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastCustomAction) {\n\t\t\t\tlastCustomAction.last = true;\n\t\t\t}\n\t\t}\n\t\tstyleActionButtons('Quote');\n\t\tstyleActionButtons('Group');\n\t}\n\n\t_getCommunityPrefix() {\n\t\tlet path = document.location.pathname;\n\t\tlet idx = path.indexOf('/apex');\n\t\tif (idx < 0) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.substring(0, idx);\n\t}\n}\n\n/**\n * Recreates fieldsets after applying field level security\n * Relies on the metadata retrieved from describe.js\n * @param data\n * @param md\n * @returns {{}} object of fieldsets mapped by fieldset name\n * @private\n */\nlet _createFieldsetMap = (data, md) => {\n\tlet fieldsetList = _createFieldsetList(data.developerPrefix);\n\tlet fieldsetMap = {};\n\tfieldsetList.forEach( (fieldset) => {\n\t\tif (!data[fieldset.name]) {\n\t\t\tfieldsetMap[fieldset.name] = data[fieldset.name];\n\t\t\treturn;\n\t\t}\n\t\tfieldsetMap[fieldset.name] = [];\n\t\tdata[fieldset.name].forEach( (field) => {\n\t\t\tif (md.fieldsMap[fieldset.table][field]) {\n\t\t\t\tfieldsetMap[fieldset.name].push(field);\n\t\t\t};\n\t\t});\n\t});\n\treturn fieldsetMap;\n};\n\nlet _createFieldsetList = (prefix) => {\n\treturn [{ table: prefix + 'QuoteLine__c', name : 'lineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesTablet' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'lineFieldNamesPhone' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLine__c', name : 'multiSegmentLineSummaryFieldNames' },\n\t\t\t{ table: prefix + 'DiscountTier__c', name : 'discountScheduleModalFieldNames' },\n\t\t\t{ table: prefix + 'Quote__c', name : 'quoteFieldNames' },\n\t\t\t{ table: prefix + 'QuoteLineGroup__c', name : 'groupFieldNames' }];\n};\n\nlet _isToggleOptionalShown = (editorModel) => {\n\tlet containsOptional_Field = (lineFieldNames) => {\n\t\tfor (let i = 0, l = lineFieldNames.length; i < l; i++) {\n\t\t\tif (lineFieldNames[i] === editorModel.constants.OPTIONAL_FIELD)\n\t\t\t\treturn true;\n\t\t}\n\t}\n\treturn containsOptional_Field(editorModel.fieldsetMap.lineFieldNames) || containsOptional_Field(editorModel.fieldsetMap.multiSegmentLineFieldNames);\n}\n\n/**\n * [_initCustomActions description]\n * @param  {[type]} customActions [description]\n * @return {[type]}               [description]\n */\nlet _initCustomActions = (customActions, editorModel) => {\n\teditorModel.defaultCustomActions = [];\n\tlet validLocations = ['Quote', 'Group', 'Line'];\n\tlet customActionsByLocation = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByLocationMobile = {'Quote': [], 'Group': [], 'Line':[]};\n\tlet customActionsByParentId = {'Quote': {}, 'Group': {}, 'Line':{}};\n\tlet addGroupCustomActionModel;\n\n\tlet addToLocation = (customAction, location) => {\n\t\tif(validLocations.indexOf(location) === -1)\n\t\t\treturn; // not a valid location, so we bail\n\t\t\n\t\tlet customActionModel = new CustomActionModel(editorModel, customAction, customActionsByParentId[location], location);\n\t\tif (!customActionModel.isSeparator) {\n\t\t\tcustomActionsByLocationMobile[location].push(customActionModel);\n\t\t}\n\t\t\n\t\t// Grab all the default Custom Actions\n\t\tif (customActionModel.default) {\n\t\t\teditorModel.defaultCustomActions.push(customActionModel);\n\t\t}\n\n\t\t// Grab the addGroup custom action in case solution groups used. If so, add solution groups as children\n\t\tif (customActionModel.eventHandlerName === 'onAddGroup') {\n\t\t\taddGroupCustomActionModel = customActionModel;\n\t\t}\n\n\t\t// If it has a parent, add it to the parent and not main array.\n\t\tif (customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD]) {\n\t\t\tlet parentId = customAction[editorModel.constants.PARENT_CUSTOM_ACTION_FIELD];\n\t\t\tlet childCustomActions = customActionsByParentId[location][parentId];\n\t\t\tif (childCustomActions) {\n\t\t\t\tchildCustomActions.push(customActionModel);\n\t\t\t} else\n\t\t\t\tcustomActionsByParentId[location][parentId] = [customActionModel];\n\t\t} else {\n\t\t\tcustomActionsByLocation[location].push(customActionModel);\n\t\t}\n\t}\n\t\n\tfor (let i = 0, l = customActions.length; i < l; i++) {\n\t\tlet location = customActions[i][editorModel.constants.LOCATION_FIELD];\n\t\tif (location === 'Quote/Group') {\n\t\t\taddToLocation(customActions[i], 'Quote');\n\t\t\taddToLocation(customActions[i], 'Group');\n\t\t} else if (location && location !== 'Configurator')\n\t\t\taddToLocation(customActions[i], location);\n\t}\n\n\teditorModel.customActionsByLocation = customActionsByLocation;\n\teditorModel.customActionsByLocationMobile = customActionsByLocationMobile;\n\teditorModel.groupMobileMenuButtonAction = new CustomActionModel(editorModel);\n\teditorModel.groupMobileMenuButtonAction.children = customActionsByLocationMobile.Group;\n\n\t// Setup Solution Groups\n\tif (editorModel.data.settings.solutionGroupsEnabled && editorModel.data.solutionGroups.length > 0 && addGroupCustomActionModel) {\n\t\tlet solutionGroups = editorModel.data.solutionGroups;\n\t\tlet addGroupChildren = customActionsByParentId.Quote[addGroupCustomActionModel.record.Id] || [];\n\t\taddGroupCustomActionModel.type = 'Menu';\n\t\tfor (let j = 0, sgL = solutionGroups.length; j < sgL; j++) {\n\t\t\tlet solutionGroupAction = new CustomActionModel(editorModel, solutionGroups[j]);\n\t\t\tsolutionGroupAction.type = 'Solution Group';\n\t\t\tsolutionGroupAction.eventHandlerName = 'onAddGroup';\n\t\t\tsolutionGroupAction.label = solutionGroups[j].Name;\n\t\t\taddGroupChildren.push(solutionGroupAction);\n\t\t}\n\t\taddGroupCustomActionModel.children = addGroupChildren;\n\t}\n\n}","import {LineModel} from 'quotes/models/LineModel.js';\n/**\n * GroupModel - contains the QuoteLineGroupVO and linked with the quoteModel\n *\n * Feature:\n *      1. Contains QuoteLineGroupVO which is the same as the server\n *      2. Linked with QuoteModel\n *      3. Builds the standardLines array that stores the LineModels\n *      4. Builds the dimensions array that stores the price dimensions to keep the order of dimensions on the page\n *      5. Builds the segmentedLinesByDimension object that stores the segmented LineModels by dimension\n *      6. Builds the segmentedLinesBySegmentKey object that stores the segmented LineModels by segment key\n *      (Segment key is unique to each product)\n */\nexport class GroupModel {\n\tconstructor(groupVO, quoteModel) {\n\t\tthis.groupVO = groupVO;\n\t\tthis.groupKey = groupVO.key;\n\t\tthis.quoteModel = quoteModel;\n\n\t\tthis.standardLines = [];\n\t\tthis.segmentedLines = [];\n\t\tthis.dimensions = [];\n\t\tthis.dimensionsMap = {};\n\t\tthis.segmentedLinesByDimension = {}; //stores lineModels in the order the UI needs (arrays of lineModels per dimension)\n\t\tthis.segmentedLinesBySegmentKey = {}; // stores lineModels by segment key for easy reference\n\t\tthis.segmentedLineKeysBySegmentKey = {}; // stores keys by segment key for easy reference\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t\tthis.groupObjectName = this.constants.QUOTE_LINE_GROUP;\n\t\tthis.summaries = this.quoteModel.grouped ? this.groupVO.summaries : this.quoteModel.quoteVO.summaries;\n\t\tthis.multiSegmentColumnTotals = this.groupVO.multiSegmentColumnTotals ? this.groupVO.multiSegmentColumnTotals : this.quoteModel.quoteVO.multiSegmentColumnTotals;\n\t\tthis.netMultiSegmentTotal = this.groupVO.netMultiSegmentTotal ? this.groupVO.netMultiSegmentTotal : this.quoteModel.quoteVO.netMultiSegmentTotal;\n\t\tthis.hasVisibleStandardLines = false;\n\t\tthis.hasVisibleSegmentedLines = {};\n\t}\n\n\t// getters\n\n\tget editorModel() {\n\t\treturn this.quoteModel.editorModel;\n\t}\n\n\tget constants() {\n\t\treturn this.quoteModel.editorModel.constants;\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\t// helper methods\n\n\t/**\n\t * Creates a LineModel for the LineVO and adds to the appropriate array depending on type (standard vs segmented)\n\t * Will also populate the lineModelsByKey object in QuoteModel\n\t * @param lineVO\n\t */\n\taddLine(lineVO) {\n\t\tlet lineModel = new LineModel(lineVO, this);\n\t\tthis.quoteModel.lineModelsByKey[lineModel.lineVO.key] = lineModel;\n\t\tif (!lineModel.segmented) {\n\t\t\tthis._addStandardLine(lineModel);\n\t\t} else {\n\t\t\tthis._addSegmentedLine(lineModel);\n\t\t}\n\t\tif (lineModel.lineVO.parentItemKey && (!lineModel.segmented || (lineModel.segmented && lineModel.segments))) {\n\t\t\t\tthis.addToLinesByParentItemKey(lineModel);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param lineModel\n\t * @private\n\t */\n\t_addStandardLine(lineModel) {\n\t\tif (lineModel.visible) {\n\t\t\tthis.hasVisibleStandardLines = true;\n\t\t}\n\t\tthis.quoteModel.indexByGroupKey[lineModel.lineVO.parentGroupKey].indexByLineKey[lineModel.lineVO.key] = this.standardLines.length;\n\t\tthis.standardLines.push(lineModel);\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped)\n\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t}\n\n\t/**\n\t * Each segment of a segmented product is represented as a separate lineVO and eventually lineModel.\n\t * We create a lineModel to represent the summary line item on the segmented products table off of the 1st segment.\n\t * And all segments are added to the segments array of their parent lineModel (summary line item).\n\t *\n\t * Creates a segments array for the lineModel, and either adds the lineModel to the appropriate dimension or\n\t * adds the lineModel to the segments array of its parent summary.\n\t * @param lineModel\n\t * @private\n\t */\n\t_addSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.quoteVO.multiSegmentKeys) ? this.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\n\t\tif (this.segmentedLinesBySegmentKey[segmentKey]) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = this.segmentedLinesBySegmentKey[segmentKey].segments.length;\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tlineModel.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segments.push(lineModel);\n\t\t\tthis.segmentedLinesBySegmentKey[segmentKey].segmentsByLabel[segmentLabel] = lineModel;\n\t\t} else {\n\t\t\tif (lineModel.visible && !this.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tthis.hasVisibleSegmentedLines[dimension] = true;\n\t\t\t}\n\t\t\tlet firstSegment = new LineModel(lineVO, this);\n\t\t\tthis.setDimensionProperties(dimension);\n\t\t\tlineModel.addToSegmentsArray(firstSegment); // create list of lineModels per segments (in order)\n\t\t\tlineModel.addToSegmentsByLabel(segmentLabel, lineModel); // create map of lineModels by segment label for easy access\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[lineKey] = lineModel.segments.length - 1;\n\t\t\tfirstSegment.segmentedLineKey = this.segmentedLineKeysBySegmentKey[segmentKey];\n\t\t\tthis.segmentedLines.push(lineModel);\n\t\t\tif ( dimension ) {\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = this.segmentedLinesByDimension[dimension].length;\n\t\t\t\tthis.segmentedLinesByDimension[dimension].push(lineModel);\n\t\t\t\tthis.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\t\t\tlineModel.dimensionType = dimension;\n\t\t\t}\n\t\t}\n\n\t\tif (lineModel.subscriptionScopeEditable && this.quoteModel.grouped)\n\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t}\n\n\tremoveDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (this.segmentedLinesByDimension[dim] && this.segmentedLinesByDimension[dim].length === 0) {\n\t\t\tdelete this.segmentedLinesByDimension[dim];\n\n\t\t\tif (this.dimensionsMap[dim]) {\n\t\t\t\tdelete this.dimensionsMap[dim];\n\t\t\t}\n\t\t\tthis.dimensions.splice(this.dimensions.indexOf(dim), 1);\n\t\t}\n\t}\n\n\tsetDimensionProperties (dim) {\n\t\tif (!dim) { return; }\n\t\tif (!this.dimensionsMap[dim]) {\n\t\t\tthis.dimensionsMap[dim] = true;\n\t\t\tthis.dimensions.push(dim);\n\t\t}\n\t\tif (!this.segmentedLinesByDimension[dim]) {\n\t\t\tthis.segmentedLinesByDimension[dim] = [];\n\t\t}\n\t}\n\n\t/**\n\t * Adds lineModels into linesByParentItemKey map on the quoteModel\n\t * @param lineModel\n\t */\n\taddToLinesByParentItemKey(lineModel) {\n\t\tlet map = this.quoteModel.linesByParentItemKey,\n\t\t\tstdMap = this.quoteModel.standardLinesByParentItemKey,\n\t\t\tmdqMap = this.quoteModel.segmentedLinesByParentItemKey,\n\t\t\tparentItemKey = lineModel.lineVO.parentItemKey;\n\t\tif (parentItemKey) {\n\t\t\tif (!map[parentItemKey]) {\n\t\t\t\tmap[parentItemKey] = [];\n\t\t\t}\n\t\t\tmap[parentItemKey].push(lineModel);\n\t\t\tif (!lineModel.segmented) {\n\t\t\t\tif (!stdMap[parentItemKey]) {\n\t\t\t\t\tstdMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tstdMap[parentItemKey].push(lineModel);\n\t\t\t} else {\n\t\t\t\tif (!mdqMap[parentItemKey]) {\n\t\t\t\t\tmdqMap[parentItemKey] = [];\n\t\t\t\t}\n\t\t\t\tmdqMap[parentItemKey].push(lineModel);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a clone of the passed in standard lineModel\n\t * @param line - lineModel\n\t * @returns {lineModel} - cloned lineModel\n\t */\n\tcloneLine(line, parentItemKey) {\n\t\tlet newLineVO = JSON.parse(JSON.stringify(line.lineVO));\n\t\tnewLineVO.record = JSON.parse(JSON.stringify(line.lineVO.record));\n\t\tlet clone = new LineModel(newLineVO, line.groupModel);\n\t\tclone.lineVO.parentItemKey = parentItemKey ? parentItemKey : null; // Update clone's parentItemKey to create the new bundle-component linkage\n\t\tif (clone.segmented && !line.segmentedLineKey) {\n\t\t\tclone.segments = [];\n\t\t\tclone.segmentsByLabel = {};\n\t\t}\n\t\tclone.lineVO.record.Id = null; // Record Id needs to be removed to avoid upsert duplication error\n\t\t// Avoid original cloned bundle quote line RequiredBy__c field being referenced after it had been deleted\n\t\tclone.lineVO.record[this.constants.REQUIRED_BY_FIELD] = null;\n\t\t// Add original quote line as the source in the cloned quote line\n\t\tclone.lineVO.record[this.constants.SOURCE_FIELD] = line.lineVO.record['Id'];\n\t\t// If line is being cloned from amend on contract\n\t\tif (line.editorModel.quoteModel.quoteVO.record[this.constants.TYPE_FIELD] === 'Amendment') {\n\t\t\tclone.lineVO.record[this.constants.EXISTING_FIELD] = false;\n\t\t\tclone.lineVO.record[this.constants.RENEWAL_CHECKBOX] = false;\n\t\t\tclone.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.UPGRADED_SUBSCRIPTION_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.NET_TOTAL_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD] = null;\n\t\t\tclone.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD] = null;\n\n\t\t\t// Update variables on the line for the UI\n\t\t\tclone.existing = false;\n\t\t\tclone.removable = !clone.component && !clone.existing;\n\n\t\t\tif (!clone.component) { // Set fields\n\t\t\t\tclone.discountEditable = true;\n\t\t\t}\n\t\t}\n\t\tclone.lineVO.key = ++clone.editorModel.quoteModel.quoteVO.nextKey;\n\t\treturn clone;\n\t}\n\n\t/**\n\t * Creates a clone of the passed in segmented lineModel including cloned segments\n\t * @param line - original segmented summary lineModel\n\t * @param parentItemKey - key of the parent lineModel if this lineModel is a component\n\t * @returns {lineModel} - returns cloned summary segmented lineModel with its cloned segment\n\t */\n\tcloneSegmentedLine(line, parentItemKey) {\n\t\tlet clone = this.cloneLine(line, parentItemKey);\n\t\tclone.lineVO.segmentKey = new Date().getTime(); // Segment keys are created in the same fashion on the server side.\n\t\tlet multiSegmentRowTotals = this.quoteModel.quoteVO.multiSegmentRowTotals;\n\t\tif (multiSegmentRowTotals) {\n\t\t\tmultiSegmentRowTotals[clone.lineVO.segmentKey] = multiSegmentRowTotals[line.lineVO.record[this.constants.SEGMENT_KEY_FIELD]]; // There is a bug where multiSegmentedRowTotals aren't reproduced in new groups.\n\t\t}\n\n\t\tthis.segmentedLinesBySegmentKey[clone.lineVO.segmentKey] = clone;\n\t\tthis.quoteVO.multiSegmentKeys[clone.lineVO.segmentKey] = clone.lineVO.dimensionType;\n\n\t\tfor (let i = 0, l = line.segments.length; i < l; i++) {\n\t\t\tlet clonedSegment = this.cloneLine(line.segments[i]);\n\t\t\tclonedSegment.lineVO.record[this.constants.SEGMENT_KEY_FIELD] = clone.lineVO.segmentKey; // This needs to match its parent summary's segment key\n\t\t\tclonedSegment.lineVO.parentItemKey = clone.lineVO.parentItemKey; // Segments have the same parentItemKeys as its parent summary line, if it's bundled\n\t\t\t// Segmented line key is used for differentiating summaryLine from other segment lines\n\t\t\tclonedSegment.segmentedLineKey = clone.lineVO.key;\n\t\t\tif (clone.segments) {\n\t\t\t\tclone.segments.push(clonedSegment);\n\t\t\t}\n\t\t\tif (clone.segmentsByLabel) {\n\t\t\t\tlet label = clonedSegment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\t\tclone.segmentsByLabel[label] = clonedSegment;\n\t\t\t}\n\t\t}\n\t\tclone.dimensionType = line.dimensionType;\n\n\t\treturn clone;\n\t}\n\n\t_groupHasStandardProducts() {\n\t\tthis.hasVisibleStandardLines = false;\n\t\tfor (let j = 0, l = this.standardLines.length; j < l; j ++) {\n\t\t\tif (this.standardLines[j].visible) {\n\t\t\t\tthis.hasVisibleStandardLines = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this.hasVisibleStandardLines;\n\t}\n\n\t_groupHasSegmentedProducts() {\n\t\tlet dimensions = Object.keys(this.hasVisibleSegmentedLines);\n\t\tlet result = false;\n\t\tfor (let s in this.segmentedLinesByDimension) {\n\t\t\tthis.hasVisibleSegmentedLines[s] = false;\n\t\t\tfor(let k = 0, l = this.segmentedLinesByDimension[s].length; k < l; k ++ ){\n\t\t\t\tif (this.segmentedLinesByDimension[s][k].visible) {\n\t\t\t\t\tthis.hasVisibleSegmentedLines[s] = true;\n\t\t\t\t\tresult = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateStandardSubscriptionScopeEditable(removedLine) {\n\t\tfor (let j = 0, l = this.standardLines.length; j < l; j ++) {\n\t\t\tif (this.standardLines[j].visible && this.standardLines[j].subscriptionScopeEditable && this.standardLines[j] !== removedLine) {    //ignore the removed line\n\t\t\t\tthis.standardSubscriptionScopeEditable = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.standardSubscriptionScopeEditable = false;\n\t}\n\n\t/**\n\t * Only runs if the drag element has subscription scope editable\n\t * @private\n\t */\n\t_updateSegmentedSubscriptionScopeEditable(removedLine) {\n\t\tfor (let j = 0, l = this.segmentedLines.length; j < l; j ++) {\n\t\t\tif (this.segmentedLines[j].visible && this.segmentedLines[j].subscriptionScopeEditable && this.segmentedLines[j] !== removedLine) {     //ignore the removed line\n\t\t\t\tthis.segmentedSubscriptionScopeEditable = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.segmentedSubscriptionScopeEditable = false;\n\t}\n\n\tget serviceModel() {\n\t\treturn {\n\t\t\tkeys: [this.groupVO.key],\n\t\t\tfavIds: [this.groupVO.record[this.editorModel.constants.FAVORITE_ID_FIELD]]\n\t\t}\n\t}\n\n\t/**\n\t * Recreates the indexByGroupKey after a front end operation that changes the index of line items\n\t */\n\trenumberStandardIndexes() {\n\t\tfor (let i = 0, l = this.standardLines.length; i < l; i++) {\n\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[this.standardLines[i].lineVO.key] = i;\n\t\t}\n\t}\n\n\trenumberSegmentedIndexes() {\n\t\tfor (let j = 0, d = this.dimensions.length; j < d; j++) {\n\t\t\tlet dimension = this.dimensions[j];\n\t\t\tlet lineItems = this.segmentedLinesByDimension[dimension];\n\t\t\tfor (let k = 0, length = lineItems.length; k < length; k++) {\n\t\t\t\tvar segmentKey = lineItems[k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[segmentKey] = k;\n\t\t\t\tlet segments = lineItems[k].segments;\n\t\t\t\tfor (let m = 0, len = segments.length; m < len; m ++) {\n\t\t\t\t\tthis.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[segments[m].lineVO.key] = m;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}","/**\n * JSQCNotifier class - Sends out notifyPaths each time a property on QuoteModel, QuoteLineGroupModel, or QuoteLineModel change\n *\n * Used to make polymer components aware of sub-property changes during JSQC calculate\n */\nexport class JSQCNotifier {\n\tconstructor(lineEditorComponent) {\n\t\tthis.lineEditorComponent = lineEditorComponent;\n\t\tthis.editorModel = this.lineEditorComponent.editorModel;\n\t\tthis.indexByGroupKey = this.editorModel.quoteModel.indexByGroupKey;\n\t\tthis.fieldNameSet = this.lineEditorComponent.editorModel.fieldNameSet;\n\t\tthis.fieldNameSet.add('multiSegmentRowTotals');\n\t\tthis.fieldNameSet.add('multiSegmentColumnTotals');\n\t\tthis.fieldNameSet.add('netMultiSegmentTotal');\n\t\tthis.fieldNameSet.add('summaries');\n\t\tthis.fieldNameSet.add('fieldVisibility');\n\t\tthis.fieldNameSet.add('fieldEditability');\n\t\tthis.constants = this.editorModel.constants;\n\t\tthis.pathsToNotify = {};\n\t\tthis.originalPathValues = {};\n\t\tthis.pathsToSet = {};\n\n\t\tthis.groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tthis.quoteVO = this.editorModel.quoteModel.quoteVO;\n\t}\n\n\t/**\n\t * notifies the correct path based on which sub-property was changed and what object it came from in the JSQC\n\t *\n\t * @param root\n\t * @param path\n\t * @param value\n\t * @param modelVO\n\t *\n\t */\n\tnotify(root, path, value, modelVO, previous) {\n\t\tlet groupIndex;\n\t\tlet lineIndex;\n\n\t\t// Only notifies paths for fields on the quote, quote line group, or quote line field sets\n\t\t// Currently manually adding fields to set from VO's that are related to rendered fields\n\t\tif (!this.fieldNameSet.has(path.split('.').pop())) {\n\t\t\treturn;\n\t\t}\n\t\tif (root == 'QuoteModel') {\n\t\t\t// Notify QuoteVO and record level fields\n\t\t\tthis.notifyPath(`editorModel.quoteModel.quoteVO.${path}`, value, previous, root);\n\t\t\t// Used to update the total column for MDQ products\n\t\t\tif (path == 'multiSegmentRowTotals') {\n\t\t\t\tfor (let i = 0, l = this.groupModels.length; i < l; i++) {\n\t\t\t\t\tlet dimensions = this.groupModels[i].dimensions;\n\t\t\t\t\tfor (let j = 0, length = dimensions.length; j < length; j ++) {\n\t\t\t\t\t\tfor (let k = 0, len = this.groupModels[i].segmentedLinesByDimension[dimensions[j]].length; k < len; k++) {\n\t\t\t\t\t\t\tlet segmentKey = this.groupModels[i].segmentedLinesByDimension[dimensions[j]][k].lineVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\t\t\t\t\t\t// TODO Use localized value for total\n\t\t\t\t\t\t\tthis.notifyPath(`groupModels.${i}.segmentedLinesByDimension.${dimensions[j]}.${k}.total`, value[segmentKey], previous, root);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (modelVO.grouped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet groupIndex = this.indexByGroupKey[this.groupModels[0].groupVO.key].index;\n\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t// Notify GroupVO and record level fields\n\t\t} else if (root == 'QuoteLineGroupModel') {\n\t\t\tif ( this.indexByGroupKey[modelVO.key] != null && this.indexByGroupKey[modelVO.key].index != null ) {\n\t\t\t\tgroupIndex = this.indexByGroupKey[modelVO.key].index;\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.groupVO.${path}`, value, previous, root);\n\t\t\t\tthis.notifySpecificPath(groupIndex, path, modelVO, value, previous, root);\n\t\t\t}\n\t\t// Notify LineVO and record level fields\n\t\t} else if (root == 'QuoteLineModel') {\n\t\t\tgroupIndex = this.indexByGroupKey[modelVO.parentGroupKey].index;\n\t\t\tlineIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexByLineKey[modelVO.key];\n\t\t\t// Used to update the horizontal MDQ row that displays net total of each segment for a single product\n\t\t\tif (modelVO.record[this.constants.SEGMENT_KEY_FIELD]) {\n\t\t\t\tvar dimensionType = modelVO.parentQuote.multiSegmentKeys[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tlet segmentIndex = this.indexByGroupKey[modelVO.parentGroupKey].indexBySegmentKey[modelVO.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.segments.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t\tif (path == 'record.' + [this.constants.NET_TOTAL_FIELD]) {\n\t\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimensionType}.${segmentIndex}.` + modelVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, ''), value, previous, root);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// StandardLines notification\n\t\t\t\tthis.notifyPath(`groupModels.${groupIndex}.standardLines.${lineIndex}.lineVO.${path}`, value, previous, root);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Used to update the subtotal row that sums all the net totals at the bottom of MDQ section\n\t * Also updates summary lines\n\t * These paths have to match properties set on the polymer group component to work\n\t * @param element\n\t * @param path\n\t * @param modelVO\n\t * @param value\n\t */\n\tnotifySpecificPath(groupIndex, path, modelVO, value, previous, root) {\n\t\tif (path != 'multiSegmentColumnTotals' && path != 'netMultiSegmentTotal' && path != 'summaries') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (path == 'summaries') {\n\t\t\tthis.set(`groupModels.${groupIndex}.summaries`, value, previous, root);\n\t\t\treturn;\n\t\t}\n\n\t\tvar dimensions = modelVO.localizedMultiSegmentColumns ? Object.keys(modelVO.localizedMultiSegmentColumns) : Object.keys(modelVO.multiSegmentColumnTotals);\n\n\t\t// Updates segmented lines sub totals\n\t\tfor (let i = 0, dimensionsLength = dimensions.length; i < dimensionsLength; i++) {\n\t\t\tlet columns = (path == 'netMultiSegmentTotal') ? modelVO.netMultiSegmentTotal[dimensions[i]] : modelVO.multiSegmentColumnTotals[dimensions[i]];\n\t\t\tif (path == 'netMultiSegmentTotal') {\n\t\t\t\tthis.set(`groupModels.${groupIndex}.netMultiSegmentTotal.${dimensions[i]}`, value[dimensions[i]], previous, root);\n\t\t\t} else {\n\t\t\t\tlet columnKeys = Object.keys(columns);\n\t\t\t\tfor (let j = 0, columnsLength = columnKeys.length; j < columnsLength; j++) {\n\t\t\t\t\tthis.set(`groupModels.${groupIndex}.multiSegmentColumnTotals.${dimensions[i]}.${columnKeys[j]}`, value[dimensions[i]][columnKeys[j]], previous, root);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Collects map of paths and values to notify after calculate is complete\n\t * @param path\n\t * @param value\n\t */\n\tnotifyPath(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToNotify[path] = { value : value, root : root };\n\t}\n\n\tset(path, value, previous, root) {\n\t\tif(!this.originalPathValues.hasOwnProperty(path))\n\t\t\tthis.originalPathValues[path] = previous;\n\t\tthis.pathsToSet[path] = { value : value, root : root };\n\t}\n}","export class LineModel {\n\tconstructor(lineVO, groupModel) {\n\t\tthis.lineVO = lineVO;\n\t\tthis.groupModel = groupModel;\n\t\tthis.selected = false;\n\t\tthis.expandedIconClass = this._getExpansionClass();\n\t\tthis.visible = this.isVisibleInLineEditor();\n\n\t\t// Default pricing method\n\t\tif (this.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] == null) {\n\t\t\tthis.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] = 'List';\n\t\t}\n\t}\n\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\tget fieldNames() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget component() {\n\t\t// When MDQ item has option level, it's still not a component.\n\t\treturn (this.lineVO.record[this.fieldNames.OPTION_LEVEL_FIELD] != null && this.lineVO.dimensionType == null);\n\t}\n\n\tget subscription() {\n\t\treturn (this.lineVO.record[this.fieldNames.SUBSCRIPTION_PRICING_FIELD] != null);\n\t}\n\n\tget dynamicSubscription() {\n\t\treturn (this.lineVO.record[this.fieldNames.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total');\n\t}\n\n\tget dynamic() {\n\t\treturn (this.lineVO.record[this.fieldNames.SUBSCRIPTION_PRICING_FIELD] == 'Percent Of Total' || this.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] == 'Percent Of Total');\n\t}\n\n\tget subscriptionScopeEditable() {\n\t\treturn this.dynamic && (this.lineVO.record[this.fieldNames.COMPONENT_SUBSCRIPTION_SCOPE_FIELD] == null) && (this.lineVO.record[this.fieldNames.SUBSCRIBED_ASSET_IDS_FIELD] == null);\n\t}\n\n\tget rootPackage() {\n\t\treturn (this.bundle || (this.lineVO.productPullIns && (this.lineVO.productPullIns.hasConfiguration || this.lineVO.productPullIns.hasConfigurationAttributes))) && !this.component;\n\t}\n\n\tget legacySupport() {\n\t\treturn (!(this.lineVO.record[this.fieldNames.RENEWAL_CHECKBOX] == true && this.lineVO.record[this.fieldNames.EXISTING_FIELD] != true && this.lineVO.record[this.fieldNames.PRIOR_QUANTITY_FIELD] == null)) || this.editorModel.data.settings.renewalQuotesWithoutAssetsAllowed;\n\t}\n\n\tget quantityEditable() {\n\t\treturn ((this.lineVO.record[this.fieldNames.BUNDLED_QUANTITY_FIELD] == null) || !this.component) && this.legacySupport && (this.lineVO.productQuantityEditable) || (this.lineVO.quantityEditable == true);\n\t}\n\n\tget costEditable() {\n\t\treturn (this.lineVO.record[this.fieldNames.COST_EDITABLE_FIELD] == true);\n\t}\n\n\tget unitCostEditable() {\n\t\treturn this.costEditable && !this.bundled && !this.dynamic;\n\t}\n\n\tget pricingMethodList() {\n\t\treturn (this.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] == 'List');\n\t}\n\n\tget pricingMethodCustom() {\n\t\treturn (this.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] == 'Custom');\n\t}\n\n\tget pricingMethodCost() {\n\t\treturn (this.lineVO.record[this.fieldNames.PRICING_METHOD_FIELD] == 'Cost');\n\t}\n\n\tget pricingMethodDisabled() {\n\t\treturn this.dynamicSubscription || this.bundled || !(this.lineVO.record[this.fieldNames.PRICING_METHOD_EDITABLE_FIELD]);\n\t}\n\n\tget bundled() {\n\t\treturn (this.lineVO.record[this.fieldNames.BUNDLED_FIELD] == true);\n\t}\n\n\tget bundle() {\n\t\treturn (this.lineVO.record[this.fieldNames.BUNDLE_FIELD] == true);\n\t}\n\n\tget nonDiscountable() {\n\t\treturn (this.lineVO.record[this.fieldNames.NON_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\tget nonPartnerDiscountable() {\n\t\treturn (this.lineVO.record[this.fieldNames.NON_PARTNER_DISCOUNTABLE_FIELD] == true);\n\t}\n\n\tget componentDiscountedByPackage() {\n\t\treturn (this.lineVO.record[this.fieldNames.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD] == true);\n\t}\n\n\tget discountable() {\n\t\treturn !this.bundled && !this.nonDiscountable && !this.pricingMethodCustom && !this.componentDiscountedByPackage;\n\t}\n\n\tget discountEditable() {\n\t\treturn (this.groupModel.quoteModel.quoteVO.record[this.fieldNames.TYPE_FIELD] != 'Amendment' || !this.lineVO.record[this.fieldNames.EXISTING_FIELD]);\n\t}\n\n\tget removable() {\n\t\treturn (this.lineVO.record[this.fieldNames.OPTION_LEVEL_FIELD] == null) && (this.groupModel.quoteModel.quoteVO.record[this.fieldNames.TYPE_FIELD] != 'Amendment' || (this.groupModel.quoteModel.quoteVO.record[this.fieldNames.TYPE_FIELD] == 'Amendment' && !this.lineVO.record[this.fieldNames.EXISTING_FIELD]));\n\t}\n\n\tget configurable() {\n\t\treturn this.rootPackage && !this.lineVO.reconfigurationDisabled && (this.lineVO.configurationType != 'Disabled') && ((this.lineVO.configurationEvent == null) || (this.lineVO.configurationEvent == 'Always') || (this.lineVO.configurationEvent == 'Edit'));\n\t}\n\n\tget listPriceEditable() {\n\t\treturn this.lineVO.record[this.fieldNames.PRICE_EDITABLE_FIELD] && !this.bundled && !this.dynamicSubscription && this.pricingMethodList;\n\t}\n\n\tget segmented() {\n\t\treturn (this.lineVO.record[this.fieldNames.SEGMENT_KEY_FIELD] != null);\n\t}\n\n\tget favorite() {\n\t\treturn (!this.component && (this.lineVO.record[this.fieldNames.FAVORITE_ID_FIELD] != null));\n\t}\n\n\tget existing() {\n\t\treturn this.lineVO.record[this.fieldNames.EXISTING_FIELD];\n\t}\n\n\tget descriptionLocked() {\n\t\treturn this.lineVO.descriptionLocked;\n\t}\n\n\tgetFieldMD(fieldName) {\n\t\treturn this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName][fieldName];\n\t}\n\n\tgetField(fieldName) {\n\t\treturn this.lineVO.record[fieldName];\n\t}\n\n\t_getExpansionClass() {\n\t\tif (this.segmented) {\n\t\t\treturn this.lineVO.expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tisEditable(fieldName) {\n\t\tlet field = this.getFieldMD(fieldName);\n\n\t\tif (!field) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (field.name == this.fieldNames.QUANTITY_FIELD || field.name == this.fieldNames.ADDITIONAL_QUANTITY_FIELD) {\n\t\t\treturn field.updateable && this.quantityEditable;\n\t\t} else if (field.name == this.fieldNames.LIST_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.listPriceEditable;\n\t\t} else if (field.name == this.fieldNames.ADDITIONAL_DISCOUNT_FIELD) {\n\t\t\treturn this.discountable && this.discountEditable;\n\t\t} else if (field.name == this.fieldNames.PARTNER_DISCOUNT_FIELD) {\n\t\t\treturn !this.nonPartnerDiscountable;\n\t\t} else if (field.name == this.fieldNames.DISTRIBUTOR_DISCOUNT_FIELD) {\n\t\t\treturn this.discountEditable;\n\t\t} else if (field.name == this.fieldNames.UPLIFT_FIELD) {\n\t\t\treturn field.updateable && this.lineVO.upliftable;\n\t\t} else if (field.name == this.fieldNames.UNIT_COST_FIELD) {\n\t\t\treturn field.updateable && this.unitCostEditable;\n\t\t} else if (field.name == this.fieldNames.CUSTOMER_PRICE_FIELD) {\n\t\t\treturn field.updateable && this.pricingMethodCustom;\n\t\t} else if (field.name == this.fieldNames.PRICING_METHOD_FIELD) {\n\t\t\treturn field.updateable && !this.pricingMethodDisabled;\n\t\t} else if (field.name == this.fieldNames.MARKUP_FIELD) {\n\t\t\treturn !this.bundled && this.pricingMethodCost && this.discountEditable;\n\t\t} else if (field.name == this.fieldNames.NET_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.fieldNames.PARTNER_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.fieldNames.DESCRIPTION_FIELD) {\n\t\t\treturn !this.descriptionLocked;\n\t\t} else if (field.name == this.fieldNames.PACKAGE_PRODUCT_CODE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.fieldNames.PRORATED_LIST_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.fieldNames.REGULAR_PRICE_FIELD) {\n\t\t\treturn false;\n\t\t} else if (field.name == this.fieldNames.START_DATE_FIELD || field.name == this.fieldNames.END_DATE_FIELD) {\n\t\t\treturn this.subscription;\n\t\t}\n\n\t\tif (this.lineVO.fieldEditability && this.lineVO.fieldEditability[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn this.lineVO.fieldEditability[fieldName];\n\t\t}\n\n\t\treturn !!field && field.updateable;\n\t}\n\n\tisFieldRendered(fieldName, isMobile) {\n\t\tif (this.lineVO.fieldVisibility && this.lineVO.fieldVisibility[fieldName] != null) {\n\t\t\t// Honor the Page Security Plugin opinion.\n\t\t\treturn this.lineVO.fieldVisibility[fieldName];\n\t\t}\n\n\t\tlet field = this.getFieldMD(fieldName);\n\t\tif (field && field.name == this.fieldNames.SUBSCRIPTION_TERM_FIELD) {\n\t\t\treturn this.subscription;\n\t\t} else if (field && field.extraTypeInfo === 'richtextarea') {\n\t\t\treturn !isMobile || (this.lineVO.record[fieldName] && isMobile);\n\t\t}\n\t\treturn true;\n\t}\n\n\tget serviceModel() {\n\t\tlet keys = [];\n\t\t// Only MDQ Summary Lines have a segments array. Standard Lines' segments property is undefined\n\t\tif (this.segments) {\n\t\t\tfor (let i = 0, segmentsLength = this.segments.length; i < segmentsLength; i++)\n\t\t\t\tkeys.push(this.segments[i].lineVO.key);\n\t\t} else \n\t\t\tkeys.push(this.lineVO.key)\n\t\t\t\n\t\treturn {\n\t\t\tkeys: keys,\n\t\t\tsegmentKey: this.getField(this.fieldNames.SEGMENT_KEY_FIELD),\n\t\t\tsegmented: this.segmented,\n\t\t\tupdateCustomSegments: false,\n\t\t\tfavIds: [this.getField(this.fieldNames.FAVORITE_ID_FIELD)],\n\t\t\tscheduleId: this.getField(this.fieldNames.DISCOUNT_SCHEDULE_FIELD)\n\n\t\t};\n\t}\n\n\tisVisibleInLineEditor() {\n\t\tlet visible = (this.lineVO.componentVisibility == null) || (this.lineVO.componentVisibility == '') || (this.lineVO.componentVisibility == 'Always') || (this.lineVO.componentVisibility == 'Editor Only');\n\t\tif (visible && (this.renewedAssetId != null) && this.editorModel.data.settings.renewedAssetsHiddenWhenEditing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn visible;\n\t}\n\n\taddToSegmentsArray (lineModel) {\n\t\tif (!this.segments) {\n\t\t\tthis.segments = []; // list of lineModels per segments (in order)\n\t\t}\n\t\tthis.segments.push(lineModel);\n\t}\n\n\tremoveFromSegmentsArray (lineModel) {\n\t\tthis.segments.splice(this.segments.indexOf(lineModel), 1);\n\t\tif (this.segments.length === 0) {\n\t\t\tdelete this.segments;\n\t\t}\n\t}\n\n\taddToSegmentsByLabel (segmentLabel, lineModel) {\n\t\tif (!this.segmentsByLabel) {\n\t\t\tthis.segmentsByLabel = {}; // map of lineModels by segment label for easy access\n\t\t}\n\t\tthis.segmentsByLabel[segmentLabel] = lineModel;\n\t}\n\n\tremoveFromSegmentsByLabel (segmentLabel) {\n\t\tif (this.segmentsByLabel[segmentLabel]) {\n\t\t\tdelete this.segmentsByLabel[segmentLabel];\n\t\t}\n\t\tif (Object.keys(this.segmentsByLabel).length == 0) {\n\t\t\tdelete this.segmentsByLabel;\n\t\t}\n\t}\n}","/**\n * Created by jfeingold on 9/30/16.\n */\nexport class MDQSegmentHelper {\n\tconstructor(editorModel, groupModelsByKey) {\n\t\tthis.MONTHLY_DIM = 'Month';\n\t\tthis.YEARLY_DIM = 'Year';\n\t\tthis.QUARTERLY_DIM = 'Quarter';\n\t\tthis.editorModel = editorModel;\n\t\tthis.groupModelsByKey = groupModelsByKey;\n\t\tthis.prefix = editorModel.developerPrefix;\n\t\tthis.START_DATE_FIELD = this.prefix + 'StartDate__c';\n\t\tthis.END_DATE_FIELD = this.prefix + 'EndDate__c';\n\t\tthis.SUBSCRIPTION_TERM_FIELD = this.prefix + 'SubscriptionTerm__c';\n\t\tthis.LINES_GROUPED_FIELD = this.prefix + 'LineItemsGrouped__c';\n\t\tthis.SEGMENT_KEY_FIELD = this.prefix + 'SegmentKey__c';\n\t\tthis.SEGMENT_INDEX_FIELD = this.prefix + 'SegmentIndex__c';\n\t\tthis.SEGMENT_LABEL_FIELD = this.prefix + 'SegmentLabel__c';\n\t\tthis.FIRST_SEGMENT_END_DATE_FIELD = this.prefix + 'FirstSegmentTermEndDate__c';\n\t\tthis.TYPE_FIELD = this.prefix + 'Type__c';\n\t\tthis.EXISTING_FIELD = this.prefix + 'Existing__c';\n\n\t\tthis._segmentsChanged = false;\n\t}\n\n\tupdateSegments() {\n\t\tvar quote = this.editorModel.quote;\n\t\tif (this._hasMultiSegmentLines(quote)) {\n\t\t\tif (quote.grouped || quote.record[this.LINES_GROUPED_FIELD]) {\n\t\t\t\tquote.lineItemGroups.forEach(function(group) {\n\t\t\t\t\tthis._adjustSegments(quote, group);\n\t\t\t\t}, this);\n\t\t\t} else {\n\t\t\t\tthis._adjustSegments(quote, null);\n\t\t\t}\n\t\t}\n\t\treturn this._segmentsChanged;\n\t}\n\n\t_hasMultiSegmentLines(obj) {\n\t\tvar lineCount = obj.lineItems.length;\n\t\tfor (var i = 0; i < lineCount; i++) {\n\t\t\tif (obj.lineItems[i].record[this.SEGMENT_KEY_FIELD] != null) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_adjustSegments(quote, group) {\n\t\tvar term = this._calculateSubscriptionTerm(quote, group);\n\t\tvar lines = group ? quote.lineItems.filter((line) => line.parentGroupKey === group.key) : quote.lineItems;\n\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.YEARLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.MONTHLY_DIM);\n\t\tthis._calculateSegmentDeltasAndModifySegments(quote, group, lines, term, this.QUARTERLY_DIM);\n\t}\n\n\t_calculateSubscriptionTerm(quote, group) {\n\t\tvar startDateFieldValue = group\n\t\t\t? group.record[this.START_DATE_FIELD] || quote.record[this.START_DATE_FIELD]\n\t\t\t: quote.record[this.START_DATE_FIELD];\n\t\tvar endDateFieldValue = group\n\t\t\t? group.record[this.END_DATE_FIELD] || quote.record[this.END_DATE_FIELD]\n\t\t\t: quote.record[this.END_DATE_FIELD];\n\t\tvar subscriptionTermValue = (group && (group.record[this.SUBSCRIPTION_TERM_FIELD] != null))\n\t\t\t? group.record[this.SUBSCRIPTION_TERM_FIELD]\n\t\t\t: quote.record[this.SUBSCRIPTION_TERM_FIELD];\n\n\t\tvar startDate = startDateFieldValue ? new Date(startDateFieldValue) : null;\n\t\tvar endDate = endDateFieldValue ? new Date(endDateFieldValue) : null;\n\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\n\t\tif (firstSegEndDate) {\n\t\t\tstartDate = startDate ? startDate : new Date();\n\t\t\tif (!endDate) {\n\t\t\t\tendDate = new Date(startDate.getTime());\n\t\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() + subscriptionTermValue - 1);\n\t\t\t\t} else {\n\t\t\t\t\tSB.addMonths(endDate, subscriptionTermValue);\n\t\t\t\t\tendDate.setUTCDate(endDate.getUTCDate() - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(firstSegPlusOneDay, endDate);\n\t\t\t} else {\n\t\t\t    return SB.monthsBetweenRoundPartialUp(firstSegPlusOneDay, endDate);\n\t\t\t}\n\t\t} else if (startDate && endDate) {\n\t\t\tendDate.setDate(endDate.getDate() + 1);\n\t\t\tif (this.editorModel.settings.subscriptionTermUnitIsDay) {\n\t\t\t\treturn SB.daysBetween(startDate, endDate);\n\t\t\t} else {\n\t\t\t\treturn SB.monthsBetweenRoundPartialUp(startDate, endDate);\n\t\t\t}\n\t\t} else {\n\t\t\treturn subscriptionTermValue;\n\t\t}\n\t}\n\n\t_calculateSegmentDeltasAndModifySegments(quote, group, lines, term, dimType) {\n\t\tvar segmentDeltasBySegmentKey = this._calculateSegmentDeltas(quote, lines, term, dimType);\n\t\tif (segmentDeltasBySegmentKey.size != 0) {\n\t\t\tthis._modifySegmentsBasedOnDelta(quote, group, segmentDeltasBySegmentKey, dimType);\n\t\t}\n\t}\n\n\t_calculateSegmentDeltas(quote, lines, term, dimType) {\n\t\tvar termIsDay = this.editorModel.settings.subscriptionTermUnitIsDay;\n\n\t\t// Term might be null if there wasn't enough information to calculate it. In that case, default to 1 year.\n\t\tterm = (term == null) ? (termIsDay ? 365 : 12) : term;\n\n\t\t// Map all segment keys to the number of time-based segments with that key.\n\t\tvar segmentCountsBySegmentKey = mapSegmentCountsBySegmentKeys.bind(this)();\n\t\tvar trueSegmentCount = determineDesiredNumberOfSegments.bind(this)();\n\t\tvar segmentDeltasBySegmentKey = new Map();\n\t\tsegmentCountsBySegmentKey.forEach(function(currentSegCount, segKey) {\n\t\t\tsegmentDeltasBySegmentKey.set(segKey, trueSegmentCount - currentSegCount);\n\t\t});\n\t\treturn segmentDeltasBySegmentKey;\n\n\n\t\tfunction mapSegmentCountsBySegmentKeys() {\n\t\t\tvar segmentCountsBySegmentKey = new Map();\n\t\t\tvar lineCount = lines.length;\n\t\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\t\tlet line = lines[i];\n\t\t\t\tif (line.dimensionType == dimType) {\n\t\t\t\t\tlet lineSegKey = line.record[this.SEGMENT_KEY_FIELD];\n\t\t\t\t\tlet currentSegCount = segmentCountsBySegmentKey.get(lineSegKey) || 0;\n\t\t\t\t\tsegmentCountsBySegmentKey.set(lineSegKey, currentSegCount + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn segmentCountsBySegmentKey;\n\t\t}\n\n\t\tfunction determineDesiredNumberOfSegments() {\n\t\t\t// Calculate the number of segments represented by the given term and dimension type.\n\t\t\tvar trueSegmentCount = 0;\n\t\t\tvar firstSegEndDateFieldValue = quote.record[this.FIRST_SEGMENT_END_DATE_FIELD];\n\t\t\tvar firstSegEndDate = firstSegEndDateFieldValue ? new Date(firstSegEndDateFieldValue) : null;\n\t\t\t// If the first segment has a specified end date, we must take that into account as we calculate the\n\t\t\t// number of segments\n\t\t\tif (firstSegEndDate) {\n\t\t\t\t// We immediately include the first term in our count.\n\t\t\t\ttrueSegmentCount = 1;\n\n\t\t\t\tvar firstSegPlusOneDay = new Date(firstSegEndDate.getTime());\n\t\t\t\tfirstSegPlusOneDay.setUTCDate(firstSegPlusOneDay.getUTCDate() + 1);\n\t\t\t}\n\n\t\t\t// Convert term expressed as days into months if termIsDay to ensure the number of segments is correct.\n\t\t\tif (termIsDay) {\n\t\t\t\tlet termStartDate = firstSegPlusOneDay ? firstSegPlusOneDay : new Date(this.editorModel.quote.record[this.START_DATE_FIELD]);\n\t\t\t\tlet quoteEndDate = this.editorModel.quote.record[this.END_DATE_FIELD] ? new Date(this.editorModel.quote.record[this.END_DATE_FIELD]) : new Date(termStartDate.setUTCDate(termStartDate.getUTCDate() + term));\n\t\t\t\tterm = SB.monthsBetween(termStartDate, quoteEndDate);\n\t\t\t\ttermStartDate.setUTCMonth(termStartDate.getUTCMonth() + term);\n\t\t\t\ttermStartDate.setUTCDate(termStartDate.getUTCDate() - 1);\n\t\t\t\t// If the date in the month of the termStartDate is less than the end date of the quote we need to add one more month to the term,\n\t\t\t\t// this ensures that the number of segments will be calculated correctly.\n\t\t\t\tif (termStartDate < quoteEndDate) {\n\t\t\t\t\tterm += 1\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Now we calculate the number of segments based on our dimension type and the term.\n\t\t\tswitch (dimType) {\n\t\t\t\tcase this.YEARLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 12);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.QUARTERLY_DIM:\n\t\t\t\t\ttrueSegmentCount += Math.ceil(term / 3);\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.MONTHLY_DIM:\n\t\t\t\t\ttrueSegmentCount += term;\n\t\t\t}\n\t\t\treturn trueSegmentCount;\n\t\t}\n\t}\n\n\t_modifySegmentsBasedOnDelta(quote, group, deltaMap, dimType) {\n\t\tdeltaMap.forEach(function(delta, segmentKey) {\n\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\n\t\t\tvar noDelta = delta === 0;\n\t\t\tvar amendmentLine = quote.record[this.TYPE_FIELD] === 'Amendment' && lastSegment.record[this.EXISTING_FIELD];\n\n\t\t\tvar lastSegStartDateFieldValue = lastSegment.record[this.START_DATE_FIELD];\n\t\t\tvar lastSegEndDateFieldValue = lastSegment.record[this.END_DATE_FIELD];\n\n\t\t\tvar lastSegStartDate = lastSegStartDateFieldValue ? new Date(lastSegStartDateFieldValue) : null;\n\t\t\tvar lastSegEndDate = lastSegEndDateFieldValue ? new Date(lastSegEndDateFieldValue) : null;\n\t\t\tvar startDateBeforeEndDate = lastSegEndDate >= lastSegStartDate;\n\t\t\tif (noDelta || amendmentLine) {\n\t\t\t\t// If we're amending an old line, or the delta is 0, do nothing\n\t\t\t\treturn;\n\t\t\t} else if (delta > 0 && startDateBeforeEndDate) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\tfor (let i = 1; i <= delta; i++) {\n\t\t\t\t\t// We need to add additional segments, which we do by repeatedly cloning the last segment\n\t\t\t\t\tvar newSegmentVO = this._createNewSegment(quote, lastSegment, i);\n\t\t\t\t\tquote.lineItems.push(newSegmentVO);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Add line to group model, so that the models can have a handle on the new segment and reflect it in the UI\n\t\t\t\t\t\tthis.groupModelsByKey[newSegmentVO.parentGroupKey].addLine(newSegmentVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (delta < 0) {\n\t\t\t\tthis._segmentsChanged = true;\n\t\t\t\t// If the delta is negative, we need to remove that many segments\n\t\t\t\tfor (let i = 0; i > delta; i--) {\n\t\t\t\t\tlet lastSegment = this._getLastSegmentFromQuote(quote, segmentKey, dimType);\n\t\t\t\t\tthis._removeSegment(quote, lastSegment);\n\t\t\t\t\tif (this.groupModelsByKey) {\n\t\t\t\t\t\t// Remove deleted line from segments array on the given group model\n\t\t\t\t\t\tlet line = this.groupModelsByKey[lastSegment.parentGroupKey].segmentedLinesBySegmentKey[segmentKey];\n\t\t\t\t\t\tline.segments.splice(line.segments.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t}\n\n\t_getLastSegmentFromQuote(quote, segmentKey, dimType) {\n\t\tvar lineItem = null;\n\t\tvar maxIndex = null;\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tif (line.record[this.SEGMENT_KEY_FIELD] === segmentKey && line.dimensionType === dimType) {\n\t\t\t\tlet index = line.record[this.SEGMENT_INDEX_FIELD];\n\t\t\t\tif ((index != null) && ((maxIndex == null) || (maxIndex < index))) {\n\t\t\t\t\t// If the segment index is higher than the highest we've seen so far, store this line\n\t\t\t\t\tmaxIndex = index;\n\t\t\t\t\tlineItem = line;\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\t\treturn lineItem;\n\t}\n\n\t_createNewSegment(quote, sourceSegment, offset) {\n\t\tvar clone = JSON.parse(JSON.stringify(sourceSegment));\n\t\t// We need to update the clone's key, and delete its ID\n\t\tclone.key = ++quote.nextKey;\n\t\tclone.record.Id = null;\n\t\t// We also need to offset the segment indices\n\t\tclone.record[this.SEGMENT_KEY_FIELD] = sourceSegment.record[this.SEGMENT_KEY_FIELD];\n\t\tclone.record[this.SEGMENT_INDEX_FIELD] = sourceSegment.record[this.SEGMENT_INDEX_FIELD] + offset;\n\t\tvar whitespace = (clone.record[this.SEGMENT_INDEX_FIELD] < 10) ? '  ' : ' ';\n\t\tclone.record[this.SEGMENT_LABEL_FIELD] = sourceSegment.dimensionType + whitespace + clone.record[this.SEGMENT_INDEX_FIELD];\n\t\treturn clone;\n\t}\n\n\t_removeSegment(quote, segmentToRemove) {\n\t\tvar lineCount = quote.lineItems.length;\n\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\tvar line = quote.lineItems[i];\n\t\t\tif (line.key === segmentToRemove.key) {\n\t\t\t\tquote.lineItems = quote.lineItems.slice(0, i).concat(quote.lineItems.slice(i + 1, lineCount));\n\t\t\t\tif (quote.deletedLineIds && line.record && line.record.Id) {\n\t\t\t\t\tquote.deletedLineIds.push(line.record.Id);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n}","export class QuoteMessenger {\n\n\tconstructor(editorModel, targetRecord) {\n\t\tthis.editorModel = editorModel;\n\t\tthis.targetRecord = targetRecord;\n\t}\n\n\tgetRequest() {\n\t\tlet message = {\n\t\t\ttarget: this.targetRecord,\n\t\t\tquote: this.editorModel.quoteModel.quoteVO.record,\n\t\t\tlines: [],\n\t\t\tactions: []\n\t\t};\n\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif (!message)\n\t\t\treturn;\n\n\t\tswitch (message.actions[0].toLowerCase().replace(' ', '')) {\n\t\t\tcase 'save':\n\t\t\t\treturn {lines: message.lines, action: 'save'};\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\treturn {lines: message.lines, action: 'quicksave'};\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\treturn {lines: message.lines, action: 'reload'};\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t\t\treturn {lines: message.lines, action: 'none'};\n\t\t}\n\t}\n\n}","import {GroupModel} from 'quotes/models/GroupModel.js';\nimport {LineModel} from 'quotes/models/LineModel.js';\n\n/**\n *  QuoteModel - contains the quoteVO and linked with the editorModel\n *\n * Feature:\n *      1. Contains QuoteVO which is the same as the server\n *      2. Linked with EditorModel\n *      3. Rebuild the groupsByKey to link GroupVO and QuoteVO together\n */\nexport class QuoteModel {\n\tconstructor(quoteVO, editorModel) {\n\t\tthis.quoteVO = quoteVO; // quote returned from the server\n\t\tthis.editorModel = editorModel;\n\n\t\tthis.grouped = quoteVO.record[this.editorModel.constants.GROUP_LINE_ITEMS_FIELD];\n\n\t\tthis.groupsByKey = {};\n\t\tthis.lineModelsByKey = {};\n\t\tthis.indexByGroupKey = {};\n\t\tthis.lineGroups = [];\n\t\t// stores lineModels by parentItemKey (parenItemKey: [array of components])\n\t\t// this map is on the quoteModel instead of each group because users can drag components to other groups when Keep Bundle Together setting is off\n\t\tthis.linesByParentItemKey = {};\n\t\tthis.standardLinesByParentItemKey = {};\n\t\tthis.segmentedLinesByParentItemKey = {};\n\n\t\tthis.allOptional = true;\n\n\t\tthis.isPrimary = this.quoteVO.record[\"SBQQ__Primary__c\"];\n\t\tthis.isAmendment = this.quoteVO.record[this.editorModel.constants.TYPE_FIELD] === 'Amendment';\n\t\tthis.isRenewal = this.quoteVO.record[this.editorModel.constants.TYPE_FIELD] === 'Renewal';\n\n\t\t// If Group Line Items is true but there are no Groups in the Model, create an empty one and add all lines to it\n\t\tif (this.grouped && this.quoteVO.lineItemGroups.length == 0) {\n\t\t\tlet groupRecord = {Name: `Group${1}`};\n\t\t\tlet groupVO = {key: ++this.quoteVO.nextKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\t\tlet group = new GroupModel(groupVO, this);\n\t\t\tthis.quoteVO.lineItemGroups.push(groupVO);\n\t\t\tthis.groupsByKey[group.groupVO.key] = group;\n\t\t\tthis.indexByGroupKey[group.groupVO.key] = {index: Object.keys(this.indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t\tlet lineVOs = this.quoteVO.lineItems;\n\t\t\tfor (let i = 0; i < lineVOs.length; i++) {\n\t\t\t\tlet lineVO = lineVOs[i];\n\t\t\t\tlineVO.parentGroupKey = group.groupVO.key;\n\t\t\t}\n\t\t}\n\t\t// form the Group Models looping through the GroupVOs on the QuoteVO\n\t\tlet groups = this.grouped ? this.quoteVO.lineItemGroups : [{key: null, record: {}}];\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tlet groupModel = new GroupModel(groups[i], this);\n\t\t\tthis.lineGroups.push(groupModel);\n\t\t\tthis.groupsByKey[groupModel.groupVO.key] = groupModel;\n\t\t\tthis.indexByGroupKey[groupModel.groupVO.key] = {index: i, indexByLineKey : {}, indexBySegmentKey : {}};\n\t\t}\n\n\t\t// form the Line Models and push each model into its Group Model's lines array depending on type (standard vs segmented)\n\t\tlet lineVOs = this.quoteVO.lineItems;\n\t\tfor (let j = 0, l = lineVOs.length; j < l; j++) {\n\t\t\tlet lineVO = lineVOs[j];\n\t\t\tif (!lineVO.record[this.editorModel.constants.OPTIONAL_FIELD]) {\n\t\t\t    this.allOptional = false;\n   \t\t\t}\n\t\t\tthis.groupsByKey[lineVO.parentGroupKey].addLine(lineVO);\n\t\t}\n\t}\n\n\trenumberIndexes(/*Boolean*/ deepRenumber) {\n\t\t// if deepRenumber is true, it will renumber all of the line items as well\n\t\tfor (let i = 0, l = this.lineGroups.length; i < l; i ++) {\n\t\t\tlet groupKey = this.lineGroups[i].groupKey;\n\t\t\tthis.indexByGroupKey[groupKey].index = i;\n\t\t\tif (deepRenumber) {\n\t\t\t\tthis.lineGroups[i].renumberStandardIndexes();\n\t\t\t\tthis.lineGroups[i].renumberSegmentedIndexes();\n\t\t\t}\n\t\t}\n\t}\n}","import {Constants} from 'quotes/models/Constants.js';\n\nexport class SortLinesHandler {\n    constructor(prefix) {\n        this.constants = new Constants(prefix);\n    }\n\n    sortLineItems(lines, lineSortField) {\n        lines.sort(function(a, b) {\n            a.lineSortValue = a.record[lineSortField];\n            b.lineSortValue = b.record[lineSortField];\n            if (a.lineSortValue != null && b.lineSortValue != null && a.lineSortValue != b.lineSortValue) {\n                // We know both values are non-null and non-equal, so we can try to compare them.\n                // Try subtraction, on the chance we're dealing with numeric strings or numbers\n                var difference = a.lineSortValue - b.lineSortValue;\n                if (difference === difference) {\n                    // There's only one value in all of JS that's not equal to itself, and it's NaN. So if the difference\n                    // is equal to itself, we can just return it, since it's going to be a number.\n                    return difference;\n                } else {\n                    // If the difference isn't equal to itself, then we're dealing with a non-numeric string.\n                    // Just use '<'. It should be fine.\n                    return a.lineSortValue < b.lineSortValue ? -1 : 1;\n                }\n            } else if (a.lineSortValue == b.lineSortValue) {\n                var aSecondary = a.record[this.constants.SEGMENT_INDEX_FIELD];\n                var bSecondary = b.record[this.constants.SEGMENT_INDEX_FIELD];\n                if (aSecondary == bSecondary) {\n                    // If both of the secondary sort values are equal, then we should try using the Number__c field\n                    return a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n                } else if (aSecondary == null) {\n                    return -1;\n                } else if (bSecondary == null) {\n                    return 1;\n                } else {\n                    return aSecondary - bSecondary;\n                }\n            } else if (a.lineSortValue == null) {\n                return -1;\n            } else if (b.lineSortValue == null) {\n                return 1;\n            } else {\n                // There's no reason we should end up in this branch, but if we somehow do, then we should compare the\n                // Number__c fields.\n                return a.record[this.constants.NUMBER_FIELD] - b.record[this.constants.NUMBER_FIELD];\n            }\n        }.bind(this));\n        return lines;\n    }\n}\n","/**\n * Created by jfeingold on 10/13/16.\n */\nmodule.exports = convertTo18;\n\nvar CONVERSION_TABLE = {\n\t\"00000\": \"A\",\n\t\"00001\": \"B\",\n\t\"00010\": \"C\",\n\t\"00011\": \"D\",\n\t\"00100\": \"E\",\n\t\"00101\": \"F\",\n\t\"00110\": \"G\",\n\t\"00111\": \"H\",\n\t\"01000\": \"I\",\n\t\"01001\": \"J\",\n\t\"01010\": \"K\",\n\t\"01011\": \"L\",\n\t\"01100\": \"M\",\n\t\"01101\": \"N\",\n\t\"01110\": \"O\",\n\t\"01111\": \"P\",\n\t\"10000\": \"Q\",\n\t\"10001\": \"R\",\n\t\"10010\": \"S\",\n\t\"10011\": \"T\",\n\t\"10100\": \"U\",\n\t\"10101\": \"V\",\n\t\"10110\": \"W\",\n\t\"10111\": \"X\",\n\t\"11000\": \"Y\",\n\t\"11001\": \"Z\",\n\t\"11010\": \"0\",\n\t\"11011\": \"1\",\n\t\"11100\": \"2\",\n\t\"11101\": \"3\",\n\t\"11110\": \"4\",\n\t\"11111\": \"5\"\n};\n\n/**\n * Converts the ID provided to an 18-digit Apex ID\n * @param {String} id An Apex ID string\n * @returns {string|null}\n * @throws Throws an error if argument is not 15 or 18 characters long\n */\nfunction convertTo18(id) {\n\tif (!id) {\n\t\treturn null;\n\t} else if (id.length === 18) {\n\t\treturn id;\n\t} else if (id.length === 15) {\n\t\tvar part1 = convertToDigit(id.slice(0, 5));\n\t\tvar part2 = convertToDigit(id.slice(5, 10));\n\t\tvar part3 = convertToDigit(id.slice(10, 15));\n\t\treturn (id + part1 + part2 + part3);\n\t} else {\n\t\treturn null;\n\t}\n}\n\n\n/**\n * Reverses the characters in an alphanumeric string, i.e., \"SpinOn\" becomes \"nOnipS\"\n * @param {String} str An alphanumeric string\n * @returns {string}\n * @private\n */\nfunction reverseString(str) {\n\treturn str.split(\"\").reverse().join(\"\");\n}\n\n/**\n * Replaces all numeric or lowercase characters with 0, and all uppercase characters with 1, i.e. \"0Sa0Z\" becomes \"01001\"\n * @param {String} string\n * @returns {string}\n * @private\n */\nfunction replaceWithBinary(string) {\n\tvar res = string.replace(/[^A-Z]/g, \"0\");\n\treturn res.replace(/[A-Z]/g, \"1\");\n}\n\n/**\n * Uses the Conversion Table to turn a 5-digit binary string into a single character\n * @param {String} seg A 5-digit string of 1s and 0s\n * @returns {String} A single character in the range A-Z or 0-5\n * @private\n */\nfunction convertToDigit(seg) {\n\treturn CONVERSION_TABLE[replaceWithBinary(reverseString(seg))];\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nself.addEventListener('message', function(e) {\n\tvar startTime = new Date().getTime();\n\t// We need to import these scripts so that we have access to JSForce and a Promise polyfill.\n\timportScripts(\"//cdnjs.cloudflare.com/ajax/libs/jsforce/1.7.0/jsforce.min.js\");\n\timportScripts(\"https://www.promisejs.org/polyfills/promise-7.0.4.min.js\");\n\t// Create JSForce connection using the access token provided by the event's context.\n\tvar conn = new jsforce.Connection({\n\t\toauth2 : new jsforce.OAuth2({clientId: true, clientSecret: true}),\n\t\taccessToken: e.data.accessToken,\n\t\trefreshToken: '',\n\t\tinstanceUrl: e.data.siteUrl\n\t});\n\t// Create a proxy REST connection to the org.\n\tvar client = require('./PrecacheRestClient.js')(conn, e.data.orgUrl, e.data.siteUrl);\n\t// Create a wrapper object to manage the apex connection and simplify interaction.\n\tvar apex = apexFactory(client);\n\n\t// The specific precaching actions are all handled by separate files that we've called 'Sequence Runners'.\n\t// Every Sequence Runner contains a method that takes several parameters and returns\n\t// an object with a method called executeSequence(), which actually performs the precaching.\n\t// We identify which runner to use, and create an array of arguments to pass into an apply call.\n\tvar precacheSequence = e.data.precacheSequence;\n\tvar runnerConstructor = getRunnerConstructor(precacheSequence);\n\tif (!runnerConstructor) {\n\t\tself.postMessage({failure: true, sequence: precacheSequence, msg: 'Unrecognized sequence'});\n\t\tclose();\n\t}\n\tvar argumentList = getArgumentList(precacheSequence, apex, e.data, self.postMessage);\n\tvar runner = runnerConstructor.apply(null, argumentList);\n\trunner.executeSequence()\n\t\t.then(function() {\n\t\t\tclose();\n\t\t});\n});\n\n/**\n * Requires the right constructor for the sequence runner associated with the precache sequence \n * @param {String} sequence Indicates which precache sequence to use\n * @returns {function} A constructor for an object with an executeSequence() method.\n */\nfunction getRunnerConstructor(sequence) {\n\tvar requiredModulesBySequence = {\n\t\t'PriceRuleSequence': require('./PrecacheSequenceRunners/PriceRuleSequenceRunner.js'),\n\t\t'MetadataSequence': require('./PrecacheSequenceRunners/MetadataSequenceRunner.js'),\n\t\t'OptionSequence': require('./PrecacheSequenceRunners/OptionSequenceRunner.js'),\n\t\t'DiscountAndAccountSequence': require('./PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js'),\n\t\t'ProductSequence': require('./PrecacheSequenceRunners/ProductSequenceRunner.js'),\n\t\t'RelatedRecordSequence': require('./PrecacheSequenceRunners/RelatedRecordSequenceRunner.js')\n\t};\n\treturn requiredModulesBySequence[sequence] || null;\n}\n\n/**\n * Creates a list of arguments to be passed into a sequence runner using .apply().\n * @param {String} sequence Indicates which sequence is in progress.\n * @param {Object} apex A wrapper to provide access to the SFDC org\n * @param {Object} data The context passed in from the main thread\n * @param {Function} resultPoster self.postMessage() passed in as a parameter.\n * @returns {*}\n */\nfunction getArgumentList(sequence, apex, data, resultPoster) {\n\t// All sequence runners receive these three arguments.\n\tvar result = [apex, data.prefix, resultPoster];\n\t// Each runner requires extra data, so we get that data and append it to the argument list.\n\tswitch(sequence) {\n\t\tcase 'PriceRuleSequence':\n\t\t\t// In addition to the standard data, we must also include the Account ID for this quote, so assets and subscriptions\n\t\t\t// may be loaded.\n\t\t\treturn result.concat([data.accountId]);\n\t\tcase 'MetadataSequence':\n\t\t\t// In addition to the standard data, the context will include the Referenced Field Map from the inner class\n\t\t\t// EditorSettings in QuoteEditorModel.cls. This indicates which fields must have their metadata queried.\n\t\t\treturn result.concat([data.referencedFieldMap]);\n\t\tcase 'DiscountAndAccountSequence':\n\t\t\t// In addition to the standard data, we must also include the Quote JSON, and the account ID. The former\n\t\t\t// is swept for schedule IDs, and the latter is used to get asset and subscription summary information.\n\t\t\treturn result.concat([data.quote, data.accountId]);\n\t\tcase 'RelatedRecordSequence':\n\t\t\t// In addition to the standard data, we must also include the QuoteJSON, the referenced field map,\n\t\t\t// and a map of lookup fields. The quote is swept for data, the the lookup map indicates which fields must\n\t\t\t// be checked for IDs, and the referenced field map indicates which fields on the corresponding objects must\n\t\t\t// be queried.\n\t\t\treturn result.concat([data.quote, data.lookupFieldMap, data.referencedFieldMap]);\n\t\tcase 'ProductSequence':\n\t\tcase 'OptionSequence':\n\t\t\t// Both the Option and Product sequences require the Quote JSON, and a list of referenced fields.\n\t\t\treturn result.concat([data.quote, data.referencedFields]);\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n\nfunction apexFactory(client) {\n\tfunction read(prefix, provider, uid) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.read(prefix, provider, uid).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tclient.load(prefix, provider, uid || '', context).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\tclient.setOptions(opts);\n\t}\n\n\tfunction md(mdType, mdItems) {\n\t\t// Since the Metadata API can only handle 10 fields at once, we break the request into batches of at most\n\t\t// 10 fields each.\n\t\tvar promiseArray = [];\n\t\tvar promisesNeeded = Math.ceil(mdItems.length / 10);\n\t\tfor (var i = 0; i < promisesNeeded; i++) {\n\t\t\tpromiseArray.push(client.md(mdType, mdItems.slice(i * 10, (i + 1) * 10)));\n\t\t}\n\t\t// After all the promises resolve, combine them into a single array, then cache and return that array.\n\t\treturn Promise.all(promiseArray)\n\t\t\t.then(function(dataArray) {\n\t\t\t\tvar combinedDataArray = [];\n\t\t\t\tdataArray.forEach(function(arr) {\n\t\t\t\t\tif (arr != null) {\n\t\t\t\t\t\t// If arr has no length, it's a single item, so we wrap it in an array.\n\t\t\t\t\t\tif (arr.length == null) {\n\t\t\t\t\t\t\tarr = [arr];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcombinedDataArray = combinedDataArray.concat(arr);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn combinedDataArray;\n\t\t\t});\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tmd: md,\n\t\tsetOptions: setOptions\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n */\nimport {Constants} from 'quotes/models/Constants.js';\n// Import RemoteOAuth.js instead of OAuthClient.js, because at this time we only support precaching in the org.\n// If we ever support it in Localhost, we'll need to import OAuthClient.js.\nimport {RemoteOAuth} from 'common/data/client/RemoteOAuth.js';\nexport class JSQCPrecacheWorkerManager {\n\tconstructor(data) {\n\t\tthis.data = data;\n\t\tthis.orgUrl = this.data.settings.orgUrl;\n\t\tthis.siteUrl = this.data.settings.siteUrl;\n\t\tthis.prefix = this.data.developerPrefix ? 'SBQQ' : '';\n\t\tthis.constants = new Constants(this.data.developerPrefix);\n\t\tthis.filePath = this.siteUrl + '/resource/' + new Date().getTime() + '/' + this.data.developerPrefix + 'PrecacherUI2';\n\t}\n\n\tbeginPrecaching() {\n\t\tvar self = this;\n\t\tthis._getAccessToken()\n\t\t\t.then(function(accessToken) {\n\t\t\t\tself.accessToken = accessToken;\n\t\t\t\tself._spoolWorkers();\n\t\t\t}, function(err) {\n\t\t\t\tconsole.log('Could not get access token');\n\t\t\t});\n\t}\n\n\t_getAccessToken() {\n\t\tvar oauth = new RemoteOAuth(this.prefix);\n\t\treturn oauth.getAccessTokenBypassingCache();\n\t}\n\n\t_spoolWorkers() {\n\t\tvar accountId = this.data.quote.record[this.constants.ACCOUNT_ID_FIELD];\n\t\tvar settings = this.data.settings;\n\t\tvar quote = this.data.quote;\n\t\tvar referencedFieldMap = this.data.settings.referencedFieldMap;\n\n\n\t\tvar priceRuleWorker = this._createWorker();\n\t\tvar priceRuleContext = this._createWorkerContext('PriceRuleSequence',\n\t\t\t// We must include the account ID so that the sequence runner can retrieve asset and subscription records.\n\t\t\tnew Map([['accountId', accountId]]));\n\t\tpriceRuleWorker.postMessage(priceRuleContext);\n\n\t\tvar metadataWorker = this._createWorker();\n\t\tvar metadataContext = this._createWorkerContext('MetadataSequence',\n\t\t\t// We must include the referenced field map so that the sequence runner knows which fields it needs metadata for.\n\t\t\tnew Map([['referencedFieldMap', referencedFieldMap]])\n\t\t);\n\t\tmetadataWorker.postMessage(metadataContext);\n\n\t\tvar discountWorker = this._createWorker();\n\t\tvar discountContext = this._createWorkerContext('DiscountAndAccountSequence',\n\t\t\t// We must include the Account Id so its assets and subscriptions may be summarized, and the quote so we\n\t\t\t// can sweep it for discount schedule Ids.\n\t\t\tnew Map([['accountId', accountId], ['quote', quote]])\n\t\t);\n\t\tdiscountWorker.postMessage(discountContext);\n\n\t\tvar relatedRecordWorker = this._createWorker();\n\t\tvar lookupFieldMap = {\n\t\t\tquoteLookups: settings.quoteLookups || {},\n\t\t\tgroupLookups: settings.groupLookups || {},\n\t\t\tlineLookups: (function() {\n\t\t\t\tvar allLineLookups = settings.lineLookups || {};\n\t\t\t\tvar nonstandardLineLookups = {};\n\t\t\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\t\t\tfor (var key in allLineLookups) {\n\t\t\t\t\tif (key !== fieldPrefix + 'Product__c' && key !== fieldPrefix + 'ProductOption__c') {\n\t\t\t\t\t\tnonstandardLineLookups[key] = allLineLookups[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn nonstandardLineLookups;\n\t\t\t})()\n\t\t};\n\t\tvar relatedRecordContext = this._createWorkerContext('RelatedRecordSequence',\n\t\t\t// We must include the quote so it can be swept for Ids, the lookup field map to know what fields point to other\n\t\t\t// records, and the referenced field map so we can know what fields on those objects to query.\n\t\t\tnew Map([['quote', quote], ['referencedFieldMap', referencedFieldMap], ['lookupFieldMap', lookupFieldMap]])\n\t\t);\n\t\trelatedRecordWorker.postMessage(relatedRecordContext);\n\t\t\n\t\tvar productWorker = this._createWorker();\n\t\tvar productContext = this._createWorkerContext('ProductSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap['Product2']]])\n\t\t);\n\t\tproductWorker.postMessage(productContext);\n\t\t\n\t\tvar fieldPrefix = settings.developerPrefix || '';\n\t\tvar optionWorker = this._createWorker();\n\t\tvar optionContext = this._createWorkerContext('OptionSequence',\n\t\t\tnew Map([['quote', quote], ['referencedFields', settings.referencedFieldMap[fieldPrefix + 'ProductOption__c']]])\n\t\t);\n\t\toptionWorker.postMessage(optionContext);\n\t}\n\n\t_createWorkerContext(sequence, extrasMap) {\n\t\tvar baseContext = {\n\t\t\torgUrl: this.orgUrl,\n\t\t\tsiteUrl: this.siteUrl,\n\t\t\taccessToken: this.accessToken,\n\t\t\tprecacheSequence: sequence,\n\t\t\tprefix: this.prefix\n\t\t};\n\t\tif (extrasMap && extrasMap.size != 0) {\n\t\t\textrasMap.forEach(function(val, key) {\n\t\t\t\tbaseContext[key] = val;\n\t\t\t});\n\t\t}\n\t\treturn baseContext;\n\t}\n\n\t_createWorker() {\n\t\tvar wrkr = new Worker(this.filePath);\n\t\tvar precachingFn = this._precache;\n\t\twrkr.addEventListener('message', function(e) {\n\t\t\tif (e.data.successful) {\n\t\t\t\tprecachingFn(e.data.provider, e.data.uid, e.data.results);\n\t\t\t} else if (e.data.failure) {\n\t\t\t\tconsole.error('Main thread received failure from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t} else if (e.data.err) {\n\t\t\t\tconsole.error('Main thread received error from precache sequence ' + e.data.sequence + ': ' + e.data.msg);\n\t\t\t}\n\t\t});\n\t\treturn wrkr;\n\t}\n\n\t_precache(provider, uid, results) {\n\t\tif (SB && SB.JSQCPrecacher) {\n\t\t\tvar precacher = new SB.JSQCPrecacher();\n\t\t\tprecacher.precacheValue(provider, uid, results);\n\t\t}\n\t}\n}","/**\n * Created by jfeingold on 10/11/16.\n */\nmodule.exports= restClient;\nfunction restClient(conn, orgUrl, siteUrl) {\n\tvar proxy = restProxy(conn, orgUrl, siteUrl);\n\n\tfunction read(prefix, provider, uid) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.get(endpoint + '?reader=' + provider + '&uid=' + uid).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction load(prefix, provider, uid, context) {\n\t\tvar endpoint = getEndpoint(prefix);\n\t\tvar body = JSON.stringify({context: JSON.stringify(context)});\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.patch(endpoint + '?loader=' + provider + '&uid=' + uid, body).then(function(res) {\n\t\t\t\tresolve(parse(res));\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction md(mdType, mdItems) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tproxy.md(mdType, mdItems).then(function(res) {\n\t\t\t\tresolve(res);\n\t\t\t}, function(err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction setOptions(opts) {\n\t\t// not supported\n\t}\n\n\tfunction getEndpoint(prefix) {\n\t\tvar endpoint = '/ServiceRouter';\n\t\treturn prefix ? ('/' + prefix + endpoint) : endpoint;\n\t}\n\n\tfunction parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch (e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n\n\treturn {\n\t\tread: read,\n\t\tload: load,\n\t\tmd: md,\n\t\tsetOptions: setOptions\n\t};\n}\n\nfunction restProxy(conn, orgUrl, siteUrl) {\n\n\tfunction get(endpoint) {\n\t\treturn send(endpoint, 'GET');\n\t}\n\n\tfunction patch(endpoint, body) {\n\t\treturn send(endpoint, 'PATCH', body);\n\t}\n\n\tfunction md(mdType, mdItems) {\n\t\treturn conn.metadata.read(mdType, mdItems);\n\t}\n\n\tfunction send(endpoint, method, body) {\n\t\tvar params = {\n\t\t\turl: siteUrl != '' ?\n\t\t\t\tsiteUrl + '/services/apexrest' + endpoint :\n\t\t\t\t'/services/proxy',\n\t\t\tmethod: method,\n\t\t\theaders: {\n\t\t\t\t'SalesforceProxy-Endpoint': orgUrl + '/services/apexrest' + endpoint,\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t};\n\n\t\tif(body)\n\t\t\tparams.body = body;\n\n\t\treturn conn.request(params);\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tpatch: patch,\n\t\tmd: md\n\t};\n}","import {Navigator} from 'common/core/Navigator.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {OAuthClient} from 'common/data/client/OAuthClient.js';\nimport {JSQCNotifier} from 'quotes/models/JSQCNotifier.js';\nimport {SortLinesHandler} from 'quotes/models/SortLinesHandler.js';\nimport {QuoteMessenger} from 'quotes/models/QuoteMessenger.js';\nimport {JsonFormatter} from 'common/data/format/JsonFormatter.js';\nimport {MDQSegmentHelper} from 'quotes/models/MDQSegmentHelper.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js'\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n *  <sb-le-custom-action-services>\n *\n *  Features:\n *\n **/\nexport class LECustomActionServices {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-custom-action-services';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\teventDetail: Object,\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Finds the sb-service component and sets its model\n\t * @param  {String} eventHandlerName   - Id of the sb-service component\n\t * @param  {Object} pseudoServiceModel - The initial value of the model to set the sb-service component\n\t */\n\t_executeServiceAction(eventHandlerName, pseudoServiceModel) {\n\t\tlet serviceModel = pseudoServiceModel || (this.eventDetail && this.eventDetail.model ? this.eventDetail.model.serviceModel : null);\n\t\tif(this.editorModel) {\n\t\t\tif (this._usesClientCalculator())\n\t\t\t\tthis.sortLines(this.editorModel.quoteModel.quoteVO, false);\n\t\t\t// Replaces lineItems on quoteVO with a reordered version after front end operations (i.e. drag and drop, clone lines, delete lines, etc) so the lineVOs are indexed correctly before sent to server\n\t\t\tthis.editorModel.quoteModel.quoteVO.lineItems = this._reorderLineItems();\n\t\t\tthis._reorderGroups();\n\t\t}\n\t\tlet quoteVO = this.editorModel ? this.editorModel.quoteModel.quoteVO : this.data.quote;\n\t\tif (serviceModel) {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tserviceModel.quoteJSON = new JsonFormatter(true).format(quoteVO);\n\t\t\tthis.$[eventHandlerName].model = serviceModel;\n\t\t} else {\n\t\t\tthis.$[eventHandlerName].model = undefined;\n\t\t\tthis.$[eventHandlerName].model = new JsonFormatter(true).format(quoteVO);\n\t\t}\n\t}\n\n\t/**\n\t * Reorders lineItems on quoteVO before sent to server after front end operations (i.e. drag and drop, clone lines, delete lines, etc)\n\t * @return  {Array} lineItems - lineVOs that have been reordered\n\t * @private\n\t */\n\t_reorderLineItems() {\n\t\tlet lineItems = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, numOfGroups = groupModels.length; i < numOfGroups; i++) {\n\t\t\tlet groupModel = groupModels[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) {\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) {\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) {\n\t\t\t\t\t\t// push segments lineVO\n\t\t\t\t\t\tlineItems.push(segments[m].lineVO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++) {\n\t\t\t\t// push standard lineVO\n\t\t\t\tlineItems.push(groupModel.standardLines[n].lineVO);\n\t\t\t}\n\t\t}\n\t\treturn lineItems;\n\t}\n\n\t_reorderGroups() {\n\t\tlet groupModels = this.domHost.groupModels;\n\t\tfor (let i = 0; i < groupModels.length; i ++ ) {\n\t\t\tgroupModels[i].groupVO.record[this.editorModel.constants.NUMBER_FIELD] = i + 1;    // Update groupVO number field\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-favorite-saved': '_saveFavorite',\n\t\t\t'job-completed': '_jobCompleted'\n\t\t};\n\t}\n\n\t_saveFavorite(e) {\n\t\tthis._executeServiceAction('favoriteLinesService', {keys: e.detail.keys, favName: e.detail.name, groupKey: e.detail.groupKey});\n\t}\n\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_executeCustomAction(eventDetail)',\n\t\t\t'_handleCalculateResponse(calculateResponse)',\n\t\t\t'_checkForGuidedMessages(saverResponse)',\n\t\t\t'_reloadEditor(quoteEditorModelResponse)',\n\t\t\t'_clearDirtyFields(quoteEditorModelResponse)',\n\t\t\t'_updateQuote(quoteVOResponse)',\n\t\t\t'_handleToggleGroupResponse(toggleGroupResponse)',\n\t\t\t'_handlePopupResponse(popupResponse)'\n\t\t\t];\n\t}\n\n\t/**\n\t * Invoked with eventDetail is set. The eventDetail object looks like {customAction: CustomActionModel, model: QuoteModel, GroupModel, or LineModel}\n\t * If there is a function with the same name as the eventHandlerName, invoke it. Otherwise, execute the action.\n\t */\n\t_executeCustomAction() {\n\t\tlet action = this.eventDetail.customAction;\n\t\tif (action.url && action.urlTarget) {\n\t\t\tthis._executeCustomURLAction(action.url, action.urlTarget, this.eventDetail.model);\n\t\t} else if (typeof this[action.eventHandlerName] == \"function\") {\n\t\t\tthis[action.eventHandlerName]();\n\t\t} else  {\n\t\t\tthis._executeServiceAction(this.eventDetail.customAction.eventHandlerName);\n\t\t}\n\t}\n\n\t_executeCustomURLAction(url, target, model) {\n\t\tif (model.quoteVO)\n\t\t\tthis.model = model.quoteVO;\n\t\telse if (model.lineVO)\n\t\t\tthis.model = model.lineVO;\n\t\telse if (model.groupVO)\n\t\t\tthis.model = model.groupVO;\n\n\t\tlet parsedURL = this._parseURL(url, this.model);\n\t\tif (target === 'Popup')\n\t\t\tthis._handlePopup(parsedURL, this.model.record);\n\t\telse\n\t\t\tthis._navigateToURL(parsedURL);\n\t}\n\n\t_handleCalculateResponse() {\n\t\tlet response = this.calculateResponse;\n\t\tif (response) {\n\t\t\t// if job id is exist, this implies that the background calculate was executed before.\n\t\t\tif ( response.jobId != null) {\n\t\t\t\tthis._onJobChecker(response);\n\t\t\t} else {\n\t\t\t\tthis._updateQuote(response);\n\t\t\t}\n\t\t}\n\t}\n\n\t_updateQuote(quoteVO) {\n\t\tthis.domHost.updateQuote(quoteVO);\n\t}\n\n\t_checkForGuidedMessages() {\n\t\tif (this.saverResponse.guidedMessages && this.saverResponse.guidedMessages.length > 0) {\n\t\t\tthis.domHost.handleProductRuleAlertModal('saveService', this.saverResponse.guidedMessages);\n\t\t\tthis.showSpinner = false;\n\t\t} else {\n\t\t\t// Pass true to ensure validation process is called in navigateToReturnUrl\n\t\t\tthis.navigateToReturnUrl(true);\n\t\t}\n\t}\n\n\tnavigateToReturnUrl(args) {\n\t\t// when cancelling, no args are passed and we can just go to the detail page, skipping the validation process\n\t\tif(args && this.saverResponse && this.saverResponse.messages && this.saverResponse.messages.length > 0) {\n\t\t\tif (this.showSpinner)\n\t\t\t\tthis.showSpinner = false;\n\t\t\tthis.domHost.errors = this.saverResponse.messages;\n\t\t\treturn;\n\t\t}\n\t\tlet sobjectId = this.editorModel.quoteModel.quoteVO.record.Id;\n\t\tlet returnUrl = this.eventDetail.customAction.record ? this.eventDetail.customAction.record[this.editorModel.constants.RETURN_URL_FIELD] : null;\n\t\tif (returnUrl) {\n\t\t\treturnUrl = this._parseURL(returnUrl, this.editorModel.quoteModel.quoteVO, this.editorModel.quoteModel);\n\t\t\tif ((returnUrl.length == 15 || returnUrl.length == 18) && returnUrl.match(/^[a-zA-Z0-9]*$/)) {\n\t\t\t\t// This is an ID\n\t\t\t\tsobjectId = returnUrl;\n\t\t\t\treturnUrl = null;\n\t\t\t}\n\t\t}\n\t\tif (this._isLightningExperience() && !returnUrl){\n\t\t\t//W-014658: mobile does not have a way to exit the Visualforce page besides the back button\n\t\t\tif(PageContainer.getViewport().isMobile() === true)\n\t\t\t\tthis._navigateToURL('#/sObject/' + this.prefix + 'Quote__c/home');\n\t\t\telse\n\t\t\t\tsforce.one.navigateToSObject(sobjectId);\n\t\t\treturn;\n\t\t}\n\t\t// Check if in partner portal\n\t\treturnUrl = returnUrl || (this.editorModel.communityPrefix + '/') + sobjectId;\n\n\t\tif (window.parent) {\n\t\t\t// For org\n\t\t\twindow.parent.location.href = returnUrl;\n\t\t} else {\n\t\t\t// For localhost\n\t\t\twindow.location.href = returnUrl;\n\t\t}\n\t}\n\n\t_reloadEditor() {\n\t\tthis.domHost.destampGroups(); //destroy the groups so that they can be rerendered;\n\t\tthis.domHost.md = undefined;\n\n\t\t// Wrap this in after next render so destampGroups has time to remove group elements.\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.domHost.rawData = this.quoteEditorModelResponse;\n\t\t\tif (this.quoteEditorModelResponse.guidedMessages && this.quoteEditorModelResponse.guidedMessages.length > 0) {\n\t\t\t\tthis.domHost.handleProductRuleAlertModal('quickSaveService', this.quoteEditorModelResponse.guidedMessages);\n\t\t\t}\n\t\t\tthis.showSpinner = false;\n\t\t});\n\t}\n\n\t/**\n\t * Event handler for response-event changed from sb-service (id=\"toggleGroupService\") component.\n\t * @private\n\t */\n\t_handleToggleGroupResponse() {\n\t\tthis.domHost.set('editorModel.quoteModel.quoteVO', this.toggleGroupResponse);\n\t\tif (this.domHost.$$('#quoteTabs'))\n\t\t\tthis.domHost.$$('#quoteTabs').destroyTabs();\n\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\n\t\tlet lineItemGroups = quoteModel.quoteVO.lineItemGroups;\n\t\tif (!quoteModel.grouped){ //Grouping the quote\n\t\t\tif (this.eventDetail.customAction.type === 'Solution Group') { this._extendSolutionGroupRecord(lineItemGroups[0].record)};\n\t\t\tthis.set('editorModel.quoteModel.grouped', true);\n\t\t\tthis.set('editorModel.quoteModel.quoteVO.lineItemGroups', quoteModel.quoteVO.lineItemGroups);\n\t\t} else { //Ungrouping the quote\n\t\t\tthis.domHost.set('editorModel.quoteModel.grouped', false);\n\t\t\t// Hides the \"Groups\" button that toggles the side panel\n\t\t\tthis.domHost.rightSideButton = false;\n\t\t\t// Notifies LEGroupLayout to close the group side panel\n\t\t\tthis.fire('iron-signal', {name: 'close-group-panel'});\n\t\t\tfor (let i =0; i < this.domHost.groupModels.length; i++) {\n\t\t\t\tthis.domHost.set('groupModels.' + i + '.groupVO', {});\n\t\t\t}\n\t\t}\n\t\tthis._updateQuote(quoteModel.quoteVO);\n\t\tif (this.domHost.viewport.isMobile()) {\n\t\t\tthis.domHost.buildQuoteTabs();\n\t\t}\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_handlePopupResponse() {\n\t\tlet lines = this.popupResponse.lines;\n\t\tswitch (this.popupResponse.action) {\n\t\t\tcase 'save':\n\t\t\t\tthis.onSave();\n\t\t\t\tbreak;\n\t\t\tcase 'quicksave':\n\t\t\t\tthis.onQuickSave();\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\tlocation.reload();\n\t\t\t\tbreak;\n\t\t\tcase 'none':\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t_handlePopup(url, record) {\n\t\tlet popup = this.$.popup;\n\t\tpopup.url = url;\n\t\tpopup.messenger = new QuoteMessenger(this.editorModel, record);\n\t\tpopup.open();\n\t}\n\n\t_parseURL(url, targetModel, quoteModel) {\n\t\tlet parsedURL = url.replace(/{!(.*?)}/g, function(match, value) {\n\t\t\tlet record;\n\t\t\tlet splitValues = value.split('.');\n\t\t\tlet objectName = splitValues[0];\n\t\t\tif (objectName == 'SBQQ__Quote__c' || objectName == 'SBQQ__Quote__r' || objectName == 'Quote__c' || objectName == 'Quote__r') {\n\t\t\t\trecord = quoteModel.quoteVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else if (objectName == 'SBQQ__Group__c' || objectName == 'SBQQ__Group__r' || objectName == 'Group__c' || objectName == 'Group__r') {\n\t\t\t\trecord = quoteModel.groupsByKey[this.model.parentGroupKey].groupVO.record;\n\t\t\t\tsplitValues.shift();\n\t\t\t} else {\n\t\t\t\trecord = targetModel.record;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < splitValues.length; i++) {\n\t\t\t\tif (i == splitValues.length - 1)\n\t\t\t\t\treturn record[splitValues[i]];\n\t\t\t\telse\n\t\t\t\t\trecord = record[splitValues[i]];\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn parsedURL;\n\t}\n\n\t_navigateToURL(url) {\n\t\tif (this._isLightningExperience())\n\t\t\tsforce.one.navigateToURL(url);\n\t\telse\n\t\t\twindow.location.href = url;\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce != 'undefined') && sforce && (!!sforce.one);\n\t}\n\n// Quote Actions\n\n\t/**\n\t * Sets the calculate service model\n\t *\n\t * @private\n\t */\n\tonFlagCalculate(showSpinner, updateQuoteRequired) {\n\t\tthis.domHost.errors = null;\n\t\tif (this._usesClientCalculator()) {\n\t\t\tthis._jsqcCalculate(showSpinner).then(function(res){\n\t\t\t\t// Runs after a quote service comes back from the server and it requires a calculation\n\t\t\t\t// Or if custom segments have changed and need to be reflected in UI\n\t\t\t\tif (updateQuoteRequired || res.updateQuoteRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tthis._updateQuote(res.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Runs after add products\n\t\t\t\tif (this.data.quote.calculationRequired) {\n\t\t\t\t\tthis.data.quote.calculationRequired = false;\n\t\t\t\t\tif ( res.value.lineSortField && res.value.lineSortField != this.data.developerPrefix + 'Number__c' ) {\n\t\t\t\t\t\t// Unique sort to handle sorting line items that haven't been rendered yet (navigating from add products)\n\t\t\t\t\t\tres.value.lineItems = new SortLinesHandler(this.data.developerPrefix).sortLineItems(res.value.lineItems, res.value.lineSortField);\n\t\t\t\t\t}\n\t\t\t\t\tthis.domHost._createEditorModel();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Runs after a calculate to update the UI\n\t\t\t\tlet sortRequired = res.value.lineSortField && res.value.lineSortField == this.editorModel.constants.NUMBER_FIELD;\n\t\t\t\tthis.domHost.updateAfterJSQC(this.notifier, sortRequired);\n\t\t\t\t// Sorts lines after a normal calculate\n\t\t\t\tthis.sortLines(res.value, true);\n\t\t\t}.bind(this), function(rej) {\n\t\t\t\tif (this.editorModel !== undefined) {\n\t\t\t\t\tthis.domHost.error = rej;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//When errors get caught here the LE page is not usable.  So we display an alert with the message and a button that goes back to the last page\n\t\t\t\tthis.$.alertModal.displayContinueButton = false;\n\t\t\t\tthis.$.alertModal.cancelCB = function() {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}.bind(this);\n\t\t\t\tthis.$.alertModal.alerts = [rej.message];\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\tthis.$.calculateService.model = undefined;\n\t\t\tthis.$.calculateService.background = showSpinner === false;\n\t\t\tthis._executeServiceAction('calculateService');\n\t\t}\n\t}\n\n\tonSave() {\n\t\tthis.showSpinner = true;\n\t\tthis.$.saveService.background = true;\n\t\tthis._save('saveService');\n\t}\n\n\tonQuickSave() {\n\t\tthis.$.quickSaveService.uid = this.editorModel.quoteModel.quoteVO.record.Id.substring(0, 15);\n\t\tthis.showSpinner = true;\n\t\tthis.$.quickSaveService.background = true;\n\t\tthis._save('quickSaveService');\n\t}\n\n\tonCancel() {\n\t\tthis.showSpinner = true;\n\t\tthis.navigateToReturnUrl();\n\t}\n\n\tonAddProducts() {\n\t\tthis._navigateToLookup('product');\n\t}\n\n\tonAddFavorites() {\n\t\tthis._navigateToLookup('favorite');\n\t}\n\n\tonDeleteLines() {\n\t\tthis._executeServiceAction('onDeleteLine', {keys: this._retrieveKeysOfSelected()});\n\t}\n\n\tonAddGroup(selectedSolutionGroup) {\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis._addGroup(); // Called when quote is grouped to add a new empty group.\n\t\t} else {\n\t\t\tthis._executeServiceAction('onAddGroup'); // Called for ungrouped quote to create new group out of existing lines.\n\t\t}\n\t}\n\n\n// Quote/Group Actions\n\n\tonResetDiscounts() {\n\t\tlet groupKey,\n\t\t\tconstants = this.editorModel.constants;\n\t\t// reset add discount fields on conditionally rendered lines (ie. segmented details, mobile) to make sure they have the correct data\n\t\tif (this.eventDetail.model.groupKey) {\n\t\t\t// event is fired from the group\n\t\t\tgroupKey = this.eventDetail.model.groupKey;\n\t\t\tlet group = this.editorModel.quoteModel.groupsByKey[groupKey];\n\n\t\t\t// reset standard lines\n\t\t\tfor (let i = 0, x = group.standardLines.length; i < x; i++) {\n\t\t\t\tlet standardLineVO = group.standardLines[i].lineVO;\n\t\t\t\tstandardLineVO.record[constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\t\tstandardLineVO.record[constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\t}\n\n\t\t\t// reset all segments of segmented lines\n\t\t\tfor (let j = 0, y = group.dimensions.length; j < y; j++) {\n\t\t\t\tlet dim = group.dimensions[j],\n\t\t\t\t\tsegmentedLines = group.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, z = segmentedLines.length; k < z; k++) {\n\t\t\t\t\tlet segmentedLine = segmentedLines[k];\n\t\t\t\t\tfor (let l = 0, w = segmentedLine.segments.length; l < w; l++) {\n\t\t\t\t\t\tlet segmentLineVO = segmentedLine.segments[l].lineVO;\n\t\t\t\t\t\tsegmentLineVO.record[constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\t\t\t\tsegmentLineVO.record[constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// event is fired from the quote\n\t\t\tlet lineItems = this.editorModel.quoteModel.quoteVO.lineItems;\n\t\t\tfor (let m = 0, len = lineItems.length; m < len; m++) {\n\t\t\t\tlineItems[m].record[constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\t\tlineItems[m].record[constants.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\t}\n\t\t}\n\t\tthis.fire('iron-signal', {name : 'reset-discount-clicked', data: {groupKey: groupKey}});\n\t}\n\n\tupdateLineOptional() {\n\t\tlet groupKey;\n\t\tif (this.eventDetail.model.groupKey) {\n\t\t\tgroupKey = this.eventDetail.model.groupKey;\n\t\t}\n\t\tthis.editorModel.quoteModel.allOptional = this.eventDetail.customAction.caClass === 'optionalAllBtn';\n\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\tthis.notifyPath('editorModel.quoteModel.allOptional', this.editorModel.quoteModel.allOptional);\n\t\tthis.fire('iron-signal', {name: 'toggle-optional-clicked', data : {toggleOptionalBoolean : this.editorModel.quoteModel.allOptional, groupKey: groupKey}});\n\t}\n\n\tonUpgradeAssets() {\n\t\tthis._navigateToLookup('asset');\n\t}\n\n\tonRenewSubscriptions() {\n\t\tthis._navigateToLookup('subscription');\n\t}\n\n// Group Actions\n\n\tonDeleteGroup() {\n\t\tif (confirm('All lines will also be deleted. Are you sure you want to delete this group?'))\n\t\t\tthis._executeServiceAction('onDeleteGroup');\n\t}\n\n\n\n// Line Actions\n\n\tonReconfigureLine() {\n\t\tNavigator.nav('#',\n\t\t\t{lineKey: this.eventDetail.model.lineVO.key,\n\t\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\t\tignoreCache: true},\n\t\t\t['product', 'pc'], false, this);\n\t}\n\n\tonAddToFavorites() {\n\t\tthis._openDialog('favDialog');\n\t}\n\n\tonRemoveFromFavorites() {\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tif (!confirm('Are you sure you want to remove the favorite?'))\n\t\t\t\treturn;\n\t\t} else {\n\t\t\tif (!confirm('All lines will be removed from favorites. Are you sure you want to remove this group from favorites?'))\n\t\t\t\treturn;\n\t\t}\n\t\tthis._executeServiceAction('onRemoveFromFavorites');\n\t}\n\n\t/**\n\t * Clones line items\n\t * @private\n\t * cloneLines and clonedSegmentedLines are holding arrays used to keep a list of the lines that need to be cloned\n\t */\n\tonCloneLine() {\n\t\tlet originalLine = this.eventDetail.model;\n\t\tlet clonedLines = []; // list of cloned standard lines\n\t\tlet clonedSegmentedLines = {Year: {lines: []}, Quarter: {lines: []}, Month: {lines: []}, Custom: {lines: []}}; // list of cloned segmented summary lines by dimension\n\t\tlet groupIndex = this.editorModel.quoteModel.indexByGroupKey[this.eventDetail.model.lineVO.parentGroupKey].index || 0;\n\t\tlet groupModel = this.eventDetail.model.groupModel;\n\t\tlet groupModels = this.domHost.groupModels;\n\n\t\t/**\n\t\t * Recursively populates the clonedLines and clonedSegmentedLines arrays that hold cloned line models\n\t\t * @param line - lineModel, will either be the standard line being cloned and if bundle first is the parent line of the bundle then recursively called for each option that belongs to the bundle\n\t\t * @param parentItemKey - unique identifier that establishes the link between bundle and component line\n\t\t * @param clonedLines - array that holds cloned standard lines\n\t\t * @param clonedSegmentedLines - array that holds clones segmented lines\n\t\t * @private\n\t\t */\n\t\tlet _addParentAndAllChildLineItems = (line, parentItemKey) => {\n\t\t\tlet clone;\n\t\t\tif (line.segmented) {\n\t\t\t\tclone = groupModels[groupIndex].cloneSegmentedLine(line, parentItemKey);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].lines.push(clone);\n\t\t\t\tclonedSegmentedLines[clone.dimensionType].key = line.lineVO.key;\n\t\t\t} else {\n\t\t\t\tclone = groupModels[groupIndex].cloneLine(line, parentItemKey);\n\t\t\t\tclonedLines.push(clone);\n\t\t\t}\n\t\t\tgroupModels[groupIndex].addToLinesByParentItemKey(clone); // update linesByParentItemKey map for the new bundle\n\n\t\t\t// if line is a bundle, execute this method for each component recursively\n\t\t\tif (line.bundle) {\n\t\t\t\tif (groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key]) {\n\t\t\t\t\tlet components = groupModels[groupIndex].quoteModel.linesByParentItemKey[line.lineVO.key];\n\t\t\t\t\tfor (let i = 0, l = components.length; i < l; i++) {\n\t\t\t\t\t\t_addParentAndAllChildLineItems(components[i], clone.lineVO.key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned standard lines into the group's standardLines array and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedLines - the holding array containing the lines that need to be cloned, will be spliced into groupModel.standardLines\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tlet _addClonedLines = () => {\n\t\t\tif (clonedLines.length > 0) {\n\t\t\t\t// find the index of the original line within the group\n\t\t\t\tlet idx;\n\t\t\t\tlet i,\n\t\t\t\t\tlen = groupModels[groupIndex].standardLines.length;\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\tif (originalLine.lineVO.key === groupModels[groupIndex].standardLines[i].lineVO.key) {\n\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// if the original line is a bundle, increment the index until we reach a non-component item\n\t\t\t\tif (originalLine.bundle) {\n\t\t\t\t\tif (!this.editorModel.data.settings.bundleKeptTogether) {\n\t\t\t\t\t\tidx = len;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let j = i; j < len; j++) {\n\t\t\t\t\t\t\tif (!groupModels[groupIndex].standardLines[j].component && groupModels[groupIndex].standardLines[j].lineVO.key !== originalLine.lineVO.key) {\n\t\t\t\t\t\t\t\tidx = j;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else { // Assign idx to end of groupModel.standardLines in case bundle is indexed at the end to avoid idx not getting set, will be overridden by the above if assignment in case the bundle is not at the end of the array\n\t\t\t\t\t\t\t\tidx = len;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// add cloned lines to the standardLines array of the group and the lineVO's to the quoteVO\n\t\t\t\tfor (let k = 0, l = clonedLines.length; k < l; k++) {\n\t\t\t\t\tlet clonedLine = clonedLines[k];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.standardLines`, idx, 0, clonedLine);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(clonedLine.lineVO);\n\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[clonedLine.lineVO.key] = clonedLine;\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds cloned segmented lines into the group's segmentedLinesByDimension array it should belong in and the lineVO's of these lines into the quoteVO\n\t\t * @param clonedSegmentedLines - the holding array containing the lines that need to be cloned, will be spliced into the dimensionType on segmentedLinesByDimension\n\t\t * @param originalLine - the original line that was tapped for cloning\n\t\t * @private\n\t\t */\n\t\tlet _addClonedSegmentedLines = () => {\n\t\t\tfor (let dimension in clonedSegmentedLines) {\n\t\t\t\tif (!(clonedSegmentedLines[dimension].lines.length > 0)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet idx = 0;\n\t\t\t\tlet segmentedLinesToSplice = clonedSegmentedLines[dimension].lines;\n\t\t\t\tlet segmentedLines = groupModels[groupIndex].segmentedLinesByDimension[dimension];\n\t\t\t\tlet lastSegmentedLineKey = clonedSegmentedLines[dimension].key;\n\t\t\t\tfor (let i = 0, l = segmentedLines.length; i < l; i++) {\n\t\t\t\t\tif (segmentedLines[i].lineVO.key === lastSegmentedLineKey) {\n\t\t\t\t\t\tidx = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let j = 0, l = segmentedLinesToSplice.length; j < l; j++) {\n\t\t\t\t\tlet segmentedLineModelToSplice = segmentedLinesToSplice[j];\n\t\t\t\t\tthis.domHost.splice(`groupModels.${groupIndex}.segmentedLinesByDimension.${dimension}`, idx + j, 0, segmentedLineModelToSplice);\n\t\t\t\t\t// Need to push it in the segmentsLines array as well because the segmentLines are being used in the delete lines @ Quote level\n\t\t\t\t\tthis.domHost.push(`groupModels.${groupIndex}.segmentedLines`, segmentedLineModelToSplice);\n\t\t\t\t\t// Push to lineItems on quoteVO to be sent to server. Order does not matter when sent to server, so adding to end is fine.\n\t\t\t\t\tfor (let k = 0; k < segmentedLineModelToSplice.segments.length; k++) {\n\t\t\t\t\t\tgroupModels[groupIndex].quoteModel.quoteVO.lineItems.push(segmentedLineModelToSplice.segments[k].lineVO);\n\t\t\t\t\t\tthis.editorModel.quoteModel.lineModelsByKey[segmentedLineModelToSplice.segments[k].lineVO.key] = segmentedLineModelToSplice.segments[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t_addParentAndAllChildLineItems(originalLine);\n\t\t_addClonedLines();\n\t\t_addClonedSegmentedLines();\n\t\tthis.domHost.renumber();\n\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t}\n\n\n// Helper functions\n\n\t_usesClientCalculator() {\n\t\treturn this.data.settings.usesClientCalculator;\n\t}\n\n\t_jsqcCalculate(showSpinner) {\n\t\t// Prevents this showSpinner from overriding showSpinner initiated by a save\n\t\tthis.showSpinner = showSpinner || showSpinner == null ? true : this.showSpinner;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (SB && SB.JSQC) {\n\t\t\t\tlet res = {};\n\t\t\t\tlet settings = this.data.settings;\n\t\t\t\tlet oauthClient = new OAuthClient(this.app.org.prefix);\n\t\t\t\tthis.notifier = !this.data.quote.calculationRequired && this.domHost.editorModel ? new JSQCNotifier(this.domHost) : null;\n\t\t\t\tsettings.displayedLookupMap = this.getDisplayedLookupNames(this.data);\n\t\t\t\tvar mdqHelper = this.editorModel ? new MDQSegmentHelper(this.data, this.editorModel.quoteModel.groupsByKey) : new MDQSegmentHelper(this.data, null);\n\t\t\t\tvar segmentsChanged = mdqHelper.updateSegments();\n\t\t\t\tif (segmentsChanged && !this.data.quote.calculationRequired) {\n\t\t\t\t\tres.updateQuoteRequired = true;\n\t\t\t\t\tthis.notifier = null;\n\t\t\t\t}\n\t\t\t\tlet qc = new SB.JSQC(settings, this.data.quote, this.notifier);\n\t\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\t\tlet connectionPromiseArray = [oauthClient.getConnection(), oauthClient.getConnection()];\n\t\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\t\tlet promise = qc.onCalc();\n\t\t\t\t\tpromise.then(function(successQuote) {\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\tres.value = successQuote;\n\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\t\tthis.showSpinner = showSpinner || showSpinner == null ? false : this.showSpinner;\n\t\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject({message: err.message || err});\n\t\t\t\t}.bind(this));\n\t\t\t} else {\n\t\t\t\treject({message: \"ERROR: Could not find the Client-Side Calculator\"});\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetDisplayedLookupNames(data) {\n\t\tlet results = {'line': [], 'group': [], 'quote': []};\n\n\t\t// Retrieve lookup objects and convert to array so we can cycle through and replace the fields with their relationship fields\n\t\tlet lineFields = (data.settings.lineLookups) ? Object.keys(data.settings.lineLookups) : [];\n\t\tlet groupFields = (data.settings.groupLookups) ? Object.keys(data.settings.groupLookups) : [];\n\t\tlet quoteFields = (data.settings.quoteLookups) ? Object.keys(data.settings.quoteLookups) : [];\n\n\t\tlineFields.forEach(function (field) {\n\t\t\tresults.line.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tgroupFields.forEach(function (field) {\n\t\t\tresults.group.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\tquoteFields.forEach(function (field) {\n\t\t\tresults.quote.push(RelationshipFieldManager.getRelationshipField(field));\n\t\t});\n\n\t\treturn results;\n\t}\n\n\t_onJobChecker(job){\n\t\tjob.jobType = 'QuoteCalculator';\n\t\tthis.$.jobchecker.useSpinner = !this.$.calculateService.background;\n\t\tthis.$.jobchecker.data = job;\n\t}\n\n\t_jobCompleted() {\n\t\tif (this.$.jobchecker.result.payload != null) {\n\t\t\tlet quote = JSON.parse(this.$.jobchecker.result.payload);\n\t\t\tquote.backgroundCalculatePending = false;\n\t\t\tif (this.saveServiceAfterBackgroundCalc) {\n\t\t\t\t// Update quoteModel so the newly calculated quote reference is used in preparation for the save\n\t\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\t\tthis._executeServiceAction(this.saveServiceAfterBackgroundCalc);\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.domHost.updateQuote(quote);\n\t\t}\n\t}\n\n\t_save(saveService) {\n\t\tif (this.editorModel.data.settings.usesClientCalculator) { // Check if jsqc should be used\n\t\t\tthis._jsqcCalculate(false).then(function (res) {\n\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t}.bind(this), function (rej) {\n\t\t\t\tthis.domHost.error = rej;\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\t// If background calc enabled, need to run background calc and wait for response before triggering the correct save\n\t\t\tif (this.editorModel.data.settings.usesBackgroundCalculator) {\n\t\t\t\t// This property is used in _onJobChecker to trigger a save after job is complete\n\t\t\t\tthis.saveServiceAfterBackgroundCalc = saveService;\n\t\t\t\tthis.onFlagCalculate(false);\n\t\t\t} else {\n\t\t\t\t// Call executeServiceAction which sets the model and reorder the lineVOs\n\t\t\t\tthis._executeServiceAction(saveService);\n\t\t\t}\n\t\t}\n\t}\n\n\t_navigateToLookup(lookupName) {\n\t\tthis.domHost.errors = null;\n\t\tlet queryParams = {\n\t\t\tqId : this.editorModel.quoteModel.quoteVO.record.Id,\n\t\t\taId : this.eventDetail.customAction.customActionId\n\t\t\t};\n\t\tif (this.eventDetail.model && this.eventDetail.model.groupKey)\n\t\t\tqueryParams.groupKey = this.eventDetail.model.groupKey;\n\n\t\tNavigator.nav('#', queryParams, [lookupName, 'lookup'], false, this);\n\t}\n\n\t_retrieveKeysOfSelected() {\n\t\tlet keys = [];\n\t\tlet groupModels = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, gmLength = groupModels.length; i < gmLength; i++) {\n\t\t\tlet standardLines = groupModels[i].standardLines;\n\t\t\tfor (let j = 0, standardLinesLength = standardLines.length; j < standardLinesLength; j++) {\n\t\t\t\tif (standardLines[j].selected && !standardLines[j].component)\n\t\t\t\t\tkeys.push(standardLines[j].lineVO.key);\n\t\t\t}\n\t\t\tlet segmentedLines = groupModels[i].segmentedLines;\n\t\t\tfor (let j = 0, segmentedLinesLength = segmentedLines.length; j < segmentedLinesLength; j++) {\n\t\t\t\tif (segmentedLines[j].selected && !segmentedLines[j].component){\n\t\t\t\t\tlet segments = segmentedLines[j].segments;\n\t\t\t\t\tfor (let k = 0, segmentsLength = segments.length; k < segmentsLength; k++)\n\t\t\t\t\t\tkeys.push(segments[k].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn keys;\n\t}\n\n\t_addGroup() {\n\t\tlet constants = this.editorModel.constants;\n\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\tlet groupRecord = {Name: `Group${quoteModel.lineGroups.length + 1}`};\n\t\t\n\t\tgroupRecord[constants.QUOTE_PROCESS_FIELD] = this.editorModel.data.defaultQuoteProcessId;\n\t\tgroupRecord[constants.ACCOUNT_FIELD] = quoteModel.quoteVO.record[constants.ACCOUNT_FIELD];\n\n\t\tif (this.eventDetail.customAction.type === 'Solution Group') { \n\t\t\tthis._extendSolutionGroupRecord(groupRecord);\n\t\t}\n\n\t\tlet groupVO = {key: ++quoteModel.quoteVO.nextKey, record: groupRecord, multiSegmentColumns: {}, localizedMultiSegmentColumns: {}};\n\t\tlet group = new GroupModel(groupVO, quoteModel);\n\n\t\tquoteModel.quoteVO.lineItemGroups.push(groupVO);\n\t\tquoteModel.groupsByKey[group.groupVO.key] = group;\n\t\tlet indexByGroupKey = quoteModel.indexByGroupKey;\n\t\tindexByGroupKey[group.groupVO.key] = {index: Object.keys(indexByGroupKey).length, indexByLineKey : {}, indexBySegmentKey : {}};\n\n\t\tthis.domHost.push('groupModels', group);\n\t\tfor (let i = 0; i < quoteModel.quoteVO.lineItemGroups.length; i++) {\n\t\t\tquoteModel.quoteVO.lineItemGroups[i].record[constants.NUMBER_FIELD] = i + 1;\n\t\t}\n\t\tthis.domHost.rightSideButton = quoteModel.lineGroups.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.domHost.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\n\t\tif(quoteModel.lineGroups.length == 2) {\n\t\t\tthis.fire('iron-signal', { name: 'group-panel-created'});\n\t\t}\n\n\t\tthis.domHost.quoteHasNoLines();\n\t}\n\n\t_extendSolutionGroupRecord(groupRecord) {\n\t\tgroupRecord.Name = this.eventDetail.customAction.record.Name;\n\t\tgroupRecord[this.editorModel.constants.DESCRIPTION_FIELD] = this.eventDetail.customAction.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t}\n\n\n\t_openDialog(dialogName) {\n\t\tlet favDialog = this.$[dialogName];\n\t\tif (this.eventDetail.customAction.location === \"Line\") {\n\t\t\tfavDialog.favoritedLine = this.eventDetail.model.serviceModel.keys;\n\t\t} else {\n\t\t\tlet groupLines = [].concat(this.eventDetail.model.standardLines).concat(this.eventDetail.model.segmentedLines);\n\t\t\tif (groupLines.length == 0) {\n\t\t\t\tthis.domHost.errors = ['Please select a group with one or more lines to favorite.']; //TODO: custom label with sb18n\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tfavDialog.favoritedGroup = this.eventDetail.model.groupKey;\n\t\t\t\tfavDialog.groupLines = groupLines;\n\t\t\t}\n\t\t}\n\t\tfavDialog.$.dialog.toggle();\n\t}\n\n\tget prefix() {\n\t\tif(this.app === undefined)\n\t\t\treturn;\n\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tsortLines(quote, notify) {\n\t\tlet lineSortField = quote.lineSortField;\n\t\tif ( !quote.lineSortField || lineSortField == this.editorModel.constants.NUMBER_FIELD ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.fire('iron-signal', {name: 'sort-lines-required', data: {lineSortField: lineSortField, notify: notify}});\n\t}\n\n\t_clearDirtyFields() {\n\t\tif(PageContainer.getViewport().isDesktop())\n\t\t\tthis.fire('iron-signal', { name: 'sb-quote-quick-save'} )\n\t}\n\n}\n\nPolymer( LECustomActionServices );","import {Localizer} from '../layout/sb-le-table-cell/Localizer.js';\n\nlet sortByField;\nlet lookupNameField;\nlet developerPrefix;\nlet constants;\n\n/**\n * For each node in the tree, starting at a given id and proceeding\n * depth-first (pre-order), sort the child nodes based on sortChildLinesAsc, and\n * call the callback with each child node.\n */\nfunction depthFirstTraversal(tree, id, byOrder, callback) {\n    let children = tree[id];\n    if (!children) return;\n\n    if(byOrder === '') {    // Scenario of reverting the sort\n        children.sort(sortLinesAscByKey.bind(this));\n    } else if (byOrder === 'asc'){\n        children.sort(sortLinesAscByField.bind(this));\n    } else if (byOrder === 'desc'){\n        children.sort(sortLinesDescByField.bind(this));\n    }\n\n    for (let i=0; i < children.length; i++) {\n        callback(children[i]);\n        depthFirstTraversal(tree, children[i].lineVO.key, byOrder, callback);\n    }\n}\n\n/**\n * Returns an object, where each key is a node, and\n * its value is an array of child nodes.\n */\nfunction makeLineItemsTree(arr) {\n    var tree = {};\n    for (var i = 0; i < arr.length; i++) {\n        // parentItemKey in tree object must not be null or undefined\n        if (arr[i].lineVO.parentItemKey == null){\n            arr[i].lineVO.parentItemKey = 0;\n        }\n\n        if (!tree[arr[i].lineVO.parentItemKey]){\n            tree[arr[i].lineVO.parentItemKey] = [];\n        }\n        tree[arr[i].lineVO.parentItemKey].push(arr[i]);\n    }\n    return tree;\n}\n\n// Child Lines are sorted ascending order by their line keys.\nfunction sortLinesAscByKey(a, b) {\n    return a.lineVO.key-b.lineVO.key;\n}\n\n// Parent lines are sorted by user defined ascending or descending.\nfunction sortLinesAscByField(a, b) {\n    let A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n    let B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n    let isABundled;\n    let isBBundled;\n    if (sortByField === constants.LIST_PRICE_FIELD) {\n        isABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n        isBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n    } else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n        let aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n        let bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n        A = aLocalizedValue || A;\n        B = bLocalizedValue || B;\n    }\n    A = updateFieldFormat(A, isABundled);\n    B = updateFieldFormat(B, isBBundled);\n    if (A == B) {\n        return 0;\n    }else if ( A < B ){\n        return -1;\n    }else if ( A > B ){\n        return 1;\n    }else if (A == null){\n        return -1;\n    }else if (B == null){\n        return 1;\n    }else{\n        return 0;\n    }\n}\n\nfunction sortLinesDescByField(a, b) {\n    let A = lookupNameField && a.lineVO.record[sortByField] ? a.lineVO.record[sortByField][lookupNameField] : a.lineVO.record[sortByField];\n    let B = lookupNameField && b.lineVO.record[sortByField] ? b.lineVO.record[sortByField][lookupNameField] : b.lineVO.record[sortByField];\n    let isABundled;\n    let isBBundled;\n    if (sortByField === constants.LIST_PRICE_FIELD) {\n        isABundled = a.lineVO.record[constants.BUNDLED_FIELD];\n        isBBundled = b.lineVO.record[constants.BUNDLED_FIELD];\n    } else if (a.groupModel.quoteVO.localizationByFieldByProductId && Object.keys(a.groupModel.quoteVO.localizationByFieldByProductId).length > 0) {\n        let aLocalizedValue = Localizer.getLocalizedValue(a, sortByField, lookupNameField);\n        let bLocalizedValue = Localizer.getLocalizedValue(b, sortByField, lookupNameField);\n        A = aLocalizedValue || A;\n        B = bLocalizedValue || B;\n    }\n    A = updateFieldFormat(A, isABundled);\n    B = updateFieldFormat(B, isBBundled);\n    if (A == B) {\n        return 0;\n    }else if ( A > B ){\n        return -1;\n    }else if ( A < B ){\n        return 1;\n    }else if (A == null){\n        return 1;\n    }else if (B == null){\n        return -1;\n    }else{\n        return 0;\n    }\n}\n\n/**\n * Renumbers the Number__c field from record of LineViewModel to update displayed line numbers on line editor.\n * @param {arr}: Array of line items\n * @param {num}: String starting number taken from original line items array.\n */\nfunction reorderLineNumbers(lowestVisibleNumber, lowestInvisibleNumber, array){\n    if (array.length > 0) {\n        var indexByGroupKey = array[0].groupModel.quoteModel.indexByGroupKey;\n        var groupKey = array[0].lineVO.parentGroupKey;\n    }\n    for (let i = 0; i < array.length; i++){\n        // Used to update key to index map that is used for JSQCNotifier to update correct paths\n        var lineKey = array[i].lineVO.key;\n        if (array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]) {\n            // Used to update MDQ summary line index\n            indexByGroupKey[groupKey].indexBySegmentKey[array[i].lineVO.record[constants.SEGMENT_KEY_FIELD]] = i;\n        } else {\n            // Used to update standard lines index only\n            indexByGroupKey[groupKey].indexByLineKey[lineKey] = i;\n        }\n        if (array[i].visible) {\n            array[i].lineVO.record[constants.NUMBER_FIELD] = lowestVisibleNumber;\n            lowestVisibleNumber++;\n        } else {\n            array[i].lineVO.record[constants.NUMBER_FIELD] = lowestInvisibleNumber;\n            lowestInvisibleNumber++;\n        }\n    }\n    return array;\n}\n\n\nfunction updateFieldFormat(field, isBundled) {\n    if (isBundled) {\n        field = 0;\n    }\n    if (typeof field === 'string') {\n        field.toUpperCase();\n    } else if (typeof field === 'undefined') {\n        field = null;\n    }\n    return field;\n}\n\n/**\n * Returns lowest starting visible and invisible line numbers\n */\nfunction getStartingNumbers(arr) {\n    let lowestVisibleNumber;\n    let lowestInvisibleNumber;\n    arr.forEach( function(line) {\n        let lineNumber = line.lineVO.record[constants.NUMBER_FIELD];\n        // lowest numbers will be undefined the first time through so assign them to the first lineNumber\n        if (line.visible) {\n            lowestVisibleNumber = !lowestVisibleNumber || lineNumber < lowestVisibleNumber ? lineNumber : lowestVisibleNumber;\n        } else {\n            lowestInvisibleNumber = !lowestInvisibleNumber || lineNumber < lowestInvisibleNumber ? lineNumber : lowestInvisibleNumber;\n        }\n    }.bind(this));\n    return { lowestVisibleNumber : lowestVisibleNumber, lowestInvisibleNumber : lowestInvisibleNumber};\n}\n\n/**\n * Sorts line items while maintaining bundle hierarchy.\n * @param {arr}: Array of line items\n * @param {byOrder}: String 'asc' for ascending order, 'desc' for descending order\n */\nexport function depthFirstLineItemsTreeSort(arr, field, byOrder, keepBundle, nameField) {\n    let i = 0;\n    constants = arr[0].editorModel.constants;\n    let bundleKeptTogether = keepBundle;\n    sortByField = arr[0].segmented && !arr[0].lineVO.record[field] ? constants.NET_TOTAL_FIELD : field;\n    lookupNameField = nameField;\n    let startingNumbers = getStartingNumbers(arr);\n\n    // bundleKeptTogether flag will only be true if bundleKeptTogether setting is true and the lines being sorted are from the standard lines table\n    // Segmented lines table will send false because parent bundle hierarchy tree does not need to be created, skip directly to sorting\n    if (bundleKeptTogether){\n        let tree = makeLineItemsTree(arr);\n        depthFirstTraversal(tree, 0, byOrder, function(node) {\n            arr[i++] = node;\n        });\n    } else {\n        if (byOrder === 'asc'){\n            arr.sort(sortLinesAscByField.bind(this));\n        } else if (byOrder === 'desc'){\n            arr.sort(sortLinesDescByField.bind(this));\n        } else if (byOrder === ''){     // Scenario of reverting the sort\n            arr.sort(sortLinesAscByKey.bind(this));\n        }\n    }\n\n    // Overwrite arr with the reordered result\n    arr = reorderLineNumbers(startingNumbers.lowestVisibleNumber, startingNumbers.lowestInvisibleNumber, arr);\n\n    return arr;\n}","export class LocalizeFields {\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tlocalizeSearchModel(searchModel) {\n\t\t//localize product fields\n\t\tlet localizedProducts = searchModel.localizationByFieldByProductId;\n\t\tif (!localizedProducts)\n\t\t\treturn searchModel;\n\n\t\tfor (let result of searchModel.results) {\n\t\t\tlet localizedFields = localizedProducts[result.record.Product2Id];\n\t\t\tif (localizedFields) {\n\t\t\t\tfor (let field in localizedFields) {\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localizedFields[field].record);\n\t\t\t\t\tif (!localizedValue)\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tresult.record.Product2[field] = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn searchModel;\n\t}\n\n\tlocalizeProduct(product) {\n\t\t//localize bundle name\n\t\tif(!product.localizationByFieldByProductId) {\n\t\t\treturn product;\n\t\t}\n\t\tlet localized = product.localizationByFieldByProductId[product.record.Id];\n\t\tif (localized && localized.Name) {\n\t\t\tlet localizedFeatureName = this.getLocalizedValue(localized.Name.record);\n\t\t\tif (localizedFeatureName){\n\t\t\t\t//need to store untranslated values to search against on configurator\n\t\t\t\tif (!product.untranslatedRecord)\n\t\t\t\t\tproduct.untranslatedRecord = {Name: JSON.parse(JSON.stringify(product.record.Name))};\n\t\t\t\tproduct.record.Name = localizedFeatureName;\n\t\t\t}\n\t\t}\n\n\t\t//localize option fields\n\t\tfor (let option of product.options) {\n\t\t\tlet untranslatedRecord = {};\n\t\t\tfor (let field in option.localizationByFieldName) {\n\t\t\t\tlet localizedOptionField = null;\n\t\t\t\t// Our understanding is that we only localize custom fields\n\t\t\t\tif (field.indexOf('__c') === -1)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet localized = option.localizationByFieldName[field];\n\t\t\t\tif (localized)\n\t\t\t\t\tlocalizedOptionField = this.getLocalizedValue(localized.record);\n\t\t\t\t// TODO: W-014862: Should fix the backend processes so that we only get one version of the localized values, we are currently getting a prefixed value and a non prefixed value.\n\t\t\t\tif (field === 'Description__c') // TODO: This should be handled in the backend as well\n\t\t\t\t\tfield = 'ProductDescription__c';\n\t\t\t\tif (field.replace('__c', '') !== localized.record[this.prefix + 'APIName__c'].replace('__c', '') || field === localized.record[this.prefix + 'APIName__c'].replace(this.prefix, ''))\n\t\t\t\t\tfield = this.prefix + field;\n\n\t\t\t\tuntranslatedRecord[field] = option.record[field];\n\t\t\t\tif (localizedOptionField && option.record[field])\n\t\t\t\t\toption.record[field] = JSON.parse(JSON.stringify(localizedOptionField));\n\n\t\t\t\telse if(localizedOptionField && option.record[this.prefix + field]) //TODO: Fix underlying problems; this should become unnecessary\n\t\t\t\t\toption.record[this.prefix + field] = JSON.parse(JSON.stringify(localizedOptionField));\n\t\t\t}\n\n\t\t\tif (!option.untranslatedRecord)\n\t\t\t\toption.untranslatedRecord = untranslatedRecord;\n\t\t}\n\n\t\t//localize feature names\n\t\tfor (let feature of product.features) {\n\t\t\tif (!feature.untranslatedRecord)\n\t\t\t\tfeature.untranslatedRecord = {Name: JSON.parse(JSON.stringify(feature.record.Name))};\n\t\t\tlet localizationByFieldName = feature.localizationByFieldName;\n\t\t\tif (localizationByFieldName) {\n\t\t\t\tif (localizationByFieldName.Name) {\n\t\t\t\t\tlet localized = localizationByFieldName.Name;\n\t\t\t\t\tlet localizedValue = this.getLocalizedValue(localized.record);\n\t\t\t\t\tif (localizedValue)\n\t\t\t\t\t\tfeature.record.Name = localizedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn product;\n\t}\n\n\tgetLocalizedValue(record) {\n\t\t//field text type can be 1 of 4\n\t\treturn record[this.prefix + 'Text__c'] ||\n\t\t\trecord[this.prefix + 'TextArea__c'] ||\n\t\t\trecord[this.prefix + 'LongTextArea__c'] ||\n\t\t\trecord[this.prefix + 'RichTextArea__c'];\n\t}\n}","export class AssetUpgradeQuantityCalculator {\n\n    constructor(upgradeHandler) {\n        this.upgradeHandler = upgradeHandler;\n    }\n\n    setQuantitiesByRatio() {\n        let source;\n        let upgrade;\n        let isSourceLine = this.upgradeHandler.isSourceLine();\n\n        // If the configuration changed by the user is a source line, we need to find the corresponding upgrade option\n        if(isSourceLine) {\n            source = this.upgradeHandler.getLine();\n            upgrade = this._getUpgrade(source, null);\n        // If the configuration changed by the user is an upgrade, we need to find the corresponding source option\n        } else {\n            upgrade = this.upgradeHandler.getLine();\n            source = this._getSource(null, upgrade);\n        }\n\n        if(!source || !upgrade) {\n            return;\n        }\n\n        this.upgradeHandler.setSourceAndUpgrade(source, upgrade);\n        this._setAutomaticQuantity(source, upgrade, isSourceLine);\n    }\n\n    _getSource(source, upgrade) {\n        return this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n    }\n\n    _getUpgrade(source, upgrade) {\n        return this.upgradeHandler.getSourceOrUpgrade(source, upgrade);\n    }\n\n    _setAutomaticQuantity(source, upgrade, didUserChangeSourceQuantity) {\n        let upgradeRatio = this._getUpgradeRatio(source, upgrade, this.upgradeHandler.getSourceIdField(), this.upgradeHandler.getUpgradeConversionRateField());\n\n        if(upgradeRatio == null) {\n            return;\n        }\n\n        let sourceCurrentQty = this.upgradeHandler.getSourceCurrentQuantityField(source);\n        let upgradeCurrentQty = this.upgradeHandler.getUpgradeCurrentQuantityField(upgrade);\n        let sourceRate = upgradeRatio.split(':')[0];\n        let upgradeRate = upgradeRatio.split(':')[1];\n        let sourceQtyAfterUpdate = sourceCurrentQty;\n        let upgradeQtyAfterUpdate = upgradeCurrentQty;\n        let sourcePriorQty = this.upgradeHandler.getSourcePriorQuantity(source);\n\n        if(sourceCurrentQty < 0) {\n            source.invalidQuantity = sourceCurrentQty;\n            source.validQuantity = 0;\n        } else if(upgradeCurrentQty < 0) {\n            upgrade.invalidQuantity = upgradeCurrentQty;\n            upgrade.validQuantity = 0;\n        }\n\n        if (this.upgradeHandler.didSourceQuantityChange(didUserChangeSourceQuantity, source, upgrade)) {\n            // If the upgrade option is selected, then its quantity should automatically change if\n            // the source option isn't selected, since that's the same as source quantity of 0\n            // or the source configuration is selected and the user changes its quantity necessitating ratio enforcement\n            upgradeQtyAfterUpdate = (sourcePriorQty - sourceCurrentQty) * (upgradeRate / sourceRate);\n        } else if (this.upgradeHandler.didUpgradeQuantityChange(didUserChangeSourceQuantity, source)) {\n            // If the source option is selected and the user changes the upgrade's quantity\n            // the change must reflect on the source\n            sourceQtyAfterUpdate = sourcePriorQty - (upgradeCurrentQty * (sourceRate / upgradeRate));\n        }\n\n        if (sourceQtyAfterUpdate < 0) {\n            sourceQtyAfterUpdate = 0;\n            if (this.upgradeHandler.isSelected(upgrade)) {\n                upgradeQtyAfterUpdate = sourcePriorQty * (upgradeRate / sourceRate);\n                if(upgradeCurrentQty > upgradeQtyAfterUpdate) {\n                    upgrade.invalidQuantity = upgradeCurrentQty;\n                    upgrade.validQuantity = upgradeQtyAfterUpdate;\n                }\n            }\n        } else if (upgradeQtyAfterUpdate < 0) {\n            upgradeQtyAfterUpdate = 0;\n            if (this.upgradeHandler.isSelected(source)) {\n                sourceQtyAfterUpdate = sourcePriorQty;\n                if(sourceCurrentQty > sourceQtyAfterUpdate) {\n                    source.invalidQuantity = sourceCurrentQty;\n                    source.validQuantity = sourceQtyAfterUpdate;\n                }\n            }\n        }\n\n        this.upgradeHandler.setUpdatedQuantity(source, upgrade, sourceQtyAfterUpdate, upgradeQtyAfterUpdate);\n    }\n\n    _getUpgradeRatio(source, upgrade, sourceIdField, upgradeConversionRateField) {\n        for (let sourceId in upgrade.upgradeSourcesBySourceProductId) {\n            if (sourceId === source.record[sourceIdField]) {\n                return upgrade.upgradeSourcesBySourceProductId[sourceId][upgradeConversionRateField];\n            }\n        }\n    }\n}\n","import {AppContext} from '../AppContext.js';\nimport {Util} from '../../Util.js';\n\n// Maps of cached Intl.DateTimeFormat and Intl.NumberFormat objects using their \"options\" object as 2nd-level keys\n// First level keys are locale strings\nlet dateFormatCache = new Util.Map(),\n\t\tnumberFormatCache = new Util.Map(),\n\t\tlocaleData;  // CLDR locale data for current user's locale, e.g. fr-CA\n\nexport class I18n {\n\n\tconstructor( app ) {\n\t\t// As a Polymer web component we get \"this.app\" from AppContext behavior.\n\t\t// But as regular ES6 class we have to set up ourselves (and we can't extend AppContext for circular dep reasons)\n\t\tthis.app = app;\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-i18n';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\t/**\n\t\t\t * The BCP 47 locale to use to format the data value or translate the message string (i.e. the language).\n\t\t\t * This will default to the user's locale or language so you only need to set it in \"override\" situations.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tlocale: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * The key to use to lookup the translated message string. Only set for overrides or complex/long messages.\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tkey: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: false\n\t\t\t},\n\t\t\t/**\n\t\t\t * The single value to replace the 0th wildcard in the provided translation key (e.g. '{0} items found')\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\t/**\n\t\t\t * The array of values to replace the multiple wildcard strings provided by the translation key (e.g. '{0} of {1} items found')\n\t\t\t * @type {Array}\n\t\t\t */\n\t\t\tvalues: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['localize(key, value, values)'];\n\t}\n\n\tattached() {\n\t\tthis.key = this.key ? this.key : this.innerHTML;\n\t\tif(/{[0-9]}/.test(this.innerHTML))\n\t\t\tthis.innerHTML = ''; // contains wildcard so lets hide until wildcard values are replaced\n\t}\n\n\tlocalize() {\n\t\tthis.innerHTML = this.l(this.key, this.value ? [this.value] : this.values);\n\t}\n\n\t/** Localize a string into a different language */\n\tl( key, values ) {\n\t\tlet label = this.labels[ key ] || key;\n\t\tif(/{[0-9]}/.test(label) && values && values.length > 0)\n\t\t\tlabel = this._replaceWildcards(label, values);\n\n\t\treturn label;\n\t}\n\n\tstatic addLocaleData( d ) {\n\t\tif( d )\n\t\t\tlocaleData = d;\n\t}\n\n\tstatic getLocaleData( locale ) {\n\t\treturn localeData;  // in future we may hold more than 1 data concurrently\n\t}\n\n\t_replaceWildcards(label, values) {\n\t\tfor(let i = 0, l = values.length; i < l; i++)\n\t\t\tlabel = label.replace(new RegExp('{[' + i + ']}', 'g'), values[i]);\n\t\treturn label;\n\t}\n\n\t_getFormat( locale, key, isDate ) {\n\t\tlet f = null;\n\t\tif( locale && key ) {\n\t\t\tlet loc = isDate ? dateFormatCache.get( locale ) : numberFormatCache.get( locale );\n\t\t\tif ( !loc ) {\n\t\t\t\tloc = new Util.Map();\n\t\t\t\tlet c = isDate ? dateFormatCache : numberFormatCache;\n\t\t\t\tc.set( locale, loc );\n\t\t\t}\n\n\t\t\tlet stringKey = JSON.stringify( key );\n\t\t\tf = loc.get( stringKey );\n\t\t\tif( !f ) {\n\t\t\t\tf = isDate ? new Intl.DateTimeFormat( locale, key ) : new Intl.NumberFormat( locale, key );\n\t\t\t\tloc.set( stringKey, f );\n\t\t\t}\n\t\t}\n\t\treturn f;\n\t}\n\n\t/**\n\t * Format a date or number.\n\t * @param  {Object|number} value   the Date object or number value (float or integer)\n\t * @param  {object} options the options object to pass into Intl.DateTimeFormat or Intl.NumberFormat constructor\n\t * @return {string}         the formated string\n\t */\n\tformat( value, options ) {\n\t\tlet v = '',\n\t\t\topts = options || {},\n\t\t\tlocale = this.user.locale;\n\n\t\tif ( value || value == 0 ) {\n\t\t\tif ( value instanceof Date || opts.date ) {\n\t\t\t\tlet fmt = this._getFormat( locale, opts, true );\n\t\t\t\tif ( value instanceof Date ) {\n\t\t\t\t\tv = fmt.format( value );\n\t\t\t\t} else if ( typeof value == 'number' ) {\n\t\t\t\t\tv = fmt.format( new Date( value ) );\n\t\t\t\t} else if ( typeof value === 'string' ) {\n\t\t\t\t\t// Salesforce has dates in ISO-8601 format always\n\t\t\t\t\tlet pos = value.indexOf( 'T' );\n\t\t\t\t\tif( pos >= 0 )\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tv = fmt.format( Date.parse( value ) );  // assume it is in ISO-8601 format with correct TZ?\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tlet parts = value.split('T'),\n\t\t\t\t\t\t\t\tymd = parts[0].split( '-' );\n\t\t\t\t\t\t\tif( ymd && ymd.length == 3 )\n\t\t\t\t\t\t\t\tv = fmt.format( new Date( ymd[0], ymd[1]-1, ymd[2] ) );\n\t\t\t\t\t\t}\n\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet ymd = value.split( '-' );\n\t\t\t\t\t\tif( ymd && ymd.length == 3 )\n\t\t\t\t\t\t\tv = fmt.format( new Date( ymd[0], ymd[1]-1, ymd[2] ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet fmt = this._getFormat( locale, opts, false );\n\t\t\t\tv = fmt.format( value );\n\t\t\t\tif (opts.style === 'currency') {\n\t\t\t\t\tv = this.additionalCurrencyFormat(opts, v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn v;\n\t}\n\n\tadditionalCurrencyFormat (opts, v) {\n\t\t// Allow a user defined Currency Symbol to override org default currency.\n\t\tif (opts.currency === 'XXX') {\n\t\t\treturn this.org.currencySymbol + v.replace(/[XXX]/g, '');\n\t\t} else {\n\t\t\tlet containsDash;\n\t\t\tif (opts.currencyDisplay == 'code') {\n\t\t\t\tcontainsDash = v.indexOf('-') > - 1;\n\t\t\t\tif (containsDash)  {\n\t\t\t\t\tv = v.replace('-', '');\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Append a space after currency code if code is used.\n\t\t\tlet additionalContent = containsDash ? ' -' : ' ';\n\t\t\treturn v.replace(opts.currency, opts.currency + additionalContent) ;\n\t\t}\n\t}\n}\n\nPolymer( I18n );\n","export class LoadingSpinner {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-loading-spinner';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'fixed'\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'large'\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( LoadingSpinner );","// Media Query breakpoints.  These need to be kept in sync with variables.less.\nlet bpXS = 0, bpS = 480, bpM = 800, bpL = 1024, bpXL = 1200,\n\t\tmqXS = window.matchMedia( 'screen and (max-width: ' + bpS + 'px)' ),\n\t\tmqSOnly = window.matchMedia( 'screen and (min-width: ' + (bpS + 1) + 'px) and (max-width: ' + bpM + 'px)' ),\n\t\tmqMOnly = window.matchMedia( 'screen and (min-width: ' + (bpM + 1) + 'px) and (max-width: ' + bpL + 'px)' ),\n\t\tmqLOnly = window.matchMedia( 'screen and (min-width: ' + (bpL + 1) + 'px) and (max-width: ' + bpXL + 'px)' ),\n\t\t// AA Fix to resolve button rendering issue\n\t\tmqXL = window.matchMedia( 'screen and (min-width: ' + (bpXL + 1) + 'px)' );\n\nimport {AppContext} from 'common/core/AppContext.js';\nexport class PageContainer {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-container';\n\t\tthis.properties = {\n\t\t\troute: String,\n\n\t\t\tallRoutes: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; },\n\t\t\t\tobserver: '_allRoutesChanged'\n\t\t\t},\n\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_buildViewport( xs, s, m, l, xl ) {\n\t\tlet v = {\n\t\t\tXS: {},\n\t\t\tS: {},\n\t\t\tM: {},\n\t\t\tL: {},\n\t\t\tXL: {},\n\t\t\tcurrent: function() {\n\t\t\t\tif(this.XS.only)\n\t\t\t\t\treturn {size: 'XS', window: [bpXS, bpS]};\n\t\t\t\tif(this.S.only)\n\t\t\t\t\treturn {size: 'S', window: [bpS + 1, bpM]};\n\t\t\t\tif(this.M.only)\n\t\t\t\t\treturn {size: 'M', window: [bpM + 1, bpL]};\n\t\t\t\tif(this.L.only)\n\t\t\t\t\treturn {size: 'L', window: [bpL + 1, bpXL]};\n\t\t\t\tif(this.XL.only)\n\t\t\t\t\treturn {size: 'XL', window: [bpXL, 10000]};\n\t\t\t},\n\t\t\tisMobile: function() {\n\t\t\t\treturn this.isPhone() || this.isTablet();\n\t\t\t},\n\t\t\tisPhone: function() {\n\t\t\t\treturn AppContext.isPhone;\n\t\t\t},\n\t\t\tisTablet: function() {\n\t\t\t\treturn AppContext.isTablet;\n\t\t\t},\n\t\t\tisDesktop: function() {\n\t\t\t\treturn AppContext.isDesktop;\n\t\t\t}\n\t\t};\n\n\t\tv.XS.only = xs && !s && !m && !l && !xl;\n\t\tv.XS.down = v.XS.only;\n\t\tv.XS.up = xs || s || m || l || xl;\n\n\t\tv.S.only = !xs && s && !m && !l && !xl;\n\t\tv.S.down = (xs || s) && !m && !l && !xl;\n\t\tv.S.up = !xs && (s || m || l || xl);\n\n\t\tv.M.only = !xs && !s && m && !l && !xl;\n\t\tv.M.down = (xs || s || m) && !l && !xl;\n\t\tv.M.up = !xs && !s && (m || l || xl);\n\n\t\tv.L.only = !xs && !s && !m && l && !xl;\n\t\tv.L.down = (xs || s || m || l) && !xl;\n\t\tv.L.up = !xs && !s && !m && (l || xl);\n\n\t\tv.XL.only = !xs && !s && !m && !l && xl;\n\t\tv.XL.down = true;\n\t\tv.XL.up = v.XL.only;\n\n\t\treturn v;\n\t}\n\n\tready() {\n\t\tthis._setupViewportListeners();\n\t}\n\n\trenderPage( e, detail, sender ) {\n\n\t\tif( detail.route.comp && detail.route.comp != '' ) {\n\t\t\tlet ctx = {};\n\t\t\tctx.params = detail.params;\n\t\t\tctx.pathParams = detail.pathParams;\n\n\t\t\t// dynamically add component\n\t\t\t// todo: unbind stuff?\n\t\t\tlet html = (function(detail, ctx) {\n\t\t\t\treturn '<' + detail.route.comp + ' ctx=\\'' + JSON.stringify(ctx) + '\\'></' + detail.route.comp + '>';\n\t\t\t}.bind(this))(detail, ctx);\n\t\t\tif( detail.route.mod ) {\n\t\t\t\tSystem.import( detail.route.mod ).then( function(m) {\n\t\t\t\t\tthis.$.content.innerHTML = html;\n\t\t\t\t\tthis._viewportChanged(); // update the Page's viewport\n\t\t\t\t\tPolymer.updateStyles();\n\t\t\t\t}.bind(this) ).catch( function(err){\n\t\t\t\t\tconsole.log( err );\n\t\t\t\t\tconsole.log( err.originalErr );\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.$.content.innerHTML = html;\n\t\t\t\tPolymer.updateStyles();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// load view HTML file - todo: cache\n\t\t\tthis.$.ajax.url = detail.route.view;\n\t\t\tif( this.$.ajax.url )\n\t\t\tthis.$.ajax.go();\n\t\t}\n\t}\n\n\t_allRoutesChanged( nv ) {\n\t\tthis.$.router.init( nv );\n\t}\n\n\t_viewportChanged() {\n\t\t// pass down the new value to the page instance and fire event for any other WC's that may be listening\n\t\tlet el = this.$.content.querySelector( '*:first-child' );\n\t\tif( el ) el.viewport = this.viewport;\n\n\t\t// some browsers (e.g. Firefox) need this setTimeout to break the event loop\n\t\tsetTimeout( function() {\n\t\t\tthis.fire( 'iron-signal', { name: 'sb-viewport-changed', data: { viewport: this.viewport } });\n\t\t}.bind(this), 10 );\n\t}\n\n\t// We listener for MQ stuff here and pass it down to page so we don't have to do this every time we create a new Page\n\t_setupViewportListeners() {\n\t\tvar self = this;\n\t\tfunction build(m) {\n\t\t\tif( m.matches )\n\t\t\t\tself.viewport = self._buildViewport( mqXS.matches, mqSOnly.matches, mqMOnly.matches, mqLOnly.matches, mqXL.matches );\n\t\t};\n\n\t\t// disable all viewport listeners for DreamForce\n\t\tmqXS.addListener( build );\n\t\tmqSOnly.addListener( build );\n\t\tmqMOnly.addListener( build );\n\t\tmqLOnly.addListener( build );\n\t\tmqXL.addListener( build );\n\t}\n\n\tstatic getContainer() {\n\t\treturn document.querySelector( '#' + PageContainer.domId );\n\t}\n\n\tstatic getViewport() {\n\t\tlet container = PageContainer.getContainer();\n\t\treturn container ? container.viewport : null;\n\t}\n}\n\n// the id used in the DOM for this element\nPageContainer.domId = 'sbPageContainer';\n\nPolymer( PageContainer );\n","let private_router,\n\t\troutes,\n\t\tPATH_PARAM_REGEX = /:[a-z0-9_$]*/g;\n\nexport class Router {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-router';\n\t\tthis.properties = {\n\t\t\tautoHash: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return false; }\n\t\t\t},\n\n\t\t\troute: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'routeChanged'\n\t\t\t},\n\n\t\t\trouter: {\n\t\t\t\ttype: Object,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif( !private_router ) {\n\t\t\t\t\t\tprivate_router = new window.Router();\n\t\t\t\t\t\tprivate_router.init();\n\t\t\t\t\t}\n\t\t\t\t\treturn private_router;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tinit( allRoutes ) {\n\t\tlet modules = Object.keys(allRoutes);\n\n\t\tif( !routes && modules.length ) {\n\t\t\troutes = allRoutes;\n\t\t\tlet router = this.router,\n\t\t\tlen = modules ? modules.length : 0;\n\n\t\t\t// attach a Director handler for all configured routes (module + path = route)\n\t\t\tfor( let i=0; i < len; i++ ) {\n\t\t\t\tlet mod = modules[i],\n\t\t\t\tmodulePaths = Object.keys( routes[mod] ),\n\t\t\t\tpLen = modulePaths ? modulePaths.length : 0;\n\n\t\t\t\tfor( let p=0; p < pLen; p++ ) {\n\t\t\t\t\tlet path = modulePaths[p],\n\t\t\t\t\tpathParams = path ? path.match( PATH_PARAM_REGEX ) : null,\n\t\t\t\t\tparamNames = [],\n\t\t\t\t\tparamMap = {};\n\n\t\t\t\t\t// if path params exist build map of name=value for easy access\n\t\t\t\t\tif( pathParams ) {\n\t\t\t\t\t\tparamNames = pathParams.map( function( val, index ) {\n\t\t\t\t\t\t\tlet p = val.substring(1);\n\t\t\t\t\t\t\tparamMap[p] = null;\n\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\trouter.on( mod + path, function( m, p, paramNames, paramMap ) {\n\t\t\t\t\t\tlet pathParams = JSON.parse(JSON.stringify( paramMap )),  // clone\n\t\t\t\t\t\tparams = Array.prototype.slice.call(arguments,4),\n\t\t\t\t\t\tparamsLen = params ? params.length : 0;\n\n\t\t\t\t\t\t// map path parameter name to actual value\n\t\t\t\t\t\tfor( let j=0; j < paramsLen; j++ )\n\t\t\t\t\t\tpathParams[paramNames[j]] = params[j];\n\n\t\t\t\t\t\tthis.routeHandler( m, p, pathParams );\n\t\t\t\t\t}.bind(this, mod, path, paramNames, paramMap));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trouter.on( '/*', function() {\n\t\t\t\tconsole.log( 'got an unknown route. need to show 404 here' ); // todo\n\t\t\t});\n\n\t\t\trouter.on( '', function() {\n\t\t\t\tconsole.log( 'Got the <empty> route' );\n\t\t\t})\n\t\t}\n\t}\n\n\t/* the Director route handler */\n\trouteHandler( mod, path, params ) {\n\t\t// Director doesn't support query string-like params in the hash.  We have to manually get them.\n\t\tlet hash = window.location.hash.slice(1),\n\t\tpos = hash.indexOf( '?' ),\n\t\tqsParams = {};\n\n\t\tif( pos >= 0 && hash.length > pos ) {\n\t\t\t// use 3rd party to parse\n\t\t\tqsParams = queryString.parse( hash.substring( pos+1 ) );\n\t\t}\n\t\tthis.fire( 'sb-route-complete', {mod: mod, path: path, route: routes[mod][path], pathParams: params, params: qsParams } );\n\t}\n\n\t/** Observer for when the route property changes.  Update the window hash and fire event if needed */\n\trouteChanged( nv, ov ) {\n\t\tif( this.autoHash && nv ) {\n\t\t\tlet same = window.location.hash.slice(1) == this.route;\n\t\t\twindow.location.hash = this.route;\n\n\t\t\t// if you set the hash to be same value as it currently has you don't get a hashchange event\n\t\t\tif( same ) {\n\t\t\t\t// window.dispatchEvent(new HashChangeEvent(\"hashchange\"));  doesn't work in FF so manually dispatch event\n\t\t\t\tthis.router.dispatch( 'on', nv );\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Router );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class PageHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-page-header';\n\t\tthis.properties = {\n\t\t\t/**\n\t\t\t * Viewport information for things like T-shirt size (S, M, L, XL)\n\t\t\t * @type {Object}\n\t\t\t */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowMenu: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\tmenuClosed : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() { return true; }\n\t\t\t},\n\t\t\thideFullTitle: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\t_showFullTitle(e) {\n\t\tif (!this.viewport.isMobile()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hideFullTitle && !Polymer.dom(this).children[1].textContent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideFullTitle = !this.hideFullTitle;\n\n\t\tthis.$.fullTitle.innerText     = this.hideFullTitle ? Polymer.dom(this).children[1].textContent : \"\";\n\t\tthis.$.fullTitle.style.opacity = this.hideFullTitle ? 1 : 0;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tnavigationChanged() {\n\t\tthis._closeMenu();\n\t}\n\n\t_closeMenu() {\n\t\tthis.toggleClass('open', false, this.$.buttons);\n\t\tthis.toggleClass('autoLaunch', false, this.$.buttons);\n\t\tsetTimeout(function () {\n\t\t\t// defer setting the menuClosed flag in case _changeMenu is called after _closeMenu in the same event loop\n\t\t\tthis.menuClosed = true;\n\t\t}.bind(this), 1);\n\t}\n\n\t_changeMenu(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.getAttribute('data-target');\n\t\tif(target === \"Popup\")\n\t\t\treturn; // the popup will handle closing the menu when it closes\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed , this.$.buttons, 'open', this);\n\t\tif (this.menuClosed)\n\t\t\tthis.fire('sb-menu-closed');\n\t}\n\n\t_viewportChanged() {\n\t\t// need an explicit boolean + CSS here so we don't have race condition with dom-if\n\t\tthis.showMenu = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tif( this.showMenu )\n\t\t\tthis.$.buttons.classList.remove( 'normal' );\n\t\telse\n\t\t\tthis.$.buttons.classList.add( 'normal' );\n\t}\n\n\t// Helper function that can be used with a menu dropdown button. It returns the flipped state of the menu button.\n\t// target element will be a dom element on which adding an openClass will show the menu and removing it will\n\t// close the menu\n\tstatic changeMenu(e, menuClosed, targetElement, openClass, toggler) {\n\t\t\tlet rect = e.currentTarget.getBoundingClientRect();\n\t\t\tlet\tbs = targetElement.style;\n\t\t\tbs.top = (rect.bottom+2) + 'px';\n\t\t\tbs.right = (window.innerWidth - rect.right) + 'px';\n\t\t\ttoggler.toggleClass(openClass, menuClosed, targetElement);\n\t\treturn !menuClosed;\n\t}\n\n\topenLookupDialog(e) {\n\t\tlet lookup = this.$.lookup;\n\t\tlookup.invoker = e.detail.lookup;\n\t\tlookup.open(e.detail.searchValue);\n\t}\n\n\topenRteDialog(e) {\n\t\tlet rte = this.$.rte;\n\t\trte.value = e.detail.value;\n\t\trte.rte = e.detail.rte;\n\t\trte.open();\n\t}\n\n\tallowAutoLaunchPopup() {\n\t\tif(this.showMenu) {\n\t\t\t// \"open\" the menu so the auto launched popup is visible\n\t\t\tthis.toggleClass('open', true, this.$.buttons);\n\t\t\tthis.toggleClass('autoLaunch', true, this.$.buttons);\n\t\t\tthis.menuClosed = false;\n\t\t}\n\t}\n}\n\nPolymer( PageHeader );\n","export class Toast {\n\n    get behaviors() {\n        return [window.CommonBehaviors.DeviceBehavior];\n    }\n\n    beforeRegister() {\n        this.is = 'sb-toast';\n        this.properties = {\n            /**\n             * The array of messages used to build the messagesModel which renders the toasts\n             * Can be an array of strings or it can be an array of objects with properties (msg and type)\n             * where msg is a string and type is success, error, warning or info (default if type is undefined)\n             */\n            messages: {       // Can be array of strings or objects with type and msg properties\n                type: Array,  // ['test', '123', 'abc']\n                notify: true  // [{type: error, msg: 'hello', type: warning, msg: 'test123', type: success, msg: 'great success'}]\n            },\n            /**\n             * Used to determine the styling if messages is an array of strings.\n             * Info styling is used if type is left undefined.\n             * This property is not used if messages is an array of objects.\n             * @type {String}\n             */\n            type: String // Optional -- error, success, warning, info(default if undefined)\n        }\n    }\n\n    ready() {\n        this.hasMessages = false;\n        this.messagesModel = [];\n        this.repeatHandlers = {};\n    }\n\n    get observers() {\n        return['validation(messages)'];\n    }\n\n    /**\n     * Populates messagesModel that contains information on how to render each type of toast\n     * Checks to see if first index of array is type String or Object, then it will group and style accordingly.\n     */\n    validation() {\n        if (!this.messages) {\n            this.messagesModel = [];\n            this.hasMessages = false;\n            this.repeatHandlers = {};\n            return\n        }\n\n        let errorMsgs = {type : 'error', class : 'slds-theme--error', msgs : [], icon : 'sf-icon-error'};\n        let successMsgs = {type : 'success', class : 'slds-theme--success', msgs : [], icon : 'sf-icon-success'};\n        let warningMsgs = {type : 'warning', class : 'slds-theme--warning', msgs : [], icon : 'sf-icon-warning'};\n        let infoMsgs = {type : 'info', class : '', msgs : [], icon : 'sf-icon-info'};\n        let numMessages = this.messages.length;\n        if (typeof(this.messages[0]) == 'object') {\n            for (let i = 0; i < numMessages; i++) {\n                let messagesSplit = this.messages[i].msg.split('\\n');\n                if (this.messages[i].type == 'error') {\n                    errorMsgs.msgs.push(messagesSplit);\n                } else if (this.messages[i].type == 'warning') {\n                    warningMsgs.msgs.push(messagesSplit);\n                } else if (this.messages[i].type == 'success') {\n                    successMsgs.msgs.push(messagesSplit);\n                } else {\n                    infoMsgs.msgs.push(messagesSplit);\n                }\n            }\n        } else if (typeof(this.messages[0]) == 'string') {\n            let messagesSplit = [];\n            for (let i = 0; i < numMessages; i++) {\n                messagesSplit.push(this.messages[i].split('\\n'));\n            }\n            if (this.type == 'error') {\n                errorMsgs.msgs = messagesSplit;\n            } else if (this.type == 'success') {\n                successMsgs.msgs = messagesSplit;\n            } else if (this.type == 'warning') {\n                warningMsgs.msgs = messagesSplit;\n            } else {\n                infoMsgs.msgs = messagesSplit;\n            }\n        }\n\n        if (this.messages && this.messages.length > 0) {\n            this.removeRepeatedMessages(errorMsgs, 'error');\n            if (errorMsgs.msgs.length > 0) {\n                this.push('messagesModel', errorMsgs);\n            }\n            this.removeRepeatedMessages(successMsgs, 'success');\n            if (successMsgs.msgs.length > 0) {\n                this.push('messagesModel', successMsgs);\n            }\n            this.removeRepeatedMessages(successMsgs, 'warning');\n            if (warningMsgs.msgs.length > 0) {\n                this.push('messagesModel', warningMsgs);\n            }\n            this.removeRepeatedMessages(infoMsgs, 'info');\n            if (infoMsgs.msgs.length > 0) {\n                this.push('messagesModel', infoMsgs);\n            }\n            this.hasMessages = true;\n        } else {\n            this.hasMessages = false;\n            this.messages = undefined;\n        }\n    }\n\n    removeRepeatedMessages(messages, type) {\n        if(!this.messagesModel)\n            return;\n\n        for(let i = 0, l = this.messagesModel.length; i < l; i++) {\n            let msg = this.messagesModel[i];\n            if(type !== msg.type)\n                continue;\n\n            let repeat = this.isMessageRepeated(msg, messages);\n            if(repeat) messages.msgs = [];\n            this.toggleRepeatClass(type, repeat, i);\n        }\n    }\n\n    isMessageRepeated(msg1, msg2) {\n        for(let i = 0, l = msg1.msgs.length; i < l; i++) {\n            for (let j = 0, ll = msg1.msgs[i].length; j < ll; j++) {\n                if (msg1.msgs[i][j] !== msg2.msgs[i][j])\n                    return false;\n            }\n        }\n        return true;\n    }\n\n    toggleRepeatClass(type, repeat, index) {\n        this.removeAnimationListeners(type, index);\n        let container = this.addAnimationListeners(type, index);\n        this.toggleClass('repeat', repeat, container);\n    }\n\n    removeAnimationListeners(type, index) {\n        let id = type + '_' + index;\n        let handler = this.repeatHandlers[id];\n        if(!handler)\n            return;\n\n        let container = this.$$('#' + id);\n        container.removeEventListener('animationend', handler);\n        container.removeEventListener('webkitAnimationEnd', handler);\n    }\n\n    addAnimationListeners(type, index) {\n        let id = type + '_' + index;\n        let container = this.$$('#' + id);\n        let handler = this.repeatHandlers[id] || this.removeRepeatClass.bind(this, container);\n        this.repeatHandlers[id] = handler;\n\n        container.addEventListener('animationend', handler);\n        container.addEventListener('webkitAnimationEnd', handler);\n        return container;\n    }\n\n    removeRepeatClass(container) {\n        this.toggleClass('repeat', false, container);\n    }\n\n    closeMessage(e) {\n        let type = e.model.__data__.messages.type;\n        let index = 0;\n        for (let i = 0; i < this.messagesModel.length; i++) {\n            if (this.messagesModel[i].type == type) {\n                delete this.repeatHandlers[type + '_' + (index++)];\n                this.splice('messagesModel', i, 1);\n                i--;\n            }\n        }\n        if (this.messagesModel.length == 0) {\n            this.hasMessages = false;\n            this.messages = undefined;\n        }\n    }\n}\n\nPolymer( Toast );","let map = {};\n\nexport class Cache {\n\n\tstatic add(name, id, object, type, emitter) {\n\t\tif(!name || !id || !object)\n\t\t\treturn;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\tmap[type] = {};\n\n\t\tif(!map[type][name]) {\n\t\t\tmap[type][name] = {};\n\t\t\tif (emitter && type == 'value' && name == 'LineEditor') {\n\t\t\t\tvar event = document.createEvent('Event');\n\t\t\t\tevent.initEvent(name + '-cached', true, true);\n\t\t\t\tdocument.dispatchEvent(event);\n\t\t\t}\n\t\t}\n\n\t\tmap[type][name][id] = object;\n\t}\n\n\tstatic get(name, id, type) {\n\t\tif(!name || !id)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn null;\n\n\t\tif(!map[type][name])\n\t\t\treturn null;\n\n\t\treturn map[type][name][id];\n\t}\n\n\tstatic remove(name, id, type) {\n\t\tif(!name || !id || !type)\n\t\t\treturn null;\n\n\t\tif(!type)\n\t\t\ttype = 'value';\n\n\t\tif(!map[type])\n\t\t\treturn;\n\t\tif(!map[type][name])\n\t\t\treturn;\n\n\t\tdelete map[type][name][id];\n\t}\n}","import {OAuth} from 'common/oauth/OAuth.js';\nimport {RemoteOAuth} from 'common/data/client/RemoteOAuth.js';\n\nexport class OAuthClient {\n\n\tconstructor(prefix) {\n\t\tthis.prefix = prefix;\n\t}\n\n\tgetConnection() {\n\t\tif(typeof Visualforce !== 'undefined') {\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tresolve(new RemoteOAuth(this.prefix).getConnection());\n\t\t\t}.bind(this));\n\t\t} else {\n\t\t\treturn new OAuth().getConnection();\n\t\t}\n\t}\n}","import {RemoteOAuth} from 'common/data/client/RemoteOAuth.js';\nimport {RemoteSession} from 'common/data/client/RemoteSession.js';\nimport {RestClient} from 'common/data/client/RestClient.js';\n\nexport class RemoteClient {\n\n\tconstructor() {\n\t\tthis.VF_MAX_INPUT = 1000000 * 1000; // DISABLE FOR NOW BY MAKING THIS HUGE.\n\t\tthis._restClient = new RestClient(this._getConnection());\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn this._remote('read', reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\tvar contextString = JSON.stringify(context);\n\t\tvar uidLen = uid ? uid.length : 0;\n\t\tif ((contextString.length + uidLen) < this.VF_MAX_INPUT) {\n\t\t\treturn this._remote('load', loader, uid, contextString);\n\t\t} else {\n\t\t\treturn this._restClient.load(prefix, loader, uid, context);\n\t\t}\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\tvar modelString = typeof model === 'string' ? model : JSON.stringify(model);\n\t\tif ((modelString.length + saver.length) < this.VF_MAX_INPUT) {\n\t\t\treturn this._remote('save', saver, modelString);\n\t\t} else {\n\t\t\treturn this._restClient.save(prefix, saver, model);\n\t\t}\n\t}\n\n\tmd(prefix, type, fullNames) {\n\t\treturn new RemoteOAuth(prefix).getConnection()\n\t\t\t.then((conn) => {\n\t\t\t\treturn conn.metadata.read(type, fullNames);\n\t\t\t});\n\t}\n\n\tdescribe(sObject){\n\t\treturn new RemoteSession( window.sb.vfSessionId ).getConnection().describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn new RemoteSession( window.sb.vfSessionId, version ).getConnection().query(soql);\n\t}\n\n\t_remote(method, provider, input, context) {\n\t\tvar action = this._getAction() + '.' + method;\n\t\tif(context)\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, context, function(obj, event) {\n\t\t\t\t\tthis._callback(obj, event, resolve, reject);\n\t\t\t   }.bind(this), {escape: false});\n\t\t\t}.bind(this));\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tVisualforce.remoting.Manager.invokeAction(action, provider, input, function(obj, event) {\n\t\t\t\tthis._callback(obj, event, resolve, reject);\n\t\t   }.bind(this), {escape: false});\n\t\t}.bind(this));\n\t}\n\n\t_getConnection() {\n\t\tif (!this.connection) {\n\t\t\tthis.connection = new RemoteSession(window.sb.vfSessionId).getConnection();\n\t\t}\n\t\treturn this.connection;\n\t}\n\n\t_getAction() {\n\t\treturn this._getPrefix() + 'ServiceRouter';\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? (this.prefix + '.') : '';\n\t}\n\n\t_callback(obj, event, resolve, reject) {\n\t\tif(!event.status)\n\t\t\treject(event.message);\n\t\telse\n\t\t\tresolve(this._parse(obj));\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n}","export class RemoteOAuth {\n\n    constructor(prefix) {\n        this.refreshTokenRemoteAction = 'OAuthExtension.refreshAccessToken';\n        this.getTokenRemoteAction = 'OAuthExtension.getAccessToken';\n        if (prefix) {\n            this.refreshTokenRemoteAction = prefix + '.' + this.refreshTokenRemoteAction;\n            this.getTokenRemoteAction = prefix + '.' + this.getTokenRemoteAction;\n        }\n\n        jsforce.OAuth2.prototype.refreshToken = function (refreshToken, callback) {\n            Visualforce.remoting.Manager.invokeAction(this.refreshTokenRemoteAction, function (accessToken, event) {\n                this.cacheToken(accessToken);\n                callback((!accessToken ? {message: event.message} : false), {access_token: accessToken, id: ''});\n            }.bind(this));\n        }.bind(this);\n    }\n\n    getConnection() {\n\t    return this.accessToken\n\t\t    .then((token) => {\n\t\t\t    return new jsforce.Connection({\n\t\t\t\t    oauth2 : new jsforce.OAuth2({clientId : true, clientSecret: true}),\n\t\t\t\t    accessToken : token,\n\t\t\t\t    refreshToken: '',\n\t\t\t\t    instanceUrl: sb.common.core.AppContext.org.orgUrl\n\t\t\t    });\n\t\t    });\n    }\n\n    getCachedToken() {\n        if(typeof sessionStorage === 'undefined')\n            return '';\n\n        return sessionStorage.getItem(this.refreshTokenRemoteAction);\n    }\n\n    cacheToken(accessToken) {\n        if(typeof sessionStorage === 'undefined')\n            return;\n\n        sessionStorage.setItem(this.refreshTokenRemoteAction, accessToken);\n    }\n\n    get accessToken() {\n        let accessToken = this.getCachedToken();\n        var self = this;\n        if (accessToken) {\n            return Promise.resolve(accessToken);\n        } else {\n            return new Promise(function(resolve, reject) {\n                Visualforce.remoting.Manager.invokeAction(self.getTokenRemoteAction, function(accessToken, event) {\n                    if (accessToken) {\n                        self.cacheToken(accessToken);\n                        resolve(accessToken);\n                    } else {\n                        reject(event ? event.message : 'Could not get access token');\n                    }\n                });\n            });\n        }\n    }\n    \n    getAccessTokenBypassingCache() {\n        var self = this;\n        return new Promise(function(resolve, reject) {\n            Visualforce.remoting.Manager.invokeAction(self.getTokenRemoteAction, function(accessToken, event) {\n                if (accessToken) {\n                    resolve(accessToken);\n                } else {\n                    reject(event ? event.message : 'Could not get access token');\n                }\n            });\n        });\n    }\n}","export class RemoteSession {\n\n\tconstructor(sessionId, version) {\n\t\tthis.sessionId = sessionId;\n\t\tthis.version = version || '36.0';\n\t}\n\n\tgetConnection() {\n\t\treturn new jsforce.Connection({\n\t\t\tsessionId: this.sessionId,\n\t\t\tversion: this.version,\n\t\t\tinstanceUrl: sb.common.core.AppContext.org.orgUrl\n\t\t});\n\t}\n}","import {OAuth} from 'common/oauth/OAuth.js';\n\nexport class RestClient {\n\n\tconstructor(conn) {\n\t\tif (conn) {\n\t\t\tthis.connection = conn;\n\t\t}\n\t}\n\n\tread(prefix, reader, uid) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.get(this._getEndpoint() + '?reader=' + reader + '&uid=' + uid).then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t   });\n\t\t}.bind(this));\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.patch(this._getEndpoint() + '?loader=' + loader + '&uid=' + uid, {\n\t\t\t\t\t\tcontext: JSON.stringify(context)\n\t\t\t\t\t}).then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t   });\n\t\t}.bind(this));\n\t}\n\n\tsave(prefix, saver, model) {\n\t\tthis.prefix = prefix;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.post(this._getEndpoint(), {\n\t\t\t\t\tsaver: saver,\n\t\t\t\t\tmodel: (typeof model === 'string' ? model : JSON.stringify(model))\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t   reject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tmd(prefix, type, fullNames) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.post(null, {\n\t\t\t\t\tsaver: 'md.read',\n\t\t\t\t\tmodel: JSON.stringify({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\tfullNames: fullNames\n\t\t\t\t\t})\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tdescribe(sObject) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.post(null, {\n\t\t\t\t\tsaver: 'object.describe',\n\t\t\t\t\tmodel: JSON.stringify({\n\t\t\t\t\t\tname: sObject\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tquery(soql) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tthis._getApex().then(function(apex) {\n\t\t\t\tapex.post(null, {\n\t\t\t\t\tsaver: 'query',\n\t\t\t\t\tmodel: JSON.stringify({\n\t\t\t\t\t\tsoql: soql\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.then(function(result) {\n\t\t\t\t\tthis._handleResult(resolve, reject, result);\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\treject(err.message || err);\n\t\t\t\t});\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tsetConnection(conn) {\n\t\tthis.connection = conn;\n\t}\n\n\t_getApex() {\n\t\tif(this.connection)\n\t\t\treturn Promise.resolve(this.connection.apex);\n\n\t\tif(typeof window === 'undefined')\n\t\t\treturn Promise.reject('Connection not set');\n\n\t\tthis.oauth = this.oauth || new OAuth();\n\t\treturn this._getConnection(this.oauth);\n\t}\n\n\t_getConnection(oauth) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\toauth.getConnection().then(function(conn) {\n\t\t\t\tthis.connection = conn;\n\t\t\t\tresolve(this.connection.apex);\n\t\t\t}.bind(this), function(err) {\n\t\t\t\treject(err.message || err);\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\t_getEndpoint() {\n\t\treturn this._getPrefix() + '/ServiceRouter';\n\t}\n\n\t_getPrefix() {\n\t\treturn this.prefix ? ('/' + this.prefix) : '';\n\t}\n\n\t_handleResult(resolve, reject, result) {\n\t\tif(result.proxy) {\n\t\t\tthis._handleProxyResult(resolve, reject, result.proxy);\n\t\t\treturn;\n\t\t}\n\t\tresolve(this._parse(result));\n\t}\n\n\t_handleProxyResult(resolve, reject, proxyResult) {\n\t\tif(proxyResult.error) {\n\t\t\tthis._handleProxyErrorResult(reject, proxyResult.error);\n\t\t\treturn;\n\t\t}\n\t\tif(this.oauth && proxyResult.accessToken)\n\t\t\tthis.oauth.accessToken = proxyResult.accessToken;\n\n\t\tresolve(this._parse(proxyResult.response));\n\t}\n\n\t_handleProxyErrorResult(reject, error) {\n\t\tconsole.warn('Service Proxy Exception: ' + this._adjustProxyErrorMessage(error));\n\t\treject(error);\n\t}\n\n\t_adjustProxyErrorMessage(errorMessage) {\n\t\tif(errorMessage === 'expired access/refresh token')\n\t\t\terrorMessage += ' - to authorize go to http://localhost:' + location.port + '/common/oauth';\n\n\t\treturn errorMessage;\n\t}\n\n\t_parse(obj) {\n\t\ttry {\n\t\t\treturn JSON.parse(obj);\n\t\t} catch(e) {\n\t\t\treturn obj;\n\t\t}\n\t}\n}","import {RemoteClient} from 'common/data/client/RemoteClient.js';\nimport {RestClient} from 'common/data/client/RestClient.js';\n\nexport class ServiceClient {\n\n\tconstructor() {\n\t\tthis.client = typeof Visualforce !== 'undefined' ? new RemoteClient() : new RestClient();\n\t}\n\n\tread(prefix, reader, uid) {\n\t\treturn this.client.read(prefix, reader, uid);\n\t}\n\n\tload(prefix, loader, uid, context) {\n\t\treturn this.client.load(prefix, loader, uid, context);\n\t}\n\n\tsave(prefix, saver, model) {\n\t\treturn this.client.save(prefix, saver, model);\n\t}\n\n\tmd(prefix, type, fullNames) {\n\t\treturn this.client.md(prefix, type, fullNames);\n\t}\n\n\tdescribe(prefix, sObject) {\n\t\treturn this.client.describe(sObject);\n\t}\n\n\tquery(soql, version) {\n\t\treturn this.client.query(soql, version);\n\t}\n\n\tsetConnection(conn) {\n\t\tif(typeof this.client.setConnection === 'function')\n\t\t\tthis.client.setConnection(conn);\n\t}\n}","import {JsonFormatter} from 'common/data/format/JsonFormatter.js';\n\nexport class DataBuilder {\n\n\tconstructor(pretty) {\n\t\tthis.pretty = pretty;\n\t\tthis.data = {};\n\t}\n\n\taddQuote(key, quote, omitRelationships) {\n\t\treturn this.addObject(key, quote, true, omitRelationships);\n\t}\n\n\taddObject(key, obj, omitNull, omitRelationships) {\n\t\tthis.data[key] = obj != null ? new JsonFormatter(omitNull, omitRelationships, this.pretty).format(obj) : obj;\n\t\treturn this;\n\t}\n\n\t//currently unused as the parameters have been checked before reaching the DataBuilder\n\taddInt(key, int) {\n\t\ttry {\n\t\t\tint = parseInt(int);\n\t\t\tif(!isNaN(int))\n\t\t\t\tthis.data[key] = int;\n\t\t\treturn this;\n\t\t} catch (e) {\n\t\t\t// just in case parseInt throws exception in other browsers\n\t\t\treturn this;\n\t\t}\n\t}\n\n\tadd(key, val) {\n\t\tthis.data[key] = val;\n\t\treturn this;\n\t}\n\n\tbuild() {\n\t\treturn this.data;\n\t}\n}","export class ErrorFormatter {\n\n\tconstructor(message) { //takes string or array\n\t\tthis.message = typeof message === 'string' ? message : message[0];\n\t}\n\n\ttruncate() {\n\t\tlet topLine = this.message.split('\\n')[0].split(':');\n\t\tif (topLine.length > 1)\n\t\t\tif (topLine[0].startsWith('System'))\n\t\t\t\treturn [topLine.splice(1, topLine.length - 1).join(':')];\n\t\t\telse\n\t\t\t\treturn [topLine.join(':')];\n\t\telse\n\t\t\treturn topLine;\n\t}\n}","export class JsonFormatter {\n\n\tconstructor(omitNull, omitRelationships, pretty) {\n\t\tthis.omitNull = omitNull;\n\t\tthis.omitRelationships = omitRelationships;\n\t\tthis.pretty = pretty;\n\t}\n\n\tformat(obj) {\n\t\tif(obj === undefined)\n\t\t\treturn;\n\n\t\tif(obj === null)\n\t\t\treturn JSON.stringify(obj);\n\n\t\tlet pretty = this.pretty;\n\t\tif (typeof pretty !== 'number')\n\t\t\tpretty = pretty ? 2 : null;\n\n\t\treturn JSON.stringify(obj, this._replacer.bind(this), pretty);\n\t}\n\n\t_replacer(key, value) {\n\t\tif (value === undefined || key === '_transient_')\n\t\t\treturn;\n\n\t\tif (this.omitNull && value === null)\n\t\t\treturn;\n\n\t\t// if key is an number and not a string then key.endsWith is undefined so lets check its defined before we dereference it\n\t\t// without this check the underlying error affected apply immediately product rule execution for Nimble in Safari\n\t\tif(this.omitRelationships && key.endsWith && key.endsWith('__r'))\n\t\t\treturn;\n\n\t\tif(value === '#Error!')\n\t\t\treturn !this.omitNull ? null : undefined;\n\n\t\treturn value;\n\t}\n}","export class Describe {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-describe';\n\t\tthis.properties = {\n\t\t\tobjects: Array, // An array of objectNames for describing objects\n\t\t\tfields: Array, // An array of objectName.fieldName for describing fields\n\t\t\tcache: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'describe'\n\t\t\t},\n\t\t\tdescribe: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'describeObjects(objects)',\n\t\t\t'describeFields(fields)'\n\t\t];\n\t}\n\n\tdescribeObjects() {\n\t\tlet ordered = [];\n\t\tthis.objects.forEach(function (obj) {\n\t\t\tordered.push(obj);\n\t\t});\n\t\tthis._describe(this.objects).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet response = {objects: ordered};\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tmd[obj.name] = obj;\n\t\t\t}\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\tdescribeFields() {\n\t\tlet ordered = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tordered.push(field);\n\t\t});\n\t\tlet objectFields = {};\n\t\tfor (let i = 0, l = this.fields.length; i < l; i++) {\n\t\t\tlet parts = this.fields[i].split('.'), obj = parts[0], field = parts[1];\n\t\t\tobjectFields[obj] = objectFields[obj] || {};\n\t\t\tobjectFields[obj][field] = true;\n\t\t}\n\n\t\tthis._describe(Object.keys(objectFields)).then(function (objects) {\n\t\t\tlet md = null;\n\t\t\tlet allFields = {};\n\t\t\tlet response = {fields: ordered};\n\t\t\tlet controlledFields = [];\n\t\t\tfor (let i = 0, l = objects.length; i < l; i++) {\n\t\t\t\tlet obj = objects[i];\n\t\t\t\tif (!obj)\n\t\t\t\t\tcontinue;\n\t\t\t\tmd = md || {};\n\t\t\t\tlet mdFields = objectFields[obj.name];\n\t\t\t\tfor (let i = 0, l = obj.fields.length; i < l; i++) {\n\t\t\t\t\tallFields[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\tif (mdFields[obj.fields[i].name]) {\n\t\t\t\t\t\tmd[obj.name + '.' + obj.fields[i].name] = obj.fields[i];\n\t\t\t\t\t\tobj.fields[i].tableName = obj.name; // add a reference to the field's table\n\t\t\t\t\t\tif (obj.fields[i].controllerName != null) {\n\t\t\t\t\t\t\tcontrolledFields.push(obj.fields[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Loop through all controlled pick-list fields (children) on the requested set of fields\n\t\t\t// and find each child's corresponding controlling pick-list field (parent) and associate the two together\n\t\t\t// also add each controlling pick-list field (parent) to the response md object even if not part of the requested set of fields\n\t\t\tcontrolledFields.forEach((controlledField) => {\n\t\t\t\tlet controllingFieldName = controlledField.tableName + '.' + controlledField.controllerName;\n\t\t\t\tcontrolledField.controllingField = allFields[controllingFieldName];\n\t\t\t\tcontrolledField.controllingField.controllingPicklist = true;\n\t\t\t\tmd[controllingFieldName] = controlledField.controllingField;\n\t\t\t});\n\n\t\t\tif (md) {\n\t\t\t\tresponse.md = md;\n\t\t\t\tthis.describe = response;\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tthis.error = err || err.message;\n\t\t}.bind(this));\n\t}\n\n\t_describe(objects) {\n\t\tthis.waiting = true;\n\t\tlet promises = [];\n\t\tfor (let i = 0, l = objects.length; i < l; i++)\n\t\t\tpromises.push(this.$.service.describe({sObject: objects[i]}));\n\n\t\treturn Promise.all(promises);\n\t}\n}\n\nPolymer(Describe);","import {AppContext} from 'common/core/AppContext.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {Cache} from 'common/data/cache/Cache.js';\n\nexport class Service {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-service';\n\t\tthis.properties = {\n\t\t\treader: String,\n\t\t\tloader: String,\n\t\t\tsaver: String,\n\t\t\tuid: String, // used for reader, loader, and saver\n\t\t\tmodel: Object, // user for saver\n\t\t\tcontext: Object, // used for loader\n\t\t\tmdType: String, // type of metadata to read (see https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_types_list.htm)\n\t\t\tmdItems: Array, // items of metadata to read\n\t\t\tsObject: String, // name of an sObject to be described\n\t\t\tsoql: String, // soql statement to be queried\n\t\t\tcache: String, // the named cache used manage the server retrieve response\n\t\t\twaiting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclient: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn new ServiceClient();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttransient: {\n\t\t\t\ttype: Boolean\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean, //Setting this to true will force a read from the service and not use the cache\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\twaitId: String, // identifies a service request that other service requests can wait for before executing\n\t\t\twaitFor: String, // waits for pending service request with a matching wait id to resolve before processing the request,\n\t\t\tversion: String // currently only supported for the query API for RemoteClient\n\t\t};\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'response-changed': '_cache'\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_read(reader, uid, prefix)',\n\t\t\t'_save(saver, model, prefix)',\n\t\t\t'_load(loader, uid, context, prefix)',\n\t\t\t'_md(mdType, mdItems, prefix)',\n\t\t\t'_describe(sObject, prefix)',\n\t\t\t'_query(soql)',\n\t\t\t'_spinner(waiting, background)'];\n\t}\n\n\tread(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.read(this.prefix, this.reader, this.uid));\n\t}\n\n\tload(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.load(this.prefix, this.loader, this.uid, this.context));\n\t}\n\n\tsave(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tif (this.transient)\n\t\t\treturn this._response(Promise.resolve(this.model));\n\n\t\treturn this._response(this.client.save(this.prefix, this.saver, this.model));\n\t}\n\n\tmd(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\tvar promiseArray = [];\n\t\t// only supports 10 mdItems per request, so slice mdItems into chunks of 10\n\t\tfor (var i = 0, n = Math.ceil(this.mdItems.length / 10); i < n; i++)\n\t\t\tpromiseArray.push(this.client.md(this.prefix, this.mdType, this.mdItems.slice(i * 10, (i + 1) * 10)));\n\n\t\treturn this._responseAll(promiseArray);\n\t}\n\n\tdescribe(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse(this.sObject, this._describeResponse);\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._describeResponse(this.client.describe(this.prefix, this.sObject));\n\t}\n\n\t_describeResponse(promise) {\n\t\treturn this._response(new Promise(function (resolve, reject) {\n\t\t\tCache.add(this.cache, this.sObject, promise, 'promise');\n\t\t\tpromise.then(function (res) {\n\t\t\t\tthis.uid = res ? res.name : null;\n\t\t\t\tCache.remove(this.cache, this.sObject, 'promise');\n\t\t\t\tresolve(res);\n\t\t\t}.bind(this), function (err) {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t}.bind(this)));\n\t}\n\n\tquery(request) {\n\t\tPolymer.Base.extend(this, request);\n\t\tvar promise = this._returnPromiseIfCachedResponse();\n\t\tif (promise)\n\t\t\treturn promise;\n\n\t\treturn this._response(this.client.query(this.soql, this.version));\n\t}\n\n\t_read() {\n\t\tif(this._shouldWait(this._read.bind(this)))\n\t\t\treturn;\n\n\t\tthis.read().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_load() {\n\t\tif(this._shouldWait(this._load.bind(this)))\n\t\t\treturn;\n\n\t\tthis.load().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_save() {\n\t\tif(this._shouldWait(this._save.bind(this)))\n\t\t\treturn;\n\n\t\tthis.save().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_md() {\n\t\tif(this._shouldWait(this._md.bind(this)))\n\t\t\treturn;\n\n\t\tthis.md().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_describe() {\n\t\tif(this._shouldWait(this._describe.bind(this)))\n\t\t\treturn;\n\n\t\tthis.describe().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_query() {\n\t\tif(this._shouldWait(this._query.bind(this)))\n\t\t\treturn;\n\n\t\tthis.query().then(function () {\n\t\t}, function (err) {\n\t\t\tconsole.error(err.message || err)\n\t\t});\n\t}\n\n\t_spinner() {\n\t\tthis.spinner = this.waiting && !this.background;\n\t}\n\n\t_shouldWait(request) {\n\t\tif(!this.waitFor)\n\t\t\treturn false;\n\n\t\tlet waitForPromise = Cache.get('__wait__', this.waitFor, 'promise');\n\t\tif(!waitForPromise)\n\t\t\treturn false;\n\n\t\tlet waiting = Cache.get('__wait__', this.waitFor, 'waiting') || [];\n\t\twaiting.push(request);\n\t\tCache.add('__wait__', this.waitFor, waiting, 'waiting');\n\n\t\tthis.waiting = !this.background; // in case the thing you are waiting for is a background request\n\t\treturn true;\n\t}\n\n\t_returnPromiseIfCachedResponse(uid, response) {\n\t\tif(this.ignoreCache === true)\n\t\t\treturn false;\n\t\tuid = uid || this.uid;\n\t\tresponse = response ? response.bind(this) : this._response.bind(this);\n\n\t\tvar cachedResponse = Cache.get(this.cache, uid);\n\t\tif (cachedResponse)\n\t\t\treturn response(Promise.resolve(cachedResponse));\n\n\t\tvar cachedPromise = Cache.get(this.cache, uid, 'promise');\n\t\tif (cachedPromise)\n\t\t\treturn response(cachedPromise);\n\n\t\tif (this.transient)\n\t\t\treturn response(Promise.resolve(this.response));\n\n\t\treturn null;\n\t}\n\n\t_response(promise) {\n\t\tthis.waiting = true;\n\t\tvar newPromise = new Promise(function (resolve, reject) {\n\t\t\tpromise.then(function (res) {\n\t\t\t\tthis.waiting = false;\n\t\t\t\tif (res)\n\t\t\t\t\tthis.response = res;\n\t\t\t\tCache.remove(this.cache, this.uid, 'promise');\n\t\t\t\tresolve(this.response);\n\t\t\t\tService.executeWaiting(this.waitId);\n\t\t\t}.bind(this), function (err) {\n\t\t\t\tthis.waiting = false;\n\t\t\t\tif (err)\n\t\t\t\t\tthis.error = this._createError(err);\n\t\t\t\tCache.remove(this.cache, this.uid, 'promise');\n\t\t\t\treject(this.error);\n\t\t\t\tService.executeWaiting(this.waitId);\n\t\t\t}.bind(this))\n\t\t}.bind(this));\n\t\tCache.add(this.cache, this.uid, newPromise, 'promise');\n\t\tService.addWaitFor(this.waitId, newPromise);\n\t\treturn newPromise;\n\t}\n\n\t_responseAll(promises) {\n\t\tthis.waiting = true;\n\t\tvar newPromise = Promise.all(promises).then(function (res) {\n\t\t\tfor (var i = 0, l = res.length; i < l; i++) {\n\t\t\t\tif (res[i].constructor !== Array)\n\t\t\t\t\tres[i] = [res[i]];\n\t\t\t}\n\t\t\tthis.waiting = false;\n\t\t\tthis.response = [].concat.apply([], res);\n\t\t\tCache.remove(this.cache, this.uid, 'promise');\n\t\t\tlet promise = Promise.resolve(this.response);\n\t\t\tService.executeWaiting(this.waitId);\n\t\t\treturn promise;\n\t\t}.bind(this), function (err) {\n\t\t\tthis.waiting = false;\n\t\t\tif (err)\n\t\t\t\tthis.error = this._createError(err);\n\t\t\tCache.remove(this.cache, this.uid, 'promise');\n\t\t\tlet promise = Promise.reject(this.error);\n\t\t\tService.executeWaiting(this.waitId);\n\t\t\treturn promise;\n\t\t}.bind(this));\n\t\tCache.add(this.cache, this.uid, newPromise, 'promise');\n\t\tService.addWaitFor(this.waitId, newPromise);\n\t\treturn newPromise;\n\t}\n\n\t_cache() {\n\t\tCache.add(this.cache, this.uid, this.response, 'value', this);\n\t}\n\n\t_createError(err) {\n\t\tvar msg = err.message || err;\n\t\tvar error = {message: msg};\n\n\t\tvar validations;\n\t\tif (msg.indexOf('ValidationException: [') != -1 || msg.startsWith('[')) {\n\t\t\tvar start = msg.indexOf('[');\n\t\t\tvar end = msg.indexOf(']', start) + 1;\n\t\t\tif (end > start)\n\t\t\t\tvalidations = msg.substring(start, end);\n\t\t}\n\n\t\tif (validations) {\n\t\t\ttry {\n\t\t\t\tvar escapedValidations = validations.replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\\\\r\");\n\t\t\t\tvar validationsArray = JSON.parse(escapedValidations);\n\t\t\t\terror.validations = validationsArray;\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n\n\t\treturn error;\n\t}\n\n\tstatic addWaitFor(waitId, promise) {\n\t\tCache.add('__wait__', waitId, promise, 'promise');\n\t}\n\n\tstatic executeWaiting(waitId) {\n\t\tCache.remove('__wait__', waitId, 'promise');\n\n\t\tlet waiting = Cache.get('__wait__', waitId, 'waiting');\n\t\tif (!waiting)\n\t\t\treturn;\n\n\t\tCache.remove('__wait__', waitId, 'waiting');\n\t\tfor (let w of waiting)\n\t\t\tw();\n\t}\n}\n\nPolymer(Service);","import {Util} from 'common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Searcher {\n\tconstructor(model) {\n\t\tthis.model = model;\n\t\tthis.searchFilterData = {};\n\t}\n\n\tbuildFields(fields) {\n\t\treturn fields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.model.targetObjectName;\n\t}\n\n\tgetGroupKey(filter) {\n\t\tif (this.model.hasCustomSearchFilters)\n\t\t\treturn filter.record.Id;\n\t\telse\n\t\t\treturn filter.targetFieldName;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tif (this.model.hasCustomSearchFilters) {\n\t\t\tfor (let id of group) {\n\t\t\t\tfor (let filter of this.model.searchFilters) {\n\t\t\t\t\tif (filter.record.Id === id) {\n\t\t\t\t\t\tif(searchFilterModel && this.isLookupType(searchFilterModel[id].model.type))\n\t\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(filter.stringValue, searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\t\tsearchFilterData[id] = {\n\t\t\t\t\t\t\tvalue: this.searchFilterData[id] === undefined ? (filter.stringValue ? filter.stringValue : '') : this.searchFilterData[id].value,\n\t\t\t\t\t\t\tfield: this.searchFilterData[id] === undefined ? (filter.targetFieldName ? filter.targetFieldName : '') : this.searchFilterData[id].field\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let filter of group) {\n\t\t\t\tsearchFilterData[filter] = {value: this.searchFilterData[filter] === undefined ? searchFilterModel[filter].stringValue : this.searchFilterData[filter].value};\n\t\t\t\tif(this.searchFilterData[filter] && this.searchFilterData[filter].label)\n\t\t\t\t\tsearchFilterData[filter].label = this.searchFilterData[filter].label;\n\t\t\t}\n\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = this.handleDynamicSearchFilters(searchFilterData);\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = this.handleDynamicSearchFilters(searchFilterData);\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleDynamicSearchFilters(searchFilterData) {\n\t\tif (!this.dynamicSearchFilters)\n\t\t\treturn searchFilterData;\n\t\telse {\n\t\t\tfor (let filter of this.dynamicSearchFilters) {\n\t\t\t\tif (filter.type === 'Optional Filter' && searchFilterData[filter.targetFieldName])\n\t\t\t\t\tsearchFilterData[filter.targetFieldName].value = filter.stringValue;\n\t\t\t}\n\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\tgetFilterContext() {\n\t\tlet searchFilterData = {};\n\t\tif (this.model.hasCustomSearchFilters) {\n\t\t\tfor (let value in this.searchFilterData) {\n\t\t\t\tfor (let filter of this.model.searchFilters) {\n\t\t\t\t\tif (value === filter.record.Id && this.searchFilterData[value]) {\n\t\t\t\t\t\t//some search filters evaluate equals instead of contains so need to avoid searching against only empty value\n\t\t\t\t\t\tif (this.searchFilterData[value].value === '')\n\t\t\t\t\t\t\tsearchFilterData[filter.targetFieldName] = null;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tsearchFilterData[filter.targetFieldName] = this.searchFilterData[value].value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn searchFilterData;\n\t\t} else\n\t\t\tfor (let value in this.searchFilterData) {\n\t\t\t\t//some search filters evaluate equals instead of contains so need to avoid searching against only empty value\n\t\t\t\tif (this.searchFilterData[value].value === '')\n\t\t\t\t\tsearchFilterData[value] = null;\n\t\t\t\telse\n\t\t\t\t\tsearchFilterData[value] = this.searchFilterData[value].value;\n\t\t\t}\n\t\treturn searchFilterData;\n\t}\n\n\tgetAdditionalProperties() {\n\t\t//build object for DynamicOptionsLoader service\n\t\tif (this.dynamicSearchFilters) {\n\t\t\tlet filters = [];\n\t\t\tfor (let i = 0, numFilters = this.dynamicSearchFilters.length; i < numFilters; i++)\n\t\t\t\tif (this.dynamicSearchFilters[i].type === 'Default Filter')\n\t\t\t\t\tfilters.push(JSON.stringify(this.dynamicSearchFilters[i]));\n\t\t\treturn filters;\n\t\t}\n\t}\n\n\tclearFields() {\n\t\tlet searchFilterData = {};\n\t\tfor (let filter in this.searchFilterData) {\n\t\t\t// clone the previous object as we want to maintain all previous search filter data properties (i.e. field) and simply clear the value property\n\t\t\tsearchFilterData[filter] = JSON.parse(JSON.stringify(this.searchFilterData[filter]));\n\t\t\tsearchFilterData[filter].value = '';\n\t\t}\n\t\treturn this.searchFilterData = searchFilterData;\n\t}\n\n\trunOnLoad(filterValues) {\n\t\tthis.searchFilterData = filterValues;\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n}","const NOT_GROUPED_NAME = 'Other';\n\nexport class RecordGrouper {\n\n\t/**\n\t * @param groupField the name of the field on the item's record used to group the items by\n\t * @param groupedRecordFields the name (or names) of the field(s) to assign the group value for the dummy item's grouper object (optional)\n\t * @param recordPath if the items to be grouped contain the record, then this is the path from the item to the record (optional)\n\t * @param itemProperties map of item properties to be added to all items when being grouped (optional)\n\t * @param itemPropertiesByGroup map of item properties by group to be added to matching items when being grouped (optional)\n\t * @param groupProperties map of group properties to be added to dummy item group object (optional)\n\t * @param groupCountPath if non nil contains the path in the dummy item group object where the grouped count should be stored (optional)\n\t */\n\tconstructor(groupField, groupedRecordFields, recordPath, itemProperties, itemPropertiesByGroup, groupProperties, groupCountPath, groupFieldType, groupFieldTypePath) {\n\t\tthis.groupField = groupField;\n\t\tif(groupedRecordFields)\n\t\t\tthis.groupedRecordFields = groupedRecordFields.constructor !== Array ? [groupedRecordFields] : groupedRecordFields;\n\t\tthis.recordPath = recordPath;\n\t\tthis.itemProperties = itemProperties;\n\t\tthis.itemPropertiesByGroup = itemPropertiesByGroup;\n\t\tthis.groupProperties = groupProperties;\n\t\tthis.groupCountPath = groupCountPath;\n\t\tthis.groupFieldType = groupFieldType;\n\t\tthis.groupFieldTypePath = groupFieldTypePath;\n\t}\n\n\t/**\n\t * Returns the provided items ordered by groups with an optional item object before each set of grouped items that contains the group details.\n\t *\n\t * @param items the list of objects that needs to be grouped assuming each item is, or contains, the record that contains the group value\n\t */\n\tgroup(items) {\n\t\tlet orderdGroups = [];\n\t\tlet itemsByGroup = {};\n\n\t\t// initialize ordered groups array and group map\n\t\tfor(let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i];\n\n\t\t\t// get the record within the item via its record path, if recordPath is nil then the item is the record\n\t\t\tlet record = this._get(item, this.recordPath);\n\n\t\t\t// determine the group name based on the record's value by that key\n\t\t\tlet group = record[this.groupField];\n\n\t\t\t// treat the record as not grouped if the group value is nil\n\t\t\tlet notGrouped = group === undefined || group === null || group === '';\n\n\t\t\t// ensure the group is a valid string even if not grouped\n\t\t\tgroup = notGrouped ? NOT_GROUPED_NAME : (group + '');\n\n\t\t\t// grab the existing items already organized by the current group\n\t\t\tlet groupedItems = itemsByGroup[group];\n\n\t\t\t// add the group to the groups list the first time the group is encountered\n\t\t\tif(!groupedItems && !notGrouped)\n\t\t\t\torderdGroups.push(group);\n\n\t\t\t// ensure we have a defined groupItems array in case first item in this group\n\t\t\tgroupedItems = groupedItems || [];\n\n\t\t\t// this item is now a groupie to this group, so lets indicate as much\n\t\t\titem.groupie = group;\n\t\t\titem.grouper = null;\n\t\t\tgroupedItems.push(item);\n\t\t\titemsByGroup[group] = groupedItems;\n\n\t\t\tthis._setProperties(item, this.itemProperties);\n\t\t\tthis._setProperties(item, this.itemPropertiesByGroup, group);\n\t\t}\n\n\t\t// if group map contains the non grouped name, then add the non grouped name at the end of the ordered list\n\t\tif(itemsByGroup[NOT_GROUPED_NAME])\n\t\t\torderdGroups.push(NOT_GROUPED_NAME);\n\n\t\treturn this._sortItemsByGroup(orderdGroups, itemsByGroup);\n\t}\n\n\t/**\n\t * Returns an ordered array of items by group with an optional grouper item before each group.\n\t *\n\t * @param orderedGroups the ordered grouped values\n\t * @param itemsByGroup the map that has ordered items by group value\n\t * @private\n\t */\n\t_sortItemsByGroup(orderedGroups, itemsByGroup) {\n\t\tlet response = [];\n\t\tfor(let i = 0, l = orderedGroups.length; i < l; i++) {\n\t\t\tlet group = orderedGroups[i];\n\t\t\tlet items = itemsByGroup[group];\n\t\t\tlet numItems = items.length;\n\t\t\tif(this.groupedRecordFields) {\n\t\t\t\tlet groupItem = { grouper : group, groupie: null };\n\t\t\t\tlet groupRecord = this._get(groupItem, this.recordPath);\n\t\t\t\tfor(let j = 0, ll = this.groupedRecordFields.length; j < ll; j++)\n\t\t\t\t\tgroupRecord[this.groupedRecordFields[j]] = group;\n\t\t\t\tif(this.groupCountPath) {\n\t\t\t\t\tlet groupCount = this._get(groupItem, this.groupCountPath.path);\n\t\t\t\t\tgroupCount[this.groupCountPath.property] = '(' + numItems + ')';\n\t\t\t\t}\n\t\t\t\tif(this.groupFieldType && this.groupFieldTypePath) {\n\t\t\t\t\tlet groupFieldMd = this._get(groupItem, this.groupFieldTypePath.path);\n\t\t\t\t\tgroupFieldMd[this.groupFieldTypePath.property] = group !== NOT_GROUPED_NAME ? this.groupFieldType : 'string';\n\t\t\t\t}\n\t\t\t\tthis._setProperties(groupItem, this.groupProperties);\n\t\t\t\tresponse.push(groupItem);\n\t\t\t}\n\t\t\tresponse = response.concat(items);\n\t\t}\n\t\treturn response;\n\t}\n\n\t_get(obj, path) {\n\t\tif (!path)\n\t\t\treturn obj;\n\n\t\tlet parts = path.split('.');\n\t\tfor (let i = 0, l = parts.length; i < l; i++) {\n\t\t\tif(!obj[parts[i]])\n\t\t\t\tobj[parts[i]] = {};\n\t\t\tobj = obj[parts[i]];\n\t\t}\n\t\treturn obj;\n\t}\n\n\t_setProperties(item, properties, propertiesKey) {\n\t\tif(!properties)\n\t\t\treturn;\n\n\t\tif(propertiesKey) {\n\t\t\tif (!properties[propertiesKey])\n\t\t\t\treturn;\n\t\t\tproperties = properties[propertiesKey];\n\t\t}\n\n\t\tfor(let key in properties)\n\t\t\titem[key] = properties[key];\n\t}\n}","export class FieldHider {\n\n\tconstructor(hidden, toggle) {\n\t\tthis.toggle = toggle;\n\t\tif(typeof hidden === 'boolean')\n\t\t\tthis.hide = { hidden: hidden, type: 'hide' };\n\t\telse if(typeof hidden === 'object')\n\t\t\tthis.hide = { hidden: !!(hidden.hidden), type: hidden.type || 'hide'};\n\t\telse\n\t\t\tthis.hide = { hidden: false, type: 'hide' };\n\t}\n\n\tget hidden() {\n\t\treturn this.hide.hidden;\n\t}\n\n\tget type() {\n\t\treturn this.hide.type;\n\t}\n\n\tapplyTo(field) {\n\t\tlet types = [this.hide];\n\t\tif(this.type === 'hide')\n\t\t\ttypes.push( { hidden: false, type: 'invisible' } );\n\t\telse\n\t\t\ttypes.push( { hidden: false, type: 'hide' } );\n\n\t\tfor(let type of types)\n\t\t\tthis.toggle.toggleClass(type.type, type.hidden, field);\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetHandler {\n\n\tconstructor(fieldSets, desktop, tablet, phone) {\n\t\tthis.fieldSets = fieldSets;\n\t\tthis.desktopFields = {name: desktop};\n\t\tif(tablet)\n\t\t\tthis.tabletFields = {name: tablet};\n\t\tif(phone)\n\t\t\tthis.phoneFields = {name: phone};\n\t}\n\n\tgetByViewport(viewport) {\n\t\tif(viewport && viewport.isPhone())\n\t\t\treturn this._getPhoneFieldSet();\n\n\t\tif(viewport && viewport.isTablet())\n\t\t\treturn this._getTabletFieldSet();\n\n\t\treturn this._getDesktopFieldSet();\n\t}\n\n\t_getPhoneFieldSet() {\n\t\tlet fieldSet = this.phoneFields ? this.fieldSets[this.phoneFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getTabletFieldSet();\n\n\t\tthis.phoneFields.fields = fieldSet;\n\t\treturn this.phoneFields;\n\t}\n\n\t_getTabletFieldSet() {\n\t\tlet fieldSet = this.tabletFields ? this.fieldSets[this.tabletFields.name] : null;\n\t\tif(!fieldSet || fieldSet.length === 0)\n\t\t\treturn this._getDesktopFieldSet();\n\n\t\tthis.tabletFields.fields = fieldSet;\n\t\treturn this.tabletFields;\n\t}\n\n\t_getDesktopFieldSet() {\n\t\tthis.desktopFields.fields = this.fieldSets[this.desktopFields.name];\n\t\treturn this.desktopFields;\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Actions {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-actions';\n\t\tthis.properties = {\n\t\t\trowActions: Array,\n\t\t\t/** position - determine the component's position */\n\t\t\tposition: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'left'\n\t\t\t},\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** viewport - to determine what viewport it is */\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'disableActions(data.disabledData.disabled)'\n\t\t];\n\t}\n\n\t/**\n\t * To initialize some values in the component\n\t *\n\t */\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tshouldDisable(index) {\n\t\t// Sorting table rows causes this to reevaluate and throw an error if the length of rowActions are unequal\n\t\tif (!this.data || !this.rowActions || !this.rowActions[index])\n\t\t\treturn;\n\t\treturn this.rowActions[index].title == 'Delete' && ((this.data.required && !this.data.addedManually) || (!!this.data.disabledData && this.data.disabledData.disabled));\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To attach the tapEvent which is defined from the caller\n\t *\n\t * @param e\n\t */\n\ttapEvent(e) {\n\t\tif (this.rowActions[e.currentTarget.dataIndex].onTapFunction && !this.shouldDisable(e.currentTarget.dataIndex)) {\n\t\t\tthis.rowActions[e.currentTarget.dataIndex].onTapFunction.bind(this)();\n\t\t}\n\t}\n\n\t_isVisible(invisible) {\n\t\treturn invisible ? 'visibilityHidden' : '';\n\t}\n\n\tdisplayTitle(action, index) {\n\t\treturn this.shouldDisable(index) ? 'Disabled' : action.title;\n\t}\n\n\t_isDisabled(index) {\n\t\treturn this.shouldDisable(index) ? 'disabled' : '';\n\t}\n\n\tdisableActions() {\n\t\tif (!this.$$('.sb-action-icon'))\n\t\t\treturn;\n\t\tfor (let i = 0; i < this.rowActions.length; i++) {\n\t\t\tthis.toggleClass('disabled', this.shouldDisable(i), this.$$('#_' + i));\n\t\t}\n\t}\n\n\t_configurationRequired(iconTitle) {\n\t\tif(!this.isMobile || !!this.data.configured) {\n\t\t\treturn '';\n\t\t}\n\n\t\tfor(let i = 0; i < this.rowActions.length; i++) {\n\t\t\tif(iconTitle === 'Configure' && this.rowActions[i].configurationRequired) {\n\t\t\t\treturn 'configurationRequired';\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( Actions );","export class Badge {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-badge';\n\n\t\tthis.properties = {\n\t\t\tfor: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: '_changedFor'\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: '_changedLabel'\n\t\t\t}\n\t\t}\n\t}\n\n\tget target() {\n\t\tvar ownerRoot = this.parentNode;\n\t\tvar target;\n\n\t\tif (this.for) {\n\t\t\ttarget = Polymer.dom(ownerRoot).querySelector('#' + this.for);\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tattached() {\n\t\tthis._updateTarget();\n\t\tthis._setVisibility();\n\t}\n\n\t_setVisibility() {\n\t\tif (!this.label && !this.getAttribute(\"hidden\")) {\n\t\t\tthis.setAttribute(\"hidden\", \"\");\n\t\t} else {\n\t\t\tthis.removeAttribute(\"hidden\");\n\t\t}\n\t}\n\n\t_updateTarget() {\n\t\tthis._target = this.target;\n\t\tthis.updatePosition();\n\t}\n\n\tattributeChanged(name) {\n\t\tif (name === 'hidden') {\n\n\t\t}\n\t}\n\n\t_changedFor() {\n\t\tif (!this.isAttached) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateTarget();\n\t}\n\n\t_changedLabel() {\n\t\tthis.setAttribute('aria-label', this.label);\n\t\tthis._setVisibility();\n\t}\n\n\tupdatePosition() {\n\t\tvar targetRect, thisRect;\n\n\t\tif (!this._target) {\n\t\t\treturn;\n\t\t}\n\n\t\ttargetRect = this._target.getBoundingClientRect();\n\t\tthisRect   = this.getBoundingClientRect();\n\n\t\tvar top = thisRect.top - targetRect.top;\n\t\tthis.style.top = 0 - (top + targetRect.height / 2) + \"px\";\n\n\t\tvar left = (targetRect.right - thisRect.left) + 1;\n\t\tthis.style.left = left + \"px\";\n\t}\n}\n\nPolymer(Badge);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class Dialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dialog';\n\t\tthis.properties = {\n\t\t\tshow: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmodal: {\n\t\t\t\t// when set to true, it will add a mask when dialog is toggled on\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tappendedClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tcancelText: {\n\t\t\t\tType: String,\n\t\t\t\tvalue: 'Cancel'\n\t\t\t},\n\t\t\tcloseDialog: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-dialog'\n\t\t\t},\n\t\t\thideCloseIcon: { //controls if the X close icon should show on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelButton: { //controls the Cancel button on desktop\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tif (PageContainer.getViewport())\n\t\t\t\t\t\treturn PageContainer.getViewport().isMobile() ? true : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tmobileDropDown: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttapDialog: String // Event fired when dialog is tapped (optional)\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\tready() {\n\t\tif (this.appendedClass)\n\t\t\tthis.$$('.sbDialog').classList.add(this.appendedClass);\n\t\tif (this.mobile) {\n\t\t\tthis._appendMobileClasses();\n\t\t\tPolymer.dom(this).observeNodes(function() {\n\t\t\t\tlet buttons = Polymer.dom(this).querySelectorAll('paper-button');\n\t\t\t\tlet title = this.$$('#title');\n\t\t\t\tif (buttons.length === 0) {\n\t\t\t\t\tlet title = this.$$('#title');\n\t\t\t\t\tthis.toggleClass('no-buttons', true, title);\n\t\t\t\t} else {\n\t\t\t\t\tthis.mobileDropDown = buttons.length > 1 ? true : false;\n\t\t\t\t\tlet mobileButtons = this.$$('#mobileButtons');\n\t\t\t\t\tlet dropDownButton = this.$$('#drop-down-button');\n\t\t\t\t\tthis.toggleClass('no-buttons', false, title);\n\t\t\t\t\tthis.toggleClass('drop-down-menu', this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('single-button', !this.mobileDropDown, mobileButtons);\n\t\t\t\t\tthis.toggleClass('hidden', !this.mobileDropDown, dropDownButton);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.toggleClass('is-ie', AppContext.isIE(), this.$.footer);\n\t}\n\n\t_appendMobileClasses() {\n\t\t// adds class mobile to style the component if the format is mobile\n\t\tthis.toggleClass('mobile', true, this.$$('.sbDialog'));\n\t\tlet children = Polymer.dom(this).children,\n\t\t\tnumChildren = children.length;\n\t\tfor (let i=0; i < numChildren; i++) {\n\t\t\tthis.toggleClass('mobile', true, children[i]);\n\t\t}\n\t}\n\n\ttoggle() {\n\t\tthis.show = !this.show;\n\t\tif (this.show) {\n\t\t\tthis.fire('sb-open-dialog');\n\t\t}\n\t}\n\n\topen() {\n\t\tthis.show = true;\n\t}\n\n\tclose() {\n\t\tthis.show = false;\n\t}\n\n\ttoggleMenu() {\n\t\tlet dropDownMenu = this.$$('.drop-down-menu');\n\t\tif (dropDownMenu && dropDownMenu.classList.contains('open'))\n\t\t\tthis.toggleClass('open', false, dropDownMenu);\n\t\telse\n\t\t\tthis.toggleClass('open', true, dropDownMenu);\n\t}\n\n\tonCloseDialog() {\n\t\tthis.fire( 'iron-signal', { name: 'sb-panel-closed' });\n\t\t// pass in the event name with attr 'close-dialog' for the message you want to fire to close the dialog\n\t\tthis.fire(this.closeDialog);\n\t}\n\n\ttapEvent() {\n\t\tif (this.tapDialog) {\n\t\t\tthis.fire(this.tapDialog);\n\t\t}\n\t}\n\n\t/***\n\t *\n\t * Adjust the date picker so that it can display under the date picker input box\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer;\n\t\tlet datepicker = e.detail.datepicker;\n\t\tlet content = this.$.content;\n\n\t\tdatepicker.style.position = 'fixed';\n\t\tlet dateContainerBoundingClientRect = dateContainer.getBoundingClientRect();\n\t\tlet contentBoundingClientRect = content.getBoundingClientRect();\n\n\t\tif (AppContext.isIE()) {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left - contentBoundingClientRect.left + 'px';\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top + dateContainerBoundingClientRect.height - this.$.header.getBoundingClientRect().top + 1 + 'px';\n\t\t}\n\t}\n}\n\nPolymer( Dialog );","export class Div {\n\n    beforeRegister() {\n        this.is = 'sb-div';\n    }\n}\n\nPolymer(Div);","export class Drawer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\n\t\tthis.is = 'sb-drawer';\n\n\t\tthis.listeners = {\n\t\t\t'iron-deselect': '_blurActiveElement'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tisRight: {\n\t\t\t\tType: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\trenderHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ticon: String,\n\t\t\tarrows: String,\n\t\t\t/**\n\t\t\t * Label for the side panel\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tsideText: String,\n\t\t\t/**\n\t\t\t * Boolean that hides and shows the panel slideout button\n\t\t\t * @type {Boolean}\n\t\t\t */\n\t\t\trightSideButton: Boolean\n\t\t};\n\t}\n\n\t_blurActiveElement(e) {\n\t\tif (e.detail.item.id === 'drawer') {\n\t\t\tdocument.activeElement.blur();\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.drawer.rightDrawer = this.isRight;\n\t}\n\n\tget observers() {\n\t\treturn ['setIcon(isOpen)']\n\t}\n\n\tcloseDrawer() {\n\t\tthis.$.drawer.closeDrawer();\n\t}\n\n\ttoggleDrawer() {\n\t\tthis.fire('side-toggle-clicked');\n\t}\n\n\tsetIcon() {\n\t\tif (this.isOpen === \"open\") {\n\t\t\tthis.icon = 'sf-icon-left';\n\t\t}\n\t\telse {\n\t\t\tthis.icon = 'sf-icon-right';\n\t\t\tthis.arrows = 'closedArrows';\n\t\t}\n\t}\n}\n\nPolymer(Drawer);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class FieldItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldData(item, model)', '_dataChanged(data, item)'];\n\t}\n\n\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tthis.md = this.model[this.item];\n\t\tthis.label = this.md.label;\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\tthis.$.field.editing = this.md.updateable;\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_dataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(FieldItem);\n","export class FieldTable {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-table';\n\t\tthis.properties = {\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: String,\n\t\t\tmd: Object,\n\t\t\tdisabled: Boolean\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['generateColumns(md, fieldNames)'];\n\t}\n\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tlet numFields = this.fieldNames.length;\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(this.fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(this.fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(this.fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n}\n\nPolymer(FieldTable);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class FilterItem {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\thidden: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabel: String,\n\t\t\tdisplay: String\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleKeyPress();\n\t\tthis.addEventListener('lookup-value-changed', this.handleLabelChange);\n\t}\n\n\thandleLabelChange(e) {\n\t\tlet data = {\n\t\t\titem: this.item.split('.')[0],\n\t\t\tvalue: e.detail.refDisplay\n\t\t};\n\t\tthis.fire('filter-item-value-changed', data);\n\t}\n\n\thandleKeyPress() {\n\t\tthis.addEventListener('keypress', function (e) {\n\t\t\tlet item = this.item.split('.')[0];\n\t\t\tthis.fire('filter-item-field-keypress', {keyCode: e.keyCode, item: item, itemType: this.model[item].model.type})\n\t\t}.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setMd(item, model)',\n\t\t\t'setHidden(data.*)',\n\t\t\t'dataChanged(data, item)',\n\t\t\t'_displayChanged(value, display, item, data, md)'\n\t\t];\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n\n\tsetMd() {\n\t\tlet item = this.item.split('.')[0];\n\t\tthis.md = this.model[item].model;\n\t\tthis.label = this.model[item].label ? this.model[item].label : this.model[item].record.Name;\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = this.md;\n\t}\n\n\tsetHidden() {\n\t\tlet item = this.item;\n\t\tif (!this.data[item])\n\t\t\titem = this.item.split('.')[0];\n\n\t\tif (this.data[item]) {\n\t\t\tthis.hidden = this.data[item].hidden;\n\t\t}\n\t}\n\n\tdataChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tthis.display = this.data[id].label;\n\n\t\t// set the sb-field record property to this to enable dependent pick list functionality\n\t\t// this class satisfies the contract of a sb-field record property because it implements the following functions: getValue, setValue, and equals\n\t\tthis.$.field.record = this;\n\t}\n\n\t_displayChanged() {\n\t\tlet id = this.item.split('.')[0];\n\t\tlet rfm = new RelationshipFieldManager(id, this.data);\n\t\tlet relationship = rfm.buildRelationship(this.value, this.display, this.md.referenceTo[0]);\n\t\tif(relationship)\n\t\t\tthis.data[id].label = relationship.value.Name;\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tif (this.data[name])\n\t\t\treturn this.data[name].value;\n\t\telse\n\t\t\tfor (let process in this.data) {\n\t\t\t\tif (this.data[process].field === name)\n\t\t\t\t\treturn this.data[process].value;\n\t\t\t}\n\n\t\treturn null;\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(filterItem) {\n\t\treturn this.data === filterItem.data;\n\t}\n}\n\nPolymer(FilterItem);\n","import {Page} from 'common/core/Page.js';\nimport {DataBuilder} from 'common/data/format/DataBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FilterLayout extends Page {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-filter-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilterPath: { //path in the search model for the search filters\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'searchFilters'\n\t\t\t},\n\t\t\tfilterKey: String,\n\t\t\tfilterDelegator: Object, //logic handler (suggester, searcher, filterer)\n\t\t\tsearchFilterData: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchFilterModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true //this is required for Safari to sync values between modal and panel\n\t\t\t},\n\t\t\tserviceLoader: String,\n\t\t\tquote: Object,\n\t\t\tenterCallback: Object,\n\t\t\ttranslationCallback: Object,\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}, Page.properties)\n\t}\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelReady(searchModel, filterDelegator)'\n\t\t]\n\t}\n\n\tready() {\n\t\tthis.mdResponse(); //handle the field metadata response\n\t\tthis.handleEnterKeyPressed();\n\t}\n\n\thandleEnterKeyPressed() {\n\t\tthis.addEventListener('filter-item-field-keypress', function (e) {\n\t\t\t//if key is not enter, the callback is not a function, or if the item type is a reference, return; don't run filter\n\t\t\tif (e.detail.keyCode !== 13 || typeof this.enterCallback !== 'function' || e.detail.itemType === 'reference')\n\t\t\t\treturn;\n\t\t\tthis.enterCallback();\n\t\t}.bind(this));\n\t}\n\n\tsearchModelReady() {\n\t\t//only need to run this once\n\t\tif (this.searchModelInitialized === true)\n\t\t\treturn;\n\t\tthis.searchModelInitialized = true;\n\t\tif (this.filterKey === undefined)\n\t\t\tthis.filterKey = this.searchModel.hasCustomSearchFilters ? 'Id' : 'Name';\n\t\tlet properties = this.filterPath.split('.');\n\t\tthis.path = 'this.searchModel';\n\t\tfor (let property of properties) {\n\t\t\tthis.path += '.' + property;\n\t\t}\n\n\t\tlet searchFilters = eval(this.path),\n\t\t\tfields = [],\n\t\t\tsearchFilterModel = {};\n\t\tif (Array.isArray(searchFilters) === false)\n\t\t\treturn;\n\n\t\tfor (let filter of searchFilters) {\n\t\t\tfields.push(this.getSearchTable() + '.' + filter.targetFieldName);\n\t\t\t//Fixes a bug where dynamic filters would always be hidden\n\t\t\t//Now shows the filter if any instance of that filter is not hidden\n\t\t\tlet duplicateHidden = searchFilterModel[this.filterDelegator.getGroupKey(filter)];\n\t\t\tsearchFilterModel[this.filterDelegator.getGroupKey(filter)] = filter;\n\t\t\tif (duplicateHidden)\n\t\t\t\tsearchFilterModel[this.filterDelegator.getGroupKey(filter)].hidden = duplicateHidden;\n\t\t}\n\t\tthis.fields = this.filterDelegator.buildFields(fields);\n\t\tthis.searchFilterModel = searchFilterModel;\n\t}\n\n\tmdResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet mdResponse = e.detail.value;\n\t\t\tif (mdResponse === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.setFilterValueMap(mdResponse);\n\t\t}.bind(this));\n\t}\n\n\tsetFilterValueMap(mdResponse) {\n\t\tlet groupItems = [];\n\t\tlet groupKeys = [];\n\t\tif (this.searchFilterModel === undefined)\n\t\t\treturn;\n\n\t\tfor (let i in this.searchFilterModel) {\n\t\t\tif(this.searchFilterModel[i].hidden === true)\n\t\t\t\tcontinue;\n\t\t\tlet fieldName = this.searchFilterModel[i].targetFieldName;\n\t\t\tgroupItems.push(i + '.value');\n\t\t\tgroupKeys.push(i);\n\t\t\tthis.searchFilterModel[i].model = mdResponse.fieldsByObject[this.getSearchTable()][fieldName];\n\t\t}\n\t\t//groupItems notifies up and will set off a chain reaction of rebuilding a group when it doesn't have to\n\t\t//simple safe check to see if the groupItems are the same and only set if they are not\n\t\tif(JSON.stringify(this.groupItems) !== JSON.stringify(groupItems))\n\t\t\tthis.groupItems = groupItems;\n\t\tthis.filterDelegator.setDefaultFilterValues(groupKeys, this.searchFilterModel).then(function(searchFilterData) {\n\t\t\t//Don't reset property if it already exists to avoid firing observers on child fields\n\t\t\tif (!this.searchFilterData)\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\tthis.filterDelegator.searchFilterModel = this.searchFilterModel;\n\t\t\tthis.filterDelegator.groupItems = this.groupItems;\n\t\t}.bind(this));\n\t}\n\n\tgetSearchTable() {\n\t\tif (this.searchModel === undefined)\n\t\t\treturn;\n\n\t\treturn this.filterDelegator.getSearchTable();\n\t}\n\n\tfocusFirstField() {\n\t\tif(!this.isMobile())\n\t\t\tthis.$.panel.applyFocusToItem(0);\n\t}\n\n\trunService(actionId, resultLimit, pageNumber, fieldSet) {\n\t\tif (this.serviceLoader === undefined || this.quote === undefined)\n\t\t\treturn;\n\n\t\tthis.spinner = true;\n\t\tlet context = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.addObject('filterContext', this.filterDelegator.getFilterContext())\n\t\t\t.add('additional', this.filterDelegator.getAdditionalProperties())\n\t\t\t.add('actionId',  this.actionId)\n\t\t\t.add('resultLimit', resultLimit)\n\t\t\t.add('pageNumber', pageNumber)\n\t\t\t.add('fieldSet', fieldSet)\n\t\t\t.build();\n\n\t\tthis.$.service.client.load(\n\t\t\tthis.prefix,\n\t\t\tthis.serviceLoader,\n\t\t\tnull,\n\t\t\tcontext\n\t\t).then(function (result) {\n\t\t\tthis.spinner = false;\n\t\t\tthis.searchModel = this.localizer ? this.localizer.localizeSearchModel(result) : result;\n\t\t}.bind(this));\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n\nPolymer(FilterLayout);","import {AppContext} from 'common/core/AppContext.js';\n\nconst quiet = typeof Visualforce !== 'undefined';\n\nexport class Group {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group';\n\t\tthis.properties = {\n\t\t\titem: String, // name of the component that represents an item in the group\n\t\t\tgroup: Array, // array of strings that represents the group\n\t\t\tdata: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each group item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupClass: String, // class string to be added the div that wraps the group items\n\t\t\titemClass: String, // class string to be added to each group item\n\t\t\tgroupDisplay: Object, // map whose keys match the group array and value is used for display purposes\n\t\t\tprimaryItems: { // if defined these named items are added to the front of the group only if they exist in the group\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tnumPrimary: { // used to determine the number of initial group items have the 'primary' class even if primaryItems is not yet defined\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tincludePrimaryInSecondary: { // if true will repeat the primary items in the secondary item set\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // used to tell each item in group it is a \"selected\" group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateSelected'\n\t\t\t},\n\t\t\tdisabled: { // used to tell each item in group it is a disabled group\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'updateDisabled'\n\t\t\t},\n\t\t\t//when an items value is not a property on data, but a deep property like data.record.value,\n\t\t\t//you can set this to record. as the path prefix so the item is updated when the host data changes\n\t\t\t//specifically it's used when looping through the elements to find the item\n\t\t\tpathPrefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusIndex: { // index of group item you want to apply \"focus\"\n\t\t\t\ttype: Number,\n\t\t\t\tobserver: 'updateFocusIndex'\n\t\t\t},\n\t\t\titemClassMap: { // map of attributes to classNames (used for adding classes only to the item that have the attributes)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\titemEditableMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'toggleEditable'\n\t\t\t},\n\t\t\tcolumnWidths: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tsignaler: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'updateSignaler'\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildGroup(item, group, data, primaryItems, itemClassMap, columnWidths)',\n\t\t\t'handlePrimaryEvents(template, _primaryItems)',\n\t\t\t'propagateFromParentToChild(data.*)',\n\t\t\t'toggleItemClass(itemClassMap.*)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened'\n\t\t};\n\t}\n\n\tbuildGroup() {\n\t\tthis.initInternalGroupAndPrimaryItems();\n\t\tif (this.template) {\n\t\t\t// If the group is unchanged, we need to only reset the data and the model\n\t\t\tif (this.template.group === this._group) {\n\t\t\t\tthis.template.selected = this.selected;\n\t\t\t\tthis.template.disabled = this.disabled;\n\t\t\t\tthis.template.data = this.data;\n\t\t\t\tthis.template.model = this.model;\n\t\t\t\tif (this.columnWidths && (this.template.columnWidths != this.columnWidths)) {\n\t\t\t\t\tthis._updateColumnWidths();\n\t\t\t\t}\n\n\t\t\t} else if(!quiet)\n\t\t\t\tconsole.error(`Rebuilding a group is no longer supported. Called by ${this.domHost.tagName.toLowerCase()}: old group [${this.template.group}], new group [${this._group}]`);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.expanded = false;\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis.template.group = this._group;\n\t\tthis.template.selected = this.selected;\n\t\tthis.template.disabled = this.disabled;\n\t\tthis.template.signaler = this.signaler;\n\t\tthis.template.model = this.model;\n\t\tthis.template.data = this.data;\n\t\tthis.template.columnWidths = this.columnWidths;\n\t\tthis.buildItems(this.template);\n\t\tPolymer.dom(this.$.g).appendChild(this.template);\n\t\t// observe for when the child elements are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.g).observeNodes(function (info) {\n\t\t\tif (info.addedNodes[0])\n\t\t\t\tthis.bindElementEvents(Polymer.dom(info.addedNodes[0]).childNodes);\n\t\t}.bind(this));\n\t}\n\n\tdestroyGroup() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis.elements = null;\n\t\t\tPolymer.dom(this.$.g).removeChild(this.template);\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.group = undefined;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_updateColumnWidths() {\n\t\tif(!this.columnWidths)\n\t\t\treturn;\n\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t// In Safari and FF, items are not yet rendered sometimes. Wait for rendering to complete, if that's the case.\n\t\tif (!items || items && items.length == 0) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet items = Polymer.dom(this.$.g).querySelectorAll(this.item);\n\t\t\t\tthis._setColumnWidths(items);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._setColumnWidths(items);\n\t\t}\n\n\t}\n\n\t_setColumnWidths(items) {\n\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\tlet item = items[i],\n\t\t\t\tfieldName = item.getAttribute('item');\n\t\t\t// Setting min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\t\titem.style.minWidth = this.columnWidths[fieldName] + 'px';\n\t\t\titem.style.maxWidth = this.columnWidths[fieldName] + 'px';\n\t\t}\n\t}\n\n\tupdateSelected() {\n\t\tif (this.template)\n\t\t\tthis.template.selected = this.selected;\n\t}\n\n\tupdateDisabled() {\n\t\tif (this.template)\n\t\t\tthis.template.disabled = this.disabled;\n\t}\n\n\tupdateSignaler() {\n\t\tif (this.template)\n\t\t\tthis.template.signaler = this.signaler;\n\t}\n\n\tapplyFocusToItem(focusIndex) {\n\t\tthis.focusIndex = undefined;\n\t\tthis.focusIndex = focusIndex;\n\t}\n\n\tupdateFocusIndex() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tif(!this.elements)\n\t\t\treturn;\n\n\t\tif(this.focusIndex === undefined || this.focusIndex < 0)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.template.group.length; i < l; i++) {\n\t\t\tthis.template[`focus_${i}`] = false;\n\t\t\tif(this.focusIndex === i)\n\t\t\t\tthis.template[`focus_${i}`] = true;\n\t\t}\n\t}\n\n\tinitInternalGroupAndPrimaryItems() {\n\t\t// the internal group property is the provided group with any applicable primary items concatenated to the front of the group\n\t\tthis._group = this.group;\n\n\t\t// the internal primaryItems property is the provided primary items normalized against the group itself\n\t\tthis._primaryItems = undefined;\n\n\t\t// if primary items is not defined or an empty array then we are done\n\t\tif (!this.primaryItems || this.primaryItems.length === 0)\n\t\t\treturn;\n\n\t\tlet primaryItems = [].concat(this.primaryItems);\n\n\t\t// if first primary item is not on group, then use the first item in group instead\n\t\tif(this.group.indexOf(primaryItems[0]) === -1)\n\t\t\tprimaryItems[0] = this.group[0];\n\n\t\t// if second primary item is not on group, then just simply remove\n\t\t// we do not support more then 2 primary items\n\t\tif(primaryItems.length > 1) {\n\t\t\tif(this.group.indexOf(primaryItems[1]) === -1)\n\t\t\t\tprimaryItems = [primaryItems[0]];\n\t\t\telse\n\t\t\t\tprimaryItems = [primaryItems[0], primaryItems[1]];\n\t\t}\n\n\t\t// at least one provided primary item was in the group, so lets ensure the primary items are in the front of the group\n\t\tthis._primaryItems = primaryItems;\n\t\tif(this.includePrimaryInSecondary) {\n\t\t\t// if include primary in secondary, then simply append the primary to the group and we are done\n\t\t\tthis._group = primaryItems.concat(this.group);\n\t\t\tthis._normalizeWithTemplateGroup();\n\t\t\treturn;\n\t\t}\n\n\t\t// we do not want to repeat primary, so lets create secondary list from group by filtering out primaryItems\n\t\tlet secondary = this.group.filter(function (item) {\n\t\t\treturn primaryItems.indexOf(item) === -1;\n\t\t});\n\n\t\t// simply append primary with secondary and call it a day\n\t\tthis._group = primaryItems.concat(secondary);\n\t\tthis._normalizeWithTemplateGroup();\n\t}\n\n\tbuildItems(template) {\n\n\t\tvar doc = template.content.ownerDocument;\n\t\tvar root = doc.createElement('div');\n\t\tif (this.groupClass)\n\t\t\tPolymer.dom(root).setAttribute('class', this.groupClass);\n\n\t\tlet numPrimary = this.numPrimary > 0 ? this.numPrimary : (this._primaryItems ? this._primaryItems.length : 0);\n\t\tthis._group.forEach(function (item, index) {\n\t\t\tlet html = '<' + this.item + ' ' + 'item=\"' + item + '\" value=\"{{data.' + item + '}}\" model=\"[[model]]\" data=\"[[data]]\" disabled=\"[[disabled]]\" selected=\"[[selected]]\" focus=\"[[focus_' + index + ']]\" index=\"' + index + '\"';\n\n\t\t\tlet isPrimary = index < numPrimary;\n\n\t\t\tif (!isPrimary && this.groupDisplay && this.groupDisplay[item]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item] + '\"';\n\t\t\t} else if (!isPrimary && this.groupDisplay && this.groupDisplay[item.split(\".\")[1]]) {\n\t\t\t\thtml += ' field-label=\"' + this.groupDisplay[item.split(\".\")[1]] + '\"';\n\t\t\t}\n\n\t\t\tlet classes = '';\n\t\t\tif (this.itemClass)\n\t\t\t\tclasses += this.itemClass + ' ';\n\n\t\t\tif (isPrimary) {\n\t\t\t\tclasses += index === 0 ? 'primary first' : 'primary multi';\n\t\t\t\tclasses += this.selected ? ' selected' : '';\n\t\t\t} else if (numPrimary > 0) {\n\t\t\t\tclasses += 'secondary';\n\t\t\t}\n\n\t\t\tif (this.itemClassMap && this.itemClassMap[item]) {\n\t\t\t\tclasses += ' ' + (this.itemClassMap[item].class || this.itemClassMap[item]);\n\t\t\t\tif(this.itemClassMap[item].style)\n\t\t\t\t\thtml += ` style=\"${this.itemClassMap[item].style}\"`;\n\t\t\t}\n\n\t\t\tif (classes)\n\t\t\t\thtml += ' class' + '=' + '\"' + classes + '\"';\n\n\n\t\t\tif (this.columnWidths && this.columnWidths[item]) {\n\t\t\t\t// Setting min-width and max-width instead of width because otherwise browser overwrites our value with its own and that breaks the overall alignment\n\t\t\t\thtml += ' style' + '=' + '\"min-width:' + this.columnWidths[item] + 'px;' + 'max-width:' + this.columnWidths[item] + 'px;\"';\n\t\t\t}\n\n\t\t\thtml += ' signaler=\"[[signaler]]\"></' + this.item + '>';\n\t\t\tlet div = doc.createElement('div');\n\n\t\t\tdiv.innerHTML = html;\n\n\t\t\tPolymer.dom(root).appendChild(Polymer.dom(div).firstChild);\n\t\t}.bind(this));\n\t\tPolymer.dom(template.content).appendChild(root);\n\t}\n\n\tbindElementEvents(elements) {\n\t\t//this is needed for Safari and FireFox to have a handle of this in the callbacks\n\t\tthis.elements = elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tthis.updateFocusIndex();\n\n\t\tthis.propagateValueToParent = this.propagateValueToParent || function (e) {\n\t\t\t\t//the internal property will protect against the parent observer if it has a parent property called data\n\t\t\t\tthis.internal = true;\n\t\t\t\tthis.set('data.' + e.target.item, e.detail.value);\n\t\t\t\tif(this.childToParentExtension)\n\t\t\t\t\tthis.childToParentExtension( { path: 'data.' + e.target.item, value: e.detail.value } );\n\t\t\t\tthis.internal = false;\n\t\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\telements[i].removeEventListener('value-changed', this.propagateValueToParent);\n\t\t\telements[i].addEventListener('value-changed', this.propagateValueToParent);\n\t\t}\n\t}\n\n\tpropagateFromParentToChild(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tif (e.path === 'data')\n\t\t\treturn;\n\n\t\tif(this.propagateFromParentToChildOverride) {\n\t\t\tthis.propagateFromParentToChildOverride(e);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._propagateFromParentToChild(e);\n\t}\n\n\t_propagateFromParentToChild(e) {\n\t\t//Chrome and FireFox do not have access to element or numElements outside this callback\n\t\tvar elements = this.elements;\n\t\tvar numElements = elements ? elements.length : 0;\n\t\t//looking for the item in the elements to apply the value to\n\t\tvar parts = e.path.split('.');\n\t\tvar item = this.pathPrefix + parts[parts.length - 1];\n\t\tfor (var i = 0; i < numElements; i++) {\n\t\t\tif (elements[i].item === item) {\n\t\t\t\telements[i].value = e.value;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\thandlePrimaryEvents() {\n\t\tif (this.primaryEventsResistered)\n\t\t\treturn;\n\n\t\tthis.addEventListener('group-selected', function (e) {\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item + '.primary');\n\t\t\tfor (var i = 0, l = items.length; i < l; i++)\n\t\t\t\tthis.toggleClass('selected', e.detail.selected, items[i]);\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('group-expanded', function (e) {\n\t\t\tlet primary = e.detail.path.filter(function (node) {\n\t\t\t\tlet el = Polymer.dom(node);\n\t\t\t\tlet tagName = el.node.tagName ? el.node.tagName.toLowerCase() : '';\n\t\t\t\treturn tagName === this.item && el.classList.contains('primary');\n\t\t\t}.bind(this));\n\n\t\t\tif (!primary || primary.length === 0)\n\t\t\t\treturn;\n\n\t\t\tthis.toggleClass('initial', false, primary[0]);\n\t\t\tthis.expanded = !this.expanded;\n\t\t\t// toggle the expanded property on the host in case it needs it\n\n\t\t\tif (this.domHost) {\n\t\t\t\tthis.domHost.expanded = !this.domHost.expanded;\n\t\t\t}\n\n\t\t\tlet items = Polymer.dom(this.root).querySelectorAll(this.item);\n\t\t\tfor (let i = 0, l = items.length; i < l; i++) {\n\t\t\t\tlet itemField = items[i].$$('sb-field');\n\t\t\t\tif(itemField) itemField.renderReadOnly = false;\n\t\t\t\tthis.toggleClass('expanded', this.expanded, items[i]);\n\t\t\t}\n\t\t\t// Caught in swipe-container\n\t\t\tthis.fire('expanded-changed', {expanded: this.expanded});\n\t\t}.bind(this));\n\t\tthis.primaryEventsResistered = true;\n\t}\n\n\tnavigationChanged() {\n\t\tthis.fire('group-selected', {selected: false}, {bubbles: false});\n\t}\n\n\toverridePropagateFromParentToChild(propagateFromParentToChildOverride) {\n\t\tif (typeof propagateFromParentToChildOverride !== 'function')\n\t\t\treturn;\n\n\t\tthis.propagateFromParentToChildOverride = propagateFromParentToChildOverride;\n\t}\n\n\tsetFromChildToParentExtension(childToParentExtension) {\n\t\tif (typeof childToParentExtension !== 'function')\n\t\t\treturn;\n\n\t\tthis.childToParentExtension = childToParentExtension;\n\t}\n\n\t/**\n\t * \tObserve changes to this.itemClassMap.*\n\t * \te.value should be an array of objects with the properties \"class\" and \"value\"\n\t */\n\ttoggleItemClass(e) {\n\t\tlet parts = e.path.split('.');\n\t\tif(parts.length === 1)\n\t\t\treturn; // Don't care about changes to itemClassMap itself, just its members\n\n\t\tlet path = parts[1];\n\t\tfor(let element of this.elements) {\n\t\t\t\tif (element.item === path) {\n\t\t\t\t\tfor(let i = 0, l = e.value.length; i < l; i++)\n\t\t\t\t\t\telement.toggleClass(e.value[i].class, e.value[i].value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\t/**\n\t * Observe changes to this.itemEditableMap.* which is just a map of field name to an 'editable' flag\n\t */\n\ttoggleEditable() {\n\t\tif(!this.itemEditableMap)\n\t\t\treturn; // Don't care about changes to itemEditableMap itself, just its members\n\n\t\tfor (let element of this.elements) {\n\t\t\t\tlet editable = this.itemEditableMap[element.item];\n\t\t\t\tif (editable != null)\n\t\t\t\t\telement.editable = editable;\n\t\t\t}\n\t\t}\n\n\t_normalizeWithTemplateGroup() {\n\t\tif(!this.template || !this.template.group)\n\t\t\treturn; // template.group not defined so bail\n\n\t\tif(this.template.group.length !== this._group.length)\n\t\t\treturn; // template.group not same length as _group so bail\n\n\t\tfor(var i = 0, l = this._group.length; i < l; i++) {\n\t\t\tif(this.template.group[i] !== this._group[i])\n\t\t\t\treturn; // we found an element that is not the same, so bail\n\t\t}\n\t\t// template.group is same as _group, so lets assign it as such\n\t\tthis._group = this.template.group;\n\t}\n\n\t/**\n\t * Readjust the date picker position while opening\n\t *\n\t * @param e\n\t * @private\n\t */\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker;\n\n\t\t// This line is required because datepicker is someone receiving an inline style position of fixed\n\t\tdatepicker.style.position = 'absolute';\n\t\tlet dateRow = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\n\t\t// If there isn't enough space to display the right-side of the calendar, we align it to the right\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\t}\n}\n\nPolymer(Group);\n","import {DEFAULT_WIDTH} from 'common/layout/tables/ImageCellSizer.js';\nimport {DEFAULT_HEIGHT} from 'common/layout/tables/ImageCellSizer.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst CHECKBOX = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC';\nconst CHECKBOX_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==';\nconst CHECKBOX_CHECKED_DIRTY = 'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==';\n\nexport class Html {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-html';\n\t\tthis.properties = {\n\t\t\tvalue: String,\n\t\t\ttype: String,\n\t\t\tlink: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbooleanValue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'registerTabIndexEvents'\n\t\t\t},\n\t\t\tisDirty: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabindex: {\n\t\t\t\ttype: Number,\n\t\t\t\treflectToAttribute: true\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['sanitizeAndSetInnerHTML(value, type, link, viewport, booleanValue, isDirty)'];\n\t}\n\n\tsanitizeAndSetInnerHTML() {\n\t\tif(this.isNil()) {\n\t\t\t// adding styles inline on image tag itself because in FF it did now work when added as CSS\n\t\t\tlet blankImage = '<img id=\"blank\" src=\"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" style=\"width:50%; height:18px\"/>';\n\t\t\tlet useImage = !this.link && !this.isMobile();\n\t\t\t// use blank image in desktop for editable empty cells to allow the empty cell to be clicked on for editing\n\t\t\tthis.$.me.innerHTML = useImage ? blankImage : '';\n\t\t\treturn;\n\t\t}\n\n\t\t// add checkbox image based on the boolean value if non null\n\t\tif(this.booleanValue != null) {\n\t\t\tlet checkboxBase64 = this.booleanValue ? CHECKBOX_CHECKED : CHECKBOX;\n\t\t\tif(this.isDirty)\n\t\t\t\tcheckboxBase64 = this.booleanValue ? CHECKBOX_CHECKED_DIRTY : CHECKBOX_DIRTY;\n\t\t\tthis.$.me.innerHTML = '<img id=\"checkbox\" style=\"margin-top:5px\" src=\"data:image/png;base64,' + checkboxBase64 +'\"/>';\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.type === 'string' || this.type === 'textarea') {\n\t\t\t// innerHTML is raw, we need to sanitize it ourselves\n\t\t\tthis.$.me.innerHTML = sanitizeHtmlText((this.value + '').trim());\n\t\t} else {\n\t\t\t// textContent is sanitized by the browser\n\t\t\tthis.$.me.textContent = (this.value + '').trim();\n\t\t}\n\t\tthis.handleDefaultSizeIfImage();\n\t}\n\n\thandleDefaultSizeIfImage() {\n\t\t// width could either be on the image's style attribute or its width attribute\n\t\t// only if its not on either will we set the default width\n\t\tlet imageNoWidth = this.$$('#me img:not([style*=width])');\n\t\tif(imageNoWidth)  // width not on style attribute, so to be sure check if not on width attribute\n\t\t\timageNoWidth = this.$$('#me img:not([width])');\n\n\t\tif(imageNoWidth)\n\t\t\tPolymer.dom(imageNoWidth).setAttribute('width', DEFAULT_WIDTH);\n\n\t\t// height could either be on the image's style attribute or its height attribute\n\t\t// only if its not on either will we set the default height\n\t\tlet imageNoHeight = this.$$('#me img:not([style*=height])');\n\t\tif(imageNoHeight)  // height not on style attribute, so to be sure check if not on height attribute\n\t\t\timageNoHeight = this.$$('#me img:not([height])');\n\n\t\tif(imageNoHeight)\n\t\t\tPolymer.dom(imageNoHeight).setAttribute('height', DEFAULT_HEIGHT);\n\t}\n\n\tisNil() {\n\t\treturn (this.value == null || (this.value + '').trim() === '') && this.booleanValue == null;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tregisterTabIndexEvents() {\n\t\tif(this.booleanValue == null)\n\t\t\treturn;\n\n\t\tif(this._registeredTabIndexEvents)\n\t\t\treturn;\n\n\t\tthis.addEventListener('mouseenter', this.clearTabIndex.bind(this));\n\t\tthis.addEventListener('mouseleave', this.restoreTabIndex.bind(this));\n\t\tthis.addEventListener('tap', this.restoreTabIndex.bind(this));\n\t\tthis._registeredTabIndexEvents = true;\n\t}\n\n\tclearTabIndex() {\n\t\tthis._tabindex = this.tabindex;\n\t\tthis.tabindex = undefined;\n\t}\n\n\trestoreTabIndex() {\n\t\tthis.tabindex = this._tabindex;\n\t}\n}\n\nPolymer(Html);","import {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n * Component for creating a list from a SearchModel.\n *\n */\nexport class LookupLayout {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-layout';\n\t\tthis.properties = {\n\t\t\tselectedRows: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsearchModel: Object,\n\t\t\ttotalCount: { //let the host know the total count of rows\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasTotalCount: { //let the host know if there is a count because polymer can't evaluate expressions in bindings\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionIdDataPath: String, //the path passed to row for where the record ID is\n\t\t\tparentAttributesPath: String,\n\t\t\tadditionalFields: Array, //additional fields to show on list not in the SearchModel,\n\t\t\tfieldPrefix: { // TODO: add good comment\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tgroupByField: String, //results can be grouped by this field\n\t\t\tgroupByFieldType: String, //type of field that results are being grouped by\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tprimaryMobileCols: Array,\n\t\t\t_primaryMobileColumns: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: '_getPrimaryMobileCols(primaryMobileCols, fieldSet)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setViewResults(searchModel, fieldSet, groupByFieldType)',\n\t\t\t'initFieldMetadata(searchModel)',\n\t\t\t'updateTotalCount(searchModel.totalCount)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.handleAllRowsSelected();\n\t\tthis.handleOneRowSelected();\n\t\tthis.handleMetaDataResponse();\n\t\tthis.hiddenByGroup = {};\n\t}\n\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.initRecordKeysFieldLabelsAndTypeMap(e.detail.value.fields);\n\t\t}.bind(this));\n\t}\n\n\tinitFieldMetadata() {\n\t\tif(this.fieldMetadataInitialized)\n\t\t\treturn;\n\t\tthis.$.md.object = this.searchModel.targetObjectName;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.searchModel, 'resultFieldNames', 'resultFieldNamesTablet', 'resultFieldNamesPhone');\n\t\tthis.setFieldMetadata();\n\t\tthis.fieldMetadataInitialized = true;\n\t}\n\n\tsetFieldMetadata() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.$.md.name === this.fieldSet.name)\n\t\t\treturn false;\n\n\t\tthis.$.md.fields = undefined;\n\t\tthis.$.md.name = this.fieldSet.name;\n\n\t\tlet metadataFields = this.fieldSet.fields;\n\n\t\t//caller provides fields from field set\n\t\tif (Array.isArray(this.additionalFields))\n\t\t\tmetadataFields = this.fieldSet.fields.concat(this.additionalFields);\n\n\t\tif(this.groupByField && metadataFields.indexOf(this.groupByField) === -1) {\n\t\t\t//adds the field to group by into the field set to get its metadata\n\t\t\tmetadataFields = [this.groupByField].concat(metadataFields);\n\t\t}\n\n\t\tthis.$.md.fields = metadataFields;\n\t}\n\n\tinitRecordKeysFieldLabelsAndTypeMap(fields) {\n\t\tlet recordKeys = [],\n\t\t\tfieldLabels = [],\n\t\t\tfieldLabelMap = {},\n\t\t\ttypeMap = {},\n\t\t\tlabelTypeMap = {},\n\t\t\titemTypeMap = {};\n\n\t\tfields.forEach(function (field) {\n\t\t\tif(this.groupByField === field.name) {\n\t\t\t\tthis.groupByFieldType = field.type;\n\t\t\t\t//ignores the field to group by from the field set if it wasn't originally included\n\t\t\t\tif(this.fieldSet.fields.indexOf(field.name) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//TODO: this unit price thing isn't going to work...\n\t\t\tlet key = field.name === 'UnitPrice' ? field.name : (this.fieldPrefix + field.name);\n\t\t\trecordKeys.push(key);\n\t\t\tfieldLabels.push(field.label);\n\t\t\tfieldLabelMap[key] = field.label;\n\t\t\ttypeMap[key] = {type: field.type};\n\t\t\tif (field.type.toLowerCase() === 'currency')\n\t\t\t\ttypeMap[key].CurrencyIsoCode = this.currencyIsoCode;\n\n\t\t\tlet type = field.type;\n\t\t\tif (!this.isMobileViewport()) {\n\t\t\t\t// returns undefined if cell is not an image\n\t\t\t\tlet imageWidth = new ImageCellSizer(field).getImageWidth(20);\n\t\t\t\t// append the image width to the type if defined as TableClassBuilder knows what to do with a type of format type:width\n\t\t\t\tif (imageWidth) type += ':' + imageWidth;\n\t\t\t}\n\n\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = type;\n\t\t\titemTypeMap[key] = type;\n\t\t}.bind(this));\n\n\t\tif(this.groupByFieldType === undefined) {\n\t\t\t//must define value to kick off setViewResults observer method\n\t\t\tthis.groupByFieldType = null;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.typeMap = typeMap;\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\thandleAllRowsSelected() {\n\t\t// listen for when the selection list selects all of the items\n\t\tthis.addEventListener('header-selection-changed', function (e) {\n\t\t\tlet selected = e.detail.selected;\n\t\t\tthis.toggleRowSelections(selected);\n\t\t}.bind(this));\n\t}\n\n\ttoggleRowSelections(selected, group) {\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\tif (rows && rows.length > 0) {\n\t\t\tfor (let row of rows) {\n\t\t\t\tif (group && (row.grouper || (row.groupie && row.groupie !== group)))\n\t\t\t\t\tcontinue;\n\t\t\t\tlet items = Polymer.dom(row.$.row.root).querySelectorAll('sb-table-cell.primary');\n\t\t\t\trow.selected = selected;\n\n\t\t\t\tfor (var i = 0, l = items.length; i < l; i++){\n\t\t\t\t\tthis.toggleClass('selected', selected, items[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleOneRowSelected() {\n\t\t// listen for selection changes to the list\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tlet selected = e.detail.selected; // true if selected, false if unselected\n\t\t\tlet recordId = e.detail.Id; // the id of the record that was just selected or unselected\n\t\t\tif (selected && !e.detail.group) {\n\t\t\t\tif (this.selectedRows === null)\n\t\t\t\t\tthis.selectedRows = {};\n\t\t\t\tthis.selectedRows[recordId] = {\n\t\t\t\t\trecord: {Id: recordId, attributes: e.detail.attributes, UnitPrice: e.detail.rowData.UnitPrice},\n\t\t\t\t\tinvalid: !!(e.detail.group)\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (!selected && !e.detail.group && this.selectedRows)\n\t\t\t\tdelete this.selectedRows[recordId];\n\n\t\t\tif (e.detail.group) // if grouped row was selected then select all of its expanded groupies\n\t\t\t\tthis.toggleRowSelections(selected, e.detail.group);\n\t\t}.bind(this));\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.header.selected = undefined; //if the header checkbox already is false, this is required so that all the rows get updated.\n\t\tthis.$.header.selected = false;\n\t}\n\n\tsetViewResults() {\n\t\tthis.selectedRows = {};\n\t\tlet viewResults = this.getViewResults(this.searchModel.results);\n\t\tthis.hasGroupedField = !!(this.groupByField);\n\n\t\t// no group field, then the view results are the search model results\n\t\tif (!this.hasGroupedField) {\n\t\t\tthis.viewResults = viewResults;\n\t\t\treturn;\n\t\t}\n\n\t\t// if viewResult already exists, clone the entire searchModel.results object so the dom-repeat will behave properly\n\t\tif (this.viewResults)\n\t\t\tviewResults = JSON.parse(JSON.stringify(this.getViewResults(this.searchModel.results)));\n\n\t\t// again if in mobile then the view results are simply the search model results\n\t\tif (this.isMobileViewport()) {\n\t\t\t// since no grouping in mobile, ensure all items have the hidden property to false\n\t\t\tthis.expandAll(viewResults);\n\t\t\tthis.viewResults = viewResults;\n\t\t\tthis.setGroupExpandedHandler(false);\n\t\t\treturn;\n\t\t}\n\n\t\t// we have a group by field and we are not in mobile, so lets apply the grouping\n\t\tlet groupFieldNames = [this.fieldSet.fields[0], 'Id']; // used to create grouper viewResult item in front of each set of grouped viewResults\n\t\tlet recordPath = 'record.' + this.searchModel.targetObjectName; // path from the searchModel.result item to the record object that contains the group\n\t\tlet groupCountPath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] , property: 'suffix' };\n\t\tlet groupFieldTypePath = { path: 'record._transient_.' + this.searchModel.targetObjectName + '.' + groupFieldNames[0] + '.md', property: 'type' };\n\n\t\t// initialize the grouper instance and group the viewResults\n\t\tlet grouper = new RecordGrouper(this.groupByField, groupFieldNames, recordPath, {hidden: true}, this.hiddenByGroup, {hidden: false}, groupCountPath, this.groupByFieldType, groupFieldTypePath);\n\t\tthis.viewResults = grouper.group(viewResults);\n\n\t\tthis.setGroupExpandedHandler(true);\n\n\t\t//if only one group then expand it by default\n\t\tif (this.viewResults.length === this.searchModel.results.length + 1) {\n\t\t\tthis.expandAll(this.viewResults);\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tlet groupRow = this.$$('sb-table-row'); // which must be the first row as only group\n\t\t\t\tgroupRow.grouperExpanded = true;\n\t\t\t\tthis.hiddenByGroup[groupRow.grouper] = {hidden: false};\n\t\t\t});\n\t\t}\n\t}\n\n\tgetViewResults(products) {\n\t\tlet prefix = this.org.prefix ? this.org.prefix + '__' : '';\n\t\tlet results = [];\n\t\tfor (let product of products || []) {\n\t\t\tlet result = {followed: product.followed, record: {}};\n\t\t\tfor (let field in product.record) {\n\t\t\t\tif (field === 'UnitPrice' && product.record.Product2[prefix + 'HidePriceInSearchResults__c']) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tresult.record[field] = product.record[field];\n\t\t\t}\n\t\t\tresults.push(result);\n\t\t}\n\t\treturn(results);\n\t}\n\n\texpandAll(viewResults) {\n\t\tfor (let i = 0, l = viewResults.length; i < l; i++)\n\t\t\tviewResults[i].hidden = false;\n\t}\n\n\tisSelected(row) {\n\t\tif (!this.selectedRows)\n\t\t\treturn false;\n\t\treturn !!(this.selectedRows[row.Id]);\n\t}\n\n\tisExpanded(group) {\n\t\treturn !!(this.hiddenByGroup[group] && this.hiddenByGroup[group].hidden === false);\n\t}\n\n\tsetGroupExpandedHandler(isGrouped) {\n\t\tthis.groupExpandedHandler = this.groupExpandedHandler || function (e) {\n\t\t\t\tthis.expandGroupedViewResults(e.detail.group, e.detail.expanded);\n\t\t\t}.bind(this);\n\t\tthis.removeEventListener('sb-row-group-tapped', this.groupExpandedHandler);\n\t\tif (isGrouped) this.addEventListener('sb-row-group-tapped', this.groupExpandedHandler);\n\t}\n\n\texpandGroupedViewResults(group, expanded) {\n\t\tfor (let i = 0, l = this.viewResults.length; i < l; i++) {\n\t\t\tif (group === this.viewResults[i].groupie)\n\t\t\t\tthis.set('viewResults.' + i + '.hidden', !expanded);\n\t\t}\n\t\tthis.hiddenByGroup[group] = {hidden: !expanded};\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t//when the searchModel.totalCount was 0, Polymer was not automatically updating the value through 2 way binding W-013313\n\t//additionally, we want the count to hide when it is 0 so we also update hasTotalCount\n\tupdateTotalCount() {\n\t\tif (this.searchModel.totalCount !== null)\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\tthis.hasTotalCount = this.totalCount > 0;\n\t}\n\n\t_getPrimaryMobileCols() {\n\t\tlet primaryMobileCols = [].concat(this.primaryMobileCols);\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone')) {\n\t\t\tlet parts = primaryMobileCols[0].split('.');\n\t\t\tlet prefix = parts.length > 1 ? (parts[0] + '.') : '';\n\t\t\tprimaryMobileCols[0] = prefix + this.fieldSet.fields[0];\n\t\t}\n\n\t\treturn primaryMobileCols;\n\t}\n}\n\nPolymer(LookupLayout);","export class Popup {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-popup';\n\t\tthis.properties = {\n\t\t\turl: String,\n\t\t\tmessenger: Object,\n\t\t\tchannel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sbQQ'\n\t\t\t},\n\t\t\tresponseMessage: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tclosePopup: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'sb-close-popup'\n\t\t\t},\n\t\t\tautoLaunched: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.close.bind(this));\n\t}\n\n\topen() {\n\t\tthis._initRpc();\n\t\tthis._sendMessage();\n\t\tthis._handleAutoLaunch();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tclose() {\n\t\tthis._close(this._getRedirectDetails(false));\n\t}\n\n\t_close(redirectDetails) {\n\t\tif(this.rpc) this.rpc.destroy();\n\t\tthis.$.dialog.toggle();\n\t\tlet frame = this.$.dialog.$$('#content').querySelector(`#easyXDM_${this.channel}_provider`);\n\t\tif(frame) frame.remove();\n\t\tthis.fire('iron-signal', { name: 'sb-navigation-changed' } ); // closes the action menu\n\t\tthis.fire(this.closePopup, { redirect: redirectDetails });\n\t}\n\n\t_initRpc() {\n\t\tif(!this.url)\n\t\t\treturn;\n\n\t\tthis.rpc = new easyXDM.Rpc(\n\t\t\t{ remote: this.url, container: this.$.dialog.$$('#content'), channel: this.channel },\n\t\t\t{ remote: { postMessage: {} }, local: { postMessage: this._receiveMessage.bind(this) }\n\t\t});\n\t}\n\n\t_sendMessage() {\n\t\tlet outgoing = {};\n\t\tif(this.messenger && typeof this.messenger.getRequest === 'function')\n\t\t\toutgoing = this.messenger.getRequest();\n\n\t\toutgoing.redirect = this._getRedirectDetails(this.autoLaunched);\n\t\tthis.rpc.postMessage(JSON.stringify(outgoing));\n\t}\n\n\t_handleAutoLaunch() {\n\t\tif(this.autoLaunched)\n\t\t\tthis.fire('iron-signal', { name: 'sb-auto-launch-popup' } );\n\t}\n\n\t_receiveMessage(incoming) {\n\t\tthis.debounce('_receiveMessage', function () {\n\t\t\tif(!this.messenger || typeof this.messenger.getResponse !== 'function') {\n\t\t\t\tthis.close();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet received = JSON.parse(incoming);\n\t\t\tthis._logReceivedMessage(received);\n\t\t\tthis.responseMessage = this.messenger.getResponse(received);\n\t\t\tlet redirectDetails = received.redirect ? received.redirect : this._getRedirectDetails(this.autoLaunched);\n\t\t\tthis._close(redirectDetails);\n\t\t}.bind(this), 100);\n\t}\n\n\t_logReceivedMessage(received) {\n\t\tconsole.log('RPC Received Message:');\n\t\tconsole.log(received);\n\t}\n\n\t_getRedirectDetails(redirect) {\n\t\treturn { auto: !!(redirect), save: !!(redirect) };\n\t}\n}\nPolymer(Popup);","export class SidePanel{\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-side-panel';\n\t\tthis.properties = {\n\t\t\trenderHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ticon: String,\n\t\t\tarrows: String,\n\t\t\t/**\n\t\t\t * Label for the side panel\n\t\t\t * @type {String}\n\t\t\t */\n\t\t\tsideText: String,\n\t\t\t/**\n\t\t\t * Boolean that hides and shows the panel slideout button\n\t\t\t * @type {Boolean}\n\t\t\t */\n\t\t\trightSideButton: Boolean\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setIcon(isOpen)']\n\t}\n\n\tcloseDrawer() {\n\t\tthis.fire('x-clicked');\n\t}\n\n\tkeyCheck(event) {\n\t\tif (event.keyCode == 13) {\n\t\t\tthis.fire('enter-keypress');\n\t\t}\n\t}\n\n\ttoggleDrawer() {\n\t\tthis.fire('side-toggle-clicked');\n\t}\n\n\tsetIcon() {\n\t\tif (this.isOpen === \"open\") {\n\t\t\tthis.icon = 'sf-icon-left';\n\t\t}\n\t\telse {\n\t\t\tthis.icon = 'sf-icon-right';\n\t\t\tthis.arrows = 'closedArrows';\n\t\t}\n\t}\n}\n\nPolymer( SidePanel );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class SwipeContainer {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-swipe-container';\n\n\t\tthis.listeners = {\n\t\t\t'expanded-changed': 'onGroupExpanded'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpreventSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisRequiredRowNotSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tgroupExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tswipeHeader: Object,\n\t\t\tswipeMenu: Object,\n\t\t\tswipeItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tswipeItemWidth: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 58\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_preventSwipe(isRequiredRowNotSelected)'\n\t\t];\n\t}\n\n\t_preventSwipe() {\n\t\tthis.preventSwipe = this.isRequiredRowNotSelected || this.groupExpanded;\n\t}\n\n\tonGroupExpanded(e) {\n\t\tthis.groupExpanded = e.detail.expanded;\n\t\tthis._preventSwipe();\n\t}\n\n\tattached() {\n\t\tlet isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tif (!isMobile || this.disableSwipe) {\n\t\t\tthis.style.minWidth = \"100%\";\n\t\t\tthis.style.position = \"static\";\n\t\t\treturn;\n\t\t}\n\n\t\tPolymer.dom(this.$.content).observeNodes(\n\t\t\tfunction(mutations) {\n\t\t\t\tfor (var i = 0; i < mutations.addedNodes.length; i++) {\n\t\t\t\t\tthis._findSwipeHeaderAndMenu(mutations.addedNodes[i]);\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t)\n\t}\n\n\t_findSwipeHeaderAndMenu(node) {\n\t\tif (node.nodeType === Node.TEXT_NODE || node.nodeType === Node.COMMENT_NODE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.id === 'swipe-header') {\n\t\t\tthis._initSwipeHeader(node);\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.id === 'swipe-menu') {\n\t\t\tthis._initSwipeMenu(node);\n\t\t\treturn;\n\t\t}\n\t}\n\n\n\t_initSwipeHeader(node) {\n\t\tvar swipeHeader = this.swipeHeader = node;\n\t\tvar swipeHeaderStyle = swipeHeader.style;\n\n\t\t// this.viewport is a necessary operand to pass a test in table-row that requires a viewport\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tswipeHeaderStyle.maxWidth = '100%';\n\t\t\tswipeHeaderStyle.display = 'table';\n\n\t\t\treturn;\n\t\t}\n\n\t\tswipeHeaderStyle.maxWidth = '50%';\n\t\tswipeHeaderStyle.position = 'relative';\n\n\t\tthis.listen(node, 'track', '_onTrack');\n\t\tthis.setScrollDirection('y', node);\n\t}\n\n\t_closeMenuWhenTapped(swipeMenu, swipeContainer) {\n\t\tswipeMenu.addEventListener('tap', function() {\n\t\t\tswipeContainer._animate(100, 1, swipeContainer.swipeHeader);\n\t\t});\n\t}\n\t_initSwipeMenu(node) {\n\t\tnode.style.maxWidth = '50%';\n\t\tthis._closeMenuWhenTapped(node, this);\n\n\t\tif (this.swipeItems && this.swipeItems.length) {\n\t\t\tfor (var k = 0; k < this.swipeItems.length; k++) {\n\t\t\t\tvar swipeItem = this.swipeItems[k];\n\t\t\t\tswipeItem.style.position = '';\n\t\t\t\tswipeItem.style.width = '0px';\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeMenu = node;\n\t\tvar allNodesOfSwipeMenu = [],\n\t\t\tswipeMenuItems = [];\n\n\t\t// if the browser supports shadowRoot (Chrome)\n\t\tif (node.children[0].shadowRoot) {\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS') {\n\t\t\t\tPolymer.dom(node.children[0].shadowRoot).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].shadowRoot.children;\n\t\t\t} else if (node.children[0].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t// else the browser doesn't support shadowRoot (Safari, Firefox)\n\t\t} else {\n\n\t\t\tif (node.children[0].nodeName === 'SB-ACTIONS') {\n\t\t\t\t// Necessary for when one action is displayed\n\t\t\t\tPolymer.dom(node.children[0]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children[0].children;\n\t\t\t} else if (node.children[1].nodeName === 'SB-CUSTOM-ACTION') {\n\t\t\t\tPolymer.dom(node.children[1]).flush();\n\t\t\t\tallNodesOfSwipeMenu = node.children;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (var i = 0, len = allNodesOfSwipeMenu.length; i < len; i++) {\n\t\t\tvar currentNode = allNodesOfSwipeMenu[i];\n\n\t\t\tif (this._isValidSwipeMenuItem(currentNode)) {\n\t\t\t\tswipeMenuItems.push(currentNode);\n\t\t\t}\n\t\t}\n\n\t\tthis.swipeItems = swipeMenuItems;\n\n\t\tvar width = this.swipeItemWidth * this.swipeItems.length;\n\n\t\tnode.style.width = width + 'px';\n\n\t\tfor (var j = 0, swipeItemsLen = this.swipeItems.length; j < swipeItemsLen; j++) {\n\t\t\tlet swipeItem  = this.swipeItems[j];\n\n\t\t\tthis.toggleClass('swipe-menu-item', true, swipeItem);\n\n\t\t\tvar speed = ((200 - ((swipeItemsLen - 1) * 20)) * swipeItemsLen);\n\n\t\t\tthis.style.transition  = 'transform ' + speed + 'ms ease-out';\n\t\t\tthis._setSwipeItemStyles(swipeItem.style, speed, width);\n\t\t}\n\t}\n\n\t_setSwipeItemStyles(swipeItemStyle, speed, width) {\n\t\tswipeItemStyle.transition               = 'transform ' + speed + 'ms ease-out';\n\t\tswipeItemStyle.webkitBackfaceVisibility = 'hidden';\n\t\tswipeItemStyle.borderRadius             = 0;\n\t\tswipeItemStyle.position                 = 'absolute';\n\t\tswipeItemStyle.left                     = 0;\n\t\tswipeItemStyle.height                   = '100%';\n\t\tswipeItemStyle.width                    = '57px';\n\t}\n\n\t_onTrack(event) {\n\t\tif (this.preventSwipe || !this.swipeItems.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar target = event.currentTarget,\n\t\t\ttrack = event.detail;\n\n\t\tif (track.state === 'track') {\n\t\t\tthis._trackMove(track, target);\n\t\t}\n\t}\n\n\t_trackMove(event, target) {\n\t\tthis._animate(event.dx, event.dy, target);\n\t}\n\n\t_animate(dx, dy, blah) {\n\t\tvar direction = dx > 0 ? 1 : -1;\n\n\t\tif (direction === -1 && Math.abs(dy) < 20 && dx < -60) {\n\t\t\tthis.fire('row-swiped', {'isOpen': true });\n\n\t\t\tvar cho = parseFloat(getComputedStyle(this.swipeItems[0]).width);\n\t\t\tvar nag = cho.toPrecision(5) * this.swipeItems.length;\n\n\t\t\tvar distance = nag * direction;\n\t\t\tthis.style.transform = 'translate3d(' + (distance) + 'px, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\n\t\t\tfor (var i = this.swipeItems.length - 1; i >= 0; i--) {\n\t\t\t\tvar dist = i * cho.toPrecision(5);\n\t\t\t\tthis.swipeItems[i].style.width = cho.toPrecision(5) + 'px';\n\t\t\t\tthis.swipeItems[i].style.transform = 'translate3d(' + dist +  'px, 0, 0)';\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (direction === 1 && Math.abs(dy) < 20 && dx > 25) {\n\t\t\tthis.fire('row-swiped', {'isOpen': false });\n\n\t\t\tvar originalPosition  = 0;\n\t\t\tthis.style.transform = 'translate3d(' + originalPosition + '%, 0, 0)';\n\t\t\tthis.style.webkitBackfaceVisibility = 'hidden';\n\n\t\t\tfor (var i = 0; i < this.swipeItems.length; i++) {\n\t\t\t\tvar trans = 'translate3d(' + originalPosition + '%, 0, 0)';\n\n\t\t\t\tthis.swipeItems[i].style.transform = trans;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_isValidSwipeMenuItem(currentNode) {\n\t\tif ((currentNode.nodeName.toLowerCase() === 'span' || (currentNode.$$ && currentNode.$$('span'))) && !currentNode.classList.contains('ignore-in-mobile')) {\n\t\t\tif (currentNode.$$ && currentNode.$$('span')) {\n\t\t\t\tvar fav = currentNode.$$('span');\n\n\t\t\t\tif ((fav.id === 'removeFromFavBtn' || fav.id === 'addToFavBtn') && (fav.style.display === 'none')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!currentNode.classList.contains('visibilityHidden')) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tcurrentNode.style.display = 'none';\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n}\n\nPolymer(SwipeContainer);","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thide: Object, // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, value, model, data)',\n\t\t\t'setDisabled(data.disabled)',\n\t\t\t'setRecordId(data.Id)',\n\t\t\t'overrideWidth(data.setItemToFullWidth)',\n\t\t\t'dataChanged(data, item)'\n\t\t];\n\t}\n\n\tbuildCell() {\n\t\tthis.setDisabled();\n\t\tthis.setHidden();\n\t\tthis.setRecordId();\n\t\tthis.setSuffix();\n\n\t\tif (this.model && this.model[this.item] && this.model[this.item].type) {\n\t\t\tthis.setFieldMetadataFromModel();\n\t\t\treturn;\n\t\t}\n\t\t// if no model then infer the type based on the item name\n\t\tlet type = 'string';\n\t\tthis.md = this.md || {type: type};\n\t}\n\n\tsetDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\tsetHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tthis.hide = new FieldHider(hidden).hide;\n\t}\n\n\tsetRecordId() {\n\t\tthis.recordId = this.data ? this.data.Id : null;\n\t}\n\n\tsetSuffix() {\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'suffix']) != null)\n\t\t\tthis.suffix = this.get(['data', '_transient_', this.item, 'suffix']);\n\t\telse\n\t\t\tthis.suffix = undefined;\n\t}\n\n\toverrideWidth() {\n\t\tif (this.data && this.data.fullWidthItem && this.classList.contains(this.data.fullWidthItem)) this.style.width = '100%';\n\t\telse if (this.style.width == '100%') this.style.width = null;\n\t}\n\n\tsetFieldMetadataFromModel() {\n\t\tlet md = this.model[this.item];\n\t\t// lets check if the data has an override metadata property for this particular item, if so lets use it\n\t\tif(this.data && this.data['_transient_'] && this.get(['data', '_transient_', this.item, 'md']) != null)\n\t\t\tmd = this.get(['data', '_transient_', this.item, 'md']);\n\t\t// set this programmatically before assigning md to ensure they are set in FF before the render function\n\t\tthis.$.field.link = !!(md.link);\n\t\tthis.$.field.readOnly = true;\n\t\t// now we set the metadata to trigger the sb-field processing\n\t\tthis.md = md;\n\t}\n\n\tdataChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n}\n\nPolymer(TableCell);","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableCellSelect {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-cell-select';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tisRadio: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isRadio(item)'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'init'\n\t\t\t}\n\t\t}\n\t}\n\n\tinit() {\n\t\tPolymer.dom(this.$.s).observeNodes(function () {\n\t\t\tthis._setDisabled();\n\t\t\tthis._setHidden();\n\t\t}.bind(this));\n\t}\n\n\t_isRadio() {\n\t\treturn this.item === 'radio';\n\t}\n\n\t_setDisabled() {\n\t\tthis.disabled = !!(this.data && this.data.disabled);\n\t}\n\n\t_setHidden() {\n\t\tlet hidden = !this.data ? false : this.data.hidden;\n\t\tlet hider = new FieldHider(hidden, Polymer.Base);\n\t\thider.applyTo(this.$$('#' + this.item));\n\t}\n}\n\nPolymer(TableCellSelect);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class TableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-header';\n\t\tthis.properties = {\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tselectable: Boolean, // true if the row's left most column selectable\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\theaderClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\theaderActions: Array,\n\t\t\thideHiddenSelectable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\tget observers() {\n\t\treturn [ 'buildLabels(cols, headerClassMap)',\n\t\t\t'setSelectable(selectable, selectionType)',\n\t\t\t'setSelected(selected, selectable, selectionType)'];\n\t}\n\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tbuildLabels() {\n\t\tvar data = {};\n\t\tvar group = [];\n\t\tthis.cols.forEach(function (col) {\n\t\t\tif (!col)\n\t\t\t\treturn;\n\n\t\t\tvar item = col.replace(/\\W/g, '');\n\t\t\tgroup.push(item);\n\t\t\tdata[item] = col;\n\t\t});\n\n\t\tthis.$.header.data = undefined;\n\t\tthis.$.header.itemClassMap = this.headerClassMap;\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = group;\n\t\tthis.$.header.data = data;\n\t}\n\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tthis.$.selection.addEventListener('data-changed', function (e) {\n\t\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\t\tthis.internal = false;\n\t\t\tthis.fire('header-selection-changed', {selected: this.selected});\n\t\t}.bind(this));\n\t}\n\n\tsetSelected() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tlet key = this.selectionType === 'radio' ? 'radio' : 'checkbox';\n\t\tif(!this.$.selection.group)\n\t\t\tthis.$.selection.group = [key];\n\t\tlet selectionData = {};\n\n\t\tlet value = this.selected;\n\t\tselectionData[key] = value;\n\t\tlet hidden = new FieldHider(!this.selectable).hide;\n\t\thidden.type = 'invisible';\n\t\tselectionData.hidden = hidden;\n\t\tthis.$.selection.data = selectionData;\n\n\t\tlet hideSelection = this.hideHiddenSelectable ? !this.selectable : false;\n\t\tthis.toggleClass('hidden', hideSelection, this.$.selection);\n\t}\n\n\t_showHeaderActions(position) {\n\t\tif (!this.headerActions || this.headerActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.headerActions.length; i < l; i++) {\n\t\t\tif (this.headerActions[i].position == position && !this.headerActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\nPolymer(TableHeader);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FieldHider} from 'common/layout/fields/FieldHider.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class TableRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tcell: String, // name of the component that represents an table cell in the row\n\t\t\tcols: Array, // array of strings that represents the columns\n\t\t\tcolsDisplay: Object,// map whose keys match the cols array items and value is used for display purposes\n\t\t\trowActions: Array, // array of strings that represents actions for the options\n\t\t\trouteSource: String,\n\t\t\trowData: { // contains the group data that can be de-referenced using the values inside of the group array\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { // object to pass through to each cell item component (optional)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trequiresModel: { // set to true if model in your use case is not optional and you do not want to build rows until model is not null\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectable: {// true if the row's left most column is selectable\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselected: { // true if the row is selectable and should be selected\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectionType: { // \"checkbox\" for checkbox or \"radio\" for radio\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'checkbox'\n\t\t\t},\n\t\t\tdisabledData: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {\n\t\t\t\t\t'disabled': false,\n\t\t\t\t\t'constrained': false\n\t\t\t\t}\n\t\t\t},\n\t\t\tselectionIdDataPath: { // path on the data object that contains the selection id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Id'\n\t\t\t},\n\t\t\tparentIdDataPath: { // path on the data object that contains the parent's id\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Parent'\n\t\t\t},\n\t\t\tparentAttributesPath: String, // if on selection you want the data attribute property, specify the path\n\t\t\tprimaryMobileCols: { // columns whose value will be primary display for this row when in the mobile viewport\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\trepeatPrimaryMobileCols: { // if true then the primary columns should be repeated in the mobile drawer\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: 'setIsMobile(viewport)'\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setActionId(isMobile)'\n\t\t\t},\n\t\t\tgrouper: String, // if non nil then this row represents a group and can show/hide its groupie rows.\n\t\t\tgrouperExpanded: Boolean, // if true then the grouper row should default in the expanded state\n\t\t\tgroupie: String, // if non nil indicates what group this row is a groupie of and therefore can be shown or hidden by its grouper row\n\t\t\tignoreViewportChange: Boolean,\n\t\t\trowClassMap: {\n\t\t\t\ttype: Object, // map of field to its type\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\teditFirstWhenSelected: { // enables editing to the provided child element of the first cell when the row is selected\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tindex: Number, // the index of the row in the context of its table container\n\t\t\tdisableSwipe: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideSelection: { // this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tselectionClass: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tleftClass: { // class to adjust red line on required configurations for selection method of not add\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '',\n\t\t\t\tcomputed: 'setLeftClass(routeSource, rowData, selected)'\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildRow(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap)',\n\t\t\t'setSelectable(selectable)',\n\t\t\t'setSelected(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass)',\n\t\t\t'setGrouper(rowData, grouper)',\n\t\t\t'setGrouperClasses(grouperExpanded, grouper)'\n\t\t];\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.expandDisabled = e.detail.isOpen;\n\t}\n\n\tsetIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\tsetActionId(isMobile) {\n\t\treturn isMobile ? 'swipe-menu' : '';\n\t}\n\n\tbuildRow() {\n\t\tif(this.requiresModel && !this.model)\n\t\t\treturn; // bail if requires model and model is not yet non nil\n\n\t\tthis.$.row.groupDisplay = undefined;\n\t\tthis.expanded = false;\n\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t\tthis.$.row.itemClassMap = this.rowClassMap;\n\t\tthis.$.row.groupDisplay = this.colsDisplay;\n\t\tif(!this.$.row.group)\n\t\t\tthis.$.row.group = this.cols;\n\t}\n\n\tsetSelectable() {\n\t\tif (!this.selectable)\n\t\t\treturn;\n\n\t\tthis.$.selection.addEventListener('data-changed', function(e) {\n\t\t\tlet selected = this.selected;\n\t\t\tthis.internal = true; // internal setting of this.selected so do not execute the implementation of the setSelected observer below\n\t\t\tthis.selected = typeof e.detail.value[this.selectionType] !== 'undefined' ? e.detail.value[this.selectionType] : e.detail.value;\n\t\t\tthis.$.row.selected = this.selected;\n\t\t\tthis.internal = false;\n\n\t\t\tlet changed = selected !== this.selected;\n\t\t\tlet path = e.detail.path === 'data.checkbox' || e.detail.path == 'data.radio';\n\t\t\tif(this.editFirstWhenSelected && this.selected && changed)\n\t\t\t\tthis.editFirst();\n\n\t\t\t// afterNextRender ensures row is built out before firing the selection event\n\t\t\t//// product rules should only fire when path originates from selection group.\n\t\t\t//// check is made in ProductConfig handleChangeEvents\n\t\t\tPolymer.RenderStatus.afterNextRender(this, this.fireSetSelectionEvent.bind(this, changed, path));\n\t\t}.bind(this));\n\t}\n\n\teditFirst() {\n\t\tlet itemToEdit = this.$.row.$$(this.cell).$$(this.editFirstWhenSelected);\n\t\tif(itemToEdit && typeof itemToEdit.edit === 'function')\n\t\t\titemToEdit.edit()\n\t}\n\n\tfireSetSelectionEvent(changed, path) {\n\t\tthis.fire('selection-changed', {\n\t\t\tselected: this.selected,\n\t\t\tselectionType: this.selectionType,\n\t\t\tId: this.get('rowData.' + this.selectionIdDataPath),\n\t\t\tbundleId: this.get('rowData.' + this.parentIdDataPath),\n\t\t\tattributes: this.parentAttributesPath === undefined ? undefined : this.get('rowData.' + this.parentAttributesPath),\n\t\t\tgroup: this.grouper,\n\t\t\tchanged: changed,\n\t\t\tpath: path,\n\t\t\tindex: this.index,\n\t\t\trowData: this.rowData\n\t\t});\n\t}\n\n\tsetSelected() {\n\t\tif (!this.selectable || this.internal)\n\t\t\treturn;\n\n\t\tthis._setSelected(this.selected);\n\t}\n\n\t_setSelected(selected) {\n\t\tif (this.disabledData.constrained && selected === true) {\n\t\t\tthis.internal = true;\n\t\t\tthis.$.row.fire('group-selected', {selected: false});\n\t\t\tselected = false;\n\t\t\tthis.internal = false;\n\t\t}\n\n\t\tlet defaultHidden = new FieldHider(this.routeSource === 'Configurator' && this.hasDeleteAction()).hide;\n\t\tif(this.hideSelection != null) {\n\t\t\tlet hidden = new FieldHider(this.hideSelection).hide;\n\t\t\tPolymer.Base.extend(defaultHidden, hidden); // union this components hideSelection with the default\n\t\t}\n\n\t\tthis.selectionData = { hidden: defaultHidden };\n\t\tthis.selectionData[this.selectionType] = selected;\n\t\tthis.selectionData.disabled = this.disabledData.disabled || this.disabledData.constrained;\n\t\tthis.$.selection.data = this.selectionData;\n\t\t//W-013831: select all was taking 1-2 seconds because we were rebuilding the group every time\n\t\t//there is no known use case at this time for rebuilding the group so adding this if check\n\t\tif(this.$.selection.group === undefined)\n\t\t\tthis.$.selection.group = [this.selectionType];\n\t\tthis.toggleClass('td', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selectionContainer);\n\t\tthis.toggleClass('innerTd', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tthis.toggleClass('selection', this.selectable && !defaultHidden.hidden || defaultHidden.type === 'invisible', this.$.selection);\n\t\tif(this.selectionClass)\n\t\t\tthis.toggleClass(this.selectionClass, true, this.$.selection);\n\t}\n\n\tselect(e) {\n\t\tif(this.selectionData !== undefined && this.selectionData.disabled === true)\n\t\t\treturn;\n\t\tlet rootTarget = Polymer.dom(e).rootTarget;\n\t\tlet tagName = rootTarget && rootTarget.tagName ? rootTarget.tagName.toLowerCase() : '';\n\t\tif(tagName === 'sb-group')\n\t\t\tthis._setSelected(!this.selected);\n\n\t\tthis.$.row.fire('group-selected', {\n\t\t\tselected: this.selected,\n\t\t\tselectionDisabled: this.selectionDisabled,\n\t\t\ttableRow: this\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tif(this.expandDisabled)\n\t\t\treturn;\n\n\t\tlet path = e.detail && e.detail.preventer ? Polymer.dom(e.detail.preventer).path : Polymer.dom(e).path;\n\t\tthis.$.row.fire('group-expanded', {path: path});\n\t}\n\n\tsetPrimaryMobileColumnsIfMobileViewport() {\n\t\tthis.$.row.numPrimary = this.primaryMobileCols.length;\n\t\tthis.$.row.primaryItems = this.isMobileViewport() ? this.primaryMobileCols : null;\n\t\tthis.$.row.includePrimaryInSecondary = this.isMobileViewport() ? this.repeatPrimaryMobileCols :false;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tif (this.ignoreViewportChange)\n\t\t\treturn;\n\t\tthis.setPrimaryMobileColumnsIfMobileViewport();\n\t}\n\n\tsetGrouper() {\n\t\tlet isGrouper = !this.isMobileViewport() && !!(this.grouper);\n\t\tthis.toggleClass('groupTr', isGrouper, this);\n\t\tthis.toggleClass('groupTd', isGrouper, this.$.row);\n\t\tthis.toggleClass('groupExpandTd', isGrouper, this.$.rowDiv);\n\t\tthis.setGrouperToggle(isGrouper);\n\t\tif (isGrouper) this.rowData.fullWidthItem = 'firstInnerTd';\n\t\telse this.rowData.fullWidthItem = null;\n\t}\n\n\tsetGrouperToggle(isGrouper) {\n\t\tthis._toggleGroupHandler = this._toggleGroupHandler || this.toggleGroupHandler.bind(this);\n\t\tthis.$.rowDiv.removeEventListener('tap', this._toggleGroupHandler);\n\t\tif (isGrouper) this.$.rowDiv.addEventListener('tap', this._toggleGroupHandler);\n\t}\n\n\ttoggleGroupHandler(e) {\n\t\tlet expected = e.detail && e.detail.expand;\n\t\tlet eventTarget = Polymer.dom(e).localTarget;\n\t\tlet isExpanded = Polymer.dom(eventTarget).classList.contains('expanded');\n\t\tisExpanded = isExpanded || !!(Polymer.dom(eventTarget).querySelector('.expanded'));\n\t\tif (expected === isExpanded)\n\t\t\treturn; // we are done since we are already in the expected expanded state\n\n\t\tthis.setGrouperClasses(!isExpanded);\n\t\tthis.fire('sb-row-group-tapped', {expanded: !isExpanded, group: this.grouper});\n\t}\n\n\tsetGrouperClasses(expanded) {\n\t\tthis.toggleClass('expanded', expanded, this.$.row);\n\t\tthis.toggleClass('expanded', expanded, this);\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tdisplayRowActions(position) {\n\t\tif (!position) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!this.rowActions || this.rowActions.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( let i = 0, l = this.rowActions.length; i < l; i++) {\n\t\t\tif (this.rowActions[i].position == position && !this.rowActions[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\thasDeleteAction() { // TODO: move logic outside of tablerow\n\t\tfor (let action of this.rowActions) {\n\t\t\tif (action.title === 'Delete')\n\t\t\t\treturn true;\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t_configurationRequired() {\n\t\tif(this.routeSource !== 'Configurator' || !this.rowData.configurationRequired || !this.selected || !!this.rowData.configured) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetLeftClass() {\n\t\tif(this._configurationRequired()) {\n\t\t\tif(!this.rowData.added) {\n\t\t\t\treturn 'left';\n\t\t\t}\n\t\t}\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', this.cell, 'swipe-header');\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n}\nPolymer(TableRow);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Tabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-tabs';\n\t\tthis.properties = {\n\t\t\t// array of tab objects with the following properties\n\t\t\t// \t\tname: String - name of the tab\n\t\t\t// \t\tlabel: String - display label of the tab\n\t\t\t// \t\tpageComponent: String - page component of the tab, if undefined use sb-tabs.pageComponent\n\t\t\t// \t\tbind: Array - list of sb-tabs properties to be bound to this tab's pageComponent, if undefined use sb-tabs.bind\n\t\t\t//      iconId: icon Id\n\t\t\t//      iconClass: name of clickable icon next to the tab\n\t\t\t//      iconEvent: event name when icon is ontap\n\t\t\ttabs: Array,\n\t\t\tpageComponent: { // name of dynamic page component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tpageData: { // object with keys that match the tab.name so each page can get page specific data\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcommonData: { // object that will be passed through to all pages\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tselectedTabIndex: { // the index of the current selected tab\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tselectedPageIndex: { // the index of the current selected page\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\ttabsClass: { // class value of the paper-tabs sub component\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tusePagination: { // if true use pagination widget to navigate through tabs\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpaginationClass: { // class value of the div wrapper of sb-pagination if usePagination is true\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'horizontal layout center-justified'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttabLimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\trendered: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toverflowTab: Object,\n\t\t\toverflowTabClass: String,\n\t\t\toverflowTabMenuClass: String,\n\t\t\tmenuMaskClass: String,\n\t\t\tbindingData: { // object of key value pairs that represent 2-way bound data between page components and this host component\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tbind: { // array of sb-tabs bound properties that should be bound to each page component, unless overridden for a given page via the tab object in the sb-tabs.tabs array\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tattributes: { // array of objects in which each object has an name and value property that represents static attributes to bind to the page component\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\thideTabs: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tpageElements: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'render(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes)',\n\t\t\t'setPaginationListener(usePagination)',\n\t\t\t'updateData(pageData.*)',\n\t\t\t'updateData(commonData.*)',\n\t\t\t'_handleSelectedChanged(selectedPageIndex, pageElements)'\n\t\t];\n\t}\n\n\trender() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis._buildTabs();\n\t\tPolymer.dom(this.$.paperTabs).observeNodes(function () {\n\t\t\tthis.rendered = true;\n\t\t\tif (!this.tabs || this.tabs.length <= 0) return;\n\t\t\tthis._viewportChanged();\n\t\t}.bind(this));\n\t}\n\n\tdestroyTabs() {\n\t\tif (!this.template)\n\t\t\treturn;\n\t\t// the tabs have change, so we must remove the previous tabs set and rebuild the tabs\n\t\ttry {\n\t\t\tlet pages = Polymer.dom(this.$.pages);\n\t\t\tlet childNodes = pages.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tpages.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tPolymer.dom.flush(); // have to flush for Firefox\n\t\t\tthis.template = null;\n\t\t\tthis.selectedTabIndex = 0;\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_enforceValidTabSelected() {\n\t\tif (isNaN(this.selectedPageIndex) || this.tabs && this.tabs.length <= this.selectedPageIndex || this.selectedPageIndex < 0 || this.selectedPageIndex % 1 !== 0) {\n\t\t\tthis.selectedPageIndex = 0;\n\t\t}\n\t}\n\n\t_buildTabs() {\n\t\tif(this.template) {\n\t\t\tthis._initTemplateData(this.template);\n\t\t\treturn;\n\t\t}\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tthis._buildPages(this.template);\n\t\tthis._initTemplateData(this.template);\n\t\tPolymer.dom(this.$.pages).appendChild(this.template);\n\t\t// Run a dom flush to update page after appending child\n\t\tPolymer.dom.flush();\n\t\t// observe for when the page components are bound to the DOM so we can bind events to them\n\t\tPolymer.dom(this.$.pages).observeNodes(function (info) {\n\t\t\tfor (let i = 0, l = info.addedNodes.length; i < l; i++)\n\t\t\t\tthis.pageElements = this.pageElements.concat(Polymer.dom(info.addedNodes[i]).childNodes)\n\n\t\t\tthis.bindElementEvents(this.pageElements);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @param elements - the page elements\n\t */\n\tsetPageElements(elements) {\n\t\tfor(let element of elements || [])\n\t\t\tthis.pageElements.push(element)\n\t}\n\n\t_initTemplateData(template) {\n\t\ttemplate.pageData = this.pageData;\n\t\ttemplate.commonData = this.commonData;\n\t\tfor (let key in this.bindingData)\n\t\t\ttemplate[key] = this.bindingData[key];\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tthis.templateBindData(template);\n\t}\n\n\t_buildPages(template) {\n\t\tlet doc = template.content.ownerDocument;\n\t\tthis._bind = [];\n\t\tthis.tabs.forEach(function (tab) {\n\t\t\tlet page = tab.pageComponent || this.pageComponent;\n\t\t\tif(!page) return;\n\t\t\tlet d = doc.createElement('div');\n\t\t\tlet elem = doc.createElement(page);\n\t\t\tPolymer.dom(elem).setAttribute('name', tab.name);\n\t\t\tPolymer.dom(elem).setAttribute('label', tab.label);\n\t\t\tPolymer.dom(elem).setAttribute('tabs', true); //lets a component know it was stamped in from a tab\n\t\t\tPolymer.dom(elem).setAttribute('key', tab.key);\n\t\t\tPolymer.dom(elem).setAttribute('page-data', '[[pageData.' + tab.name + ']]');\n\t\t\tPolymer.dom(elem).setAttribute('common-data', '[[commonData]]');\n\t\t\tfor(let key in this.bindingData)\n\t\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\n\t\t\t// set any static attributes provided\n\t\t\tlet attributes = tab.attributes || this.attributes || {};\n\t\t\tfor(let attr of attributes)\n\t\t\t\tPolymer.dom(elem).setAttribute(attr.name, attr.value);\n\n\t\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\t\tthis.appendBindData(tab, elem);\n\t\t\tPolymer.dom(d).appendChild(elem);\n\t\t\tPolymer.dom(template.content).appendChild(d);\n\t\t}.bind(this));\n\t}\n\n\tappendBindData(tab, elem) {\n\t\tlet bind = tab.bind || this.bind;\n\t\tif(!bind) return;\n\n\t\tthis._bind = this._bind.concat(bind.filter(function (item) {\n\t\t\treturn this._bind.indexOf(item) < 0;\n\t\t}.bind(this)));\n\n\t\tfor(let key of bind) {\n\t\t\tPolymer.dom(elem).setAttribute(Polymer.CaseMap.camelToDashCase(key), '{{' + key + '}}');\n\t\t\t// this forces direct assignments of bound data to delegate through _propertyChanged because the property now has an effector\n\t\t\tthis._addComplexObserverEffect(`updateData(${key})`);\n\t\t}\n\t}\n\n\ttemplateBindData(template) {\n\t\tthis.requiresTemplateBindData = this._bind && this._bind.length > 0;\n\t\tfor(let bind of this._bind) {\n\t\t\tif(this.__data__[bind] && (this.__data__[bind] !== this[bind]) || this[bind] === undefined) {\n\t\t\t\t// calling _addComplexObserverEffect in top level tabs requires this trick in lower level tabs for same binding\n\t\t\t\tthis[bind] = this.__data__[bind];\n\t\t\t}\n\n\t\t\tif(this[bind] !== undefined) {\n\t\t\t\tthis.requiresTemplateBindData = false;\n\t\t\t\ttemplate[bind] = this[bind];\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayPage(selectedTabIndex) {\n\t\tlet selectedTab = Polymer.dom(this.$.paperTabs).querySelectorAll('paper-tab')[selectedTabIndex];\n\n\t\tif (selectedTab != null) {\n\t\t\tif (selectedTab.id === 'overflowTab' && selectedTabIndex != 0) {\n\t\t\t\treturn this.selectedPageIndex;\n\t\t\t}\n\t\t}\n\t\tthis.selectedPageIndex = +selectedTabIndex;\n\t\treturn selectedTabIndex;\n\t}\n\n\tsetPaginationListener() {\n\t\tif (this.usePagination) {\n\t\t\tthis.addEventListener('pagination-changed', function (e) {\n\t\t\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\t\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\t\t\tlet tabLimit = this.tabLimit;\n\t\t\t\tlet tabLength = this.tabs.length;\n\n\t\t\t\tthis.selectedTabIndex = e.detail.index;\n\n\t\t\t\t//If an overflowed tab is selected when there is overflow\n\t\t\t\tif (this.selectedTabIndex >= tabLimit && tabLength - 1 > tabLimit) {\n\t\t\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[this.selectedTabIndex].label);\n\t\t\t\t\t// Fixed this to use the getElementsByTagName so that it can add additional elements inside the paper tabs so that it will grab element correctly.\n\t\t\t\t\tpaperTabs.selected = paperTabs.getElementsByTagName('paper-tab').length - 1;\n\t\t\t\t\tthis.$$('#pagination').pageIndex = +e.detail.index;\n\t\t\t\t\t//if there is overflow and a nonoverflowed tab is selected\n\t\t\t\t} else if (tabLength - 2 > tabLimit) {\n\t\t\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcloseMenu(isMenuItemSelected) {\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tthis.overflowTabMenuClass = '';\n\t\tthis.menuMaskClass = '';\n\n\t\t//If a tab in the overflowTabMenu is not selected and the currently selected page is not from an overflow tab\n\t\tif (isMenuItemSelected !== true && selectedPage < this.tabLimit) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t}\n\t}\n\n\tupdateData(e) {\n\t\tif (this.template && e && e.path)\n\t\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tselectTab(e) {\n\t\tlet index = parseInt(e.currentTarget.id);\n\t\tlet overflowTab = Polymer.dom(this.$.paperTabs.querySelector('#overflowTab')).node;\n\t\tlet tabLimit = this.tabLimit;\n\n\t\t//If a tab in the overflowTabMenu is selected\n\t\tif (Number.isInteger(index)) {\n\t\t\tthis.selectedPageIndex = index;\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tPolymer.dom(this.$.pages).node.selected = index;\n\t\t\tthis.set('tabs.' + index + '.className', 'overflow selected');\n\t\t\tthis.overflowTab = this.tabs[index];\n\t\t\tif ( this.tabs[index].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[index].iconId + '-overflow');\n\t\t\t\tthis.toggleClass('hideIconClass', false, iconSpan);\n\t\t\t}\n\n\t\t\tthis._displayOverflowTabName(overflowTab, e.currentTarget.textContent);\n\t\t\tthis.overflowTabClass = 'overflowTab iron-selected';\n\t\t\tthis.closeMenu(true);\n\t\t} else if (this.tabs.length - 1 > tabLimit) {\n\t\t\tthis._deselectPreviouslySelectedTab();\n\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabLimit].label);\n\t\t}\n\t}\n\n\t/**\n\t * Handle the icon is being clicked on the tab\n\t * Fire an event\n\t *\n\t * @param e - event details with the dialog and tab id info\n\t * @event event_name + '-tapped'. Event is fired with the dialog and tab id info\n\t *\n\t * @private\n\t */\n\t_handleEvent(e) {\n\t\tlet event = e.currentTarget.getAttribute('data-tap-event');\n\t\tlet id = e.currentTarget.getAttribute('id');\n\t\tlet firedEventName = (event != null) ? event : ('tab-' + Polymer.CaseMap.camelToDashCase(id));\n\t\tthis.fire ( firedEventName +'-tapped', {\n\t\t\tevent: event,\n\t\t\tId: id\n\t\t});\n\t}\n\n\tshowMenu() {\n\t\tthis.overflowTabMenuClass = 'showOverflowTabMenu';\n\t\tthis.menuMaskClass = 'showMenuMask';\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_displayOverflowTabName(overflowTab, tabToDisplay) {\n\t\tif (tabToDisplay.length > 7) {\n\t\t\ttabToDisplay = `${tabToDisplay.slice(0, 7)} ...`;\n\t\t}\n\n\t\tPolymer.dom(overflowTab).firstChild.textContent = tabToDisplay;\n\t\tthis.overflowTabClass = 'overflowTab';\n\t}\n\n\t_handleOverFlow() {\n\t\t//todo: Handle hiding filtered overflow tabs\n\t\tlet paperTabs = Polymer.dom(this.$.paperTabs).node;\n\t\tlet selectedPage = this.selectedPageIndex;\n\t\tlet overflowTab = Polymer.dom(paperTabs.querySelector('#overflowTab')).node;\n\t\tlet pagination = Polymer.dom(this.$$('#pagination')).node;\n\t\tlet tabLimit = this.tabLimit;\n\t\tlet tabLength = this.tabs.length;\n\t\tlet tabClassName, tabIndex;\n\n\t\tthis.overflowTabClass = '';\n\n\t\tfor (let i = 0; i < tabLength; i++) {\n\t\t\ttabClassName = 'noOverflow';\n\t\t\ttabIndex = tabLimit;\n\n\t\t\tif (i >= tabLimit) {\n\t\t\t\t//if there is overflow\n\t\t\t\tif (tabLength - 1 > tabLimit) {\n\t\t\t\t\t// If at last tab (the last tab is the overflow tab - a place holder tab for the tabMenu)\n\t\t\t\t\tif (i === tabLength - 1) {\n\t\t\t\t\t\tif (selectedPage >= tabLimit) {\n\t\t\t\t\t\t\ttabIndex = selectedPage;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.overflowTab = this.tabs[tabIndex];\n\t\t\t\t\t\tthis._displayOverflowTabName(overflowTab, this.tabs[tabIndex].label);\n\t\t\t\t\t}\n\t\t\t\t\ttabClassName = 'overflow';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Icon should be shown in the following scenario:\n\t\t\t// 1. Not at overflow tab\n\t\t\t// 2. On overflow tab and the first one on the list\n\t\t\tif (this.tabs[i].iconId ) {\n\t\t\t\tlet iconSpan = this.$$('#' + this.tabs[i].iconId);\n\t\t\t\tlet hideIcon =  (!(tabClassName == 'noOverflow' || (tabClassName == 'overflow' && i >= tabLimit && i != tabLength - 1)));\n\t\t\t\tthis.toggleClass('hideIconClass', hideIcon, iconSpan);\n\n\t\t\t\tif (tabClassName == 'overflow' && i === selectedPage) {\n\t\t\t\t\tlet overflowIconSpan = this.$$('#' + this.tabs[i].iconId + '-overflow');\n\t\t\t\t\tthis.toggleClass('hideIconClass', false, overflowIconSpan);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.set('tabs.' + i + '.className', i === selectedPage ? tabClassName + ' iron-selected' : tabClassName);\n\t\t}\n\n\t\t// If there is overflow and a non overflowed tab is selected or if ther e is no overflow and the last tab is selected\n\t\tif (selectedPage < tabLimit || (tabLength - 1 === tabLimit && selectedPage === tabLimit)) {\n\t\t\tthis.selectedTabIndex = selectedPage;\n\t\t\tthis.set('tabs.' + selectedPage + '.className', this.tabs[selectedPage].className.replace(' selected', ''));\n\t\t\t// If there is overflow and a overflowed tab is selected\n\t\t} else if (selectedPage >= tabLimit) {\n\t\t\tpaperTabs.selected = tabLength;\n\t\t\tthis.overflowTabClass = 'overflowTab iron-selected';\n\t\t\tthis.set('tabs.' + selectedPage + '.className', 'overflow selected');\n\t\t}\n\n\t\tif (this.usePagination) {\n\t\t\tif (pagination != null) {\n\t\t\t\tpagination.pageIndex = selectedPage;\n\t\t\t}\n\t\t}\n\t}\n\n\t_handleSelectedChanged() {\n\t\tthis._enforceValidTabSelected();\n\t\tthis.fire('selected-page-changed', this.selectedPageIndex);\n\t\tthis.fireTabSelected();\n\t}\n\n\tfireTabSelected() {\n\t\t//if there is a page for the selected tab, fire an event that the tab has been clicked\n\t\tif(this.pageElements.length > this.selectedPageIndex)\n\t\t\tthis.pageElements[this.selectedPageIndex].fire('sb-tab-selected');\n\t}\n\n\t_deselectPreviouslySelectedTab() {\n\t\tlet tabIndex = parseInt(Polymer.dom(this.$.overflowTabMenu.querySelector('.selected')).node.id);\n\n\t\tif (Number.isInteger(tabIndex)) {\n\t\t\tthis.set('tabs.' + tabIndex + '.className', this.tabs[tabIndex].className.replace(' selected', ''));\n\t\t}\n\t}\n\n\t_viewportChanged() {\n\t\tif (this.rendered) {\n\t\t\tif (this.viewport && this.viewport.XL.up) {\n\t\t\t\tthis.tabLimit = 8;\n\t\t\t} else if (this.viewport && this.viewport.L.up) {\n\t\t\t\tthis.tabLimit = 6;\n\t\t\t} else if (this.viewport && this.viewport.M.up) {\n\t\t\t\tthis.tabLimit = 5;\n\t\t\t} else if (this.viewport && this.viewport.S.up) {\n\t\t\t\tthis.tabLimit = 3;\n\t\t\t} else if (this.viewport && this.viewport.XS.up) {\n\t\t\t\tthis.tabLimit = 2;\n\t\t\t}\n\t\t\tthis._handleOverFlow();\n\t\t}\n\t}\n\n\tbindElementEvents(elements) {\n\t\tvar numElements = elements ? elements.length : 0;\n\t\tif (numElements == 0)\n\t\t\treturn;\n\n\t\tthis.fireTabSelected();\n\t\tfor (let key in this.bindingData) {\n\t\t\tlet dashKey = Polymer.CaseMap.camelToDashCase(key);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components (if notify: true) up to parent component\n\t\t\t\telements[i].addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\t// propagates value changes from parent component down to each page component\n\t\t\tthis.domHost.addEventListener(dashKey + '-changed', function (e) {\n\t\t\t\tif (!e.detail.path)\n\t\t\t\t\treturn;\n\t\t\t\tfor (let i = 0; i < numElements; i++)\n\t\t\t\t\telements[i].set(e.detail.path, e.detail.value);\n\t\t\t}.bind(this));\n\t\t}\n\n\t\t// new mechanism to bind data which should deprecate previous approach that relied on pageData, commonData, & bindingData\n\t\tfor (let bind of this._bind) {\n\t\t\tlet dashBind = Polymer.CaseMap.camelToDashCase(bind);\n\t\t\tfor (let i = 0; i < numElements; i++) {\n\t\t\t\t// propagates bound data changes from page components to the parent of this sb-tabs component\n\t\t\t\t// only works if the bound data of the page component and parent component are associated to the same name\n\t\t\t\telements[i].addEventListener(dashBind + '-changed', function (e) {\n\t\t\t\t\tif (e.detail.path)\n\t\t\t\t\t\tthis.domHost.set(e.detail.path, e.detail.value);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\n\t\t// In FF do this here to ensure each page has all of its dynamic bindings applied\n\t\tif(this.requiresTemplateBindData)\n\t\t\tthis.templateBindData(this.template);\n\t}\n\n\t// listens to changes from the sb-tabs parent and propagates them to the sb-tabs page component(s)\n\t_propertyChanged(property, value) {\n\t\tif(this.template && this._bind.indexOf(property.split('.')[0]) !== -1)\n\t\t\tthis.template.set(property, value);\n\t}\n}\n\nPolymer(Tabs);","import {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\n\nexport class TableLayoutBuilder {\n\n\tconstructor(parentElWidth, columns, md, actionsOnTheLeft, hasSelection) {\n\t\tthis.parentElWidth = parentElWidth;\n\t\tthis.md = md;\n\t\tthis.columns = columns;\n\t\tthis.actionsOnTheLeft = actionsOnTheLeft;\n\t\tthis.hasSelection = hasSelection;\n\t}\n\n\t/**\n\t * Builds an object that stores width by field name\n\t * @returns {object}\n\t */\n\tbuild() {\n\t\tthis.layout = {};\n\t\tthis.availableWidth = this._getAvailableWidth();\n\n\t\tlet totalWidth = 0,\n\t\t\tminWidth = 150,\n\t\t\tnumOfCols = this.columns.length,\n\t\t\twidthPerCol = this.availableWidth / numOfCols,\n\t\t\timageCols = [];\n\n\t\t// first pass - assign column widths and calculate the total width\n\t\tfor (let i = 0; i < numOfCols; i++) {\n\t\t\tlet col = this.columns[i],\n\t\t\t\tcolWidth = minWidth; // ensure the smallest column is 150px wide\n\n\t\t\t// if an image column, then size the column with to the image width + 25 if that total size is greater the the minimum width\n\t\t\tlet imageWidth = new ImageCellSizer(this.md[col], 0).getImageWidth(25);\n\t\t\tif(imageWidth > minWidth) {\n\t\t\t\tcolWidth = imageWidth;\n\t\t\t\timageCols.push(col);\n\t\t\t}\n\t\t\t// use weighted widths only when widthPerCol is greater than min width\n\t\t\t// this means there is enough space to use weighted widths.\n\t\t\telse if (widthPerCol > minWidth) {\n\t\t\t\tcolWidth = Math.ceil(widthPerCol * this._getMultiplier(col));\n\t\t\t}\n\t\t\tthis.layout[col] = colWidth;\n\t\t\ttotalWidth += colWidth;\n\t\t}\n\n\t\tthis.totalColsWidth = totalWidth;\n\n\t\t// second-pass: if widthPerCol is greater than minWidth, total weighted width is greater then available width.\n\t\t// To make sure we don't scroll in large screens, subtract the difference equally from each column\n\t\t// and make sure that each column is still at least 150px wide.\n\t\tif (widthPerCol > minWidth) {\n\t\t\tlet diff = totalWidth - this.availableWidth,\n\t\t\t\tnumberOfColsDivisor = numOfCols - imageCols.length, // do not adjust image column widths so subtract them from total\n\t\t\t\ttotalAdjustedWidth = 0;\n\t\t\tthis.totalColsWidth = 0;\n\t\t\tfor (let j = 0; j < numOfCols; j++) {\n\t\t\t\tlet col = this.columns[j];\n\t\t\t\tlet isImageColumn = imageCols.indexOf(col) !== -1;\n\t\t\t\t// adjust width if not an image column, otherwise use the image width determined in first pass\n\t\t\t\tlet adjustedWidth = !isImageColumn ? Math.ceil(this.layout[col] - (diff/numberOfColsDivisor)) : this.layout[col];\n\t\t\t\ttotalAdjustedWidth += adjustedWidth;\n\t\t\t\t// adjust last column for the rounding differences\n\t\t\t\tif (j == numOfCols - 1) {\n\t\t\t\t\tadjustedWidth -= totalAdjustedWidth - this.availableWidth;\n\t\t\t\t}\n\t\t\t\tthis.layout[col] = adjustedWidth;\n\t\t\t\tthis.totalColsWidth += adjustedWidth;\n\t\t\t}\n\t\t}\n\t\treturn this.layout;\n\t}\n\n\t/**\n\t * Calculates available width within the parent element by adjusting for static columns\n\t * @returns {Number}\n\t * @private\n\t */\n\t_getAvailableWidth() {\n\t\t// take out total width for static columns and td padding for the group\n\t\treturn this.parentElWidth - this._getStaticColsWidth() - 12;\n\t}\n\n\tgetTotalWidth() {\n\t\t// td padding minus borders for the group\n\t\treturn this.totalColsWidth + this._getStaticColsWidth() + 10;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns - row number, actions, multi-select\n\t * @returns {number}\n\t * @private\n\t */\n\t_getStaticColsWidth() {\n\t\t// start with the width of the number col and the actions col\n\t\tlet width = 40 + 95;\n\t\tif (this.hasSelection) {\n\t\t\twidth += 30;\n\t\t}\n\t\treturn width;\n\t}\n\n\t/**\n\t * Returns the total width of the static columns on the left\n\t * It can be different depending on the settings\n\t * @returns {number}\n\t */\n\tgetLeftOffset() {\n\t\t// start with the width of the number col\n\t\tlet offset = 40;\n\t\tif(this.actionsOnTheLeft) {\n\t\t\toffset += 95;\n\t\t}\n\t\tif (this.hasSelection) {\n\t\t\toffset += 30;\n\t\t}\n\t\treturn offset;\n\t}\n\n\t/**\n\t * Returns multiplier by field type\n\t * @param col - field name\n\t * @returns {number}\n\t * @private\n\t */\n\t_getMultiplier(col) {\n\t\t// if column is not in the metadata file, use the net total field as segments are net total columns\n\t\tlet type = this.md[col] ? this.md[col].type : 'currency';\n\n\t\tswitch(type.toUpperCase()) {\n\t\t\tcase 'STRING':\n\t\t\t\treturn 1.5;\n\t\t\t\tbreak;\n\t\t\tcase 'BOOLEAN':\n\t\t\t\treturn 1;\n\t\t\t\tbreak;\n\t\t\tcase 'DATE':\n\t\t\t\treturn 1.3;\n\t\t\t\tbreak;\n\t\t\tcase 'DOUBLE':\n\t\t\tcase 'CURRENCY':\n\t\t\tcase 'PERCENT':\n\t\t\tcase 'NUMBER':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'PICKLIST':\n\t\t\tcase 'MULTIPICKLIST':\n\t\t\t\treturn 1.4;\n\t\t\t\tbreak;\n\t\t\tcase 'REFERENCE':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t\tcase 'TEXTAREA':\n\t\t\t\treturn 1.6;\n\t\t\t\tbreak;\n\t\t}\n\t}\n}","export const DEFAULT_WIDTH = 60;\nexport const DEFAULT_HEIGHT = 60;\n\nexport class ImageCellSizer {\n\n\tconstructor(metadata, labelMultiplier) {\n\t\tthis.metadata = metadata;\n\t\tthis.labelMultiplier = labelMultiplier != null ? labelMultiplier : 9;\n\t}\n\n\tgetImageWidth(padding) {\n\t\t// get the width of the first IMAGE() function in the calculatedFormula\n\t\tlet imageWidth = this._getImageWidth(padding, 0);\n\t\tif(imageWidth == null)\n\t\t\treturn; // not a formula field or does not contain any IMAGE() functions, then we are done\n\n\t\t// we found at least one IMAGE() function in the formula,\n\t\t// so lets look for other IMAGE() functions and use the max width between them\n\t\tlet width = -1;\n\t\tdo {\n\t\t\twidth = Math.max(width, imageWidth.width);\n\t\t\timageWidth = this._getImageWidth(padding, imageWidth.end);\n\t\t} while(imageWidth != null);\n\n\t\t// if while parsing the IMAGE() function(s) we found at least one width parameter that was not a hardcoded number,\n\t\t// then log a warning as without a hardcoded width for a given IMAGE() function, the default width was used instead which may not be right\n\t\tif(this.hasInvalidWidth)\n\t\t\tthis._warnInvalidWidthParameter();\n\n\t\t// returns the max width across all the IMAGE() function(s) in the formula\n\t\treturn width;\n\t}\n\n\t_getImageWidth(padding, start) {\n\t\tif(!this.metadata)\n\t\t\treturn;\n\n\t\tlet imageFunctionStartIndex = this._getImageFunctionStart(start);\n\t\t// return early if no formula or the formula does not contain the IMAGE() function\n\t\tif(imageFunctionStartIndex === -1)\n\t\t\treturn;\n\n\t\t// we have an IMAGE() function start index, so use it to get the index of its closing parenthesis\n\t\tlet imageFunctionEndIndex = this._getImageFunctionEnd(imageFunctionStartIndex);\n\n\t\t// get the IMAGE() function from the formula\n\t\tlet imageFunction = this.metadata.calculatedFormula.substring(imageFunctionStartIndex, imageFunctionEndIndex);\n\n\t\t// get the arguments passed into the IMAGE() function\n\t\tlet args = imageFunction.split(',');\n\n\t\t// width is either the a hardcoded number in the 4th argument of the IMAGE() function,\n\t\t// or DEFAULT_WIDTH will be returned if the width argument is omitted or its an non number input like a field reference\n\t\tlet imageWidth = this._getWidthFromImageFunctionArgs(args);\n\n\t\t// return the max between the image width or the width of the image's table header plus padding\n\t\tpadding = padding != null ? padding : 0;\n\t\tlet headerWidth = this.metadata.label.length * this.labelMultiplier;\n\n\t\t// return the width of the IMAGE() from its function, and return the end index to find the next IMAGE() function if applicable\n\t\treturn { width:  Math.max(imageWidth, headerWidth) + padding, end: imageFunctionEndIndex };\n\t}\n\n\t_getImageFunctionStart(start) {\n\t\treturn this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase().indexOf('image(', start) : -1\n\t}\n\n\t_getImageFunctionEnd(start) {\n\t\tlet formula = this.metadata.calculatedFormula ? this.metadata.calculatedFormula.toLowerCase() : null;\n\t\tif(!formula)\n\t\t\treturn -1;\n\n\t\t// loop through each character of the IMAGE() function and return when at least one open parenthesis,\n\t\t// and the number of open parenthesis equal the number of closed parenthesis\n\t\tlet numOpenParenthesis = 0;\n\t\tlet numClosedParenthesis = 0;\n\t\tfor(let i = start, l = formula.length; i < l; i++) {\n\t\t\tif (formula.substring(i, i + 1) === '(')\n\t\t\t\tnumOpenParenthesis++;\n\t\t\telse if (formula.substring(i, i + 1) === ')')\n\t\t\t\tnumClosedParenthesis++;\n\n\t\t\tif (numOpenParenthesis > 0 && numOpenParenthesis === numClosedParenthesis)\n\t\t\t\treturn i;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t_getWidthFromImageFunctionArgs(args) {\n\t\t// the image width is the 4th argument in the IMAGE() function, so if not 4 arguments return the default width\n\t\tif(args.length <= 3)\n\t\t\treturn DEFAULT_WIDTH;\n\n\t\tlet width;\n\t\ttry {\n\t\t\twidth = parseInt(args[3].trim())\n\t\t} catch (e) {\n\t\t\t// cannot parse the 4th argument as an integer then mark as invalid and return the default width\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// if parsed width is not a number, then mark as invalid and return the default width\n\t\tif(isNaN(width)) {\n\t\t\tthis.hasInvalidWidth = true;\n\t\t\treturn DEFAULT_WIDTH;\n\t\t}\n\n\t\t// return the valid numeric width provided in the 4th argument of the IMAGE() function\n\t\treturn width;\n\t}\n\n\t_warnInvalidWidthParameter() {\n\t\tconsole.warn('May not have properly sized the column to fit the image specified by this formula: \"' + this.metadata.calculatedFormula + '\"\\n' +\n\t\t\t'REASON: At least one of the formula\\'s IMAGE function(s) has its width parameter (4th argument) defined from a field.\\n' +\n\t\t\t'SOLUTION: All of the formula\\'s IMAGE function(s) should have its width parameter either omitted or hardcoded to a number.');\n\t}\n}","export class TableClassBuilder {\n\n\tconstructor(columns, firstLastClassSuffix, typeByColumnMap, allColumnClasses) {\n\t\tthis.columns = columns;\n\t\tthis.firstLastClassSuffix = firstLastClassSuffix;\n\t\tthis.typeByColumnMap = typeByColumnMap;\n\t\tthis.allColumnClasses = allColumnClasses || [];\n\t}\n\n\tbuild() {\n\t\tlet classMap = {};\n\t\tthis._appendTypeClass(classMap);\n\t\tthis._appendFirstAndLastColumnClasses(classMap);\n\t\tthis._appendAllColumnClasses(classMap);\n\t\tthis._addWidthStyles(classMap);\n\t\treturn classMap;\n\t}\n\n\t_appendTypeClass(classMap) {\n\t\tif(!this.typeByColumnMap)\n\t\t\treturn;\n\n\t\tlet prevNumeric = false;\n\t\tfor (let col of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[col];\n\t\t\tlet isNumeric = this._isNumericType(type);\n\t\t\tlet isBoolean = this._isBooleanType(type);\n\n\t\t\tif(isNumeric)\n\t\t\t\tthis._appendClass(classMap, col, 'numericCell');\n\t\t\telse if(isBoolean)\n\t\t\t\tthis._appendClass(classMap, col, 'checkboxCell');\n\t\t\telse if(prevNumeric)\n\t\t\t\tthis._appendClass(classMap, col, 'afterNumericCell');\n\n\t\t\tprevNumeric = isNumeric;\n\t\t}\n\t}\n\n\t_appendFirstAndLastColumnClasses(classMap) {\n\t\tlet firstInnerClass = 'firstInner' + this.firstLastClassSuffix;\n\t\tlet lastInnerClass = 'lastInner' + this.firstLastClassSuffix;\n\t\tlet secondInnerClass = 'secondInner' + this.firstLastClassSuffix;\n\n\t\tthis._appendClass(classMap, this.columns[0], firstInnerClass);\n\t\tthis._appendClass(classMap, this.columns[this.columns.length-1], lastInnerClass);\n\t\tif(this.columns.length > 1)\n\t\t\tthis._appendClass(classMap, this.columns[1], secondInnerClass);\n\t}\n\n\t_appendAllColumnClasses(classMap) {\n\t\tfor(let column of this.columns) {\n\t\t\tfor(let columnClass of this.allColumnClasses)\n\t\t\t\tthis._appendClass(classMap, column, columnClass);\n\t\t}\n\t}\n\n\t_addWidthStyles(classMap) {\n\t\tfor(let column of this.columns) {\n\t\t\tlet type = this.typeByColumnMap[column];\n\t\t\tlet typeAndWidth = type.split(':'); // check to see if the type is in the format type:width\n\t\t\tif(typeAndWidth.length === 2)\n\t\t\t\tthis._setWidthStyle(classMap, column, typeAndWidth[1]);\n\t\t}\n\t}\n\n\t_isNumericType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'double' || type === 'number' || type === 'currency' || type === 'percent';\n\t}\n\n\t_isBooleanType(type) {\n\t\ttype = type.split(':')[0]; // possible the type is in the format type:width\n\t\treturn type === 'boolean' || type === 'checkbox'\n\t}\n\n\t_appendClass(classMap, key, classToAppend) {\n\t\tif(!classMap[key])\n\t\t\tclassMap[key] = {};\n\n\t\tlet existingClass = classMap[key].class;\n\t\tclassMap[key].class = existingClass ? (existingClass + ' ' + classToAppend) : classToAppend;\n\t}\n\n\t_setWidthStyle(classMap, key, width) {\n\t\tif(!classMap[key])\n\t\t\tclassMap[key] = {};\n\t\tclassMap[key].style = `width:${width}px`;\n\t}\n }","import {FieldHider} from 'common/layout/fields/FieldHider.js';\n\nexport class Checkbox {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-checkbox';\n\t\tthis.properties = {\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t    notify: true\n   \t\t\t},\n\t\t\thide: { // this could be a boolean or an object with properties {hidden:true|false and type:hide:invisible}\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'hideShow'\n\t\t\t}\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.checkbox.focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\thideShow() {\n\t\tlet hider = new FieldHider(this.hide, Polymer.Base);\n\t\thider.applyTo(this.$.checkbox);\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Checkbox);","import {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\n\nexport class Datepicker extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-datepicker';\n\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedDate: { // if not empty, this property needs to be in ISO-8601 format\n\t\t\t\ttype: Date,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tisBlank: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trange: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 30\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['selectedDateChanged(isBlank, selectedDate)']\n\t}\n\n\tready() {\n\t\tlet localeData = I18n.getLocaleData();\n\t\tthis.isActive = false;\n\n\t\tthis.weeks = [];\n\t\tthis.weekDays = localeData && localeData.date ? localeData.date.calendars.gregory.days.short : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\t\tthis.months = localeData && localeData.date ? localeData.date.calendars.gregory.months.long : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\n\t\tthis.year = this.date.getFullYear();\n\t\tthis.month = this.date.getMonth();\n\t\tthis.monthName = this.months[this.month].toUpperCase();\n\t\tthis.day = this.date.getDate();\n\n\t\tthis.parseDateTimePattern();\n\t}\n\n\t// methods for rendering\n\tgetDate(date) {\n\t\tif (typeof date != 'object') {\n\t\t\treturn new Date(this.year, this.month, date);\n\t\t}\n\t\treturn date.getDate();\n\t}\n\n\tclearDate() {\n\t\tif (this.isBlank) {\n\t\t\tthis.$.selectedDate = '';\n\t\t\tthis.dateFormatted = '';\n\t\t}\n\t}\n\n\tgetClass(day) {\n\t\tif (typeof day != 'object') {\n\t\t\tday = new Date(this.year, this.month, day);\n\t\t}\n\t\tvar className = '';\n\t\tif (day.getMonth() !== this.month ) {\n\t\t\tclassName += 'notCurrent';\n\t\t} else {\n\t\t\tif ( (day.getFullYear() === this.date.getFullYear()) && (day.getMonth() === this.date.getMonth()) && (day.getDate() === this.date.getDate()) ) {\n\t\t\t\tclassName += 'selected';\n\t\t\t}\n\t\t\tif ( (day.getFullYear() === this.year) && (day.getMonth() === this.month) && (day.getDate() === this.date.getDate()) ) {\n\t\t\t\tclassName += ' current';\n\t\t\t}\n\t\t}\n\t\treturn className;\n\t}\n\n\t// observers\n\tselectedDateChanged() {\n\t\tif (this.initialized || this.selectedDate) {\n\t\t\tthis._selectedDateChanged(this.selectedDate, this.selectedDate == null);\n\t\t\treturn\n\t\t}\n\t\tif(this.isBlank)\n\t\t\tthis._selectedDateChanged(new Date(), true, true);\n\t\telse {\n\t\t\tthis.selectedDate = new Date();\n\t\t\tthis._selectedDateChanged(this.selectedDate);\n\t\t}\n\t\tthis.focus();\n\t}\n\n\t_selectedDateChanged(selectedDate, isBlank, internal) {\n\t\tthis.initialized = true;\n\t\tlet dateObj = null;\n\t\t// if string and in YYYY-MM-DD format than instantiate explicitly\n\t\tif( selectedDate && typeof selectedDate === 'string' ) {\n\t\t\tlet pos = selectedDate.indexOf( 'T'),\n\t\t\t\tymd;\n\t\t\tif( pos < 0 ) {\n\t\t\t\tymd = selectedDate.split( '-' );\n\t\t\t} else {\n\t\t\t\tlet parts = selectedDate.split( 'T');\n\t\t\t\tymd = parts[0].split( '-' );\n\n\t\t\t}\n\t\t\tif( ymd && ymd.length == 3 ){\n\t\t\t\tdateObj = new Date( ymd[0], ymd[1]-1, ymd[2] );\n\t\t\t}\n\t\t}\n\n\t\t// default\n\t\tif( !dateObj ) {\n\t\t\tdateObj = selectedDate != null ? new Date( selectedDate ) : new Date();\n\t\t}\n\n\t\tthis.date = dateObj;\n\t\tthis.updateVariables();\n\n\t\tif(!isBlank)\n\t\t\ttry {\n\t\t\t\tthis.dateFormatted = this.date.toLocaleDateString(this.user.locale);\n\t\t\t} catch (e) {\n\t\t\t\tthis.dateFormatted = this.date.toLocaleDateString(); // Catch error as FF does not accept parameter\n\t\t\t}\n\t\tif(!internal)\n\t\t\tthis.fire( 'selected-date-changed', { value:  selectedDate } );\n\t}\n\n\t// event handlers\n\tshowCalendar() {\n\t\tif(this.disabled)\n\t\t\treturn;\n\n\t\tthis.ensureProperYearInSelectedAndShowCalendar();\n\t}\n\n\tensureProperYearInSelectedAndShowCalendar() {\n\t\tif(this.year === this.date.getFullYear() && this.haveEnsured)\n\t\t\tthis._showCalendar();\n\n\t\tthis.haveEnsured = true;\n\t\tthis.date.getFullYear();\n\t\tlet years = [];\n\t\tvar start = this.year - this.range;\n\t\tvar end = this.year + this.range + 1;\n\t\tfor ( var i = start; i < end; i++) {\n\t\t\tyears.push(i);\n\t\t}\n\t\tif (AppContext.isIE()) {\n\t\t\tif (!this.yearsCreated) {\n\t\t\t\tthis.$.years.remove(0); // IE creates an extra options\n\t\t\t\tfor (let j = 0, len = years.length; j < len; j++) {\n\t\t\t\t\tthis._createOptionElements(this.$.years, years[j]);\n\t\t\t\t}\n\t\t\t\tthis.yearsCreated = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.years = years;\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.yearSelection = this.$.years;\n\t\t\tif (this.yearSelection.selectedOptions) {\n\t\t\t\tthis.yearSelection.selectedOptions[0].selected = '';\n\t\t\t}\n\t\t\tthis.yearSelection.options[this.range].selected = 'selected';\n\t\t\tthis._showCalendar();\n\t\t}.bind(this));\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option;\n\t\toptionEl.value = option;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\t_showCalendar() {\n\t\tthis.isActive = true;\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t\tthis.fire('datepicker-opened', {datepicker: this.$.datePicker, dateContainer: this.$.dateContainer});\n\t}\n\n\thideCalendar() {\n\t\tif (this.isActive) {\n\t\t\tthis.isActive = false;\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\tfindToday() {\n\t\tthis.selectedDate = new Date();\n\t\tthis.updateYearPicklist();\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tupdateYearPicklist() {\n\t\tlet options = this.yearSelection.options;\n\t\tfor (let i= 0, l=options.length; i<l; i++) {\n\t\t\toptions[i].selected = this.year == options[i].text;\n\t\t}\n\t}\n\n\tchangeYear() {\n\t\tvar selectedYear = parseInt(this.yearSelection.selectedOptions[0].text);\n\t\tthis.selectedDate = new Date(selectedYear, this.month, this.day);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t\tthis.focus();\n\t}\n\n\tdecreaseMonth() {\n\t\tthis.selectedDate = new Date(this.year, this.month - 1, this.day);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t}\n\n\tincreaseMonth() {\n\t\tthis.selectedDate = new Date(this.year, this.month + 1, this.day);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t}\n\n\tselectDay(e) {\n\t\tthis.selectedDate = e.model ? e.model.day : this.date;\n\t\tthis.hideCalendar();\n\t}\n\n\t// helper methods\n\tupdateVariables() {\n\t\tthis.year = this.date.getFullYear();\n\t\tthis.month = this.date.getMonth();\n\t\tthis.monthName = this.months ? this.months[this.month].toUpperCase(): '';\n\t\tthis.day = this.date.getDate();\n\t}\n\n\tupdateDate(increment) {\n\t\tthis.date.setDate(this.date.getDate() + increment);\n\t\tthis.updateVariables();\n\t\tthis.updateCalendar();\n\t}\n\n\tupdateCalendar() {\n\t\tthis.weeks = [];\n\t\tvar firstDay = new Date(this.date.getFullYear(), this.month, 1);\n\t\tvar index = firstDay.getDay();\n\t\tvar numOfDays = 6 * 7;\n\t\tvar week = [];\n\t\tvar dayIdx = 0;\n\t\tfor ( var i = 0; i < numOfDays; i++) {\n\t\t\tvar day = new Date(firstDay);\n\t\t\tday.setDate(firstDay.getDate() + (i - index));\n\t\t\tweek[dayIdx] = day;\n\t\t\tdayIdx++;\n\n\t\t\tif ( ((i+1) % 7) === 0 || i+1 === numOfDays) {\n\t\t\t\tthis.push('weeks', week);\n\t\t\t\tweek = [];\n\t\t\t\tdayIdx = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tparseDateTimePattern() {\n\t\tvar dateTimeFormat = I18n.getLocaleData() ? I18n.getLocaleData().date.formats.dateFormats.yMd : 'M/D/YY';\n\t\t// simplify dateTimeFormat string for repeating characters\n\t\tvar dateTimeFormatSimple = dateTimeFormat.replace(new RegExp('[dD]+'), 'D').replace(new RegExp('[mM]+'), 'M').replace(new RegExp('[yY]+'), 'Y');\n\t\t// get the separator\n\t\tthis.separator = dateTimeFormatSimple.match(new RegExp('[\\/.-]'))[0];\n\t\t// split by separator to get day, month, and year indexes\n\t\tthis.dateTimeElements = dateTimeFormatSimple.split(this.separator);\n\t\tthis.dateIdx = this.dateTimeElements.indexOf('D');\n\t\tthis.monthIdx = this.dateTimeElements.indexOf('M');\n\t\tthis.yearIdx = this.dateTimeElements.indexOf('Y');\n\t}\n\n\tvalidateInput() {\n\t\tif (this.noblur)\n\t\t\treturn;\n\n\t\tlet error;\n\t\tlet invalid = false;\n\t\tlet dateString = this.$.dateInput.value;\n\t\tlet emptyDate = dateString.trim() === '';\n\t\tlet localeDate = !emptyDate ? this.getLocaleDate() : '';\n\t\tlet dateChanged = dateString !== localeDate;\n\n\t\tif (dateChanged) {\n\t\t\tinvalid = true;\n\t\t\t// pull day, month, and year from the date\n\t\t\tvar elements = dateString.split(this.separator),\n\t\t\t\tday = elements[this.dateIdx],\n\t\t\t\tmonth = elements[this.monthIdx],\n\t\t\t\tyear = elements[this.yearIdx];\n\n\t\t\t// check day, month, and year strings for validity\n\t\t\tif ((year && year.length == 4) && (month && month.length > 0 && month.length <= 2) && (day && day.length > 0 && day.length <= 2)) {\n\t\t\t\tday = parseInt(day);\n\t\t\t\tmonth = parseInt(month);\n\t\t\t\tyear = parseInt(year);\n\n\t\t\t\t// check whether input is split into separate elements and that input elements are numbers\n\t\t\t\tif (elements.length && !isNaN(year) && !isNaN(month) && !isNaN(day)) {\n\t\t\t\t\t// check year\n\t\t\t\t\tif (year >= this.year - this.range && year <= this.year + this.range) {\n\t\t\t\t\t\t// check months\n\t\t\t\t\t\tif (month >= 1 && month <= 12) {\n\t\t\t\t\t\t\t// check days including leap years\n\t\t\t\t\t\t\tvar monthEnd = 31;\n\t\t\t\t\t\t\tif (month == 2) {\n\t\t\t\t\t\t\t\tmonthEnd = 28;\n\t\t\t\t\t\t\t\tif (year % 4 == 0) {\n\t\t\t\t\t\t\t\t\tif (year % 100 != 0) {\n\t\t\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (year % 400 == 0) {\n\t\t\t\t\t\t\t\t\t\t\tmonthEnd = 29;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ((month == 4) || (month == 6) || (month == 9) || (month == 11)) {\n\t\t\t\t\t\t\t\t\tmonthEnd = 30;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (day >= 1 && day <= monthEnd) {\n\t\t\t\t\t\t\t\tinvalid = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// update date to reflect the input change\n\t\t\t\tif (!invalid) {\n\t\t\t\t\tthis.selectedDate = new Date(year, month - 1, day);\n\t\t\t\t\tthis.updateVariables();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (invalid) {\n\t\t\t\terror = this.i18n.l('Invalid Date.');\n\t\t\t}\n\t\t}\n\t\tlet hasSelectedDate = typeof this.selectedDate === 'object' || this.selectedDate.trim() !== '';\n\t\tif(emptyDate && hasSelectedDate) {\n\t\t\tthis.dateFormatted = '';\n\t\t\tthis.selectedDate = null;\n\t\t}\n\n\t\tthis.invalidInput = invalid;\n\t\tthis.fire('field-change-validated', {error: error});\n\n\t\tthis.fire('sb-date-blur');\n\t}\n\n\tnavigate(e) {\n\t\tif (e.keyCode === 9) { // tab key\n\t\t\tthis.hideCalendar();// hide the calendar\n\t\t\treturn; // allow default behavior\n\t\t}\n\n\t\tswitch(e.keyCode) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tif (this.isActive) // changes made using calendar popout\n\t\t\t\t\tthis.selectDay(e);\n\t\t\t\telse // manual edits to the input text\n\t\t\t\t\tthis.validateInput();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif (this.isActive) this.hideCalendar();\n\t\t\t\telse {\n\t\t\t\t\tthis.escaped = true;\n\t\t\t\t\tthis.fire('sb-date-esc', {keyCode: 27});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 37: // left arrow\n\t\t\t\tthis.updateDate(-1);\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\t\tthis.updateDate(-7);\n\t\t\t\tbreak;\n\t\t\tcase 39: // right arrow\n\t\t\t\tthis.updateDate(+1);\n\t\t\t\tbreak;\n\t\t\tcase 40: // down arrow\n\t\t\t\tif(!this.isActive) this.showCalendar();\n\t\t\t\telse this.updateDate(+7);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetLocaleDate() {\n\t\ttry {\n\t\t\treturn  this.date.toLocaleDateString(this.user.locale);\n\t\t} catch (e) {\n\t\t\treturn this.date.toLocaleDateString(); // Catch error as FF does not accept parameter\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.highlight();\n\t\tthis.$.dateInput.focus();\n\t}\n\n\thighlight() {\n\t\tif(this.dateFormatted)\n\t\t\tthis.$.dateInput.setSelectionRange(0, this.dateFormatted.length);\n\t}\n\n\tpreventBlur() {\n\t\tthis.noblur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noblur = false;\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\n\nPolymer( Datepicker );\n","import {NumberParser} from 'common/forms/NumberParser.js';\n\nexport class Discount {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount';\n\t\tthis.properties = {\n\t\t\tdiscountDetails: Object,\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tunitChanged: Object,\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tformatter: Object,\n\t\t\tdisplayValue: String,\n\t\t\toriginal: Object\n\t\t}\n\t}\n\n\tready() {\n\t\tlet input = this.$.discount.$.input;\n\t\tinput.addEventListener('change', this.setDiscountValue.bind(this));\n\t\tinput.addEventListener('focus', this.focused.bind(this));\n\t\tinput.addEventListener('blur', this.deferBlur.bind(this));\n\t\tinput.addEventListener('keydown', this.tabBlur.bind(this, true));\n\n\t\tlet select = this.$.discountUnits.$.select;\n\t\tselect.addEventListener('change', this.convertDiscountValue.bind(this));\n\t\tselect.addEventListener('focus', this.focused.bind(this));\n\t\tselect.addEventListener('blur', this.deferBlur.bind(this));\n\t\tselect.addEventListener('keydown', this.tabBlur.bind(this, false));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.discount.focus();\n\t}\n\n\tfocused() {\n\t\tif(this.blurred)\n\t\t\tclearTimeout(this.blurred);\n\t}\n\n\tdeferBlur() {\n\t\tif(this.tabBlurred)\n\t\t\tthis.tabBlurred = false;\n\t\telse {\n\t\t\tthis.blurred = setTimeout(function () {\n\t\t\t\tthis.blurDiscount(true);\n\t\t\t}.bind(this), 1);\n\t\t}\n\t}\n\n\ttabBlur(isInput, e) {\n\t\tif (e.keyCode === 27 && this.renderReadOnly) { // esc key\n\t\t\tthis.resetToOriginal();\n\t\t\treturn;\n\t\t}\n\n\t\tif(e.keyCode !== 9) // bail if not tab key\n\t\t\treturn;\n\n\t\tthis.tabBlurred = true;\n\n\t\t// blur direction is shift+tab from input or normal tab from select\n\t\tlet blurDirection = (isInput && e.shiftKey) || (!isInput && !e.shiftKey);\n\t\tif(blurDirection)\n\t\t\tthis.blurDiscount(false);\n\t}\n\n\tblurDiscount(directBlur) {\n\t\tif(directBlur)\n\t\t\tthis._blur();\n\t\telse {\n\t\t\tsetTimeout(function () {\n\t\t\t\tthis._blur();\n\t\t\t}.bind(this), 10);\n\t\t}\n\t}\n\n\t_blur() {\n\t\tlet value = this.$.discount.value !== '' ? this.numberParser.parse(this.$.discount.value) : null;\n\t\tthis.discountDetails.setDiscountValue(value);\n\t\tthis.fire('sb-discount-blur');\n\t}\n\n\tsetDiscountValue(e) {\n\t\tlet oldValue = this.discountDetails.displayValue;\n\t\t// If value is empty string set to null to avoid NaN returning from NumberParser.js parse method\n\t\tlet value = e.target.value !== '' ? this.numberParser.parse(e.target.value) : null;\n\t\tif ( oldValue != value ) {\n\t\t\tthis.discountDetails.setDiscountValue(value);\n\t\t\tthis.fire('sb-field-on-change-field');\n\t\t}\n\t}\n\n\tconvertDiscountValue(e) {\n\t\tthis.discountDetails.convertDiscountValue(e.target.value);\n\t\tthis.displayValue = undefined;\n\t\tthis.displayValue = this.formatter.format(this.discountDetails.displayValue);\n\t}\n\n\tresetToOriginal() {\n\t\t// need to call each API twice during escape sequence (this is not a mistake)\n\t\tthis.setDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValue({target: {value: this.original.unitValue}});\n\t\tthis.setDiscountValue({target: {value: this.original.label}});\n\t\tthis.convertDiscountValue({target: {value: this.original.unitValue}});\n\t\tthis.selectUnit(this.discountDetails.unit);\n\t}\n\n\tselectUnit(value) {\n\t\tlet select = this.$.discountUnits.$.select;\n\t\tlet options = select.options;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif(options[i].value === value) {\n\t\t\t\tselect.selectedIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n}\nPolymer(Discount);","import {AppContext} from 'common/core/AppContext.js';\nimport {NumberParser} from 'common/forms/NumberParser.js';\nimport {FieldFactory} from 'common/forms/sb-field/factory/FieldFactory.js';\nimport {DependentPicklistBuilder} from 'common/forms/DependentPicklistBuilder.js';\n\nlet KEY_READ_ONLY = 'keyReadOnly',\n\tBLUR_READ_ONLY = 'blurReadOnly',\n\tCHANGE = 'change',\n\tHIDE_FIELD = 'hideField',\n\tREF_DISPLAY = 'refDisplay',\n\tAPPLY_FOCUS = 'applyFocus';\n\nexport class Field extends AppContext {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.AppContext, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\tobj: Object,\n\t\t\t/** Required but only if you are not passing in a value */\n\t\t\tproperty: String,\n\t\t\t//adapt product metadata to return map object instead of array\n\t\t\t/** Object with structure of:\n\t\t\t {\n\t\t\t\ttype: STRING | REFERENCE | DOUBLE | CURRENCY | PICKLIST | DATE | DATETIME | CHECKBOX | BOOLEAN | RADIO\n\t\t\t\tname: <object field API name>\n\t\t\t\tlabel: <object field label>\n\t\t\t\tscale: integer\n\t\t\t\tpicklistValues: [ { label: <label>, value: <value> }]\n\t\t\t\treferenceTable: <name of editable reference lookup table>\n\t\t\t\tlink: boolean\n\t\t\t }\n\t\t\t */\n\t\t\tmd: Object,\n\t\t\ttype: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getType(md)'\n\t\t\t},\n\t\t\t/** Object with discount details if a discount field such as 'unit' > String, 'units' > Array, and 'unitChanged' > Function */\n\t\t\tdiscountDetails: Object,\n\t\t\t/** Metadata for all referenced objects in same structure as md */\n\t\t\trefObjects: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tediting: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\t_wasEverEditable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setWasEverEditable(editing)'\n\t\t\t},\n\t\t\tdisabled: { // optional boolean if field is disabled\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'disabledChanged'\n\t\t\t},\n\t\t\thidden: { // optional field if hidden, this could be a boolean or an object with properties {hidden:true|false and type:hide|invisible} (only supports checkbox and radio fields)\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'hiddenChanged'\n\t\t\t},\n\t\t\tlink: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\tvalue: {\n\t\t\t\tobserver: 'valueChanged'\n\t\t\t},\n\t\t\trefDisplay: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tobjAndRefObjects: Object, // use if obj and refObjects on same object\n\t\t\tobjKey: String, // if objAndRefObjects is set, this string is the key to the obj sub property\n\t\t\trefObjectsKey: String, // if objAndRefObjects is set, this string is the key to the refObjects sub property,\n\t\t\trefTable: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'computeRefTable(md)'\n\t\t\t},\n\t\t\treadOnly: Boolean, // assign via javascript to this field is you need to pass in true (this is because of FF)\n\t\t\trenderReadOnly: { // set to true if field should be initially rendered as read-only\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tformattedValue: Object, // set to the formatted value of this field for direct binding if renderReadOnly is true\n\t\t\toriginalFormattedValue: String,\n\t\t\ttabindex: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setTabindex(renderReadOnly, editing, disabled, md)'\n\t\t\t},\n\t\t\thideFormattedValue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'applyFocus'\n\t\t\t},\n\t\t\tindex: Number, // index of this field in the context of a group of fields (e.g. table row)\n\t\t\trecordId: { // the record id of this field\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null,\n\t\t\t\tobserver: 'recordIdChanged'\n\t\t\t},\n\t\t\tnumberParser: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn new NumberParser();\n\t\t\t\t}\n\t\t\t},\n\t\t\tpreventNumericAlignment: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tsignaler: Object,\n\t\t\trecord: Object\n\t\t}, AppContext.properties );\n\t}\n\n\tget observers() {\n\t\treturn ['render(obj, property, md, refObjects, editing, renderReadOnly)', 'setObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey)', '_setOriginalFormattedValue(originalValue, md)', 'addControlledSelectListener(md)', 'recordChanged(record.*)'];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-row-focus-signal', this.handleRowFocusSignal.bind(this));\n\t}\n\n\tattached() {\n\t\tif(typeof this.value === 'undefined')\n\t\t\treturn;\n\n\t\tif(!this.property)\n\t\t\treturn;\n\n\t\tif(this.obj) {\n\t\t\tif(this.isInternalObject) this.obj[this.property] = this.value;\n\t\t\treturn;\n\t\t}\n\t\t// have a value and property but no object, so create object with the value\n\t\t// if other required properties are already set, then will trigger the render via the observer\n\t\tlet obj = {};\n\t\tthis.isInternalObject = true;\n\t\tobj[this.property] = this.value;\n\t\tthis.obj = obj;\n\t}\n\n\tsetObjAndRefObjects() {\n\t\tthis.obj = undefined;\n\t\tthis.refObjects = undefined;\n\t\tthis.refObjects = this.objAndRefObjects[this.refObjectsKey];\n\t\tif (typeof this.refObjects === 'undefined')\n\t\t\tthis.refObjects = {};\n\t\tif (this.objKey !== '')\n\t\t\tthis.obj = this.objAndRefObjects[this.objKey];\n\t\telse\n\t\t\tthis.obj = this.objAndRefObjects;\n\t}\n\n\trender() {\n\t\tthis.rendered = true;\n\t\tif (this.isReadOnly()) {\n\t\t\tthis.updateTemplateData();\n\t\t\treturn;\n\t\t}\n\t\tthis._render();\n\t}\n\n\t_render() {\n\t\tif(this.template)\n\t\t\treturn;\n\n\t\tthis.template = document.createElement('template', 'dom-bind');\n\t\tlet ff = this.updateTemplateData();\n\t\tthis.createBaseElement(ff.html);\n\n\t\t// callback to handle general events on fields\n\t\tthis.template[CHANGE] = this.onChange.bind(this);\n\t\tthis.template[KEY_READ_ONLY] = this.onKeyupReadOnly.bind(this);\n\t\tthis.template[BLUR_READ_ONLY] = this.onBlurReadOnly.bind(this);\n\n\t\tif(!this.isReadOnly())\n\t\t\tthis.hideFormattedValue = true;\n\n\t\t// stamp the template into the DOM\n\t\tPolymer.dom(this.$.f).appendChild(this.template);\n\t}\n\n\t_setOriginalFormattedValue() {\n\t\tlet formField = this.getFormField(this.originalValue);\n\t\tthis.originalFormattedValue = this.getFormattedValue(formField, this.originalValue);\n\t}\n\n\tonChange(e) {\n\t\tthis._onChange(e);\n\t\tthis.fire('sb-field-on-change-field');\n\t}\n\n\t_onChange(e) {\n\t\tif (this.internal)\n\t\t\treturn;\n\n\t\tlet target = this.getEventTarget(e);\n\t\tlet val = target.value !== undefined ? target.value : (e.detail ? e.detail.value : null);\n\t\tthis.refDisplay = target[REF_DISPLAY] !== undefined ? target[REF_DISPLAY] :\n\t\t\t(e.detail && e.detail[REF_DISPLAY] !== undefined ? e.detail[REF_DISPLAY] : this.refDisplay);\n\n\n\t\tif (this.isNumericType()) {\n\t\t\t// If val is truthy, or 0 we need to parse a number from it. 0 is included so we don't accidentally convert\n\t\t\t// it to null.\n\t\t\tif (val && val !== 0) {\n\t\t\t\tval = this.numberParser.parse(val);\n\t\t\t} else {\n\t\t\t\t// Any falsy, non-zero values must be converted to null to avoid deserialization problems. For example,\n\t\t\t\t// an empty string deserializes to 0 on SF, which is a problem.\n\t\t\t\tval = null;\n\t\t\t}\n\t\t} else if (this.getType() === 'date' && val instanceof Date) {\n\t\t\tlet month = (val.getMonth() + 1);\n\t\t\tmonth = (month < 10) ? ('0' + month) : month;\n\t\t\tlet date = val.getDate();\n\t\t\tdate = (date < 10) ? ('0' + date) : date;\n\t\t\tval = val.getFullYear() + '-' + month + '-' + date;\n\t\t} else if (val instanceof Date) {\n\t\t\tval = val.toISOString();\n\t\t}\n\n\t\tthis.internal = true;\n\t\tthis.obj[this.property] = val;\n\t\tthis.domHost.value = val;\n\t\tthis.internal = false;\n\t\tthis.fireCustomChangeEvents(e);\n\t}\n\n\tfireCustomChangeEvents(e) {\n\t\t// must have e.detail check for FireFox as caller method is fired twice when we only want this to be fired once\n\t\t// however, the caller method is only called once with an event object that contains detail\n\t\tif (this.md && e.detail)\n\t\t\tthis.fireControllingSelectChangeEvent();\n\t}\n\n\tfireControllingSelectChangeEvent() {\n\t\tvar data = {tableName: this.md.tableName, fieldName: this.md.name, record: this.record};\n\t\tvar signal = new CustomEvent('sb-controlling-select-changed', {bubbles: false, detail: data});\n\t\tdocument.dispatchEvent(signal);\n\t}\n\n\tonKeyupReadOnly(e) {\n\t\tlet keyCode = e.keyCode || e.detail.keyCode;\n\t\tif(keyCode !== 27) // bail if not escape key\n\t\t\treturn;\n\n\t\tthis.onBlurReadOnly(false);\n\t}\n\n\tonBlurReadOnly(keepNewValue) {\n\t\tif(!this.isReadOnly())\n\t\t\treturn;\n\n\t\tif(this.template[HIDE_FIELD])\n\t\t\treturn;\n\n\t\tif(keepNewValue) {\n\t\t\tthis.setPreviouslyFormattedValue();\n\t\t\tthis.updateTemplateData();\n\t\t} else  {\n\t\t\tlet data = { target: { value: this.previouslyFormatted ? (this.previouslyFormatted.value) : this.formattedValue.value } };\n\t\t\tif(this.isLookup())\n\t\t\t\tdata.target[REF_DISPLAY] = this.previouslyFormatted ? this.previouslyFormatted.label : this.formattedValue.label;\n\t\t\tthis._onChange(data);\n\t\t\tthis.updateTemplateData();\n\t\t}\n\n\t\tthis.template[HIDE_FIELD] = true;\n\t\tthis.hideFormattedValue = false;\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.enableSignals();\n\t}\n\n\tupdateTemplateData() {\n\t\tlet value = this.obj[this.property];\n\t\tlet formField = this.getFormField(value);\n\n\t\tif(formField.defaultValue && this.template) // default value only used if a template\n\t\t\tthis._onChange( { target: { value: formField.defaultValue} } );\n\n\t\tthis.formattedValue = this.getFormattedValue(formField, value);\n\t\tthis.originalFormattedValue = this.originalFormattedValue || this.formattedValue;\n\t\tthis.addFormattedValueClasses(formField.numeric);\n\n\t\tif(this.isReadOnly())\n\t\t\tthis.setFormattedDetails();\n\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tformField.attachTo(this.template, KEY_READ_ONLY, BLUR_READ_ONLY, CHANGE, HIDE_FIELD, this.renderReadOnly);\n\t\treturn formField;\n\t}\n\n\tgetFormField(value) {\n\t\tlet editable = this.isEditable(true);\n\t\tlet selectOptions = this.getSelectOptions();\n\t\tlet referenceDetails = { refDisplay: this.refDisplay, refDisplayName: REF_DISPLAY, refTable: this.refTable, refObjects: this.refObjects, property: this.property, obj: this.obj, record: this.record };\n\t\tlet factory = new FieldFactory(value, editable, this.disabled, this.hidden, this.index, this.md, this.i18n, this.renderReadOnly, selectOptions, referenceDetails, this.discountDetails, this.preventNumericAlignment);\n\t\treturn factory.newFormField(this.type);\n\t}\n\n\tgetFormattedValue(formField, value) {\n\t\treturn formField.formattedValue || { value: value, label: value };\n\t}\n\n\taddFormattedValueClasses(numeric) {\n\t\tlet editable = this.isEditable();\n\t\tthis.toggleClass('editable', editable, this.$.formatted);\n\t\tthis.toggleClass('numericField', !this.preventNumericAlignment && numeric, this.$.formatted);\n\t\tthis.toggleClass('firstField', this.index == 0, this.$.formatted);\n\t\tthis.toggleClass('readOnly', this.readOnly, this.$.formatted);\n\n\t\tthis.isDirty = editable && this.formattedValue.value !== this.originalFormattedValue.value && !(this.isNil(this.formattedValue.value) && this.isNil(this.originalFormattedValue.value));\n\t\tthis.toggleClass('dirty', this.isDirty, this.$.formatted);\n\n\t\tlet isBool = this.isBoolean();\n\t\tlet isEmpty = !isBool && (this.formattedValue.value === false || (this.isNil(this.formattedValue.label) && this.formattedValue.value !== true));\n\t\tthis.toggleClass('empty', isEmpty, this.$.formatted);\n\t\tthis.toggleClass('empty', isEmpty, this.$.formatted.$.me);\n\n\t\tthis.toggleClass('link', this.link, this.$.formatted);\n\t\tthis.toggleClass('link', this.link, this.$.formatted.$.me);\n\n\t\tthis.toggleClass('boolean', isBool, this.$.formatted);\n\t}\n\n\tsignalRowFocus() {\n\t\tif(this.signaler) {\n\t\t\tthis.signaler.fireSignal('sb-row-focus-signal', true);\n\t\t\tsetTimeout(function() {\n\t\t\t\t// disable the signaler's internal focus events in timeout as some blur events\n\t\t\t\t// may enable it on a delay such as the discount field\n\t\t\t\tthis.signaler.disable();\n\t\t\t}.bind(this), 20);\n\t\t}\n\t}\n\n\tenableSignals() {\n\t\tif(this.signaler)\n\t\t\tthis.signaler.enable(); // enable the signalers internal focus events\n\t}\n\n\thandleRowFocusSignal(signal) {\n\t\tif(!this.signaler)\n\t\t\treturn;\n\n\t\tthis.signaler.toggleRowFocus(signal);\n\t\tif(this.isEditable())\n\t\t\tthis.toggleClass('show', signal.detail.focused, this.$.formatted);\n\t}\n\n\tcreateBaseElement( html ) {\n\t\tvar d = this.template.content.ownerDocument.createElement('div');\n\t\td.innerHTML = html;\n\t\tlet el = Polymer.dom(d).firstChild;\n\t\tPolymer.dom(this.template.content).appendChild(el);\n\t}\n\n\tisNumericType() {\n\t\tswitch(this.type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetType() {\n\t\treturn this.md && this.md.type ? this.md.type.toLowerCase() : '';\n\t}\n\n\tvalueChanged() {\n\t\tif(this.value === undefined && this.isBoolean())\n\t\t\treturn;\n\n\t\tif(!this.rendered) {\n\t\t\tthis.attached();\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.internal && this.template)\n\t\t\tthis.template.value = this.value;\n\t\telse\n\t\t\tthis.obj[this.property] = this.value;\n\n\t\tthis.setPreviouslyFormattedValue();\n\t\tthis.updateTemplateData();\n\t}\n\n\tsetPreviouslyFormattedValue() {\n\t\tthis.previouslyFormatted = this.formattedValue === undefined ? null : JSON.parse(JSON.stringify(this.formattedValue));\n\t}\n\n\tdisabledChanged() {\n\t\tthis.toggleClass('disabled', this.disabled, this.$.formatted);\n\t\tif(this.template)\n\t\t\tthis.template.disabled = this.disabled;\n\n\t\tif(this.renderReadOnly && this.editing)\n\t\t\tthis.updateTemplateData();\n\t}\n\n\thiddenChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.hide = this.hidden;\n\t}\n\n\trecordIdChanged() {\n\t\tif(!this.template)\n\t\t\treturn;\n\n\t\tthis.template.recordId = this.recordId;\n\t}\n\n\trecordChanged(e) {\n\t\tif(!this.template || !e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tthis.template.set(e.path, e.value);\n\t}\n\n\tcomputeRefTable() {\n\t\tif(this.md === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tif(this.md.referenceTable)\n\t\t\treturn this.md.referenceTable;\n\t\t// if no referenceTable property on md, check the referenceTo array property which is same property on field metadata from sb-describe\n\t\treturn this.md.referenceTo && this.md.referenceTo.length > 0 ? this.md.referenceTo[0] : null;\n\t}\n\n\tsetTabindex() {\n\t\t// If a rich text area, set tab index to -1\n\t\tif (this.md.extraTypeInfo === 'richtextarea') {\n\t\t\treturn -1;\n\t\t}\n\t\treturn this.renderReadOnly && this.isEditable() ? 0 : -1;\n\t}\n\n\tlinkOrEdit(e) {\n\t\tif(this.link)\n\t\t\tthis.fire('sb-link-tapped', { value: this.value, Id: this.recordId } ) ;\n\t\telse\n\t\t\tthis.edit(e, true);\n\t}\n\n\tedit(e, clickEdit) {\n\t\tif(!this.isEditable())\n\t\t\treturn;\n\n\t\tthis._render();\n\t\tthis.hideFormattedValue = true; // hide the formattedValue text\n\t\tthis.template[HIDE_FIELD] = false; // show the editable field\n\n\t\t// apply focus to the editable field\n\t\tif(this.template._nodes && this.template._nodes[0].focus)\n\t\t\tthis.template._nodes[0].focus(); // necessary for Firefox\n\n\t\tif(clickEdit)\n\t\t\tthis.invertValueIfInlineBoolean();\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.signalRowFocus();\n\t}\n\n\tgetEventTarget(e) {\n\t\ttry {\n\t\t\treturn Polymer.dom(e).localTarget || e.target;\n\t\t} catch(ex) {\n\t\t\treturn  e.target;\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || (typeof value === 'number' && value + '' === 'NaN');\n\t}\n\n\tapplyFocus() {\n\t\tif(this.template)\n\t\t\tthis.template[APPLY_FOCUS] = this.focus;\n\t}\n\n\tisEditable(returnTrueIfEverEditable) {\n\t\tif(returnTrueIfEverEditable && this._wasEverEditable)\n\t\t\treturn true;\n\n\t\treturn (this.readOnly || (this.renderReadOnly && this.disabled)) ? false : this.editing;\n\t}\n\n\tisReadOnly() {\n\t\treturn this.readOnly || this.renderReadOnly;\n\t}\n\n\tsetFormattedDetails() {\n\t\tthis.$.formatted.isDirty = undefined;\n\t\tthis.$.formatted.link = !!(this.link);\n\t\tthis.$.formatted.type = this.type;\n\t\tthis.$.formatted.booleanValue = this.isBoolean() ? this.obj[this.property] : null;\n\t\tthis.$.formatted.isDirty = this.isDirty;\n\t}\n\n\tisBoolean() {\n\t\treturn this.type === 'boolean' || this.type === 'checkbox';\n\t}\n\n\tisLookup() {\n\t\treturn this.type === 'id' || this.type === 'reference';\n\t}\n\n\taddControlledSelectListener() {\n\t\tif (this.md && this.md.controllerName)\n\t\t\tdocument.addEventListener('sb-controlling-select-changed', this.controllerSelectHandler.bind(this));\n\t}\n\n\tcontrollerSelectHandler(e) {\n\t\tlet tableName = e.detail.tableName;\n\t\tlet fieldName = e.detail.fieldName;\n\t\tlet record = e.detail.record;\n\n\t\tlet sameRecord = typeof this.record.equals === 'function' && record ? this.record.equals(record) : this.record === record;\n\t\tif (tableName !== this.md.tableName || this.md.controllerName !== fieldName || !sameRecord)\n\t\t\treturn; // not a child of the controlling field that has changed, so we bail\n\n\t\t// build the select options for the controlled field and clear the current value if invalid\n\t\tlet valueCleared = this.buildSelectOptions(true);\n\n\t\t// if the current value was not cleared because it was still valid, then need to update explicitly\n\t\t// otherwise the changing value to null would invoke valueChange observer which would do the update for us\n\t\tif (!valueCleared)\n\t\t\tthis.updateTemplateData();\n\t}\n\n\tgetSelectOptions() {\n\t\tif(this._selectOptions)\n\t\t\treturn this._selectOptions;\n\n\t\tthis.buildSelectOptions();\n\t\treturn this._selectOptions;\n\t}\n\n\tbuildSelectOptions(clearInvalidValue) {\n\t\tif(!this.md.controllerName || !this.record) {\n\t\t\tthis._selectOptions = this.md.picklistValues;\n\t\t\treturn false;\n\t\t}\n\n\t\tlet value = typeof this.record.getValue === 'function' ? this.record.getValue(this.md.controllerName) : this.record[this.md.controllerName];\n\t\tthis._selectOptions = new DependentPicklistBuilder(this.md, value).build();\n\t\tif(clearInvalidValue)\n\t\t\treturn this.clearValueIfNotAnOption(this._selectOptions);\n\n\t\treturn false;\n\t}\n\n\tclearValueIfNotAnOption(options) {\n\t\tif(this.value === null)\n\t\t\treturn false;\n\n\t\tlet clearValue = true;\n\t\toptions.forEach( function(option) {\n\t\t\tif (option.value == this.value) {\n\t\t\t\tclearValue = false;\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif(!clearValue)\n\t\t\treturn false;\n\n\t\tif(typeof this.record.setValue === 'function')\n\t\t\tthis.record.setValue(this.property, null);\n\t\telse\n\t\t\tthis.record[this.property] = null;\n\n\t\t// set value to null by simulating an onChange with a null value\n\t\tthis.onChange( { target: { value: null } } );\n\t\treturn true;\n\t}\n\n\tinvertValueIfInlineBoolean() {\n\t\tif(this.renderReadOnly && this.isBoolean()) {\n\t\t\tthis.value = undefined;\n\t\t\tthis.value = !this.obj[this.property];\n\t\t\tthis.internal = true;\n\t\t\tthis.domHost.value = this.value;\n\t\t\tthis.internal = false;\n\t\t\tthis.fire('sb-field-on-change-field');\n\t\t}\n\t}\n\n\t_setWasEverEditable() {\n\t\treturn this._wasEverEditable || this.editing;\n\t}\n}\n\nPolymer( Field );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Input {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-input';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed'\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tinputType: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'text'\n\t\t\t},\n\t\t\trenderReadOnly: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowClear: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showClear(viewport, inputType, disabled)'\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocused: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['hideClearIfEmpty(value, showClear, focused)']\n\t}\n\n\thideClearIfEmpty() {\n\t\tif(!this.showClear)\n\t\t\treturn;\n\t\tif(!this.$$('#clear')) {\n\t\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\t\tthis._hideClearIfEmpty();\n\t\t\t}.bind(this));\n\t\t} else\n\t\t\tthis._hideClearIfEmpty();\n\t}\n\n\t_hideClearIfEmpty() {\n\t\tthis.toggleClass('hide', this.focused || this.value == null || this.value === '' , this.$$('#clear'));\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.input.focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t\tthis.focused = false;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t\tthis.$.input.blur();\n\t}\n\n\thighlight() {\n\t\tthis.focused = true;\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.$.input.setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.$.input.value = this.value;\n\n\t\tthis.fire('sb-input-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_showClear() {\n\t\treturn this.viewport && this.viewport.isMobile() && !this.disabled && this.inputType !== 'date' && this.inputType !== 'datetime';\n\t}\n}\nPolymer(Input);","import {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\n\nexport class Lookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'initTableLabel'\n\t\t\t},\n\t\t\tlimit: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 5\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlabelName: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'label'\n\t\t\t},\n\t\t\tselectedLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSelectedLabel(tableName)'\n\t\t\t},\n\t\t\tmenuItemLabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlookupCallback: {\n\t\t\t\ttype: Function,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn this.lookupResultsCallback.bind(this);\n\t\t\t\t}\n\t\t\t},\n\t\t\thideInputAndShowPill: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t},\n\t\t\tinDialog: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttableLabel: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: 'getLabels(selectedLabel, menuItemLabels)'\n\t\t\t},\n\t\t\tsearchText: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getSearchText(placeholder, tableLabel, i18n)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'showSearch(viewport, inDialog)'\n\t\t\t},\n\t\t\tmobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed:'isMobile(viewport)'\n\t\t\t},\n\t\t\tfieldFullName: String,\n\t\t\thasFilter: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcurrentRecordFilters: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'executeDeferredLookupQuery'\n\t\t\t},\n\t\t\trecord: Object,\n\t\t\tdeferredLookupQuery: Object\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setSelectedItem(value, selectedLabel)',\n\t\t\t\t'setLabel(label)',\n\t\t\t\t'setCallback(customCallback)',\n\t\t\t\t'handleMobileEvents(viewport, inDialog)',\n\t\t\t\t'initFilterMetadata(fieldFullName, hasFilter)',\n\t\t\t\t'setForceSuggest(record.*)'];\n\t}\n\n\tready() {\n\t\tthis.$.object.addEventListener('describe-changed', this.setTableLabel.bind(this));\n\t\tthis.$.typeahead.addEventListener('enter-without-selection',this.handleEnterPressed.bind(this));\n\t\tthis.$.field.addEventListener('response-changed', this.initCurrentRecordFilters.bind(this));\n\t\tthis.$.fields.addEventListener('md-changed', this.setCurrentRecordFilters.bind(this));\n\t}\n\n\tinitFilterMetadata() {\n\t\tif(this.currentRecordFilters || this.internal)\n\t\t\treturn;\n\n\t\tif(this.hasFilter && !AppContext.org.isOAuth)\n\t\t\tthis.disableFilterAndWarnNoOAuth();\n\n\t\tif(this.hasFilter && this.fieldFullName)\n\t\t\tthis.$.field.mdItems = [this.fieldFullName];\n\t\telse\n\t\t\tthis.currentRecordFilters = {};\n\t}\n\n\tinitTableLabel() {\n\t\tif(this.tableName)\n\t\t\tthis.$.object.objects = [this.tableName];\n\t}\n\n\tsetTableLabel(e) {\n\t\tthis.tableLabel = e.detail.value.md[this.tableName].labelPlural;\n\t}\n\t\n\tsetCallback() {\n\t\tthis.lookupCallback = this.customCallback.bind(this);\n\t}\n\n\tlookupResultsCallback(searchValue) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif(!this.tableName) {\n\t\t\t\tresolve([]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(this.currentRecordFilters) {\n\t\t\t\tthis.queryLookupResults(searchValue, resolve, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.deferredLookupQuery = this.queryLookupResults.bind(this, searchValue, resolve, reject);\n\t\t}.bind(this));\n\t}\n\n\tqueryLookupResults(searchValue, resolve, reject) {\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, this.limit, this.currentRecordFilters, this.record, true);\n\t\tlet soql = queryBuilder.build(searchValue);\n\t\tthis.$.q.query({ soql: soql, version: AppContext.apiVersionString }).then(function(response) {\n\t\t\tlet records = response.records;\n\t\t\tlet searchText = searchValue == null ? '' : searchValue;\n\t\t\tlet search = { Id: '', __md__: {class: 'search', searchValue: searchText, clearAfterSelection: !this.inDialog, noFocusAfterSelection: this.inDialog } };\n\t\t\tlet tableLabel = this.tableLabel;\n\t\t\tif(!tableLabel) {\n\t\t\t\t// if table label not yet set from sb-lookup-dialog, then do our best to create a readable table label from the tableName\n\t\t\t\tlet tableParts = this.tableName.split('__');\n\t\t\t\tlet tableLabelPartIndex = tableParts.length > 1 ? tableParts.length - 2 : 0;\n\t\t\t\ttableLabel = tableParts[tableLabelPartIndex];\n\t\t\t}\n\n\t\t\tif(this.isMobile()) {\n\t\t\t\tsearch[this.selectedLabel] = searchText ? this.i18n.l('\"{0}\"', [searchText]) : '';\n\t\t\t\trecords.push(search);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet searchLabel = searchText ? '\"{0}\" in {1}' : ' in {1}';\n\t\t\t\tsearch[this.selectedLabel] = this.i18n.l(searchLabel, [searchText, tableLabel]);\n\t\t\t\trecords = [search].concat(records);\n\t\t\t}\n\t\t\tif(this.inDialog && this.isMobile())\n\t\t\t\tthis.domHost.handleSearchResults(this.limit, {records: records, totalSize: response.totalSize});\n\t\t\telse\n\t\t\t\tresolve(records);\n\t\t}.bind(this), function(error) {\n\t\t\tif(error && (error.message === 'The requested resource does not exist' || error.message === 'bind is not supported for this organization.')) {\n\t\t\t\tAppContext.apiVersion = 36; // return to the default version\n\t\t\t\tif (Object.keys(this.currentRecordFilters).length > 0)\n\t\t\t\t\tthis.disableFilterAndWarnCurrentRecordFiltersNotSupported();\n\t\t\t\tthis.queryLookupResults(searchValue, resolve, reject);\n\t\t\t} else {\n\t\t\t\tlet errorMessage = 'SOQL Execution Error: ' + soql + ' (' + (error && error.message ? error.message : error) + ')';\n\t\t\t\treject(errorMessage);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tsetLabel() {\n\t\tthis._setLabel();\n\t\tif(this.value != null && this.selectedLabel != null)\n\t\t\tthis.setSelectedItem();\n\t}\n\n\tsetSelectedItem() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tif(this.label == null)\n\t\t\treturn;\n\n\t\tlet label = this.getLabel();\n\t\tlet selectedItem = { Id: this.value };\n\t\tselectedItem[this.selectedLabel] = label;\n\t\tthis.$.typeahead.items = this.$.typeahead.items || [ selectedItem ];\n\t\tthis.$.typeahead.selectedItem = selectedItem;\n\t\tthis.setHideInputAndShowPill(this.value);\n\n\t\tthis.focus();\n\n\t\tif(!this._handleSelectedItemChanged) {\n\t\t\tthis._handleSelectedItemChanged = this.handleSelectedItemChanged.bind(this);\n\t\t\tthis.$.typeahead.addEventListener('selected-item-changed', this._handleSelectedItemChanged);\n\t\t}\n\t}\n\n\thandleSelectedItemChanged(e) {\n\t\tif (e.detail.path || e.detail.value == '')\n\t\t\treturn;\n\n\t\tlet md = e.detail.value.__md__;\n\t\tlet searchValue = md && md.searchValue !== undefined ? md.searchValue : undefined;\n\t\tif(searchValue !== undefined) {\n\t\t\tthis.applySearchValue(searchValue);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setHideInputAndShowPill(e.detail.value.Id);\n\t\tthis.focus();\n\n\t\tthis.internal = true;\n\t\tthis.value = e.detail.value.Id || null;\n\t\tthis.label = e.detail.value[this.selectedLabel] || '';\n\t\tthis.internal = false;\n\n\t\tthis._setLabel();\n\t\tthis.fireLookupValueChanged(this.value, this.label, e.detail.value);\n\t}\n\n\tapplySearchValue(searchValue) {\n\t\tif(searchValue && searchValue.detail)\n\t\t\tsearchValue = searchValue.detail.value;\n\n\t\tif(this.inDialog) {// tell host dialog component that the search value has changed\n\t\t\tthis.domHost.searchValue = searchValue;\n\t\t\tthis.domHost.querySearchResults();\n\t\t}\n\t\telse // open the dialog\n\t\t\tthis.fire('iron-signal', {name: 'sb-open-lookup-dialog', data: {\n\t\t\t\tlookup: this,\n\t\t\t\tsearchValue: searchValue\n\t\t}});\n\t}\n\n\thandleEnterPressed(e) {\n\t\tif(this.currentRecordFilters)\n\t\t\tthis.applySearchValue(e.detail.value);\n\t}\n\n\tfireLookupValueChanged(value, label, obj) {\n\t\tlet data = {\n\t\t\tvalue: value,\n\t\t\tobj: obj\n\t\t};\n\t\tdata[this.labelName] = label;\n\t\tthis.fire( 'lookup-value-changed', data );\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.isMobile())\n\t\t\treturn;\n\t\tif(!this.hideInputAndShowPill) {\n\t\t\tthis.$.typeahead.focus(forceSuggest || this.forceSuggest);\n\t\t\tthis.forceSuggest = false;\n\t\t}\n\t\telse if(!this.focusDisabled)\n\t\t\tthis.$.container.focus();\n\t}\n\n\tgetLabel() {\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tlet label = this.labelsByValue[this.value ? this.value.substring(0,15) : this.value];\n\t\tif(this.value && !label) {\n\t\t\tthis.labelsByValue[this.value ? this.value.substring(0,15) : this.value] = this.label;\n\t\t\tlabel = this.label;\n\t\t}\n\t\treturn label;\n\t}\n\n\t_setLabel() {\n\t\tthis.labelsByValue = this.labelsByValue || {};\n\t\tthis.labelsByValue[this.value ? this.value.substring(0,15) : this.value] = this.label;\n\t}\n\n\tsetHideInputAndShowPill(value) {\n\t\tthis.hideInputAndShowPill = !this.isMobile() && !this.isNil(value) && !(this.clearAfterSelection);\n\t}\n\n\tblurContainer() {\n\t\tif(this.hideInputAndShowPill && !this.blurDisabled)\n\t\t\tthis.blur();\n\t}\n\n\tblur() {\n\t\tthis.$.typeahead.setOriginalSelected();\n\t\tthis.fire('sb-type-blur');\n\t}\n\n\tpropagateEscOrHandleDelete(e) {\n\t\tif(e.keyCode === 27) // esc key\n\t\t\tthis.$.typeahead.suggest(e);\n\t\telse if(e.keyCode === 8) {// delete key\n\t\t\tthis.deletePill(); // only works in FF if its about:config > browser:backspace_action is set to 2 - https://support.mozilla.org/en-US/questions/924490\n\t\t\tthis.blurDisabled = !!(this.previousBlurDisabled);\n\t\t}\n\t}\n\n\tpreventBlurOnDelete(e) {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tif(e.keyCode === 8) // delete key\n\t\t\tthis.blurDisabled = true;\n\t}\n\n\tpreventBlur() {\n\t\tthis.previousBlurDisabled = this.blurDisabled;\n\t\tthis.blurDisabled = true;\n\t}\n\n\tdeletePill() {\n\t\tif(!this.disabled)\n\t\t\tthis.$.typeahead.clear();\n\t\tthis.blurDisabled = this.previousBlurDisabled;\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '';\n\t}\n\n\tdialogOpened() {\n\t\tthis.blurDisabled = true;\n\t\tthis.focusDisabled = true;\n\t}\n\n\tdialogClosed() {\n\t\tthis.blurDisabled = false;\n\t\tthis.focusDisabled = false;\n\t\tthis.focus(true);\n\t}\n\n\tgetSelectedLabel() {\n\t\treturn new LookupNameMapper(this.tableName).getNameField();\n\t}\n\n\tgetLabels() {\n\t\treturn this.menuItemLabels || [this.selectedLabel];\n\t}\n\n\tgetSearchText() {\n\t\treturn this.placeholder || this.buildSearchText();\n\t}\n\n\tbuildSearchText() {\n\t\tif(this.i18n && typeof this.i18n.l === 'function')\n\t\t\treturn this.i18n.l('Search {0}', [this.tableLabel]);\n\t\treturn `Search ${this.tableLabel}`;\n\t}\n\n\thandleMobileEvents() {\n\t\tif(!this.isMobile())\n\t\t\treturn;\n\n\t\tif(this.inDialog) {\n\t\t\tthis._clearAndSave = this._clearAndSave || (this.domHost.clearAndSave ? this.domHost.clearAndSave.bind(this.domHost) : null);\n\t\t\tif (this._clearAndSave) {\n\t\t\t\tthis.$.typeahead.removeEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t\tthis.$.typeahead.addEventListener('sb-type-clear', this._clearAndSave);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._applySearchValue = this._applySearchValue || this.applySearchValue.bind(this);\n\t\t\tthis.$.typeahead.removeEventListener('sb-type-focus', this._applySearchValue);\n\t\t\tthis.$.typeahead.addEventListener('sb-type-focus', this._applySearchValue);\n\t\t}\n\t}\n\n\tshowSearch() {\n\t\treturn this.isMobile() && !this.inDialog;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tinitCurrentRecordFilters(e) {\n\t\tlet currentRecordFilters = [];\n\t\tlet filterItems = e.detail.value[0].lookupFilter.filterItems;\n\t\tlet filterItemsArray = filterItems.constructor === Array ? filterItems : [filterItems];\n\t\tfor(let filterItem of filterItemsArray) {\n\t\t\tif(filterItem.field.indexOf('$Source.') === 0) {\n\t\t\t\tlet field = filterItem.field.split('.')[1];\n\t\t\t\tif(currentRecordFilters.indexOf(field) === -1)\n\t\t\t\t\tcurrentRecordFilters.push(field);\n\t\t\t}\n\t\t\tif(filterItem.valueField != null && filterItem.valueField.indexOf('$Source.') === 0) {\n\t\t\t\tlet field = filterItem.valueField.split('.')[1];\n\t\t\t\tif(currentRecordFilters.indexOf(field) === -1)\n\t\t\t\t\tcurrentRecordFilters.push(field);\n\t\t\t}\n\t\t}\n\n\t\tif(currentRecordFilters.length == 0) {\n\t\t\tthis.currentRecordFilters = {};\n\t\t\treturn;\n\t\t}\n\n\t\t// we have more then one current record field, so we need to get its field types\n\t\tlet lookupFieldTable = this.fieldFullName.split('.')[0];\n\t\tlet fields = [];\n\t\tfor(let f of currentRecordFilters)\n\t\t\tfields.push(lookupFieldTable + '.' + f);\n\n\t\tthis.$.fields.fields = fields;\n\t}\n\n\tsetCurrentRecordFilters(e) {\n\t\tlet currentRecordFilters = {};\n\t\tfor(let field of e.detail.value.fields)\n\t\t\tcurrentRecordFilters[field.name] = field.type;\n\t\tthis.currentRecordFilters = currentRecordFilters;\n\t}\n\n\texecuteDeferredLookupQuery() {\n\t\tif(!this.currentRecordFilters)\n\t\t\treturn;\n\n\t\tif(Object.keys(this.currentRecordFilters).length > 0 && AppContext.version < 39)\n\t\t\tthis.disableFilterAndWarnCurrentRecordFiltersNotSupported();\n\n\t\tif(this.deferredLookupQuery) {\n\t\t\tthis.deferredLookupQuery();\n\t\t\tthis.deferredLookupQuery = null;\n\t\t}\n\t}\n\n\tdisableFilterAndWarnCurrentRecordFiltersNotSupported() {\n\t\tthis.internal = true;\n\t\tthis.hasFilter = false;\n\t\tif(this.inDialog && this.domHost)\n\t\t\tthis.domHost.hasFilter = false;\n\t\tthis.internal = false;\n\n\t\tif(this.currentRecordFilterWarning)\n\t\t\treturn;\n\n\t\tthis.currentRecordFilterWarning = `Lookup fields that contain 'Current Record' filter conditions will not have any of its filters applied in the CPQ app until this org upgrades to the Spring 17' release.\\n`;\n\t\tthis.currentRecordFilterWarning += `The lookup field ${this.fieldFullName} contains the following 'Current Record' field(s) as part of its filter definition: ${Object.keys(this.currentRecordFilters).join()}.`;\n\t\tconsole.warn(this.currentRecordFilterWarning);\n\t}\n\n\tdisableFilterAndWarnNoOAuth() {\n\t\tthis.internal = true;\n\t\tthis.hasFilter = false;\n\t\tthis.internal = false;\n\n\t\tif(this.oauthWarning)\n\t\t\treturn;\n\n\t\tthis.oauthWarning = `Lookup fields that contain filter conditions will not work in the CPQ app until the org has been OAuth authorized by a System Administrator.\\n`;\n\t\tthis.oauthWarning += `Navigate to Editor Settings > Documents > Mass Document User Name > Request Authorization to authorize`;\n\t\tconsole.warn(this.oauthWarning);\n\t}\n\n\tsetForceSuggest(e) {\n\t\tif(this.forceSuggest)\n\t\t\treturn;\n\n\t\tif(!e || !e.path || e.path === 'record')\n\t\t\treturn;\n\n\t\tif(!this.hasFilter)\n\t\t\treturn;\n\n\t\tlet currentRecordFiltersKeys = this.currentRecordFilters ? Object.keys(this.currentRecordFilters) : [];\n\t\tif(currentRecordFiltersKeys.length === 0)\n\t\t\treturn;\n\n\t\tlet parts = e.path.split('.');\n\t\tlet property = parts[parts.length-1];\n\t\tif(currentRecordFiltersKeys.indexOf(property) === -1)\n\t\t\treturn;\n\n\t\tthis.forceSuggest = true;\n\t}\n}\n\nPolymer( Lookup );","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LookupQueryBuilder} from 'common/forms/sb-lookup/query/LookupQueryBuilder.js';\n\nexport class LookupDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-lookup-dialog';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tlabel: String,\n\t\t\ttableName: String,\n\t\t\ttableLabel: String,\n\t\t\tfieldLabel: String,\n\t\t\tlabelName: String,\n\t\t\tselectedLabel: String,\n\t\t\tsearchValue: String,\n\t\t\tmetadata: Object,\n\t\t\tnumResults: Number,\n\t\t\tresults: Object,\n\t\t\tinvoker: { // the sb-lookup component that invoked this dialog\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: 'initialize'\n\t\t\t},\n\t\t\tisOAuth: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org ? AppContext.org.isOAuth : false;\n\t\t\t\t}\n\t\t\t},\n\t\t\topenSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trecordSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_isMobile(viewport)'\n\t\t\t},\n\t\t\thideCancel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_hideCancel(isMobile, openSpinner, recordSpinner)'\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['getMetadata(tableName, viewport)'];\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-close-dialog', this.cancel.bind(this));\n\t\tthis.addEventListener('lookup-value-changed', this.setValues.bind(this));\n\t\tthis.$.object.addEventListener('response-changed', this.processSearchLayoutFields.bind(this));\n\t\tthis.$.object.addEventListener('error-changed', this.getMetadataNoOAuth.bind(this));\n\t\tthis.$.fs.addEventListener('response-changed', this.processCPQLayoutFields.bind(this));\n\t\tthis.$.field.addEventListener('md-changed', this.processListFields.bind(this));\n\t\tthis.addEventListener('sb-link-tapped', this.updateLookup.bind(this));\n\t\twindow.addEventListener('resize', this.setResultsHeight.bind(this));\n\t}\n\n\tinitialize() {\n\t\tif(!this.invoker)\n\t\t\treturn;\n\n\t\tthis.labelName = this.invoker.labelName;\n\t\tthis.selectedLabel = this.invoker.selectedLabel;\n\t\tthis.tableName = this.invoker.tableName;\n\t\tthis.fieldLabel = this.invoker.fieldLabel;\n\t\tthis.oauthWarning = this.invoker.oauthWarning;\n\t\tthis.currentRecordFilterWarning = this.invoker.currentRecordFilterWarning;\n\t\tthis.currentRecordFilters = this.invoker.currentRecordFilters;\n\t\tthis.record = this.invoker.record;\n\t\tthis.hasFilter = this.currentRecordFilters && Object.keys(this.currentRecordFilters).length > 0 && AppContext.apiVersion < 39 ? false : this.invoker.hasFilter;\n\t\tthis.fieldFullName = this.invoker.fieldFullName;\n\t}\n\n\topen(searchValue) {\n\t\tthis.$.dialog.toggle();\n\t\tthis.invoker.dialogOpened();\n\t\tthis.$.lookup.$.typeahead.blurred = true;\n\t\tthis.$.lookup.$.typeahead.hasList = false;\n\t\tthis.$.lookup.$.typeahead.labelValue = searchValue;\n\t\tthis.invoker.$.typeahead.$.itemLabel.blur();\n\t\tthis.searchValue = searchValue;\n\t}\n\n\tcancel() {\n\t\tthis.close();\n\t}\n\n\tsaveAndDeferredClose() {\n\t\tthis.syncSelection();\n\t\tthis.deferredClose();\n\t}\n\n\tsave() {\n\t\tthis.syncSelection();\n\t\tthis.close();\n\t}\n\n\tsyncSelection() {\n\t\tthis.invoker.value = undefined;\n\t\tthis.invoker.label = this.label;\n\t\tthis.invoker.value = this.value;\n\t}\n\n\tclearAndSave() {\n\t\tthis.label = null;\n\t\tthis.value = null;\n\t\tthis.save();\n\t}\n\n\tclose() {\n\t\tthis.$.dialog.toggle();\n\t\tthis.$.lookup.$.typeahead.suggest({});\n\t\tthis.invoker.dialogClosed();\n\t\tthis.reset();\n\t\tthis.clearSelected();\n\t}\n\n\n\tdeferredClose() {\n\t\t// defer the closing of the dialog to prevent applying focus in mobile to any input field\n\t\t// directly behind where the dialog was tapped that initiated the close\n\t\t// 350ms seems to be the least amount of time we can delay to ensure the focus does not seep through\n\t\tsetTimeout(function () {\n\t\t\tthis.close();\n\t\t}.bind(this), 350);\n\t}\n\n\treset() {\n\t\tthis.value = null;\n\t\tthis.label = null;\n\t\tthis.results = null;\n\t\tthis.tableLabel = null;\n\t\tthis.fieldLabel = null;\n\t\tthis.fieldFullName = undefined;\n\t\tthis.hasFilter = false;\n\t\tthis.currentRecordFilters = null;\n\t\tthis.record = null;\n\t\tthis.tableName = null;\n\t\tthis.numResults = 0;\n\t\tthis.metadata = undefined;\n\t\tthis.invoker.oauthWarning = this.$.lookup.oauthWarning;\n\t\tthis.invoker.currentRecordFilterWarning = this.$.lookup.currentRecordFilterWarning;\n\t\tthis.oauthWarning = null;\n\t\tthis.currentRecordFilterWarning = null;\n\t\tthis.$.header.cols = undefined;\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tthis.$.object.response = null;\n\t\tthis.$.fs.response = null;\n\t\tthis.$.fs.uid = undefined;\n\t\tthis.invoker = null;\n\t}\n\n\tsetValues(e) {\n\t\tthis.value = e.detail.value;\n\t\tthis.label = e.detail[this.labelName];\n\t}\n\n\tupdateLookup(e) {\n\t\tthis.label = undefined;\n\t\tthis.value = e.detail.Id;\n\t\tthis.label = this.getSelectedLabelValueById(e.detail.Id);\n\t}\n\n\tgetSelectedLabelValueById(id) {\n\t\tfor(let result of this.results) {\n\t\t\tif(result.Id === id)\n\t\t\t\treturn result[this.selectedLabel];\n\t\t}\n\t}\n\n\tgetMetadataNoOAuth() {\n\t\tthis.isOAuth = false;\n\t\tthis.getMetadata();\n\t}\n\n\tgetMetadata() {\n\t\tif(!this.tableName)\n\t\t\treturn;\n\n\t\tthis.openSpinner = true;\n\t\tif(this.isOAuth)\n\t\t\tthis.$.object.mdItems = [this.tableName];\n\t\telse\n\t\t\tthis.$.fs.uid = `${this.tableName}.CPQ_Lookup`;\n\t}\n\n\tprocessSearchLayoutFields(e) {\n\t\tif(!e.detail.value)\n\t\t\treturn;\n\t\t\n\t\tthis.tableLabel = e.detail.value[0].label;\n\t\tif(this.isMobile) {\n\t\t\tthis.initMobileMetadata();\n\t\t\treturn;\n\t\t}\n\n\t\tlet fs = e.detail.value[0].fieldSets;\n\t\tlet fieldSets = !fs ? [] : (fs.constructor === Array ? fs : [fs]);\n\n\t\t// first check if object metadata has CPQ_Lookup field set, if so use its fields\n\t\tlet lookupFields = this.getCpqLookupFields(fieldSets);\n\n\t\tif(!lookupFields) {// if no CPQ_Lookup field set, attempt to use the searchLayouts.searchResultsAdditionalFields fields\n\t\t\tthis.warnUserAboutCPQLayoutFieldSet();\n\t\t\tlet sr = e.detail.value[0].searchLayouts.searchResultsAdditionalFields;\n\t\t\tlet searchResults = !sr ? [] : (sr.constructor === Array ? sr : [sr]);\n\t\t\tlookupFields = this.getSearchResultsAdditionalFields(searchResults);\n\t\t}\n\n\t\tlookupFields = this.ensureNameField(lookupFields);\n\t\tthis.$.field.fields = lookupFields;\n\t}\n\n\tprocessCPQLayoutFields(e) {\n\t\tif(!e.detail.value)\n\t\t\treturn;\n\n\t\tthis.tableLabel = e.detail.value.label;\n\t\tif(this.isMobile) {\n\t\t\tthis.initMobileMetadata();\n\t\t\treturn;\n\t\t}\n\n\t\tlet fields = [];\n\t\tlet fs = e.detail.value.fields;\n\t\tif(fs.length === 0) {\n\t\t\tthis.warnUserAboutCPQLayoutFieldSet();\n\t\t} else {\n\t\t\tfor(let field of fs)\n\t\t\t\tfields.push(this.tableName + '.' + field);\n\t\t}\n\n\t\tfields = this.ensureNameField(fields);\n\t\tthis.$.field.fields = fields;\n\t}\n\n\tprocessListFields(e) {\n\t\tlet fields = e.detail.value.fields;\n\t\tlet fieldNames =[];\n\t\tlet fieldLabels =[];\n\t\tlet fieldTypeByName = {};\n\t\tlet fieldTypeObjByName = {};\n\t\tlet fieldTypeByLabel = {};\n\t\tlet fieldsOfTypeLookup = [];\n\t\tfor(let i = 0, l = fields.length; i < l; i++) {\n\t\t\tlet field = fields[i];\n\t\t\tlet type = { type: field.type, link: i === 0 };\n\t\t\tfieldNames.push(field.name);\n\t\t\tfieldLabels.push(field.label);\n\t\t\tfieldTypeByName[field.name] = field.type;\n\t\t\tfieldTypeObjByName[field.name] = type;\n\t\t\tfieldTypeByLabel[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\tif(field.type === 'reference' || field.type === 'id')\n\t\t\t\tfieldsOfTypeLookup.push({name: field.name, table: field.referenceTo[0]});\n\t\t}\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(fieldTypeByLabel), 'Th', fieldTypeByLabel).build();\n\t\tthis.rowClassMap = new TableClassBuilder(fieldNames, 'Td', fieldTypeByName).build();\n\t\tthis.metadata = { fieldNames: fieldNames, fieldLabels: fieldLabels, fieldTypeObjByName: fieldTypeObjByName, fieldsOfTypeLookup: fieldsOfTypeLookup };\n\t\tthis.querySearchResults();\n\t}\n\n\tquerySearchResults() {\n\t\tthis.recordSpinner = !this.openSpinner;\n\t\tlet limit = 100;\n\t\tlet queryBuilder = new LookupQueryBuilder(this.tableName, this.selectedLabel, this.hasFilter, this.fieldFullName, limit + 1, this.currentRecordFilters, this.record, false, this.metadata);\n\t\tlet soql = queryBuilder.build(this.searchValue);\n\t\tthis.$.query.query({ soql: soql }).then(this.handleSearchResults.bind(this, limit));\n\t}\n\n\thandleSearchResults(limit, response) {\n\t\tthis.clearSelected();\n\t\tlet plus = response.totalSize > limit ? '+' : '';\n\t\tlet totalSize = Math.min(limit, response.totalSize);\n\t\tthis.numResults = totalSize + plus;\n\t\tthis.results = this.getResults(response, limit);\n\t\tthis.recordSpinner = false;\n\t\tthis.openSpinner = false;\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = null; // iOS mobile has quirk where the overflow style must be cleared and reset\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis.setResultsHeight();\n\t\t}.bind(this));\n\t}\n\n\tgetResults(response, limit) {\n\t\tlet results = response.records;\n\t\tlet numResults = response.totalSize;\n\t\tlet isMobileWithSpotlight = this.isMobile && results.length > numResults;\n\t\tlet mobileSpotlight = isMobileWithSpotlight ? results.pop() : null;\n\t\t// ensure number of results matches the limit\n\t\twhile(numResults > limit) {\n\t\t\tresults.pop();\n\t\t\tnumResults--;\n\t\t}\n\t\t// add back the mobile spotlight\n\t\tif(mobileSpotlight)\n\t\t\tresults.push(mobileSpotlight);\n\t\t// add mobile decorated mobile spotlight result for display purposes\n\t\tif(isMobileWithSpotlight)\n\t\t\tresults[numResults][this.selectedLabel] = `<div class=\"sb-html ${results[numResults]['__md__'].class}\">${results[numResults][this.selectedLabel]}</div>`;\n\t\treturn results;\n\t}\n\n\tsetResultsHeight() {\n\t\tlet offsetBottom = !this.isMobile ? this.$.dialog.$$('#footer').offsetTop : document.documentElement.clientHeight;\n\t\tlet offset = offsetBottom - this.$.tbody.offsetTop;\n\t\tlet scrollHeight = this.$.tbody.scrollHeight;\n\t\tlet height = offset < scrollHeight ? (offset + 'px') : null;\n\t\tthis.$.tbody.style.height = height;\n\t\tlet mask = this.$.spinner.$$('#mask');\n\t\tmask.style.height = offset + 'px';\n\t\tif(this.isMobile)\n\t\t\tthis.$.tbody.style.overflow = 'auto'; // set overflow in mobile in this render cycle to handle iOS quirk\n\t\telse\n\t\t\tmask.style.marginLeft = '-24px';\n\t}\n\n\tgetCpqLookupFields(fieldSets) {\n\t\tlet fields = [];\n\t\tfor(let fieldSet of fieldSets) {\n\t\t\tif(fieldSet.label !== 'CPQ_Lookup')\n\t\t\t\tcontinue;\n\n\t\t\tlet df = fieldSet.displayedFields;\n\t\t\tlet displayedFields = !df ? [] : (df.constructor === Array ? df: [df]);\n\t\t\tfor(let displayedField of displayedFields) {\n\t\t\t\tlet field = displayedField.field;\n\t\t\t\tif(field.split('.').length === 1) // only support fields directly on table\n\t\t\t\t\tfields.push(this.tableName + '.' + field);\n\t\t\t}\n\n\t\t\treturn fields;\n\t\t}\n\t}\n\n\tgetSearchResultsAdditionalFields(searchResultsAdditionalFields) {\n\t\tlet fields = [];\n\t\tfor(let field of searchResultsAdditionalFields) {\n\t\t\tlet parts = field.split('.');\n\t\t\tif(parts.length !== 1 && (this.tableName.toLowerCase() !== parts[0].toLowerCase() || parts.length !== 2))\n\t\t\t\tcontinue; // only support fields directly on the table\n\n\t\t\tlet fieldName;\n\t\t\tif(parts.length === 1 && parts[0].endsWith('__c'))\n\t\t\t\tfieldName = parts[0]; // custom field on standard object\n\t\t\telse if(parts.length === 2 && parts[1].endsWith('__c'))\n\t\t\t\tfieldName = parts[1]; // custom field on custom object\n\t\t\telse {\n\t\t\t\t// if not a custom field the provided searchResults field names are actually the DB column names\n\t\t\t\t// so now we try our best to map this to a logical field name of the standard field\n\t\t\t\tlet dbFieldName = parts[parts.length-1];\n\t\t\t\t// split by underscore\n\t\t\t\tlet dbParts = dbFieldName.split('_');\n\t\t\t\tfor(let i = 0, l = dbParts.length; i < l; i++) {\n\t\t\t\t\t// make each part have first letter upper case and remove all numbers\n\t\t\t\t\tlet dbPart = dbParts[i].toLowerCase();\n\t\t\t\t\tdbPart = dbPart.charAt(0).toUpperCase() + dbPart.slice(1);\n\t\t\t\t\tdbPart = dbPart.replace(/[0-9]/g, '');\n\t\t\t\t\tdbParts[i] = dbPart;\n\t\t\t\t}\n\t\t\t\tfieldName = dbParts.join('');\n\t\t\t}\n\t\t\tfields.push(this.tableName + '.' + fieldName);\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tensureNameField(fields) {\n\t\tif(fields.indexOf(this.tableName + '.' + this.selectedLabel) === -1)\n\t\t\tfields = [this.tableName + '.' + this.selectedLabel].concat(fields);\n\t\treturn fields\n\t}\n\n\twarnUserAboutCPQLayoutFieldSet() {\n\t\tconsole.warn(`Add a field set named \"CPQ_Lookup\" to the \"${this.tableLabel}\" object to better control the fields displayed in its corresponding lookup field popup in CPQ`);\n\t}\n\n\tinitMobileMetadata() {\n\t\tlet rowClassMap = {};\n\t\trowClassMap[this.selectedLabel] = 'lookupItemTd';\n\t\tthis.rowClassMap = rowClassMap;\n\t\tthis.metadata = { fieldNames: [this.selectedLabel], fieldLabels: [], fieldTypeObjByName: {}, fieldsOfTypeLookup: [] };\n\t\tthis.$.lookup.lookupResultsCallback(this.searchValue);\n\t}\n\n\tmobileSelection(e) {\n\t\tif(!this.isMobile)\n\t\t\treturn;\n\n\t\tlet row = Polymer.dom(e).localTarget;\n\t\tthis.setSelected(row);\n\t\tif(row.hasAttribute('data-search')) {\n\t\t\tthis.searchValue = row.getAttribute('data-search');\n\t\t\tthis.querySearchResults();\n\t\t} else {\n\t\t\tthis.value = row.getAttribute('data-id');\n\t\t\tthis.label = row.getAttribute('data-name');\n\t\t\tthis.saveAndDeferredClose();\n\t\t}\n\t}\n\n\tgetSearchValue(row) {\n\t\tif(row && !row.Id)\n\t\t\treturn row['__md__'].searchValue;\n\t}\n\n\tgetNameValue(row) {\n\t\treturn row[this.selectedLabel];\n\t}\n\n\tsetSelected(row) {\n\t\tthis.selected = row.$.row.$$('sb-table-cell');\n\t\tthis.toggleClass('selectedLookupItem', true, this.selected);\n\t}\n\n\tclearSelected() {\n\t\tif(this.selected)\n\t\t\tthis.toggleClass('selectedLookupItem', false, this.selected);\n\t}\n\n\t_hideCancel() {\n\t\treturn !this.isMobile || this.openSpinner || this.recordSpinner;\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n\nPolymer(LookupDialog);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class MultiLookup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-multi-lookup';\n\t\tthis.properties = {\n\t\t\ttableName: String,\n\t\t\tobjectName: String,\n\t\t\thideCancel: Boolean,\n\t\t\ticonName: String,\n\t\t\ticonMap: Object,\n\t\t\tresults: Array,\n\t\t\tselectedItems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tselectedIdsByItems: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tcustomCallBack: Function,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: Boolean\n\t\t};\n\t}\n\n\tupdateTable(results) {\n\t\tthis.results = results;\n\t}\n\n\tready() {\n\t\t// eventlistener on lookup (lookup changed)\n\t\tthis.$.lookup.addEventListener('lookup-value-changed', function (e) {\n\t\t\tlet selectedItem = e.detail.obj;\n\t\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\t\tthis._addItem(selectedItem);\n\t\t\t} else {\n\t\t\t\tthis._animateDuplicate(selectedItem);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tif (this.viewport && this.viewport.isMobile())\n\t\t\tthis._appendMobileClasses();\n\t}\n\n\t_addItem(item) {\n\t\tthis.selectedIdsByItems[item.Id] = item;\n\t\tthis.unshift('selectedItems', item);\n\t\tPolymer.dom.flush();\n\t\tif (this.iconName && this.iconMap)\n\t\t\tthis.toggleClass(this.iconMap[item[this.iconName]], true, this.$$(`.pill-icon`));\n\t}\n\n\t_animateDuplicate(item) {\n\t\tlet pills = Polymer.dom(this.$.selectedContainer).querySelectorAll('.pill');\n\t\tfor (let i=0; i<pills.length;i++) {\n\t\t\tif (pills[i].dataValue == item.Id) {\n\t\t\t\tpills[i].addEventListener('webkitAnimationEnd', function() {\n\t\t\t\t\tthis.toggleClass('invalid-selection', false, pills[i]);\n\t\t\t\t}.bind(this), false);\n\t\t\t\tthis.toggleClass('invalid-selection', true, pills[i]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t_appendMobileClasses() {\n\t\tthis.isMobile = true;\n\t\tthis.toggleClass('mobile', true, this.$.multilookup);\n\t\tthis.toggleClass('mobile', true, this.$.selectedContainer);\n\t\tthis.toggleClass('mobile', true, this.$.lookupContainer);\n\t\tthis.toggleClass('mobile', true, this.$.resultsTable);\n\t}\n\n\tremoveItem(e) {\n\t\tthis.splice('selectedItems', Polymer.dom(e.target).parentNode.dataIndex, 1);\n\t\tdelete this.selectedIdsByItems[Polymer.dom(e.target).parentNode.dataValue];\n\t}\n\n\tselectRow(e) {\n\t\tlet selectedItem = this.results[e.currentTarget.index];\n\t\tif (!this.selectedIdsByItems[selectedItem.Id]) {\n\t\t\tthis._addItem(selectedItem);\n\t\t} else {\n\t\t\tthis._animateDuplicate(selectedItem);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.selectedItems = [];\n\t\tthis.selectedIdsByItems = {};\n\t}\n\n}\n\nPolymer( MultiLookup );","export class Pagination {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pagination';\n\t\tthis.properties = {\n\t\t\tpageIndex: { // the current page the pagination widget is on\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tpageSize: Number, // the number of items per page\n\t\t\tnumItems: Number // the number of total items\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['setNumberOfPages(pageSize, numItems)', 'setPageWindow(pageIndex, pageSize, numItems)', 'setNextDisabled(pageIndex, numPages)', 'setPreviousDisabled(pageIndex)', 'setPageNum(pageIndex)']\n\t}\n\n\tnext() {\n\t\tthis.pageIndex++;\n\t\tthis.firePageEvent('next');\n\t}\n\n\tprevious() {\n\t\tthis.pageIndex--;\n\t\tthis.firePageEvent('previous');\n\t}\n\n\tsetNumberOfPages() {\n\t\tthis.numPages = Math.ceil(this.numItems / this.pageSize);\n\t}\n\n\tsetPageWindow() {\n\t\tlet start = this.pageIndex * this.pageSize;\n\t\tlet end = start + this.pageSize;\n\t\tif(end >= this.numItems)\n\t\t\tend = this.numItems;\n\t\tthis.pageWindow = [start, end];\n\t}\n\n\tsetNextDisabled() {\n\t\tthis.nextDisabled = this.pageIndex === (this.numPages - 1);\n\t}\n\n\tsetPreviousDisabled() {\n\t\tthis.previousDisabled = this.pageIndex === 0;\n\t}\n\n\tsetPageNum() {\n\t\tthis.pageNum = this.pageIndex + 1;\n\t}\n\n\tfirePageEvent(direction) {\n\t\tthis.fire('pagination-changed', {direction: direction, page: this.pageNum, index: this.pageIndex, window: this.pageWindow});\n\t}\n}\n\nPolymer(Pagination);","/**\n * A RichTextEditor component class.\n */\nexport class RichTextEditor {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-rte';\n\t\tthis.properties = {\n\t\t\t/** The rich text value, i.e. a string of HTML */\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t};\n\t}\n\n\tattached() {\n\t\tif (this.renderReadOnly) {\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\tfocus() {\n\t\tthis.fire('iron-signal', {name : 'sb-open-rte-dialog', data : {rte: this, value: this.value}});\n\t}\n\n}\n\nPolymer( RichTextEditor );\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class Select {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-select';\n\t\tthis.properties = {\n\t\t\tvalue: { // the value of the selected option\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\toptions: Array, // array of objects with the keys 'value' and 'label'\n\t\t\tisRequired: { // true if this is a required field\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tnoneLabel: { // if not required, value of the first option that represents no selection\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tmultiSelect: Boolean,\n\t\t\tsize: Number,\n\t\t\t_multiple: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setMultiple(multiSelect)'\n\t\t\t},\n\t\t\t_options: Array\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildOptions(options, isRequired)', 'setSelected(value, _options)']\n\t}\n\n\tbuildOptions() {\n\t\tlet noneSelected = true;\n\t\tlet options = [];\n\t\tlet values = this._getValues();\n\t\tfor (let i = 0, l = this.options.length; i < l; i++) {\n\t\t\tlet option = this.options[i];\n\t\t\tlet selected = values.indexOf(option.value.toString()) !== -1;\n\t\t\tnoneSelected = noneSelected && !selected;\n\t\t\toptions.push( { value: option.value, label: option.label, selected: selected } );\n\t\t}\n\n\t\tif (noneSelected && values.length > 0) {\n\t\t\tfor(let val of values)\n\t\t\t\toptions.push({ value: val, label: val, selected: true });\n\t\t\tnoneSelected = false;\n\t\t}\n\n\t\tif (noneSelected || !this.isRequired)\n\t\t\toptions = [ { value: '', label: this.noneLabel, selected: noneSelected } ].concat(options);\n\n\t\tif (AppContext.isIE()) {\n\t\t\tlet select = Polymer.dom(this.$.select);\n\t\t\tlet childNodes = select.childNodes;\n\t\t\tfor (let i = 0, l = childNodes.length; i < l; i ++) {\n\t\t\t\tselect.removeChild(childNodes[i]);\n\t\t\t}\n\t\t\tfor (let j = 0, len = options.length; j < len; j++) {\n\t\t\t\tthis._createOptionElements(this.$.select, options[j]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._options = options;\n\t\t}\n\t}\n\n\t_createOptionElements(select, option) {\n\t\tlet optionEl = document.createElement('option');\n\t\toptionEl.label = option.label;\n\t\toptionEl.value = option.value;\n\t\toptionEl.selected = option.selected;\n\t\tselect.appendChild(optionEl);\n\t}\n\n\tsetSelected() {\n\t\tif(this.internal)\n\t\t\treturn;\n\n\t\tlet values = this._getValues();\n\t\tfor(let i = 0, l = this._options.length; i < l; i++) {\n\t\t\tthis._options[i].selected = values.indexOf(this._options[i].value.toString()) !== -1;\n\t\t\tif(this.$.select.options[i])\n\t\t\t\tthis.$.select.options[i].selected = values.indexOf(this.$.select.options[i].value.toString()) !== -1;\n\t\t}\n\t}\n\n\tchange() {\n\t\tlet options = this.$.select.options;\n\t\tlet value = null;\n\t\tfor(let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (!AppContext.isIE())\n\t\t\t\tthis._options[i].selected = options[i].selected;\n\n\t\t\tif (!options[i].selected)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.multiSelect && value != null)\n\t\t\t\tvalue += (';' + options[i].value);\n\t\t\telse\n\t\t\t\tvalue = options[i].value;\n\t\t}\n\t\tthis.internal = true;\n\t\tthis.value = value;\n\t\tthis.internal = false;\n\n\t\tthis.fire('change', { value: this.value } );\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.select.focus();\n\t}\n\n\tblur() {\n\t\tthis.fire('blur');\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_setMultiple() {\n\t\treturn this.multiSelect ? true : undefined;\n\t}\n\n\t_getValues() {\n\t\treturn Select.getValues(this.value, this.multiSelect);\n\t}\n\n\tstatic getValues(value, multiSelect) {\n\t\tif(value != null && value !== '')\n\t\t\treturn multiSelect ? value.split(';') : [value.toString()];\n\t\treturn [];\n\t}\n}\n\nPolymer(Select);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class Textarea {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-textarea';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\ttype: String,\n\t\t\t\tobserver: 'changed'\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tattached() {\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\tfocus() {\n\t\tthis.$.textarea.focus();\n\t}\n\n\tblur() {\n\t\tthis.fireChangeOnBlur();\n\t\tthis.fire('blur');\n\t}\n\n\thighlight() {\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn;\n\t\tlet length = this.value ? this.value.length : 0;\n\t\tthis.$.textarea.setSelectionRange(0, length);\n\t}\n\n\tchanged(newValue, oldValue) {\n\t\tif(oldValue === undefined) {\n\t\t\t// prevents change event being fired on load, but also prevents user change event when initial value is undefined\n\t\t\t// so to ensure latter use case is handled, fire change event explicitly on next blur\n\t\t\tthis.changeOnNextBlur = true;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.changeOnNextBlur = false;\n\t\tif(oldValue == newValue) // double equals is expected, allow coercion\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(newValue);\n\t}\n\n\tfireChangeEvent(value) {\n\t\tthis.fire('change', { value: value } );\n\t}\n\n\tfireChangeOnBlur() {\n\t\tif(!this.changeOnNextBlur)\n\t\t\treturn;\n\n\t\tthis.fireChangeEvent(this.value);\n\t\tthis.changeOnNextBlur = false;\n\t}\n\n\tpropagateEsc(e) {\n\t\tif(e.keyCode !== 27)\n\t\t\treturn; // only proceed if escape key\n\n\t\tif(this.renderReadOnly)\n\t\t\tthis.$.textarea.value = this.value;\n\n\t\tthis.fire('sb-textarea-key', { keyCode: 27 } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n}\nPolymer(Textarea);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nconst wildCards = new RegExp('[*_%]+', 'g');\nlet resultLimit = 10; // first 10 matching items\n\n\nexport class Typeahead {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-typeahead';\n\n\t\tthis.properties = {\n\t\t\t// users can give items as input or provide a callback that sets items. An optional debounce parameter with\n\t\t\t// callback ensures that the callback is called only after some delay in millis. Default value for debounce is 1s.\n\t\t\titems: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\titemsCallback: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdebounceDelay: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 300\n\t\t\t},\n\t\t\tselectedItem:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titemsList: {\n\t\t\t\ttype: Array,\n\t\t\t\tobserver: 'itemsListChanged',\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('labels') || ['label'];\n\t\t\t\t}\n\t\t\t},\n\t\t\tlabelValue: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tdelimiter: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn this.getAttribute('delimiter') || '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tsavedLabelValue: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tinvalidLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasList: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: '_calculateListPosition'\n\t\t\t},\n\t\t\thasLabel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\toptionIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfocusOnAttached: Boolean,\n\t\t\tapplyFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_applyFocus'\n\t\t\t},\n\t\t\thideCancelIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tclearAfterSelection: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tblurDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tfocusDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\trevertOnEscape: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowSearchIcon: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tcalculateListPosition: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListNoSuggestion: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowListOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thideInput: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\n\t\tthis.observers = ['itemsChanged(items, labels)', 'selectedItemChanged(selectedItem, value)'];\n\t}\n\n\tready() {\n\t\tthis.$.itemLabel.addEventListener('focus', this._directInputFocus.bind(this));\n\t\tthis.$.itemLabel.addEventListener('blur', this._directInputBlur.bind(this));\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\t\tif(this.focusOnAttached)\n\t\t\tthis.focus();\n\t}\n\n\titemsChanged() {\n\t\tif(this.items.length)\n\t\t\tthis.itemsList = this.updateItemsList();\n\t}\n\n\tselectedItemChanged() {\n\t\tif (this.selectedItem) {\n\t\t\tlet md = this.selectedItem.__md__;\n\t\t\tlet clearAfterSelection = md ? md.clearAfterSelection : false;\n\n\t\t\tthis.valueAttr = this.value ? this.value : 'value';\n\t\t\tthis.labelValue = this.selectedItem[this.valueAttr];\n\n\t\t\tif (this.clearAfterSelection || clearAfterSelection) {\n\t\t\t\tthis.selectedItem = '';\n\t\t\t\tthis.items = this.itemsList = [];\n\t\t\t}\n\t\t\tif(!this.originalSelected)\n\t\t\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem));\n\t\t}\n\t}\n\n\titemsListChanged() {\n\t\tPolymer.dom.flush(); // need to update DOM before updating innerHTML of the new elements on the list\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tif(!options) return;\n\t\tlet numOfOptions = options.length;\n\t\tlet numOfLabels = this.labels.length;\n\t\tif ( numOfOptions > 0 ) {\n\t\t\tthis.optionIndex = -1; // highlights the characters\n\t\t\tfor ( let i = 0; i < numOfOptions; i++ ) { // highlight matching characters in the label\n\t\t\t\tlet item = this.itemsList[i],\n\t\t\t\t\thtml = '';\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet label = this.labels[j],\n\t\t\t\t\t\tdelimiter = ( j===0 ) ? '' : this.delimiter,\n\t\t\t\t\t\tlabelValue = item[label];\n\t\t\t\t\thtml += delimiter + labelValue;\n\t\t\t\t}\n\t\t\t\toptions[i].innerHTML = html;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedItemValue() {\n\t\treturn this.selectedItem ? this.selectedItem[this.valueAttr] : '';\n\t}\n\n\tclear() {\n\t\tthis.hide();\n\t\tthis.updateItem({}, true);\n\t\tthis.fire('sb-type-clear');\n\t}\n\n\thide() {\n\t\tthis.hideList();\n\t\tthis.invalidLabel = false;\n\t\tthis.optionIndex = -1;\n\t}\n\n\tcloneItem(item) {\n\t\tlet clone = {},\n\t\t\tkeys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tfor ( let i = 0; i < len; i++ ) {\n\t\t\tlet key = keys[i];\n\t\t\tclone[key] = item[key];\n\t\t}\n\t\treturn clone;\n\t}\n\n\tupdateItem(item, forceSuggestOnFocus) {\n\t\t//update selectedItem\n\t\tlet keys = Object.keys(item),\n\t\t\tlen = keys.length;\n\t\tlet selectedItem = {};\n\t\tfor ( let i=0; i < len; i++) {\n\t\t\tlet key = keys[i];\n\t\t\tselectedItem[key] = item[key] !== undefined ? item[key] : '';\n\t\t}\n\t\tthis.selectedItem = selectedItem;\n\t\t//update value in the input box\n\t\tlet labelValue = '',\n\t\t\tnumOfLabels = this.labels.length;\n\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\tlet delimiter = ( j===0 ) ? '' : this.delimiter;\n\t\t\tlet selectedLabel = this.selectedItem[this.labels[j]];\n\t\t\tif(selectedLabel)\n\t\t\t\tlabelValue += delimiter + selectedLabel;\n\t\t}\n\n\t\tlet md = this.selectedItem.__md__;\n\t\tthis.labelValue = md && !md.clearAfterSelection && md.searchValue !== undefined ? md.searchValue : labelValue;\n\n\t\tthis.clearSelection();\n\t\tthis.focusOrBlurAfterSelection(this.selectedItem, forceSuggestOnFocus);\n\t}\n\n\tsubmitItem(e) {\n\t\tlet item = e.model.item;\n\t\tthis.updateItem(item);\n\t\tthis.hide();\n\t\tthis.focusOrBlurAfterSelection(item)\n\t}\n\n\tfocusOrBlurAfterSelection(item, forceSuggestOnFocus) {\n\t\tif(!item || !item.__md__ || !item.__md__.noFocusAfterSelection)\n\t\t\tthis.focus(forceSuggestOnFocus);\n\t\telse\n\t\t\tthis.$.itemLabel.blur();\n\t}\n\n\tselectAdjacentItem(keyCode) {\n\t\t// keycode 40 => arrow-down, 38 arrow-up\n\t\tif(!this.itemsList)\n\t\t\treturn;\n\t\tlet len = this.itemsList.length;\n\t\tif ( this.optionIndex >= 0 && this.optionIndex < len ) {\n\t\t\tthis.$.selector.children[this.optionIndex].removeAttribute( 'selected' );\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === 0 ? len - 1 : this.optionIndex - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = this.optionIndex === len - 1 ? 0 : this.optionIndex + 1;\n\t\t\t}\n\t\t} else if (this.optionIndex === -1) {\n\t\t\tif ( keyCode === 38 ) {\n\t\t\t\tthis.optionIndex = len - 1;\n\t\t\t} else if ( keyCode === 40 ) {\n\t\t\t\tthis.optionIndex = 0;\n\t\t\t}\n\t\t}\n\t\tthis.$.selector.children[this.optionIndex].setAttribute( 'selected', '' );\n\t}\n\n\tupdateItemsList() {\n\t\tlet result = [],\n\t\t\thighlighted = false;\n\t\tif (this.showListNoSuggestion || this.labelValue) {\n\t\t\tlet labelValue = this.labelValue || '';\n\t\t\tlet searchLabel = labelValue.replace(/\\+/g, '\\\\+').replace(/\\\\/g, '\\\\\\\\').replace( wildCards, '.+'), //capture wild card characters (1 or more)\n\t\t\t\tsearchText = new RegExp( searchLabel, 'i' );\n\n\t\t\tlet numOfItems = this.items.length,\n\t\t\t\tnumOfLabels = this.labels.length;\n\t\t\tfor ( let i = 0; i < numOfItems; i++ ) {\n\t\t\t\tlet item = this.items[i],\n\t\t\t\t\tclone = this.cloneItem(item); // clone item to preserve original object\n\t\t\t\tfor ( let j=0; j < numOfLabels; j++) {\n\t\t\t\t\tlet itemLabel = item[this.labels[j]];\n\t\t\t\t\tif ( itemLabel && (this.showListNoSuggestion || searchText.test(itemLabel)) ) {\n\t\t\t\t\t\tlet label = '_' + this.labels[j]; // create a new label for internally storing the highlighted html text\n\t\t\t\t\t\tclone[label] = itemLabel.replace( searchText, '<span style=\"font-weight:bold;\">$&</span>' );\n\t\t\t\t\t\thighlighted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( highlighted ) {\n\t\t\t\t\tresult.push(clone);\n\t\t\t\t\thighlighted = false;\n\t\t\t\t}\n\t\t\t\tif ( result.length >= resultLimit ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tsuggest(e) {\n\t\tif(!this.isAttached)\n\t\t\treturn;\n\n\t\tswitch( e.keyCode ) {\n\t\t\tcase 13: //enter - submit the selected option\n\t\t\t\tif(this.hasList) {\n\t\t\t\t\tif (this.optionIndex === -1)\n\t\t\t\t\t\tthis.optionIndex = 0;\n\t\t\t\t\tthis.updateItem(this.itemsList[this.optionIndex]);\n\t\t\t\t\tthis.noBlur = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.fire('enter-without-selection', {value: this.labelValue});\n\t\t\t\tthis.hide();\n\t\t\t\tbreak;\n\t\t\tcase 27: // esc - preserve old/originally persisted value\n\t\t\t\tif(this.revertOnEscape) {\n\t\t\t\t\tthis.updateItem(this.originalSelected);\n\t\t\t\t\tthis.items = undefined;\n\t\t\t\t\tthis.hideList();\n\t\t\t\t\tthis.clearSelection();\n\t\t\t\t\tthis.fire('sb-type-blur');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 38: // up arrow\n\t\t\tcase 40: // down arrow - move trough matching list items\n\t\t\t\tthis.selectAdjacentItem( e.keyCode );\n\t\t\t\tbreak;\n\t\t\tcase 9: // tab key\n\t\t\tcase 16: // shift key\n\t\t\t\tbreak;\n\t\t\tdefault: // re-build itemsList\n\t\t\t\tthis.invalidLabel = false;\n\t\t\t\tif(this.itemsCallback) {\n\t\t\t\t\tthis.debounce('itemsCallback', function () {\n\t\t\t\t\t\tlet promise = this.itemsCallback(this.labelValue);\n\t\t\t\t\t\tpromise.then(\n\t\t\t\t\t\t\t(function (items) {\n\t\t\t\t\t\t\t\tif(items && items.length > 0)\n\t\t\t\t\t\t\t\t\tthis.showList();\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tthis.hideList();\n\t\t\t\t\t\t\t\tthis.items = items;\n\t\t\t\t\t\t\t}).bind(this),\n\t\t\t\t\t\t\t(function (error) {\n\t\t\t\t\t\t\t\tconsole.error(error && error.message ? error.message : error);\n\t\t\t\t\t\t\t\tthis.items = []\n\t\t\t\t\t\t\t}).bind(this));\n\t\t\t\t\t}, this.debounceDelay);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.showList();\n\t\t\t\t\tthis.itemsList = this.updateItemsList();\n\t\t\t\t\tif ( this.itemsList.length === 0 ) {\n\t\t\t\t\t\tif ( this.labelValue ) {\n\t\t\t\t\t\t\tthis.invalidLabel = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.hasLabel = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.hasList = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tshowList() {\n\t\tif(this.blurred) {\n\t\t\tthis.hideList();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.showListNoSuggestion || (this.labelValue != null && this.labelValue !== '')) {\n\t\t\tthis.hasList = true;\n\t\t\tthis.hasLabel = true;\n\t\t}\n\t}\n\n\thideList() {\n\t\tthis.hasList = false;\n\t\tthis.hasLabel = false;\n\t}\n\n\tclearSelection() {\n\t\tlet options = Polymer.dom(this.$.selector).querySelectorAll('.option');\n\t\tfor(let option of options)\n\t\t\tthis.toggleAttribute('selected', false, option);\n\t}\n\n\ttabBlur(e) {\n\t\tif(e.keyCode === 9 ) // tab key\n\t\t\tthis.hasList = false;\n\t\tif(e.keyCode === 38) // up arrow\n\t\t\te.preventDefault(); // prevents the movement of the cursor in the text input to the beginning\n\t\tif(e.keyCode === 13 && this.hasList) // enter key\n\t\t\tthis.preventBlur();\n\t\tif(e.keyCode === 27 && !this.revertOnEscape) {\n\t\t\t// FF specific fix to prevent the esc from reverting back last selected value\n\t\t\tsetTimeout(function(labelValue) {\n\t\t\t\tthis.labelValue = labelValue;\n\t\t\t}.bind(this, this.labelValue), 0)\n\t\t}\n\t}\n\n\tfocus(forceSuggest) {\n\t\tif(this.focusDisabled)\n\t\t\treturn;\n\n\t\tthis.focusing = true;\n\t\tthis.$.itemLabel.focus();\n\t\tthis._showListOnFocus(forceSuggest);\n\t\tthis.focusing = false;\n\t}\n\n\tblur(e, force) {\n\t\tif(!force && (this.hasList || this.blurDisabled))\n\t\t\treturn;\n\n\t\tthis.hideList();\n\t\tthis.fire('sb-type-blur');\n\t\tthis.setOriginalSelected();\n\t}\n\n\tsetOriginalSelected() {\n\t\tthis.originalSelected = JSON.parse(JSON.stringify(this.selectedItem || {}));\n\t}\n\n\tpreventBlur() {\n\t\tthis.noBlur = true;\n\t}\n\n\tallowBlur() {\n\t\tthis.noBlur = false;\n\t}\n\n\tfocused() {\n\t\tthis.fire('sb-type-focus', { value: this.labelValue } );\n\t}\n\n\t_applyFocus() {\n\t\tif(this.applyFocus)\n\t\t\tthis.focus();\n\t}\n\n\t_calculateListPosition() {\n\t\tif(this.calculateListPosition && this.hasList) {\n\t\t\tlet leftOffset = PageContainer.getContainer().getBoundingClientRect().left;\n\t\t\tlet left = this.$.itemLabel.getBoundingClientRect().left;\n\t\t\tthis.$.selector.style.left = (left - leftOffset) + 'px';\n\t\t}\n\t}\n\n\t_showListOnFocus(forceSuggest) {\n\t\tif(!this.showListOnFocus || this.hideInput || this.hasList)\n\t\t\treturn;\n\n\t\tif(forceSuggest || !this.items || this.items.length === 0)\n\t\t\tthis.suggest({});\n\t\telse\n\t\t\tthis.showList();\n\t}\n\n\t_directInputFocus() {\n\t\tthis.blurred = false;\n\t\tif(!this.focusing)\n\t\t\tthis._showListOnFocus();\n\t}\n\n\t_directInputBlur() {\n\t\tthis.blurred = true;\n\t\tthis.blur(null, !this.noBlur);\n\t}\n}\n\nPolymer( Typeahead );\n","// Constant status which are used for checking if it's failed or completed\nconst COMPLETED  = 'Completed';\nconst FAILED = 'Failed';\nconst ABORTED = 'Aborted';\n\n/**\n *  <sb-job-checker> To send out the asynchronize call back to the server using <sb-service>\n *\n *  Features:\n *      - Minimum requirement to call this component to set the data property correctly. Format is included in the property.\n *      - Return the following result:\n *          - Status - Job Status from the server.\n *          - Result - Final result from the server\n *      - Loading Spinner:\n *          If you do not need to use it, you can set the useSpinner as false when you call this component. By default, it's true\n *\n **/\nexport class JobChecker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-job-checker';\n\t\tthis.properties = {\n\n\t\t\t/** This property is enabled to ensure that spinner is loaded when the component is ready */\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * This property is to allow the caller to determine whether we should the spinner or not.\n\t\t\t * If the caller prefers to disable the spinner, it can set it as false to disable the spinner\n\t\t\t * */\n\t\t\tuseSpinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * [Required] To use to pass information to server (Format: {recordId: recordId_num, jobId: jobId_num, jobType: QuoteCalculator})\n\t\t\t */\n\t\t\tdata: Object,\n\n\t\t\t/** [Result] Status from server */\n\t\t\tstatus: String,\n\n\t\t\t/** [Result] Final result from the server */\n\t\t\tresult: {\n\t\t\t\ttype: Object\n\t\t\t},\n\n\t\t\t/** [Result] Error from the server */\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\n\t\t\t/** A handle list which is used for cancelSync once the task is completed */\n\t\t\tasyncNumList: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\n\t\t\t/** First time when the component is being used from the caller */\n\t\t\tfirstStatusTime: Number,\n\n\t\t\t/** latest time when the component is being used from the caller. Mainly from the asych */\n\t\t\tlastStatusTime: Number\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_ping(data)'];\n\n\t}\n\n\t/**\n\t *\n\t * @private:        To determine whether the loading spinner should be shown or not.\n\t *\n\t * @returns {boolean|*|JobChecker.properties.useSpinner|{type, value}}\n\t */\n\t_useSpinner(){\n\t\treturn this.spinner && this.useSpinner;\n\t}\n\n\tready() {\n\t\tthis.firstStatusTime = Date.now();\n\t\tthis.lastStatusTime = Date.now();\n\t\tthis._setLoadingSpinner(false);\n\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis._checkStatus(e);\n\t\t}.bind(this));\n\n\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t\t// Turn off the spinner if there's error occurred\n\t\t\tthis._setLoadingSpinner(false);\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * @private         To control whether we should use the loading spinner in this component\n\t *\n\t * @param {Boolean} value\n\t */\n\t_setLoadingSpinner(value) {\n\t\tthis.spinner = value;\n\t\tthis.$.loadingSpinner.show = this._useSpinner();\n\t}\n\n\t/**\n\t *\n\t * @private: To ping the server via sb-service to get the response\n\t *\n\t * @param data\n\t */\n\t_ping(data) {\n\t\tthis._setLoadingSpinner(true);\n\t\t// Turn off the sb-service loading spinner. Use the sb-job-checker's one\n\t\tthis.$.service.background = true;\n\t\tthis.$.service.model = undefined;\n\t\tthis.$.service.model = data;\n\t}\n\n\t/**\n\t * @private:    To check the status from the Queueable checker class in Apex. This will deteremine whether the job is completed or not.\n\t *              To the check the status of the job\n\t *              - Send out the job asynch via sb-service component\n\t *              - Get the latest status received time.\n\t *              - Store the return result from the server to the component\n\t *              - Console log the status on the brower for developer to debug ( This can be removed in the future\n\t *              - Fire an event job-completed when the status is finished\n\t *\n\t * @param e     event detail coming from the response\n\t * @event job-completed\n\t */\n\t_checkStatus(e) {\n\t\tlet result = e.detail.value;\n\t\tif ( result != null) {\n\t\t\tlet jobId = result.job.Id;\n\t\t\tthis.status = result.job.Status;\n\t\t\tif (!this._isFinished()) {\n\t\t\t\tthis.lastStatusTime = Date.now();\n\t\t\t\tthis.data.jobId = jobId;\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tlet asyncNum = this.async(function () {\n\t\t\t\t\tthis._ping(this.data);\n\t\t\t\t}.bind(this), 1000);\n\t\t\t\tthis.asyncNumList.push(asyncNum);\n\t\t\t} else { // COMPLETED\n\n\t\t\t\t// The first time which the job is completed, it will get the result from the payload\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.result = result;\n\t\t\t\t\tfor (let i = 0; i < this.asyncNumList.length; i++) {\n\t\t\t\t\t\tthis.cancelAsync(this.asyncNumList[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._getStatusMessages();\n\t\t\t\tthis._setLoadingSpinner(false);\n\t\t\t\t// To fire an event that the job completed so that the caller knows and they can execute other operations that they need\n\t\t\t\tif (result.payload != null ) {\n\t\t\t\t\tthis.fire('job-completed');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @private:    This status message can be removed in the future\n\t */\n\t_getStatusMessages() {\n\t\tlet waitTime = Date.now() - this.lastStatusTime;\n\t\t// Display this status message in the console log so that we know what job is running in the background\n\t\tconsole.log('Record Id: ' + this.data.recordId + ' Job Type: ' + this.data.jobType + ' [Job Id: ' + this.data.jobId + ' - Status:' + this.status + '] Time : ' + (this.lastStatusTime - this.firstStatusTime) + ' [Wait Time: ' + waitTime + ']');\n\t}\n\n\n\t/**\n\t *\n\t * @private         To determine if the status from the status is failure status\n\t * @return {Boolean}\n\t * */\n\t_isFailure() {\n\t\treturn this.status  && (this.status == ABORTED || this.status == FAILED);\n\t}\n\n\t/**\n\t * @private     To determine if the status from the status is completed or not. It can be succesful or failed.\n\t * @return  {Boolean}\n\t * */\n\t_isFinished() {\n\t\treturn (this.status && (this.status == COMPLETED || this._isFailure()));\n\t}\n}\n\nPolymer( JobChecker );\n\n\n\n\n\n","import {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldMetadata {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-md';\n\t\tthis.properties = {\n\t\t\tfields: Array,\n\t\t\tobject: String,\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdoNotFixObjectName : {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['initFieldSetDescribe(fields, prefix)']\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function (e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldNames = e.detail.value.fields,\n\t\t\t\tfields = [],\n\t\t\t\tfieldsByObject = {};\n\t\t\tfor (let i = 0, l = fieldNames.length; i < l; i++) {\n\t\t\t\tif (!md[fieldNames[i]])\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet object = fieldNames[i].split('.')[0],\n\t\t\t\t\tfield = fieldNames[i].split('.')[1];\n\t\t\t\tif(!fieldsByObject[object])\n\t\t\t\t\tfieldsByObject[object] = {};\n\n\t\t\t\tfields.push(md[fieldNames[i]]);\n\t\t\t\tfieldsByObject[object][field] = md[fieldNames[i]];\n\t\t\t}\n\t\t\t//Array or map of maps for object{fields allowing the caller to pick and choose\n\t\t\tthis.md = {fields: fields, fieldsByObject: fieldsByObject};\n\t\t}.bind(this));\n\t\tthis.$.describe.addEventListener('error-changed', function (e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this))\n\t}\n\n\tinitFieldSetDescribe() {\n\t\tlet fields = [];\n\t\tthis.fields.forEach(function (field) {\n\t\t\tlet fieldSplit = field.split('.');\n\t\t\tif(fieldSplit.length === 2)\n\t\t\t\tfields.push(this.buildFieldList(fieldSplit[0], fieldSplit[1]));\n\t\t\telse\n\t\t\t\tfields.push(this.buildFieldList(this.object, field));\n\t\t}.bind(this));\n\t\tthis.$.describe.fields = fields;\n\t}\n\n\tbuildFieldList(target, field) {\n\t\t//Adding the prefix programmatically so that callers don't need to figure this out\n\t\t//Should the caller add it, we won't add it again\n\t\tif (!this.doNotFixObjectName && target.endsWith('__c') && !target.startsWith(this.prefix))\n\t\t\treturn this.prefix + target + '.' + field;\n\n\t\treturn target + '.' + field;\n\t}\n}\n\nPolymer(FieldMetadata);","export class LineEditorCacheSaver {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor-cache-save';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\terror: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['save(quote)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail;\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\t\n\tsave() {\n\t\tthis.$.service.transient = true;\n\t\tthis.$.service.uid = this.quote.record.Id;\n\t\tthis.$.service.model = this.quote;\n\t\tthis.$.service.saver = null;\n\t}\n}\nPolymer(LineEditorCacheSaver);\n","export class LineEditorReader {\n\n    beforeRegister() {\n        this.is = 'sb-line-editor-read';\n        this.properties = {\n            quoteId: String,\n            background: {\n                type: Boolean,\n                value: false\n            },\n            lineEditorModel: {\n                type: Object,\n                notify: true\n            },\n            error: {\n                type: Array,\n                notify: true\n            }\n        }\n    }\n\n    get observers() {\n        return ['read(quoteId, background)'];\n    }\n\n    // TODO get rid of listeners\n    ready() {\n        this.firstStatusTime = Date.now();\n        this.$.service.addEventListener('response-changed', function(e) {\n\n            this._checkStatus(e);\n        }.bind(this));\n\n        this.$.service.addEventListener('error-changed', function(e) {\n            if (e.detail.value) {\n                if(e.detail.value.validations)\n                    this.error = e.detail.value.validations;\n                else\n                    this.error = [e.detail.value.message];\n            }\n            this.$.loadingSpinner.show = false;\n        }.bind(this));\n    }\n\n\t/**\n     * Send a read service call to the server. Need to reset the uid, response to avoid caching if multiple ping to server is needed.\n     *\n     * @param quoteId\n     */\n    read() {\n        this.$.service.uid = undefined;\n        this.$.service.response = null;\n        this.$.service.background = true;\n        this.$.loadingSpinner.show = !this.background;\n        this.$.service.uid = this.quoteId.substring(0, 15);\n    }\n\n\n\t/***\n     * To check the status of the quote which is from the server. If the quote is still under processing of the calculation, it will keep sending the server call until it's finished.\n     *\n     * @param e\n     * @private\n     */\n    _checkStatus(e) {\n        if (e.detail.value) {\n            this.lastStatusTime = Date.now();\n            // if e.detail.value means that it's waiting for the background job is completed. For jsqc, it submits the calculation request to the queueable job\n            if (e.detail.value == 'Incomplete') {\n                this.$.service.ignoreCache = true;\n                this._getStatusMessages();\n                this.async(function () {\n                    this.read();\n                }.bind(this), 1000);\n            } else {\n                this.lineEditorModel = e.detail.value;\n                this.$.service.ignoreCache = false;\n                this.$.loadingSpinner.show = false;\n            }\n        }\n    }\n\n    /**\n     * @private:    This status message can be removed in the future\n     */\n    _getStatusMessages() {\n        let waitTime = Date.now() - this.lastStatusTime;\n        // Display this status message in the console log so that we know what job is running in the background\n        console.log('Reading: Quote Id: ' + this.quoteId + ' Time : ' + (this.lastStatusTime - this.firstStatusTime) + ' [Wait Time: ' + waitTime + ']');\n    }\n}\n\nPolymer(LineEditorReader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class SearchModelLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-load';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tprocessId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tactionId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsearchModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfilters: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpageNumber: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'load(quote, processId, actionId, pageNumber)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tthis.$.service.uid = null;\n\t\tthis.$.service.context = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.add('processId', this.processId)\n\t\t\t.add('actionId', this.actionId)\n\t\t\t.add('pageNumber', this.pageNumber)\n\t\t\t.add('filters', this.filters)\n\t\t\t.add('fieldSet', this.fieldSet)\n\t\t\t.build();\n\t}\n\n}\nPolymer(SearchModelLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class SearchModelSelector {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-search-model-select';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedProductList: Array,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tresult: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ttargetGroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquoteProcess: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tsaver: String,\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tuseCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'save(selectedProducts, quote)',\n\t\t\t'_save(selectedProductList)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.result = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tsave() {\n\t\tlet selectionArray = [];\n\t\tfor (let val in this.selectedProducts)\n\t\t\tselectionArray.push(this.selectedProducts[val]);\n\t\tthis.selectedProductList = selectionArray;\n\t}\n\n\t_save() {\n\t\tif(this.useCache === true) //we almost always want to cache this response, but not always\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.model = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.addObject('products', this.selectedProductList)\n\t\t\t.add('targetGroupKey', this.targetGroupKey)\n\t\t\t.addObject('quoteProcess', this.quoteProcess)\n\t\t\t.build();\n\t}\n}\nPolymer(SearchModelSelector);","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {DiscountTierModel} from 'quotes/models/DiscountTierModel.js';\nimport {DiscountTiersValidator} from 'quotes/models/DiscountTiersValidator.js';\nimport {Cache} from 'common/data/cache/Cache.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class DiscountScheduleDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-discount-schedule-dialog';\n\t\tthis.properties = {\n\t\t\tdiscountSchedule: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tdiscountUnit: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tlineModel: Object,\n\t\t\tschedule: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tdialogTapped: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_retrieveSchedule(discountScheduleId)',\n\t\t\t'_buildDialog(schedule)',\n\t\t\t'_discountScheduleResponseChanged(discountScheduleResponse)',\n\t\t\t'_discountScheduleChanged(discountSchedule.*)',\n\t\t\t'_createErrorHandler(error)',\n\t\t\t'_toggleEditableClasses(dialogTapped)',\n\t\t\t'_selectCheckboxes(model.selected)']\n\t}\n\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\tget listeners() {\n\t\treturn { 'delete-tapped' : 'onDeleteLines',\n\t\t\t'add-tapped' : 'onAddLine' }\n\t}\n\n\tready() {\n\t\t// The dialog fires 'sb-cancel-ds' whenever the dialog is closed\n\t\tthis.addEventListener('sb-cancel-ds', this.onCancel);\n\t\t// Handle mobile discount unit changed\n\t\tthis.addEventListener('data-changed', function(e) {\n\t\t\tif (e.detail && e.detail.path == `data.${this.discountUnitField}`) {\n\t\t\t\t// Only rebuild and recalculate if the discountUnit has actually changed\n\t\t\t\tif (this.discountUnit != e.detail.value) {\n\t\t\t\t\tthis.discountUnit = e.detail.value;\n\t\t\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\t\t\tthis.buildRowData();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis._handleDialogTap();\n\t\tthis._handleDialogMouseEvents();\n\t}\n\n\t/**\n\t * Service errors get routed through here and displayed in the error message toast\n\t * @private\n\t */\n\t_createErrorHandler() {\n\t\tif (this.error) {\n\t\t\tthis.errors = [this.error.message];\n\t\t}\n\t}\n\n\t/**\n\t * Creates context for discount schedule query and retrieves the quoteline's discount schedule\n\t * @param Id\n\t * @private\n\t */\n\t_retrieveSchedule(Id) {\n\t\tif (!Id) {\n\t\t\treturn;\n\t\t}\n\t\tthis.showSpinner = true;\n\t\tthis.context = {\n\t\t\tcurrencyCode: this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,\n\t\t\tfieldSetName : 'DiscountScheduleModal'\n\t\t};\n\t\tthis.$.loadDiscountScheduleService.uid = undefined;\n\t\tthis.$.loadDiscountScheduleService.context = this.context;\n\t\tthis.$.loadDiscountScheduleService.uid = Id;\n\t\t// Deactivate service spinner because modal has its own spinner\n\t\tthis.$.loadDiscountScheduleService.spinner = false;\n\t}\n\n\t/**\n\t * Instantiates discountTiers and kicks off building all of the data required to render the discountTiers\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tif (!this.schedule) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setConstants(this.constants);\n\t\tthis.discountTiers = undefined;\n\t\tthis.currencyCode = this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\tthis.editable = !this.schedule[this.overrideBehaviorField] ? false : true;\n\t\tthis.savedTiers = [];\n\t\tthis.discountSchedule = JSON.parse(JSON.stringify(this.schedule));\n\t\tthis.data = this.discountSchedule;\n\t\tthis.discountSchedule[this.discountUnitField] = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis._setDSFields();\n\t\tthis.showRevertBtn = this.discountSchedule[this.originalScheduleField] ? true : false;\n\t\tthis.discountUnit = this.discountSchedule[this.usePriceForAmountField] ? 'Price' : this.discountSchedule[this.discountUnitField];\n\t\tthis.buildRowData();\n\t\tlet tierModels = this.buildTiers();\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis.buildFieldData();\n\t\tthis.discountTiers = tierModels;\n\t\tthis._createActions();\n\t\tthis._toggleEditableClasses();\n\t\tif (this.isMobile) {\n\t\t\tthis._buildTabData();\n\t\t}\n\t\tthis.showSpinner = false;\n\t}\n\n\t/**\n\t * The response of cloning or updating a discount schedule goes here\n\t * Updates the lineModel's discount schedule Id\n\t * Runs a calculate to update formula field values if the user happens to add a formula field to the discount tier fieldset\n\t * @private\n\t */\n\t_discountScheduleResponseChanged() {\n\t\tlet newScheduleId = this.discountScheduleResponse.Id;\n\t\tthis.lineModel.lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\tif (this.lineModel.lineVO.record[this.segmentKeyField]) {\n\t\t\tlet segments = this.lineModel.segments;\n\t\t\tfor (let i = 0, l = segments.length; i < l; i++) {\n\t\t\t\tsegments[i].lineVO.record[this.discountScheduleField] = newScheduleId;\n\t\t\t}\n\t\t}\n\t\tif (this.action === 'save') {\n\t\t\tthis.onCancel();\n\t\t} else {\n\t\t\t// Rebuild rows to update with formula field values and remove dirty\n\t\t\tthis.schedule = this.discountScheduleResponse;\n\t\t\tthis.showRevertBtn = this.discountScheduleResponse[this.originalScheduleField];\n\t\t}\n\t\tthis.domHost.onFlagCalculate();\n\t}\n\n\t/**\n\t * If discount unit field has changed, it will recreate row data and display the correct discount column\n\t * @param changedRecord\n\t * @private\n\t */\n\t_discountScheduleChanged(changedRecord) {\n\t\tif (changedRecord.path == `discountSchedule.${this.discountUnitField}`) {\n\t\t\tthis.discountUnit = changedRecord.value;\n\t\t\tthis._calculateDiscountAmounts(this.discountTiers);\n\t\t\tthis.buildRowData();\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves visible discount tier records, then turns them into DiscountTierModels\n\t * @returns {Array}\n\t */\n\tbuildTiers() {\n\t\tlet tiers = [];\n\t\tlet discountTierRecords = this._retrieveRecords();\n\t\tthis.previousLowerBound = undefined;\n\t\tdiscountTierRecords.forEach(function(tier) {\n\t\t\t// Tier lowerbound will be undefined if there are no tiers defined in the database\n\t\t\t// Creates a row so the user never sees a blank discount tier section\n\t\t\tif (tier[this.lowerBoundField] == null) {\n\t\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.discountUnit == \"Percent\" && this.previousLowerBound != tier[this.lowerBoundField]) {\n\t\t\t\tthis.previousLowerBound = tier[this.lowerBoundField];\n\t\t\t} else if (this.discountUnit == \"Percent\" || tier.CurrencyIsoCode != this.currencyCode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t}.bind(this));\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Creates field data for discount schedule name input and discount unit picklist\n\t */\n\tbuildFieldData() {\n\t\tif (this.fieldNames) {\n\t\t\treturn;\n\t\t}\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.discountScheduleField];\n\t\tfieldsMD[this.discountUnitField].required = true;\n\t\tthis.fieldTableData = fieldsMD;\n\t\tthis.fieldNames = ['Name', this.discountUnitField];\n\t}\n\n\t/**\n\t * Creates maps that populate and style table rows\n\t */\n\tbuildRowData() {\n\t\tif (this.fieldsArray) {\n\t\t\tthis.fire('iron-signal', {name :'delete-groups'});\n\t\t}\n\t\tlet fields = this.editorModel.data.discountScheduleModalFieldNames;\n\t\tlet fieldsMD = this.editorModel.md.fieldsMap[this.tierField];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet priceLabel = this.editorModel.data.customLabels.lbl_price;\n\t\tlet prefixedFieldsByFields = {};\n\t\tfields.forEach(function(field) {\n\t\t\tprefixedFieldsByFields[field] = 'template.' + field;\n\t\t}.bind(this));\n\t\tif (this.discountUnit === 'Price') {\n\t\t\tprefixedFieldsByFields[priceLabel] = 'template.' + priceLabel;\n\t\t\tfieldsMD[priceLabel] = JSON.parse(JSON.stringify(fieldsMD[this.discountAmountField]));\n\t\t\tfieldsMD[priceLabel].label =  priceLabel + '(' + (this.currencyCode || this.editorModel.data.currencySymbol) + ')';\n\t\t\tfieldsMD[priceLabel].name = priceLabel;\n\t\t}\n\t\tthis.fieldsArray = Object.keys(prefixedFieldsByFields);\n\t\tlet prefixedFieldsArray = [];\n\t\tthis.fieldsArray.forEach(function(field) {\n\t\t\tif (!this._isFieldShown(field)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fieldMD = fieldsMD[field];\n\t\t\tvar key = fieldMD.name;\n\t\t\tvar label;\n\t\t\tif (field === this.numberField) {\n\t\t\t\tlabel = '#';\n\t\t\t} else if (field === this.discountAmountField) {\n\t\t\t\tlabel = fieldMD.label.replace('{0}', (this.currencyCode || this.editorModel.data.currencySymbol));\n\t\t\t\tfieldMD.label = label;\n\t\t\t} else {\n\t\t\t\tlabel = fieldMD.label;\n\t\t\t}\n\t\t\tprefixedFieldsArray.push(prefixedFieldsByFields[field]);\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[prefixedFieldsByFields[field]] = fieldMD.type;\n\t\t}.bind(this));\n\t\tthis.set('model.fieldsMD', fieldsMD);\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.selected', false);\n\t\t\tthis.set('model.headerClassMap', new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build());\n\t\t\tthis.set('model.fieldLabels', fieldLabels);\n\t\t}\n\t\tthis.set('model.rowClassMap', new TableClassBuilder(prefixedFieldsArray, 'Td', itemTypeMap).build());\n\t\tthis.set('model.fieldLabelMap', fieldLabelMap);\n\t\tthis.set('model.recordKeys', prefixedFieldsArray);\n\t}\n\n\t// Discount Schedule Modal Actions\n\n\t/**\n\t * Retrieves the original discount schedule\n\t */\n\tonRevert() {\n\t\tthis._retrieveSchedule(this.discountSchedule[this.originalScheduleField]);\n\t}\n\n\t/**\n\t * Called by clicking row level add action or by clicking add\n\t * Add will always push a new tier to the very end\n\t * @param e\n\t */\n\tonAddLine(e) {\n\t\tlet record = this._createBlankTierRecord();\n\t\tlet tierModel = new DiscountTierModel(record, this.discountSchedule);\n\t\ttierModel.rowActions = this._createRowActions();\n\t\tif (e.detail && e.detail.index !== undefined) {\n\t\t\tthis.splice('discountTiers', e.detail.index + 1, 0, tierModel);\n\t\t} else {\n\t\t\tthis.push('discountTiers', tierModel);\n\t\t}\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Called by clicking row level delete action or by selecting tiers and clicking Delete\n\t * @param e\n\t */\n\tonDeleteLines(e) {\n\t\tif (e.detail && e.detail.index) {\n\t\t\tthis.splice('discountTiers', e.detail.index, 1);\n\t\t} else {\n\t\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\t\tif (!this.discountTiers[i]) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (this.discountTiers[i].selected) {\n\t\t\t\t\tthis.splice('discountTiers', i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.set('model.selected', false);\n\t\t}\n\t\tthis._selectCheckboxes(false);\n\t\tthis._renumberLines(this.discountTiers, true);\n\t}\n\n\t/**\n\t * Assigns important values on discount schedule and saves to the server\n\t * @param e\n\t */\n\tonSave(e) {\n\t\tthis.errors = undefined;\n\t\tthis.tiers = this._processForSaving();\n\t\tif (!this.tiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis.errors = undefined;\n\t\tthis.action = e.currentTarget.attributes.id.value;\n\t\tlet model;\n\n\t\tif (this.discountSchedule[this.userDefinedField] && this.lineModel.lineVO.record.Id === this.discountSchedule[this.quoteLineField]) {\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleUpdaterService.uid = this.discountSchedule.Id;\n\t\t\tthis.$.discountScheduleUpdaterService.model = model;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.quoteLineField] = this.lineModel.lineVO.record.Id;\n\t\t\tthis.discountSchedule[this.userDefinedField] = true;\n\t\t\tthis.discountSchedule[this.originalScheduleField] = this.discountSchedule.Id;\n\t\t\tmodel = {\n\t\t\t\tdiscountScheduleJSON : JSON.stringify(this.discountSchedule),\n\t\t\t\ttiersJSON : JSON.stringify(this.tiers),\n\t\t\t\tignoreValidate : true,\n\t\t\t\tcontext : JSON.stringify(this.context)\n\t\t\t};\n\t\t\tthis.$.discountScheduleClonerService.model = model;\n\t\t}\n\t}\n\n\t/**\n\t * Called on mouse-out or when dialog is closed\n\t * Attempts to clean out dialog so transition is clean between viewing other discount schedules\n\t */\n\tonCancel() {\n\t\tthis.fire('iron-signal', {name :'delete-groups'});\n\t\tthis.dialogTapped = false;\n\t\tthis.dialogOverlapping = false;\n\t\tthis.set('model.fieldsEditable', false);\n\t\tthis.errors = undefined;\n\t\tthis.schedule = undefined;\n\t\tthis.discountSchedule = undefined;\n\t\tthis.discountTiers = undefined;\n\t\tthis.discountScheduleId = undefined;\n\t\tthis.$.dialog.close();\n\t}\n\n\t// Helper Functions\n\n\t/**\n\t * Combines all tiers that are visible or saved from current tier only behavior\n\t * Then renumbers, sorts, calculates discounts, creates multi-currency records,\n\t * runs front end validation, and then sets discount unit field\n\t * @returns {*}\n\t * @private\n\t */\n\t_processForSaving() {\n\t\t// Combine saved tiers from 'current tier only' behavior and tiers shown in the modal\n\t\tlet hiddenTiers = this._sortTiers(this.savedTiers);\n\t\tlet visibleTiers = this._sortTiers(this.discountTiers);\n\t\tif (!hiddenTiers || !visibleTiers) {\n\t\t\treturn null;\n\t\t}\n\t\tlet tierModels = hiddenTiers.concat(visibleTiers);\n\t\tthis._renumberLines(tierModels, false);\n\t\tthis.set('discountTiers', visibleTiers);\n\t\tthis._updateActions();\n\t\t// Calculate discount amounts and sort before validating\n\t\tthis._calculateDiscountAmounts(tierModels);\n\t\tthis._createTiers(tierModels);\n\t\tlet validator = new DiscountTiersValidator(this.discountSchedule, this.editorModel);\n\t\tlet errors = validator.validate(tierModels);\n\t\tif (errors.size > 0) {\n\t\t\tthis._createError(errors);\n\t\t\treturn null;\n\t\t}\n\t\tlet tiers = [];\n\t\ttierModels.forEach(function(tierModel) {\n\t\t\ttierModel.tiers.forEach(function(tier) {\n\t\t\t\ttiers.push(tier);\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t\tthis.discountSchedule[this.tiersField].records = tiers;\n\t\tthis.discountSchedule[this.tiersField].totalSize = tiers.length;\n\t\tif (this.discountUnit === \"Price\") {\n\t\t\tthis.discountSchedule[this.discountUnitField] = \"amount\";\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = true;\n\t\t} else {\n\t\t\tthis.discountSchedule[this.usePriceForAmountField] = false;\n\t\t}\n\t\treturn tiers;\n\t}\n\n\t/**\n\t * Renames all of the constants used because it is cleaner without caps\n\t * @param constants\n\t * @private\n\t */\n\t_setConstants(constants) {\n\t\tthis.discountAmountField = constants.DISCOUNT_AMOUNT_FIELD;\n\t\tthis.discountScheduleField = constants.DISCOUNT_SCHEDULE_FIELD;\n\t\tthis.discountRateField = constants.ADDITIONAL_DISCOUNT_RATE_FIELD;\n\t\tthis.discountUnitField = constants.DISCOUNT_UNIT_FIELD;\n\t\tthis.lowerBoundField = constants.LOWER_BOUND_FIELD;\n\t\tthis.numberField = constants.NUMBER_FIELD;\n\t\tthis.originalScheduleField = constants.ORIGINAL_SCHEDULE_FIELD;\n\t\tthis.overrideBehaviorField = constants.OVERRIDE_BEHAVIOR_FIELD;\n\t\tthis.quantityField = constants.QUANTITY_FIELD;\n\t\tthis.quoteLineField = constants.QUOTE_LINE;\n\t\tthis.segmentKeyField = constants.SEGMENT_KEY_FIELD;\n\t\tthis.specialPriceField = constants.SPECIAL_PRICE_FIELD;\n\t\tthis.tierField = constants.DISCOUNT_TIER_FIELD;\n\t\tthis.tiersField = constants.DISCOUNT_TIERS_FIELD;\n\t\tthis.upperBoundField = constants.UPPER_BOUND_FIELD;\n\t\tthis.usePriceForAmountField = constants.USE_PRICE_FOR_AMOUNT_FIELD;\n\t\tthis.userDefinedField = constants.USER_DEFINED_FIELD;\n\t}\n\n\t_createError(errors) {\n\t\tlet errorsArray = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowNumber = this.discountTiers[i].template[this.numberField];\n\n\t\t\t// Create error message Array\n\t\t\tif (errors && errors.get(rowNumber)) {\n\t\t\t\terrorsArray.push(errors.get(rowNumber))\n\t\t\t};\n\t\t}\n\n\t\tif (errorsArray.length > 0) {\n\t\t\tthis.errors = errorsArray;\n\t\t}\n\n\t}\n\n\t/**\n\t * Creates error icons on the left\n\t * Creates Add (plus icon) and Delete (trash can) on the right\n\t * @param errors\n\t * @private\n\t */\n\t_createActions() {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet headerActions = [];\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i++) {\n\t\t\tlet rowActions = this._createRowActions(i);\n\n\t\t\t// Update the UI with new rowActions\n\t\t\tthis.set(`discountTiers.${i}.rowActions`, rowActions);\n\t\t}\n\t\t// Add to filler icons to the right side of header so actions are aligned correctly\n\t\theaderActions.push({icon : 'sb-icon-plus', position: 'right', hidden: true, invisible: true});\n\t\theaderActions.push({icon : 'sf-icon-delete', position: 'right', hidden: true, invisible: true});\n\t\tif (!this.isMobile) {\n\t\t\tthis.set('model.headerActions', headerActions);\n\t\t}\n\t}\n\n\t/**\n\t * Set default index to 1.  This is used for adding a new row, the index is irrelevant in this case\n\t * @param index\n\t * @returns {*[]}\n\t * @private\n\t */\n\t_createRowActions(index = 1) {\n\t\treturn [{icon : 'sb-icon-plus',\n\t\t\ttitle: 'Add',\n\t\t\tposition: 'right',\n\t\t\tinvisible: false,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t}, {icon : 'sf-icon-delete',\n\t\t\ttitle: 'Delete',\n\t\t\tposition: 'right',\n\t\t\tinvisible: index == 0,\n\t\t\thidden: false,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t}];\n\t}\n\n\t/**\n\t * Only runs if override behavior is 'current tier only'\n\t * Finds the matching tier for the line's current quantity and will save tiers that come prior\n\t * to matching tier which will be added back before saving to server\n\t * If DS is user defined, it will show all tiers after the current matching tier as well\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveVisibleRecords(tiers) {\n\t\tlet visibleTiers = [];\n\t\tlet currentQuantity = this.lineModel.lineVO.record[this.quantityField];\n\t\ttiers.forEach( function(tier) {\n\t\t\tlet lowerBound = tier[this.lowerBoundField];\n\t\t\tlet upperBound = tier[this.upperBoundField];\n\t\t\tlet userDefined = this.discountSchedule[this.userDefinedField];\n\t\t\t// User defined discount schedules will show tiers above currently matching tier\n\t\t\tif (!upperBound) {\n\t\t\t\treturn (currentQuantity >= lowerBound || userDefined) ? visibleTiers.push(tier) : visibleTiers;\n\t\t\t}\n\t\t\t// Saves tiers where current quantity is greater than lower and upper bound\n\t\t\tif (currentQuantity >= lowerBound && currentQuantity >= upperBound) {\n\t\t\t\tthis.savedTiers.push(new DiscountTierModel(tier, this.discountSchedule));\n\t\t\t\t// Finds the tier where the current quantity is between the lower and upper bound\n\t\t\t} else if (lowerBound <= currentQuantity && currentQuantity < upperBound) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t\t// Display all tiers following the matching tier if discount schedule is user defined\n\t\t\t} else if (userDefined && lowerBound > currentQuantity) {\n\t\t\t\tvisibleTiers.push(tier);\n\t\t\t}\n\t\t}.bind(this));\n\t\t// Special Corner Case for when there is no matching tier\n\t\t// Ex: There exists only Discount Tier which is 1-11\n\t\t// Quantities below 1 will create a blank discount tier and not save the 1-11 tier\n\t\t// Quantities above 11 will create a tier where the lower bound is locked to 11 and tier 1-11 will be saved\n\t\tif (visibleTiers.length == 0 && tiers.length > 0) {\n\t\t\tlet lastPositionIndex = tiers.length - 1;\n\t\t\tlet lowestBound = tiers[0][this.lowerBoundField];\n\t\t\tlet highestBound = tiers[lastPositionIndex][this.upperBoundField];\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\tif (currentQuantity < lowestBound) {\n\t\t\t\trecord[this.numberField] = 1;\n\t\t\t} else if (currentQuantity >= highestBound) {\n\t\t\t\trecord[this.numberField] = tiers[lastPositionIndex][this.numberField] + 1;\n\t\t\t\trecord[this.lowerBoundField] = highestBound;\n\t\t\t}\n\t\t\tvisibleTiers.push(record);\n\t\t}\n\t\treturn visibleTiers;\n\t}\n\n\t/**\n\t * Creates a blank record if the discount doesn't have any\n\t * Otherwise, it will return the records that are used for displaying and editing purposes\n\t * @returns {Array}\n\t * @private\n\t */\n\t_retrieveRecords() {\n\t\tlet records = [];\n\t\tif (!this.discountSchedule[this.tiersField]) {\n\t\t\tlet record = this._createBlankTierRecord();\n\t\t\trecord[this.numberField] = 1;\n\t\t\trecords.push(record);\n\t\t} else {\n\t\t\trecords = this.discountSchedule[this.tiersField].records;\n\t\t\tif (this.discountSchedule[this.overrideBehaviorField] === 'Current Tier Only') {\n\t\t\t\t// current tier only setting will save all tiers before the tier that matches the line item quantity\n\t\t\t\t// and append them back right before the record is saved\n\t\t\t\trecords = this._retrieveVisibleRecords(records);\n\t\t\t\t// used in DSTableCell to disable first lower bound so it can't be edited\n\t\t\t\t// Only disable the field if there are tiers that are hidden because of current tier only functionality\n\t\t\t\tif (this.savedTiers.length > 0) {\n\t\t\t\t\tthis.editorModel.disabledDiscountTier = records[0][this.numberField];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.editorModel.disabledDiscountTier = undefined;\n\t\t\t}\n\t\t}\n\t\treturn records;\n\t}\n\n\t/**\n\t * Calculates and sets price, discount and discount amount fields\n\t * Will set them to zero if the value is undefined\n\t * Also sets the upperbound to null if undefined so it will display as an editble field\n\t * @param tiers\n\t * @private\n\t */\n\t_calculateDiscountAmounts(tiers) {\n\t\tif (!tiers) {\n\t\t\treturn;\n\t\t}\n\t\tlet priceScale = this.editorModel.data.settings.currencyDecimalScale;\n\t\tlet specialPrice = Number(this.lineModel.lineVO.record[this.specialPriceField]).toFixed(priceScale);\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet row = tier.template;\n\t\t\tif (this.discountUnit === 'Price') {\n\t\t\t\t// discount amount is equal to special price minus the price entered by the user\n\t\t\t\trow.Price = !row.Price && row.Price !== 0 ? (specialPrice - Number(row[this.discountAmountField])).toFixed(priceScale) : row.Price;\n\t\t\t\trow[this.discountAmountField] = (specialPrice - row.Price).toFixed(priceScale);\n\t\t\t} else {\n\t\t\t\trow[this.discountRateField] = row[this.discountRateField] || 0;\n\t\t\t\trow[this.discountAmountField] = Number(row[this.discountAmountField] || 0).toFixed(priceScale);\n\t\t\t}\n\t\t\t// Upper Bound may not always be defined so set it to null so field is editable\n\t\t\tif (!row[this.constants.UPPER_BOUND_FIELD] && row[this.constants.UPPER_BOUND_FIELD] != 0) {\n\t\t\t\trow[this.constants.UPPER_BOUND_FIELD] = null;\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Renumbers line starting from 1 if override behavior is not 'current tier only'\n\t * otherwise start from the first tier that is visible\n\t * Do a notifyPath so UI is updated for all cases except for when we sort all tiers\n\t * in the 'current tier only' scenario where there might be tiers not in the UI\n\t * @param tiers\n\t * @param notify\n\t * @private\n\t */\n\t_renumberLines(tiers, notify) {\n\t\tlet behavior = this.discountSchedule[this.overrideBehaviorField];\n\t\t// current tier only could have a visible tier that should start at a number that isn't 1\n\t\tlet number = behavior === 'Current Tier Only' && this.savedTiers.length > 0 ? tiers[0].template[this.numberField] : 1;\n\t\tfor (let i = 0, l = tiers.length; i < l; i ++) {\n\t\t\tif (tiers[i].template[this.numberField] != number) {\n\t\t\t\tif (notify) {\n\t\t\t\t\tthis.set(`discountTiers.${i}.template.${this.numberField}`, number);\n\t\t\t\t} else {\n\t\t\t\t\ttiers[i].template[this.numberField] = number;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnumber++;\n\t\t}\n\t}\n\n\t/**\n\t * Sorts tiers based on lowerbound value\n\t * Creates an error if there are matching lowerbounds\n\t * @param tiers\n\t * @returns {Array}\n\t * @private\n\t */\n\t_sortTiers(tiers) {\n\t\tlet lowerBoundList = [];\n\t\tlet tiersByLowerBound = {};\n\t\tlet sortedTiers = [];\n\t\ttiers.forEach(function(tier) {\n\t\t\tlet lowerBound = tier.template[this.lowerBoundField];\n\t\t\tif (tiersByLowerBound[lowerBound]) {\n\t\t\t\tthis.errors = [this.editorModel.data.customLabels.msg_identical_lower_bounds];\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tlowerBoundList.push(lowerBound);\n\t\t\ttiersByLowerBound[lowerBound] = tier;\n\t\t}.bind(this));\n\t\tlowerBoundList.sort(function (a, b) {\n\t\t\treturn a - b\n\t\t});\n\t\tlowerBoundList.forEach(function(lowerBound) {\n\t\t\tlet tier = tiersByLowerBound[lowerBound];\n\t\t\tsortedTiers.push(tier);\n\t\t}.bind(this));\n\t\treturn sortedTiers;\n\t}\n\n\t/**\n\t * Loops through all the displayed discount tiers to populate tiers array and clones displayed tiers if multi-currency is enabled\n\t * @param tiers\n\t * @private\n\t */\n\t_createTiers(tiers) {\n\t\tlet isoCodes = this.editorModel.data.settings.currencyIsoCodes;\n\t\t// discount tiers for all currencies, including the quote's currency\n\t\ttiers.forEach(function(row) {\n\t\t\trow.tiers = [];\n\t\t\tif (!isoCodes) {\n\t\t\t\trow.tiers.push(row.template);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisoCodes.forEach(function(isoCode) {\n\t\t\t\tif (isoCode == this.currencyCode) {\n\t\t\t\t\trow.template.CurrencyIsoCode = isoCode;\n\t\t\t\t\trow.tiers.push(row.template);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (this.discountUnit === 'Percent') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trow.tiers.push(this._createMultiCurrencyRecord(row.template, isoCode));\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Loops through all of the tiers and sets the selected property\n\t * @param selected\n\t * @private\n\t */\n\t_selectCheckboxes(selected) {\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 1, l = this.discountTiers.length; i < l; i++) {\n\t\t\tif (this.discountTiers[i]) {\n\t\t\t\tthis.set(`discountTiers.${i}.selected`, selected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Copies Discount Tier record to create more tiers but with different currency codes\n\t * @param tier\n\t * @param isoCode\n\t * @private\n\t */\n\t_createMultiCurrencyRecord(tier, isoCode) {\n\t\tlet priceScale = this.editorModel.data.settings.currencyDecimalScale;\n\t\tlet record = JSON.parse(JSON.stringify(tier));\n\t\trecord['CurrencyIsoCode'] = isoCode;\n\t\trecord[this.discountAmountField] = (0).toFixed(priceScale);\n\t\trecord[this.discountRateField] = Number(record[this.discountRateField] || 0).toFixed(priceScale);\n\t\t// Price needs to be removed before sending data to the server\n\t\tdelete record.Price;\n\t\treturn record;\n\t}\n\n\t/**\n\t * Creates a blank record for when a new line is added\n\t * @returns {{}}\n\t * @private\n\t */\n\t_createBlankTierRecord() {\n\t\tlet record = {};\n\t\tlet priceScale = this.editorModel.data.settings.currencyDecimalScale;\n\t\tthis.fieldsArray.forEach(function(fieldName) {\n\t\t\trecord[fieldName] = null;\n\t\t\trecord['CurrencyIsoCode'] = this.currencyCode;\n\t\t\trecord[this.discountAmountField] = (0).toFixed(priceScale);\n\t\t\trecord[this.discountRateField] = (0).toFixed(priceScale);\n\t\t}.bind(this));\n\t\treturn record;\n\t}\n\n\t/**\n\t * Called each time mouse-over, mouse-out, on-tap is called on the discount schedule icon\n\t * Initiates the query for discount schedule and toggles dialog boxShadow\n\t * Assigns dialogTapped which determines if full modal view is shown and toggles field editability if valid\n\t * @param e\n\t * @private\n\t */\n\t_handleIconAction(e) {\n\t\tlet event = e.detail.event;\n\t\tlet type = event.type;\n\t\tlet model = e.detail.model;\n\t\tthis.lineModel = this.editorModel.quoteModel.lineModelsByKey[model.serviceModel.keys[0]];\n\t\tthis.discountScheduleId = model.serviceModel.scheduleId;\n\t\tswitch(type) {\n\t\t\tcase 'mouseenter':\n\t\t\t\tif (!this.isMobile && !this.dialogTapped) {\n\t\t\t\t\tthis._toggleDialogClasses(true);\n\t\t\t\t\tthis.$.dialog.open();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'mouseleave':\n\t\t\t\t// Adding to the debounce gives the event listener attached to the dialog's mouseenter a chance to determine dialog is overlapping\n\t\t\t\tthis.debounce('closeDialog',function() {\n\t\t\t\t\tif (!this.isMobile && !this.dialogTapped && !this.dialogOverlapping) {\n\t\t\t\t\t\tthis.onCancel();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), 1);\n\t\t\t\tbreak;\n\t\t\tcase 'tap':\n\t\t\t\tthis._openDialog();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_openDialog() {\n\t\tif (this.dialogTapped) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dialogTapped = true;\n\t\tthis.$.dialog.open();\n\t\tthis._toggleDialogClasses(false);\n\t}\n\n\t_toggleDialogClasses(applyClasses) {\n\t\tlet dialog = Polymer.dom(this.$.dialog.root);\n\t\tlet sbDialog = dialog.querySelector('.sbDialog');\n\t\tthis.toggleClass('boxShadow', applyClasses, sbDialog);\n\t\tthis.toggleClass('noMarginBottom', applyClasses, dialog.querySelector('#content'));\n\t}\n\n\t_handleDialogTap() {\n\t\tthis.addEventListener('sb-tap-ds', function() {\n\t\t\tif (this.isMobile || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._openDialog();\n\t\t}.bind(this));\n\t}\n\n\t_handleDialogMouseEvents() {\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tlet dialog = Polymer.dom(this.$.dialog.root).querySelector('.sbDialog');\n\t\tdialog.addEventListener('mouseenter', function() {\n\t\t\tif (this.dialogTapped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.dialogOverlapping = true;\n\t\t}.bind(this));\n\n\t\tdialog.addEventListener('mouseleave', function() {\n\t\t\tif (this.dialogTapped || !this.dialogOverlapping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.onCancel();\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Called each time dialogTapped is triggered (when icon is clicked)\n\t * @private\n\t */\n\t_toggleEditableClasses() {\n\t\tthis.set('model.fieldsEditable', this.editable && this.dialogTapped);\n\t\tif (!this.discountTiers) {\n\t\t\treturn;\n\t\t}\n\t\tthis._setDisabled();\n\t\tthis._updateActions();\n\t}\n\n\t_updateActions() {\n\t\tfor ( let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tlet rowActions = this.discountTiers[i].rowActions;\n\t\t\tif (!rowActions) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let j = 0, k = rowActions.length; j < k; j++) {\n\t\t\t\tlet invisible = i == 0 && rowActions[j].icon == 'sf-icon-delete';\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.hidden`, !this.model.fieldsEditable);\n\t\t\t\tthis.set(`discountTiers.${i}.rowActions.${j}.invisible`, invisible);\n\t\t\t}\n\t\t}\n\t\tif (!this.isMobile && this.model.headerActions) {\n\t\t\tfor ( let m = 0, n = this.model.headerActions.length; m < n; m ++) {\n\t\t\t\tthis.set(`model.headerActions.${m}.hidden`, !this.model.fieldsEditable);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Toggles field edibility\n\t * @private\n\t */\n\t_setDisabled() {\n\t\tfor (let i = 0, l = this.discountTiers.length; i < l; i ++) {\n\t\t\tthis.set(`discountTiers.${i}.disabled`, !this.model.fieldsEditable);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the Quote and Account fields for the discount schedule with the correct value\n\t * @private\n\t */\n\t_setDSFields() {\n\t\tlet quote = this.editorModel.quoteModel.quoteVO;\n\t\tthis.discountSchedule[this.constants.QUOTE] = quote.record.Id;\n\t\tlet accountId;\n\t\tif (quote.record[this.constants.ACCOUNT_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.ACCOUNT_FIELD].Id;\n\t\t} else if (quote.record[this.constants.OPPORTUNITY_FIELD]) {\n\t\t\taccountId = quote.record[this.constants.OPPORTUNITY_FIELD].AccountId;\n\t\t}\n\t\tthis.discountSchedule[this.constants.ACCOUNT_ID_FIELD] = accountId;\n\t}\n\n\t/**\n\t * Used as a filter when looping over the discount tier field set so the correct discount unit field is shown\n\t * @param field\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_isFieldShown(field) {\n\t\tif (this.discountUnit === 'Percent' && field === this.discountAmountField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Amount' && field === this.discountRateField) {\n\t\t\treturn false;\n\t\t} else if (this.discountUnit === 'Price' && (field === this.discountRateField || field === this.discountAmountField)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Builds the tab data used for mobile user defined discount schedule\n\t * @private\n\t */\n\t_buildTabData() {\n\t\tlet tabs = [],\n\t\t\tlabels = ['Details', 'Tiers'];\n\n\t\tif (this.tabs === tabs) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0, len = labels.length; i < len; i++) {\n\t\t\tlet label = labels[i];\n\t\t\tlet tId = \"t\" + i;\n\t\t\tlet bind;\n\t\t\tlet pageComponent;\n\t\t\tif (label === 'Details') {\n\t\t\t\tbind = ['data', 'fieldNames', 'md', 'numColumns', 'disabled'];\n\t\t\t\tpageComponent = 'sb-field-table';\n\t\t\t} else if (label === 'Tiers') {\n\t\t\t\tbind = ['discountTiers', 'model', 'editorModel'];\n\t\t\t\tpageComponent = 'sb-ds-tiers';\n\t\t\t}\n\t\t\ttabs.push({name: tId, label: label, bind: bind, pageComponent: pageComponent});\n\t\t}\n\t\tthis.tabs = tabs;\n\t}\n\n\t/**\n\t * Sets the isMobile variable as the viewport changes\n\t */\n\tviewportChanged() {\n\t\tthis.isMobile = (this.viewport && this.viewport.isMobile()) ? true : false;\n\t}\n}\n\nPolymer( DiscountScheduleDialog );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst GHOST_X_OFFSET = 410;\nconst GHOST_Y_OFFSET = 180;\nconst visibilityHidden = ' visibilityHidden';\nexport class CustomSegmentDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-segment-dialog';\n\t\tthis.properties = {\n\t\t\t// dataLineModels is incoming data, and set by the caller\n\t\t\tdataLineModels: Array,\n\t\t\t// Local variable so that the component can modify the data\n\t\t\tlineModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// GroupModel is being set by the lineModels\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// deletedLineKeys is used for the backend so that it is tracking when it's tracking lines which should be deleted\n\t\t\tdeletedLineKeys: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\t// errors to display when errors from server or errors from validation logic\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Header Actions - this is just for UI alignment purpose at this moment.\n\t\t\theaderActions: Array,\n\t\t\t// header selection checkbox\n\t\t\theaderSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\n\tready() {\n\t\tthis.isMobile = this._isMobileViewport();\n\t}\n\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'sb-cancel-custom-segment': '_onCancel',\n\t\t\t'add-tapped': '_onAddByLine',\n\t\t\t'delete-tapped': '_onDeleteByLine'\n\t\t};\n\t}\n\n\t// Getters\n\tget observers() {\n\t\treturn ['_dataChanged(dataLineModels)',\n\t\t\t    '_lineModelChanged(lineModels)',\n\t\t\t\t'_handleCustomSegmentsResponseChanged(updateCustomSegmentsResponse)',\n\t\t\t\t'_handleErrorResponseChanged(errorResponse)',\n\t\t\t\t'_toggleAllCheckBoxes(headerSelected)'\n\t\t];\n\t}\n\n\t/**\n\t * Get constants which are being used in the logic\n\t *\n\t * @returns {*}\n\t */\n\tget constants() {\n\t\treturn this.editorModel.constants;\n\t}\n\n\t/**\n\t * Get quote line metadata from the editorModel.md\n\t *\n\t * @returns {*}\n\t */\n\tget quoteLineMD() {\n\t\treturn this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t}\n\n\t/**\n\t * Get the custom labels from the editorModel\n\t *\n\t * @returns {*}\n\t */\n\tget customLabels() {\n\t\treturn this.editorModel.data.customLabels;\n\t}\n\n\t/**\n\t * Helper method to find the appropriate table row to drop to.\n\t *\n\t * @param\n\t * @returns {*}\n\t * @private\n\t */\n\t_findTableRowValidTarget(el) {\n\t\tif (!el) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this._ifParentIsValidTarget(el)) {\n\t\t\treturn el;\n\t\t}\n\t\tif (el.parentNode) {\n\t\t\treturn this._findTableRowValidTarget(el.parentNode);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Helper method to determine whether the element being passed is a valid target.\n\t * Criteria is whether the element's parent has a css class we're looking for.\n\t * @param {Element} element.\n\t * @private\n\t */\n\n\t_ifParentIsValidTarget(element) {\n\t\tif (!element.parentElement) return false;\n\t\tif (element.parentElement.id == 'swipe-header') {\n\t\t\tthis.targetRowElement = element.parentElement.parentElement;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * To deteremine whether it's viewport changed\n\t *\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tlet rows = this.dragDrop ? this.dragDrop.segmentRows : null;\n\t\tif (rows) {\n\t\t\tif (this._isMobileViewport() || !AppContext.isDesktop) { \n\t\t\t\tfor ( let i = 0, l = rows.length; i < l; i++) { \n\t\t\t\t\trows[i].removeEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let j = 0, l = rows.length; j < l; j++) {\n\t\t\t\t\trows[j].addEventListener('track', this.onTrack.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To copy the incoming data into local data so that it can manipulate.\n\t *\n\t *\n\t * @private\n\t */\n\t_dataChanged() {\n\t\tif ( !this.dataLineModels ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.groupModel = this.dataLineModels[0].groupModel;\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\n\t\t// To create a new copies so that it can be used in every pop-up session without affecting the actual lineModels at the quote.\n\t\tlet lineModels = [];\n\t\tlet i, l = this.dataLineModels.length;\n\t\tlet lineModelByStartDate = {};\n\n\t\tfor (i=0; i < l; i++ ) {\n\t\t\tlet currentLineModel = this.dataLineModels[i];\n\t\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\t\t\tnewLineModel.selected = false;\n\t\t\tlineModelByStartDate[newLineModel.lineVO.record[this.constants.START_DATE_FIELD]] = newLineModel;\n\t\t}\n\n\t\t// Need to sort lineModels by Start Date because the incoming lineModels was not in the correct order. They were re-sorted after saving to the quote\n\t\tlet startDates = Object.keys(lineModelByStartDate).sort();\n\t\tfor(i=0; i <l; i++) {\n\t\t\tlineModels.push(lineModelByStartDate[startDates[i]]);\n\t\t}\n\n\t\tthis.lineModels = lineModels;\n\t}\n\n\t/**\n\t *  To determine if it's line model changed and reset the data\n\t *\n\t * @private\n\t */\n\t_lineModelChanged() {\n\t\tif ( this.lineModels && this.lineModels.length > 0 ) {\n\t\t\tthis.deletedLineKeys = [];\n\t\t\tthis.errors = [];\n\t\t\tthis._buildDialog();\n\t\t}\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment response, it needs to run _updateQuote so that it will update the UI\n\t *\n\t * @private\n\t */\n\t_handleCustomSegmentsResponseChanged(e) {\n\t\tthis.fire('segmented-changed', {quoteVO: e});\n\t\t// Need to reset all data so that it won't carry from the previous session.\n\t\tthis.resetData();\n\t}\n\n\t/**\n\t * Upon receiving the updated custom segment error response, it will populate the backend errors to the frontend\n\t *\n\t * @private\n\t */\n\t_handleErrorResponseChanged(e) {\n\t\tthis.set(`errors`, this.errors.push(errorResponse));\n\t}\n\n\n\t/**\n\t * To add a group of element at the end of specific index\n\t *\n\t *\n\t * @param e     format: information is stored in the e.detail (index: index Which is generated by the component\n\t * @private\n\t */\n\t_onAddByLine(e) {\n\t\tthis._onAddByIndex(e.detail.index);\n\t}\n\n\t/**\n\t * To add a new custom segments and it supports to add at the end of the segment list or at a specific location below the line\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onAdd(e) {\n\t\tthis.$.dialog.toggleMenu();\n\t\t// Add from action; otherwise, add from the line level\n\t\tlet index = this.lineModels.length - 1;\n\t\tthis._onAddByIndex(index)\n\t}\n\n\t/**\n\t * To add line by index. This will be used for the line and action which is at the end of the dialog\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onAddByIndex(index) {\n\t\t// Copy the existing lines from the clicked index\n\t\tlet currentLineModel = this.lineModels[index];\n\t\tlet newLineVO = JSON.parse(JSON.stringify(currentLineModel.lineVO));\n\t\tnewLineVO.record = {};\n\t\tnewLineVO.record[this.constants.SEGMENT_LABEL_FIELD] = '';\n\t\tnewLineVO.record[this.constants.START_DATE_FIELD] = null;\n\t\tnewLineVO.record[this.constants.END_DATE_FIELD] = null;\n\n\t\tlet newLineModel = new LineModel(newLineVO, this.groupModel);\n\n\t\t// reset the line record info\n\t\tnewLineModel.lineVO.record.Id = null;\n\t\tnewLineModel.lineVO.key = null;\n\t\tnewLineModel.selected = false;\n\n\t\tthis.splice('lineModels', index+1, 0, newLineModel);\n\t\tthis.headerSelected = false;\n\t\tthis.$.segmentGroup.addEventListener(\"dom-change\", function(e) {\n\t\t\tlet newRows = this.$.segmentRows.querySelectorAll('#segmentRow');\n\t\t\tif(newRows[newRows.length - 1].model.lineVO.key === null) {\n\t\t\t\tnewRows[newRows.length - 1].$.row.click();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\n\t/**\n\t * To delete a group of element at the end of specific index\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_onDeleteByLine(e) {\n\t\tthis._onDeleteLineData(e.detail.index);\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete all custom segments\n\t *\n\t * @private\n\t */\n\t_onDelete(){\n\t\tlet i, l=this.lineModels.length;\n\t\tfor (i=l-1; i > 0; i--) {\n\t\t\tlet lineModel = this.lineModels[i];\n\t\t\tif ( lineModel.selected ) {\n\t\t\t\tthis._onDeleteLineData(i);\n\t\t\t}\n\t\t}\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis.headerSelected = false;\n\t}\n\n\t/**\n\t * To delete the lineModel on the frontend\n\t *\n\t * @param index\n\t * @private\n\t */\n\t_onDeleteLineData(index) {\n\t\tlet lineModel = this.lineModels[index];\n\t\tif (lineModel.lineVO.key != null) {\n\t\t\tthis.deletedLineKeys.push(lineModel.lineVO.key);\n\t\t}\n\t\tthis.splice('lineModels', index, 1);\n\t}\n\n\t/**\n\t * Upon onSave:\n\t *      - Reset all the internal properties for validation checks\n\t *      - Run the validation check\n\t *          - if everything pass, it will send it to backend and fire an iron-signal to update the quote\n\t *          - if one of them fails, the error message will be displayed on on the frontend\n\t *\n\t * @private\n\t */\n\t_onSave() {\n\t\t// Reset all properties before running any validation\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggleMenu();\n\n\t\tthis._validateCustomSegmentLabels();\n\t\tthis._validateCustomSegmentDates();\n\t\tlet errors = [];\n\t\tif (this.hasInvalidSegmentDates) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasInvalidSegmentLabels ) {\n\t\t\terrors.push(this.customLabels.msg_invalid_custom_segment_labels);\n\t\t}\n\n\t\tif ( this.hasNonConsecutiveDates ) {\n\t\t\terrors.push(this.customLabels.msg_nonsequential_custom_segment_dates);\n\t\t}\n\n\t\tif ( this.hasOverlappingSegments ) {\n\t\t\terrors.push(this.customLabels.msg_overlapping_custom_segment_dates);\n\t\t}\n\n\t\t// Reset all the errors from the previous click on Save\n\t\tthis.set('errors', []);\n\t\tthis.set('errors', errors);\n\n\n\t\t// Gather a list of information which are needed for update custom segments in the backend\n\t\tif (  errors.length == 0 ) {\n\t\t\tlet updateSegmentMap = this._getCustomSegmentUpdates();\n\t\t\tupdateSegmentMap.updateCustomSegments = true;\n\t\t\tlet model = {\n\t\t\t\tquoteJSON: JSON.stringify(this.groupModel.quoteModel.quoteVO),\n\t\t\t\tupdateCustomSegments: updateSegmentMap.updateCustomSegments,\n\t\t\t\tupdatedLineKeys: updateSegmentMap.updatedLineKeys,\n\t\t\t\tdeletedLineKeys: this.deletedLineKeys,\n\t\t\t\tstartDates: updateSegmentMap.startDates,\n\t\t\t\tendDates: updateSegmentMap.endDates,\n\t\t\t\tsegmentLabels: updateSegmentMap.segmentLabels\n\t\t\t};\n\t\t\tthis.$.UpdateCustomSegmentsService.model = model;\n\t\t}\n\t}\n\n\t/**\n\t * Reset the data\n\t * To close the dialog and reset the data back to the original\n\t *\n\t * @private\n\t */\n\t_onCancel() {\n\t\t// Before closing the dialog, clearing those data\n\t\tthis.errors = undefined;\n\t\tthis.groupModel = undefined;\n\t\tthis.deletedLineKeys = [];\n\t\tthis._resetProperties();\n\t\tthis.$.dialog.toggle();\n\t}\n\n\t/**\n\t * To toggle the checkbox from select all\n\t *  - First lineModel cannot be updated with selected checkbox\n\t *\n\t * @private\n\t */\n\t_toggleAllCheckBoxes() {\n\t\t// listen for when the selection list selects all of the items\n\t\tif ( this.lineModels) {\n\t\t\tlet i, l = this.lineModels.length;\n\t\t\t// Update the data model\n\t\t\tfor (i = l-1; i > 0; i--) {\n\t\t\t\tthis.set(`lineModels.${i}.selected`, this.headerSelected);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset all data\n\t *\n\t */\n\tresetData() {\n\t\tthis.errors = undefined;\n\t\tthis.deletedLineKeys = [];\n\t}\n\t/**\n\t * To determine whether it's on mobile view\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_isMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t/**\n\t * To build the dialog\n\t *\n\t * @private\n\t */\n\t_buildDialog() {\n\t\tthis._buildFieldsMD();\n\t\tthis._toggleAllCheckBoxes();\n\t\tthis._buildRowData();\n\t\tthis._buildHeaderActions();\n \t}\n\n\n\t/***\n\t * Build fields metadata based on the fields that we need for the custom segment table\n\t *\n\t * @private\n\t */\n\t_buildFieldsMD() {\n\t\tlet quoteLineMD = this.quoteLineMD;\n\t\tlet fields = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet fieldsMD = [];\n\t\tfor (let i=0; i < fields.length; i++) {\n\t\t\tfieldsMD.push(quoteLineMD[fields[i]]);\n\t\t}\n\t\tthis.fields = fields;\n\t\tthis.fieldsMD = fieldsMD;\n\t}\n\n\n\t/**\n\t * To build the row data so that it can be used in the sb-table-row\n\t *\n\t * @private\n\t */\n\t_buildRowData() {\n\t\tlet recordKeys = [];\n\t\tlet fieldLabels = [];\n\t\tlet fieldLabelMap = {};\n\t\tlet labelTypeMap = {};\n\t\tlet itemTypeMap = {};\n\t\tlet fieldsLength = this.fields.length;\n\t\tfor (let i=0; i < fieldsLength; i++) {\n\t\t\tlet field = this.fields[i];\n\t\t\tlet fieldMD = this.fieldsMD[i];\n\t\t\tlet key = fieldMD.name;\n\t\t\trecordKeys.push(key);\n\t\t\tlet label = fieldMD.label;\n\t\t\tfieldLabels.push(label);\n\t\t\tfieldLabelMap[key] = fieldMD.label;\n\t\t\tlabelTypeMap[fieldMD.label.replace(/\\W/g, '')] = fieldMD.type;\n\t\t\titemTypeMap[key] = fieldMD.type;\n\t\t}\n\n\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\tthis.recordKeys = recordKeys;\n\t\tthis.fieldLabels = fieldLabels;\n\t\tthis.fieldLabelMap = fieldLabelMap;\n\t}\n\n\n\t/**\n\t * To build a header actions to occupy the space in the table to make columns align correctly.\n\t *\n\t * @private\n\t */\n\t_buildHeaderActions() {\n\t\tlet rightAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: true\n\t\t};\n\t\tthis.headerActions = [rightAction, rightAction];\n\t}\n\n\n\t/**\n\t * Build the action so that it can be attached to each row when it's using the sb-table-row\n\t * - Special condition:\n\t *      - For index = 0, it doesn't have the delete method\n\t *\n\t * @param index\n\t * @returns {Array}\n\t * @private\n\t */\n\t_buildRowActions(index) {\n\t\tlet actions = [];\n\t\tlet addAction = {\n\t\t\ticon: 'sb-icon-plus',\n\t\t\ttitle: this.customLabels.lbl_add_segment,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: this.groupModel.quoteModel.isAmendment,\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('add-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\n\t\tlet deleteAction = {\n\t\t\ticon: 'sf-icon-delete',\n\t\t\ttitle: this.customLabels.lbl_delete_custom_segments,\n\t\t\tposition: 'right',\n\t\t\thidden: false,\n\t\t\tinvisible: (index == 0 || this.groupModel.quoteModel.isAmendment),\n\t\t\tonTapFunction: function() {\n\t\t\t\tthis.fire('delete-tapped', {index: this.index});\n\t\t\t}\n\t\t};\n\t\tactions.push(addAction);\n\t\tactions.push(deleteAction);\n\n\t\treturn actions;\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t/**\n\t * Update the data path with value based on the parameter data map\n\t *\n\t * @param dataMap: {key - property, value - value to update }\n\t * @private\n\t */\n\t_updateData(/*Map*/ dataMap) {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor ( let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet keys = Object.keys(dataMap);\n\t\t\tfor ( let j=0; j < keys.length; j++ ) {\n\t\t\t\tlet key = keys[j];\n\t\t\t\tlet value = dataMap[key];\n\t\t\t\tlet path = `lineModels.${i}.${key}`;\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the segment table to reflect the rendering\n\t *\n\t * @private\n\t */\n\t_updateSegmentTable(){\n\t\tlet dataMap = {'selected': false};\n\t\tthis._updateData(dataMap);\n\t}\n\n\t/**\n\t * Generate a list information which is required for custom segment updates.\n\t *\n\t * @returns {{updatedLineKeys: Array, startDates: Array, endDates: Array, segmentLabels: Array}}\n\t * @private\n\t */\n\t_getCustomSegmentUpdates() {\n\t\tlet updates = {updatedLineKeys: [], startDates: [], endDates: [], segmentLabels: []};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++ ) {\n\t\t\tlet lineVO = this.lineModels[i].lineVO;\n\t\t\tlet record = this.lineModels[i].lineVO.record;\n\t\t\tupdates.updatedLineKeys.push(lineVO.key);\n\t\t\tupdates.segmentLabels.push(record[this.constants.SEGMENT_LABEL_FIELD]);\n\t\t\tupdates.startDates.push(record[this.constants.START_DATE_FIELD]);\n\t\t\tupdates.endDates.push(record[this.constants.END_DATE_FIELD]);\n\t\t}\n\t\treturn updates;\n\t}\n\n\t/**\n\t * To valid the custom segment labels for all segments. All custom segment labels should be unique.\n\t * To set hasInvalidSegmentLabels property so that it can be used for saving\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentLabels() {\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tlet customSegmentLabels = {};\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i=0; i < lineModelsLength;  i++) {\n\t\t\tlet segmentLabel = this.lineModels[i].lineVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\t\tif (segmentLabel == null || segmentLabel.trim() === '') {\n\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (!customSegmentLabels[segmentLabel]) {\n\t\t\t\t\tcustomSegmentLabels[segmentLabel] = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.hasInvalidSegmentLabels = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * To validate custom segment dates\n\t *\n\t * @private\n\t */\n\t_validateCustomSegmentDates() {\n\t\tlet lineModelsLength = this.lineModels.length;\n\t\tfor (let i = 0; i < lineModelsLength; i++) {\n\t\t\tlet segment = this.lineModels[i].lineVO;\n\t\t\tlet segmentStartDate = segment.record[this.constants.START_DATE_FIELD];\n\t\t\tlet segmentEndDate = segment.record[this.constants.END_DATE_FIELD];\n\n\t\t\tlet segStartDate = new Date(segmentStartDate);\n\t\t\tlet segEndDate = new Date(segmentEndDate);\n\t\t\tif (segmentStartDate == null || segmentEndDate == null) {\n\t\t\t\tthis.hasInvalidDateFormat = true;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (segStartDate > segEndDate) {\n\t\t\t\t\tthis.hasInvalidSegmentDates = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (i - 1 >= 0) {\n\t\t\t\t\tlet prevSegment = this.lineModels[i - 1].lineVO;\n\t\t\t\t\tlet endDate = new Date(prevSegment.record[this.constants.END_DATE_FIELD]);\n\t\t\t\t\tlet dayAfterEndDate = Date.parse(new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate() + 1));\n\t\t\t\t\tlet startDate = Date.parse(new Date(segStartDate.getFullYear(), segStartDate.getMonth(), segStartDate.getDate()));\n\n\t\t\t\t\tif (this.editorModel.data.settings.allowsNonConsecutiveCustomSegments) {\n\t\t\t\t\t\t// allow non consecutive custom segments\n\t\t\t\t\t\t// start date of one segment must be greater than the end date of the previous segment\n\t\t\t\t\t\tif (segStartDate <= endDate) {\n\t\t\t\t\t\t\tthis.hasOverlappingSegments = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else { // validate logical order\n\t\t\t\t\t\t// validate consecutive start and end dates between segments\n\t\t\t\t\t\t// start date of a custom segment must be a day after the end of a previous custom segment\n\t\t\t\t\t\tif (dayAfterEndDate != startDate) {\n\t\t\t\t\t\t\tthis.hasNonConsecutiveDates = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Reset the properties which are relevant for saving the custom segments\n\t *\n\t * @private\n\t */\n\t_resetProperties() {\n\t\tthis.set(`errors`, []);\n\t\tthis.headerSelected = false;\n\t\tthis.hasInvalidSegmentLabels = false;\n\t\tthis.hasInvalidSegmentDates = false;\n\t\tthis.hasNonConsecutiveDates = false;\n\t\tthis.hasOverlappingSegments = false;\n\t\tthis.hasInvalidDateFormat = false;\n\t}\n}\n\nPolymer( CustomSegmentDialog );","export class FavoriteDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-favorite-dialog';\n\t\tthis.properties = {\n\t\t\tfavName: String\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.addEventListener('sb-cancel-fav', this.onCancel);\n\t}\n\n\tonSave() {\n\t\tif (this.favName == \"\" || this.favName === undefined) {\n\t\t\tthis.errors = ['Favorite name cannot be left blank.'];\n\t\t\treturn;\n\t\t}\n\t\tlet favoriteKeys = [];\n\t\tif (this.favoritedGroup) {\n\t\t\t// saves each line within the group to send up\n\t\t\tlet numGroupLines = this.groupLines.length;\n\t\t\tfor (let i=0; i<numGroupLines; i++) {\n\t\t\t\tif (!this.groupLines[i].component) {\n\t\t\t\t\tfavoriteKeys.push(this.groupLines[i].lineVO.key);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfavoriteKeys.push(this.favoritedLine[0]);\n\t\t}\n\n\t\tthis.fire('sb-favorite-saved', {keys: favoriteKeys, name: this.favName, groupKey: this.favoritedGroup} );\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.favoritedGroup = this.favoritedLine = this.groupLines = null;\n\t\tthis.favName = \"\";\n\t\tthis.$.dialog.toggle();\n\t}\n}\n\nPolymer( FavoriteDialog );","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class PricebookDialog {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pricebook-dialog';\n\t\tthis.properties = {\n\t\t\tpricebooks: Array,\n\t\t\tselectedPricebook: String,\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.select.addEventListener('change', function(e) {\n\t\t\tthis.selectedPricebook = e.detail.value; // Change in pricebook picklist selection\n\t\t}.bind(this));\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this.onCancel.bind(this));\n\t}\n\n\topen() {\n\t\tthis.$.pricebookLoaderService.addEventListener('response-changed', function(e) {\n\t\t\tlet pricebooks = [],\n\t\t\t\tresults = e.detail.value,\n\t\t\t\tnumResults = results.length;\n\n\t\t\tfor (let i =0; i < numResults; i++) {\n\t\t\t\tpricebooks.push({ value: results[i].Id, label: results[i].Name, selected: false});\n\t\t\t}\n\n\t\t\tpricebooks[0].selected = true; // Auto-select the first pricebook\n\t\t\tthis.selectedPricebook = pricebooks[0].value;\n\n\t\t\t// Sets up the user's pricebook list in a select\n\t\t\tthis.$.select.value = this.selectedPricebook;\n\t\t\tthis.$.select.isRequired = true;\n\t\t\tthis.pricebooks = pricebooks;\n\n\t\t\tthis.$.dialog.toggle();\n\t\t}.bind(this));\n\n\t\t// ServiceLoader requires uid and context, but no values are needed\n\t\tthis.$.pricebookLoaderService.uid = '';\n\t\tthis.$.pricebookLoaderService.context = '';\n\t}\n\n\tonSave() {\n\t\tthis.$.pricebookSaverService.addEventListener('response-changed', function(e) {\n\t\t\tthis.fire('pricebook-saved', e.detail.value); // Response is the quoteVOResponse\n\t\t}.bind(this));\n\n\t\tthis.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD] = this.selectedPricebook;\n\t\tthis.$.pricebookSaverService.model = new DataBuilder()\n\t\t\t.add('targetId', this.selectedPricebook)\n\t\t\t.addQuote('quoteJSON', this.editorModel.quoteModel.quoteVO)\n\t\t\t.build();\n\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonCancel() {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: 'onCancel'}\n\t\t});\n\t}\n}\n\nPolymer( PricebookDialog );","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class CSETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-cse-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\trender: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, value, model, data)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.groupModel.editorModel.constants;\n\t}\n\n\n\n\tbuildCell() {\n\t\tlet tableCols = [this.constants.SEGMENT_LABEL_FIELD, this.constants.START_DATE_FIELD, this.constants.END_DATE_FIELD];\n\t\tlet quoteLineFieldsMD = this.model.groupModel.editorModel.md.fieldsMap[this.constants.QUOTE_LINE];\n\t\tlet fieldsMD = [];\n\n\t\tfor (let i = 0; i < tableCols.length; i++) {\n\t\t\tlet fieldMD = quoteLineFieldsMD[tableCols[i]];\n\t\t\tfieldsMD[tableCols[i]] = fieldMD;\n\t\t}\n\n\t\t//if (fieldsMD && fieldsMD[this.item] && fieldsMD[this.item].type) {\n\t\tthis.editing = true;\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.viewport && this.viewport.isMobile() ) {\n\t\t\tthis.render = true;\n\t\t\tif (this.index === 0) {\n\t\t\t\tthis.editing = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.disabled = false;\n\t\tthis.md = fieldsMD[this.item];\n\t}\n}\n\nPolymer(CSETableCell);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\n/**\n *  <sb-custom-action>\n *\n *  Features:\n *\n **/\nexport class CustomAction {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-action';\n\t\tthis.properties = {\n\t\t\tcustomAction: Object,\n\t\t\tmodel: Object,\n\t\t\tactionHidden: Boolean,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tlabel: String\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_toggleQuoteButton(model.grouped, model.allOptional)', '_toggleLineButton(model.favorite)'];\n\t}\n\n\tready() {\n\t\tif (this.customAction && this.customAction.isSeparator) {\n\t\t\tthis.button = false;\n\t\t\tthis.span = true;\n\t\t}\n\t\t\n\t\t// for the case of closing a menu inside a menu\n\t\tthis.addEventListener('paper-dropdown-close', function(e) {\n\t\t\tif (this.$$('#menuButton'))\n\t\t\t\tthis.$$('#menuButton').close();\n\t\t});\n\n\t\tif (!this.horizontalAlign) {\n\t\t\tthis.horizontalAlign = this.span ? \"left\" : \"right\";\n\t\t}\n\t\tthis.horizontalOffset = this.span ? 18 : 0;\n\t\tthis.verticalOffset = this.span ? -30 : 0;\n\t}\n\n\ttriggerCustomAction(e) {\n\t\t// If event is showDSModal, fire event for mouseover, mouseout and tap; otherwise, the event\n\t\t// must be type == 'tap' and will fire normal tap event\n\t\tif (this.customAction.eventHandlerName === \"showDSModal\") {\n\n\t\t\t// If mobile and not a tap gesture, we want to return early\n\t\t\tif (this.classList.contains('swipe-menu-item') && e.type !== 'tap') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.fire('iron-signal', {name: 'schedule-action', data: {event: e, model: this.model}});\n\t\t\treturn;\n\n\t\t} else if (e.type !== 'tap') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: this.customAction,\n\t\t\tmodel: this.model\n\t\t});\n\t\tthis.fire('paper-dropdown-close');\n\t}\n\n\t_toggleQuoteButton() {\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleLineButton() {\n\t\tthis._toggleButton();\n\t}\n\n\t_toggleButton() {\n\t\tthis.showAction = !this.customAction.isHidden(this.model);\n\t\tthis.hasMenu = (!this.button && !this.span) || (this.customAction.hasMenu && !(this.viewport && (this.viewport.isMobile() || this.viewport.S.down) ));\n\t\tthis.menuButton = this.hasMenu && !this.span;\n\n\t\t// Logic that swaps fav swipeItems after the first time\n\t\tif (this.viewport && this.viewport.isMobile() && !this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.style.transform) {\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n\t_setButtonClassAndLabel() {\n\t\tthis.label = (!this.customAction.icon || (this.viewport && (this.viewport.isMobile() || this.viewport.S.down) )) && this.customAction.renderLocation !== 'Line' ? this.customAction.label : null;\n\t\tthis.buttonClass = (this.groupAction ? 'groupButton ' : '') + (this.customAction.icon && !this.label ? this.customAction.icon : '') + (this.customAction.first ? '':' notFirst') + (this.customAction.last && !this.hasMenu ? '':' notLast') + (this.customAction.primary ? ' primary':'');\n\t\tif (!this.button && this.groupAction) {\n\t\t\tthis.menuClass = 'mobileGroupMenu';\n\t\t} else {\n\t\t\tthis.menuClass = (this.groupAction ? 'groupMenu ' : '') + (this.customAction.last ? '' : 'notLast');\n\t\t}\n\n\t\t// Logic that swaps fav swipeItems for the first time\n\t\tif (this.viewport && this.viewport.isMobile() && this.model.favorite && (this.customAction.caClass === 'removeFromFavBtn') && this.parentElement) {\n\t\t\tPolymer.dom(this.parentElement).flush();\n\t\t\tvar container = this.parentElement.parentElement;\n\t\t\tcontainer._initSwipeMenu(this.parentElement);\n\t\t}\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setButtonClassAndLabel();\n\t}\n\n}\n\nPolymer( CustomAction );","import {Constants} from 'quotes/models/Constants.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class DSTableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-table-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tdisabled: Boolean,\n\t\t\thidden: Boolean,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(item, model, data, index, viewport)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.model.constants;\n\t}\n\n\tbuildCell() {\n\t\tlet fieldsMD = this.model.md.fieldsMap[this.constants.DISCOUNT_TIER_FIELD];\n\t\tlet field = this.item.replace('template.', '');\n\t\tif (this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\t\tthis.handleOriginalValues();\n\t\tthis.editing = this.isEditable(field, fieldsMD);\n\t\tthis.md = fieldsMD[field];\n\t}\n\n\tisEditable(field, fieldsMD) {\n\t\tif(field === this.constants.NUMBER_FIELD)\n\t\t\treturn false;\n\n\t\tif(field === this.constants.LOWER_BOUND_FIELD && this.data.template[this.constants.NUMBER_FIELD] === this.model.disabledDiscountTier)\n\t\t\treturn false;\n\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif(this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\treturn false;\n\n\t\treturn fieldsMD[field].updateable;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data.original && this.data.template) {\n\t\t\tthis.data.original = {};\n\t\t\tthis.data.original.template = JSON.parse(JSON.stringify(this.data.template));\n\t\t}\n\t\tif(this.data.original)\n\t\t\tthis.$.field.originalValue = this.get('data.original.' + this.item);\n\t}\n}\n\nPolymer(DSTableCell);","export class DSTiers {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-ds-tiers';\n\t\tthis.properties = {\n\t\t\tdiscountTiers: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\t_hideSelection(index) {\n\t\treturn index === 0 && this.model.fieldsEditable ? { hidden: true, type: 'invisible' } : null;\n\t}\n\n\t_deleteGroups() {\n\t\t// Used when switching between different discount units\n\t\tthis.$.header.$.header.destroyGroup();\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\t\trows.forEach(function(row) {\n\t\t\t// Guarantees that the groups are re-rendered properly\n\t\t\trow.cols = undefined;\n\t\t\trow.$.row.destroyGroup();\n\t\t}.bind(this));\n\t}\n}\n\nPolymer( DSTiers );\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class FieldSetTable {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tnumColumns: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 1\n\t\t\t},\n\t\t\tobjectName: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['generateColumns(editorModel, objectName, viewport)'];\n\t}\n\n\tgenerateColumns() {\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\n\t\tlet fieldsObject = {};\n\t\tlet fieldsArray = [];\n\t\tlet fieldNames = [];\n\t\tlet numFields;\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tif (this.objectName == this.editorModel.constants.QUOTE_LINE_GROUP ) {\n\t\t\tlet groupFieldNames = this.editorModel.fieldsetMap.groupFieldNames.slice();\n\t\t\t// Name and Description fields are handled else where\n\t\t\tfor (let i = 0, l = groupFieldNames.length; i < l; i++) {\n\t\t\t\tif (!this.isMobile && (this.editorModel.constants.DESCRIPTION_FIELD == groupFieldNames[i] ||  'Name' == groupFieldNames[i])) {\n\t\t\t\t\tgroupFieldNames.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfieldNames = groupFieldNames;\n\t\t\tnumFields = groupFieldNames.length;\n\t\t} else if (this.objectName == this.editorModel.data.quoteObjectName) {\n\t\t\tfieldNames = this.editorModel.fieldsetMap.quoteFieldNames;\n\t\t\tnumFields = this.editorModel.fieldsetMap.quoteFieldNames.length;\n\t\t}\n\t\tfieldsObject = this.editorModel.md.fieldsMap[this.objectName];\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tfieldsArray.push(fieldsObject[fieldNames[i]]);\n\t\t\tif ( i % this.numColumns == 0) {\n\t\t\t\tcolumn1Group.push(fieldNames[i]);\n\t\t\t} else if ( i % this.numColumns == 1) {\n\t\t\t\tcolumn2Group.push(fieldNames[i]);\n\t\t\t} else {\n\t\t\t\tcolumn3Group.push(fieldNames[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.numColumns == 1)\n\t\t\tthis.columnOneWidth = 'td1';\n\t\telse if (this.numColumns == 2) {\n\t\t\tthis.columnOneWidth = 'td2';\n\t\t\tthis.columnTwoWidth = 'td2';\n\t\t} else {\n\t\t\tthis.columnOneWidth = 'td3';\n\t\t\tthis.columnTwoWidth = 'td3';\n\t\t\tthis.columnThreeWidth = 'td3';\n\t\t}\n\n\t\tthis.md = fieldsArray;\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif(column1Group.length > 0) {\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif(column2Group.length > 0) {\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif(column3Group.length > 0) {\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n}\n\nPolymer(FieldSetTable);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class FieldSetTableItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-field-set-table-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_valueChanged'\n\t\t\t},\n\t\t\t/** Item which we need to display on the field set table  */\n\t\t\titem:  String,\n\t\t\t/** List of the fields which need to display at the field set table  */\n\t\t\tmodel: Object,\n\t\t\t/** metadata coming from the caller */\n\t\t\tmd: Object,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdateInput = Polymer.dom(dateContainer).querySelector('input'),\n\t\t\tdatepicker = e.detail.datepicker,\n\t\t\tdatepickerHeight = e.detail.datepicker.offsetHeight,\n\t\t\tdatepickerWidth = e.detail.datepicker.offsetWidth,\n\t\t\twindowHeight = window.innerHeight,\n\t\t\twindowWidth = window.innerWidth,\n\t\t\tdateContainerBoundingClientRect = dateContainer.getBoundingClientRect(),\n\t\t\tdistanceFromBottom = windowHeight - dateContainerBoundingClientRect.bottom - datepickerHeight,\n\t\t\tdistanceFromRight = windowWidth - dateContainerBoundingClientRect.left - datepickerWidth;\n\n\t\tdatepicker.style.position = 'fixed';\n\n\t\t// Style depending on distance from right side of screen to position appropriately\n\t\tif (distanceFromRight < 0) {\n\t\t\t// Use date input here instead of container so that the datepicker is aligned with the input box\n\t\t\tdatepicker.style.left = dateInput.getBoundingClientRect().right - datepickerWidth + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.left = dateContainerBoundingClientRect.left + 'px';\n\t\t}\n\n\t\t// Style depending on distance from bottom of screen to position appropriately\n\t\tif (distanceFromBottom < 0) {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.top - datepickerHeight + 'px';\n\t\t} else {\n\t\t\tdatepicker.style.top = dateContainerBoundingClientRect.bottom + 'px';\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_setFieldData(item, model, data)', '_displayChanged(value, display, item, data, md)'];\n\t}\n\n\t/**\n\t * To set the field data information based on the model and metadata\n\t *\n\t * @private\n\t */\n\t_setFieldData() {\n\t\tlet numFields = this.model.length;\n\t\tfor (let i = 0; i < numFields; i++) {\n\t\t\tif (this.model[i].name === this.item)\n\t\t\t\tthis.md = this.model[i];\n\t\t}\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// Mobile RTE's should be null if there is no value, ie Group Description\n\t\tthis.label = (this.value == null && this.md.extraTypeInfo === 'richtextarea' && this.isMobile) ? null : this.md.label;\n\t\t\n\t\tthis.helpText = this.md.inlineHelpText;\n\t\t// To set the field is editable because it's required for the sb-field.\n\t\t// Calculated and roll-up summary fields should not be editable\n\n\t\t// Update CurrencyIsoCode for quote and group level fields\n\t\tif (this.data.CurrencyIsoCode) {\n\t\t\tthis.md['CurrencyIsoCode'] = this.data.CurrencyIsoCode;\n\t\t}\n\n\t\tthis.$.field.editing = this.md.updateable ? true : false;\n\t\tthis.$.field.md = this.md;\n\t\tthis.$.field.property = this.item;\n\t\tlet obj = {};\n\t\tobj[this.item] = this.value;\n\t\tthis.$.field.obj = obj;\n\t}\n\n\t_valueChanged() {\n\t\tthis._updateLookupDisplayValue();\n\t\tthis.$.field.value = this.value;\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tif (!this.data) {\n\t\t\treturn;\n\t\t}\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_handleFieldValueChanged() {\n\t\tif (this.calculateImmediately) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t}\n\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.md.referenceTo[0]);\n\t}\n\n}\n\nPolymer(FieldSetTableItem);\n","export class LEFooter {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-footer';\n\t\tthis.properties = {\n\t\t\tquoteModel: Object,\n\t\t\tquoteTotal: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\tquoteTotalMd: Object,\n\t\t\teditorModel: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_showQuoteTotal(quoteModel.quoteVO.*)',\n\t\t\t\t'_setTotalWidth(quoteModel.editorModel.layout)'];\n\t}\n\n\tget settings() {\n\t\treturn this.quoteModel.editorModel.data.settings;\n\t}\n\n\tget quoteFields() {\n\t\treturn this.quoteModel.editorModel.md.fieldsMap[this.settings.developerPrefix + 'Quote__c'];\n\t}\n\n\tget quoteVO() {\n\t\treturn this.quoteModel.quoteVO;\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_setTotalWidth() {\n\t\tif (!this.quoteModel.editorModel.layout || this.quoteModel.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.totalWidth = this.quoteModel.editorModel.layout.totalWidth + 'px';\n\t}\n\n\t_showQuoteTotal() {\n\t\tthis.grouped = this.quoteModel.grouped ? 'grouped' : '';\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tif (this.settings.lineEditorTotalsField != 'doNotDisplay' && this.quoteVO.lineItems && this.quoteVO.lineItems.length > 0) {\n\t\t\tthis._setQuoteTotal();  // if quote total is shown, set quote total to the correct value\n\t\t\tthis.showQuoteTotal = true;\n\t\t} else {\n\t\t\tthis.showQuoteTotal = false;\n\t\t}\n\t}\n\n\t_setQuoteTotal() {\n\t\tlet total,\n\t\t\tpriceScale,\n\t\t\tconstants = this.quoteModel.editorModel.constants,\n\t\t\ttotalsField = this.settings.lineEditorTotalsField; // Quote total field to be displayed. If the user has never saved this setting, its value would be null\n\n\t\t// lineEditorTotalsField takes in the label of the field; therefore translated values work fine.\n\t\tif (!totalsField || totalsField == 'Default') { // Default or unchanged totals field\n\t\t\tif (this.settings.isMultiCurrencyOrg) {\n\t\t\t\tpriceScale = this.settings.currencyDecimalScale;\n\t\t\t} else {\n\t\t\t\tif (this.quoteVO.applyAdditionalDiscountLast) {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.CUSTOMER_AMOUNT_FIELD].scale;\n\t\t\t\t} else {\n\t\t\t\t\tpriceScale = this.quoteFields[constants.NET_AMOUNT_FIELD].scale;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttotal = this.quoteVO.applyAdditionalDiscountLast ? this.quoteVO.customerTotal : this.quoteVO.netTotal;\n\t\t} else { // Custom totals field\n\t\t\tpriceScale = this.settings.isMultiCurrencyOrg ? this.settings.currencyDecimalScale : this.quoteFields[totalsField].scale;\n\t\t\ttotal = this.quoteVO.record[totalsField] || 0; // If totalsField is not found, default to 0\n\t\t}\n\t\tif (!this.quoteTotalMd) {\n\t\t\tthis.quoteTotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.quoteTotal = total.toFixed(priceScale);\n\t}\n}\n\nPolymer( LEFooter );","import {Navigator} from '../../../common/core/Navigator.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\n\n/**\n * <sb-le-group>\n *\n * Features:\n *\n */\nexport class LEGroup {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - hosts the GroupVO information and line items */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_groupModelChanged'\n\t\t\t},\n\t\t\tgroupClass: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tsubtotal: Number,\n\t\t\tsubtotalMd: Object,\n\t\t\t/** Description, labeled value to interact properly with sb-field */\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_descriptionChanged'\n\t\t\t},\n\t\t\tdescriptionMd: Object,\n\t\t\tgroupLevelTabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tfavorited: Boolean\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['_groupRecordChanged(groupModel.groupVO.record.*)', '_toggleGrouping(groupModel.groupVO)',\n\t\t\t'_segmentedPrimaryMobileColsChanged(groupModel.editorModel.segmentedPrimaryMobileCols)',\n\t\t\t'_updateTableProperties(groupModel.standardLines.splices)', '_updateTableProperties(groupModel.segmentedLinesByDimension.*)',\n\t\t\t'_createDragDropModel(editorModel)',\n\t\t\t'_groupCustomActionsChanged(groupModel.editorModel.groupCustomActions)',\n\t\t\t'_showSubtotal(groupModel.groupVO.record.*)'];\n\t}\n\n\tready() {\n\t\tthis.groupExpanded = false;\n\t\tthis.showSpinner = false;\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'cseDialog-tapped': '_handleCSEDialogTapped',\n\t\t\t'segmented-changed': '_customSegmentedUpdated',\n\t\t\t'upgrade-asset-quantity-changed': '_setUpgradeQuantity',\n\t\t};\n\t}\n\n\n\t_createDragDropModel() {\n\t\tlet validTargets = new Set(['sb-droppable-mdqRows', 'sb-droppable-emptyTable',\n\t\t\t'sb-droppable-emptyMDQTable', 'sb-droppable-emptyMDQSegmentTab',\n\t\t\t'sb-droppable-sidePanelGroups']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sb-le-table-row',\n\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\t/**\n\t *  To determine whether the lines are changed\n\t *\n\t * @private\n\t */\n\t_groupModelChanged() {\n\t\tthis.editorModel = this.groupModel.quoteModel.editorModel;\n\t\tthis._updateTableProperties();\n\t\tthis._updatePageData();\n\t\tthis._setIsButton();\n\t\tthis.isMobile = this.viewport ? this.viewport.isMobile() : false;\n\t\tif (this.isMobile) {\n\t\t\tthis.set('groupModel.groupExpanded', this.groupExpanded);\n\t\t\tthis.buildGroupTabs();\n\t\t}\n\t\t// Always show buttons in desktop\n\t\tif (this.viewport && !this.viewport.isMobile()) {\n\t\t\tthis.set('groupModel.groupExpanded', true);\n\t\t\tthis._setTotalWidth();\n\t\t}\n\n\t}\n\n\t_setIsButton() {\n\t\tthis.isButton = this.viewport ? (this.viewport.isDesktop() && this.viewport.M.up) : true;\n\t}\n\n\t_setTotalWidth() {\n\t\tif (!this.editorModel.layout || this.editorModel.deviceContext.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.totalWidth = this.editorModel.layout.totalWidth + 2 + 'px';\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setTotalWidth();\n\t}\n\n\t_updateTableProperties() {\n\t\tthis.groupHasStandardProducts = this.groupModel._groupHasStandardProducts();\n\t\tthis.groupHasSegmentedProducts = this.groupModel._groupHasSegmentedProducts();\n\t\tthis.groupedAndHasNoLineItems = this.groupModel.quoteModel.grouped && !this._groupHasLineItems();\n\t\tthis.groupHasBothProducts = this._groupHasBothProducts();\n\t\tthis._showSubtotal();\n\t\tthis._setGroupDescription();\n\t}\n\n\t_segmentedPrimaryMobileColsChanged() {\n\t\tthis._updatePageData();\n\t}\n\n\t/**\n\t * To update the page data so that it will be rendered\n\t *\n\t * @private\n\t */\n\t_updatePageData() {\n\t\tif (this.$$('#leGroupTabs')) {\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t}\n\n\t\tlet tabs = [],\n\t\t\tdimensions = this.groupModel.dimensions;\n\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\n\t\t\tif (this.groupModel.hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: this.groupModel.quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + this.groupModel.groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseDialog';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.tabs = tabs;\n\t\tif (!this.groupMDQTabs) {\n\t\t\tthis.groupMDQTabs = tabs;\n\t\t}\n\t}\n\n\t/**\n\t * Open the Custom Segment Dialog with the custom segment information from the quote\n\t *\n\t * @param e\n\t * @private\n\t */\n\t_handleCSEDialogTapped(e) {\n\t\tthis.fire('cse-tapped', {\n\t\t\tdialog: 'cseDialog',\n\t\t\tgroupModelKey: this.groupModel.groupKey\n\t\t});\n\t}\n\n\t_groupHasBothProducts() {\n\t\treturn this.groupModel._groupHasStandardProducts() && this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupHasLineItems() {\n\t\treturn this.groupModel._groupHasStandardProducts() || this.groupModel._groupHasSegmentedProducts();\n\t}\n\n\t_groupRecordChanged(changedRecord) {\n\t\tif (changedRecord.path == `groupModel.groupVO.record.${this.editorModel.constants.OPTIONAL_FIELD}`) {\n\t\t\tthis.fire('iron-signal', {name: 'toggle-optional-clicked', data : {toggleOptionalBoolean : changedRecord.value, groupKey: this.groupModel.groupKey}});\n\t\t}\n\t\tlet groupRecord = this.groupModel.groupVO.record\n\t\tthis.favorited = !!(groupRecord && groupRecord[this.editorModel.constants.FAVORITE_ID_FIELD]);\n\t}\n\n\t_setGroupDescription() {\n\t\tif (!this.groupModel.groupVO.record) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.value = this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD];\n\t\tif (this.groupModel && this.editorModel.md && this.editorModel.constants) {\n\t\t\tthis._getDescriptionMd();\n\t\t}\n\t\tif (this.value) {\n\t\t\treturn;\n\t\t}\n\t\t// If there is no description, give value a placeholder string\n\t\tthis.value = \"Click to edit description.\";\n\t}\n\n\t_descriptionChanged() {\n\t\tif (this.value !== \"Click to edit description.\") {\n\t\t\tthis.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD] = this.value;\n\t\t}\n\t}\n\n\t_getDescriptionMd() {\n\t\tlet groupObjMd = this.editorModel.md.fieldsMap[this.groupModel.groupObjectName];\n\t\tthis.descriptionMd = groupObjMd[this.editorModel.constants.DESCRIPTION_FIELD];\n\t}\n\n\t_getSegmentKeys() {\n\t\treturn Object.keys(this.groupModel.segmentedLinesBySegmentKey);\n\t}\n\t\n\ttriggerCustomAction(e) {\n\t\tthis.fire('le-action-tapped', {\n\t\t\tcustomAction: {eventHandlerName: e.currentTarget.attributes.eventHandlerName.value},\n\t\t\tmodel: this.groupModel\n\t\t});\n\t}\n\n\t// Helper Functions\n\n\tshowGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (this.isMobile) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('hidden', true, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', false, this.$$('#groupNameInput'));\n\t\tthis.$$('#groupNameInput').focus();\n\t\tthis.$$('#groupNameInput').setSelectionRange(0, this.groupModel.groupVO.record.Name.length);\n\t}\n\n\tcheckInputValue(e) {\n\t\te.stopPropagation();\n\t\tif (e.target.value != \"\") {\n\t\t\tthis.set('groupModel.groupVO.record.Name', e.target.value);\n\t\t}\n\t\tthis.toggleClass('hidden', false, this.$$('#groupHeaderName'));\n\t\tthis.toggleClass('hidden', true, this.$$('#groupNameInput'));\n\t}\n\n\tcloseGroupNameEditor(e) {\n\t\te.stopPropagation();\n\t\tif (e.keyCode == '13') {\n\t\t\tthis.$$('#groupNameInput').blur();\n\t\t}\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.groupModel.groupVO.record)\n\t\t\treturn;\n\n\t\tlet settings = this.groupModel.quoteModel.editorModel.data.settings;\n\t\tif (this.groupModel.quoteModel.grouped && settings.lineEditorGroupSubtotalsField != 'doNotDisplay' && ((this.groupModel.segmentedLines.length > 0 && this.groupModel._groupHasStandardProducts()) || (this.viewport && this.viewport.isMobile()))) {\n\t\t\tthis._getSubtotal(); // if subtotal is shown, set subtotal to the correct value\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tif (!this.groupModel.quoteModel.grouped) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorModel = this.groupModel.quoteModel.editorModel,\n\t\t\tsettings = editorModel.data.settings,\n\t\t\tpriceScale,\n\t\t\tsubtotal;\n\n\t\tlet subtotalField = settings.lineEditorGroupSubtotalsField;\n\t\t// Determine which Org Settings field to use for subtotals\n\t\tif (subtotalField == 'Default' || subtotalField == null) {\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? settings.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\tsubtotal = (this.groupModel.groupVO.record[editorModel.constants.NET_TOTAL_FIELD] || 0).toFixed(priceScale);\n\t\t} else { // Custom subtotals field\n\t\t\tpriceScale = settings.isMultiCurrencyOrg ? settings.currencyDecimalScale : editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLineGroup__c'][subtotalField].scale;\n\t\t\tsubtotal = (this.groupModel.groupVO.record[settings.lineEditorGroupSubtotalsField] || 0).toFixed(priceScale); // If subtotalsField is not found, default to 0\n\t\t}\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tthis.subtotal = subtotal;\n\t}\n\n\t_toggleGrouping(){\n\t\t// Necessary for IE to update when toggling between grouped and ungrouped\n\t\tthis.notifyPath('groupModel.quoteModel.grouped', this.groupModel.quoteModel.grouped);\n\t\tthis.set('groupClass', this.groupModel.quoteModel.grouped ? 'group' : 'virtualGroup');\n\t}\n\n\tbuildGroupTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForGroupLayout = [];\n\t\tif (this.editorModel.fieldsetMap.groupFieldNames.length > 0 && this._groupHasLineItems())\n\t\t\tnamesForGroupLayout.push('details');\n\t\tif (this.groupModel._groupHasSegmentedProducts())\n\t\t\tnamesForGroupLayout.push('segmented');\n\t\tif (this.groupModel._groupHasStandardProducts())\n\t\t\tnamesForGroupLayout.push('standard');\n\n\t\tlet tabs = [];\n\t\t// Used in sb-group-tabs to create mdq tabs\n\t\tthis.groupModel.groupMDQTabs = this.tabs;\n\n\t\tif (!this._renderTabs(namesForGroupLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#groupTabs')) {\n\t\t\tthis.$$('#groupTabs').destroyTabs();\n\t\t}\n\n\t\tfor (let i = 0, l = namesForGroupLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForGroupLayout[i];\n\n\t\t\ttabs.push({name: tId, label: tabName});\n\t\t}\n\t\tthis.groupLevelTabs = undefined;\n\t\tthis.bind = ['groupModel', 'editorModel'];\n\t\tthis.groupMDQTabs = this.groupModel.groupMDQTabs;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.groupLevelTabs = tabs;\n\t}\n\n\t_renderTabs(namesForGroupLayout) {\n\t\tif (this.groupLevelTabs.length !== namesForGroupLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModel.groupMDQTabs && this.groupMDQTabs.length !== this.groupModel.groupMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.groupLevelTabs.length; i < l; i++) {\n\t\t\tif (this.groupLevelTabs[i].label !== namesForGroupLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\texpandGroup(e) {\n\t\tif (!e.target.hasAttribute('triggersExpandGroup') || !this.isMobile || this.showSpinner){\n\t\t\treturn;\n\t\t}\n\n\t\t// if the mobile group tabs are rendered, then there should be no lag to show/hide the tabs, so a spinner shouldn't appear.\n\t\tif (!this.$$('#mobileGroupTabs')) {\n\t\t\tthis.showSpinner = true;\n\t\t}\n\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.set('groupModel.groupExpanded', !this.groupModel.groupExpanded);\n\t\t\tthis.groupExpanded = this.groupModel.groupExpanded;\n\t\t\t\n\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\tthis.showSpinner = false;\n\t\t\t});\n\t\t});\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setIsButton();\n\t\tif (this.viewport && this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * @param {Object} e - event object\n\t * @private\n\t */\n\t_setUpgradeQuantity(e) {\n\t\tlet sourceIndex = e.detail.sourceIndex;\n\t\tlet upgradeIndex = e.detail.upgradeIndex;\n\t\tlet sourceLineVO = e.detail.sourceLineVO;\n\t\tlet upgradeLineVO = e.detail.upgradeLineVO;\n\n\t\tthis.debounce('Handle user input for automatic upgrade asset quantity changed', () => {\n\t\t\tif (sourceLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex, sourceLineVO, true);\n\t\t\t} else if (upgradeLineVO.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChanged(upgradeIndex, sourceIndex, upgradeLineVO, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChanged(sourceIndex, upgradeIndex);\n\t\t\t}\n\t\t\tsourceLineVO.invalidQuantity = null;\n\t\t\tupgradeLineVO.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t/**\n\t * Notify the path of the correct line with the quantity that needs to be re-rendered for automatic upgrade source ratio enforcement\n\t * Fires validate-quantity-changed event listened for in LineEditor.js for use of toast\n\t * @param {Number} index1 - index to update for either the source or upgrade\n\t * @param {Number} index2 - index to update for the opposite of index1\n\t * @param {Object} lineVO - either the source or upgrade lineVO containing the record to be updated\n\t * @param {Boolean} invalidQuantity - flag for whether the user entered an invalidQuantity or not, added to avoid case where invalidQuantity is set to a number that evaluates to truthy\n\t */\n\t_notifyQuantityChanged(index1, index2, lineVO, invalidQuantity) {\n\t\tlet invalidQuantityCheck;\n\t\tlet validQuantityCheck;\n\t\tthis.groupModel.standardLines[index1].internalUpdate = true;\n\t\tthis.groupModel.standardLines[index2].internalUpdate = true;\n\n\t\t// Adds boolean check for invalidQuantity in case invalidQuantity is set to a number that evaluates to truthy\n\t\tif (invalidQuantity) {\n\t\t\tinvalidQuantityCheck = lineVO.invalidQuantity;\n\t\t\tvalidQuantityCheck = lineVO.validQuantity;\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.invalidQuantity;\n\t\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\t\tlineVO.record[this.editorModel.constants.QUANTITY_FIELD] = lineVO.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(`groupModel.standardLines.${index1}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index1].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index1].internalUpdate = false;\n\t\tthis.notifyPath(`groupModel.standardLines.${index2}.lineVO.record.${this.editorModel.constants.QUANTITY_FIELD}`, this.groupModel.standardLines[index2].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]);\n\t\tthis.groupModel.standardLines[index2].internalUpdate = false;\n\n\t\t// Event must be at end of function and gets called in invalidQuantity on lineVO\n\t\tthis.fire('validate-quantity-changed', {\n\t\t\tinvalidQuantity: invalidQuantityCheck,\n\t\t\tvalidQuantity: validQuantityCheck\n\t\t});\n\t}\n\n\taddSegmentedLineToEmptyTable(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tif (!this.groupModel.hasVisibleSegmentedLines ) {\n\t\t\tthis.groupModel.hasVisibleSegmentedLines = {};\n\t\t};\n\n\t\t//Create all segment tabs to allow for drag and dropping on all segments\n\n\t\tthis.groupModel.setDimensionProperties(dimension);\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t// Update multisegment columns to render the row properly\n\t\tthis.groupModel.groupVO.multiSegmentColumns[dimension] = lineModel.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\tthis.groupModel.groupVO.localizedMultiSegmentColumns[dimension] = lineModel.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\t\tif (this.$$('#leGroupTabs')) {\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t}\n\t\t// Rebuild Tabs\n\t\tthis._updatePageData();\n\t}\n\n\taddSegmentedLineToExistingTab(lineModel) {\n\t\tlet\tlineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tdimension = (this.groupModel.quoteModel.quoteVO.multiSegmentKeys) ?\n\t\t\t\tthis.groupModel.quoteModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\t//Update segmentedLines array to add new line.\n\t\tthis.groupModel.segmentedLines.push(lineModel);\n\t\t//Update properties on the lineModel to assign the line to a new group.\n\t\tlineModel.groupModel = this.groupModel;\n\t\tlineModel.lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\tfor (let i = 0, l = lineModel.segments.length; i < l; i++) {\n\t\t\tlineModel.segments[i].lineVO.parentGroupKey = this.groupModel.groupKey;\n\t\t}\n\t\tthis.groupModel.segmentedLinesBySegmentKey[segmentKey] = lineModel;\n\t\tthis.push(`groupModel.segmentedLinesByDimension.${dimension}`, lineModel);\n\n\t}\n\n\tremoveSegmentedLine(lineModel) {\n\t\tlet lineVO = lineModel.lineVO,\n\t\t\tlineRecord = lineVO.record,\n\t\t\tlineKey = lineVO.key,\n\t\t\tsegmentKey = lineRecord[this.groupModel.constants.SEGMENT_KEY_FIELD],\n\t\t\tsegmentLabel = lineRecord[this.groupModel.constants.SEGMENT_LABEL_FIELD],\n\t\t\tdimension = (this.groupModel.quoteVO.multiSegmentKeys) ? this.groupModel.quoteVO.multiSegmentKeys[segmentKey] : null;\n\n\t\tthis.groupModel.segmentedLines.splice(this.groupModel.segmentedLines.indexOf(lineModel), 1);\n\t\tdelete this.groupModel.segmentedLinesBySegmentKey[segmentKey];\n\t\tthis.splice(`groupModel.segmentedLinesByDimension.${dimension}`, this.groupModel.segmentedLinesByDimension[dimension].indexOf(lineModel), 1);\n\t\tif (this.groupModel.segmentedLinesByDimension[dimension].length === 0) {\n\t\t\tthis.groupModel.removeDimensionProperties(dimension);\n\t\t\tdelete this.groupModel.groupVO.localizedMultiSegmentColumns[dimension];\n\t\t\tdelete this.groupModel.groupVO.multiSegmentColumns[dimension];\n\t\t\tthis.$$('#leGroupTabs').destroyTabs();\n\t\t\t// Rebuild Tabs\n\t\t\tthis._updatePageData();\n\t\t}\n\t}\n\n\t_onTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tthis.dragDrop.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tthis.linesByParentKey = this.editorModel.quoteModel.linesByParentItemKey;\n\t\tthis.indexByGroupKey = this.groupModel.quoteModel.indexByGroupKey;\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\t\tthis.dragDrop.dragLineModel = [];\n\t\tthis.dragDrop.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tthis.dragDrop.dragKey = dragElement.lineModel.lineVO.key;\n\t\tthis.dragDrop.dragLineModel = dragElement.lineModel;\n\t\tthis.dragDrop.segment = dragElement.domHost.dimension;\n\t\tthis.dragDrop.dragIndex = this.groupModel.segmentedLinesByDimension[this.dragDrop.segment].indexOf(dragElement.lineModel);\n\n\t\t//Toggle true the 'hidden' attribute to hide rows being dragged from page.\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dragDrop.segment}.${this.dragDrop.dragIndex}.hidden`, true);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) return;\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.getAttribute('ref') === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tswitch(dd.targetClass) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tdd._updateMDQTableRowHoverOverObject(dd.sourceElement, hoverElement);\n\t\t\t\tif (!dd.hoverOver) return;\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = false;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tif (!dd.keepBundleTogether) {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t} else if (dd.sourceElement.lineModel.component) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (!dd.keepBundleTogether) {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t} else if (dd.sourceElement.lineModel.component) {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = {\"comp\": hoverElement};\n\t\t\t\t}\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tthis.dragDrop.dropKey = null;\n\t\tthis.dragDrop.dropIndex = null;\n\t\tthis.dragDrop.dropGroupModel = null;\n\t\tlet dropLeGroup,\n\t\t\tdropSegLinesTable,\n\t\t\tdragLineModel = this.dragDrop.dragLineModel;\n\n\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dragDrop.segment}.${this.dragDrop.dragIndex}.hidden`, false);\n\n\t\tif (!dropElement) return;\n\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\tthis.dragDrop.dragGroupModel._updateSegmentedSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tdragElement.domHost.fieldNames = dragElement.domHost._getFields();\n\t\t\tdragElement.domHost._setColumnWidths();\n\t\t}\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-mdqRows':\n\t\t\t\tlet dropGroupModel = dropElement.lineModel.groupModel,\n\t\t\t\t\tsegment = this.dragDrop.segment,\n\t\t\t\t\tdropLeGroup = dropElement.domHost.domHost.domHost,\n\t\t\t\t\tdropSegLinesTable = dropElement.domHost;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropGroupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\t\t\t\t//Get index of where drop will occur on array of segmentedLinesByDimension after line has been spliced\n\t\t\t\t//from it's original groupModel.\n\t\t\t\tlet dropIndex = dropGroupModel.segmentedLinesByDimension[segment].indexOf(dropElement.lineModel);\n\t\t\t\t//Adjust index of drop depending on whether it's dropped before or after.\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdropIndex = dropIndex >= 0 ? dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dropIndex;\n\t\t\t\t}\n\t\t\t\t//Update relevant lineModel properties to maintain it's group information\n\t\t\t\tdragLineModel.groupModel = dropGroupModel;\n\t\t\t\tdragLineModel.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\tdragLineModel.segments.forEach(function(seg){\n\t\t\t\t\tseg.lineVO.parentGroupKey = dropGroupModel.groupKey;\n\t\t\t\t\tseg.groupModel = dropGroupModel;\n\t\t\t\t}.bind(this));\n\t\t\t\t//Splice line into it's new position/group.\n\t\t\t\tdropLeGroup.splice(`groupModel.segmentedLinesByDimension.${segment}`, dropIndex, 0, dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tdropLeGroup = dropElement.parentNode.parentNode.parentNode.host ? dropElement.parentNode.parentNode.parentNode.host\n\t\t\t\t\t\t\t: dropElement.parentNode.parentNode.parentNode;\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\tbreak;\n\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = this.dragDrop._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`),\n\t\t\t\tdropSegLinesTable = undefined;\n\t\t\t\tthis.dragDrop.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tif (dragLineModel.subscriptionScopeEditable) {\n\t\t\t\t\tthis.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable = true;\n\t\t\t\t}\n\t\t\t\tif (!this.dragDrop.dropGroupModel.dimensions.includes(this.dragDrop.segment)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dragLineModel);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dragLineModel);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\t//Splice line from it's original position/group.\n\t\tthis.removeSegmentedLine(this.dragDrop.dragLineModel);\n\t\tif (className === 'sb-droppable-mdqRows') {\n\t\t\tlet model = dropLeGroup.groupModel.segmentedLinesByDimension[segment];\n\t\t\tdropElement.domHost.notifyPath(`groupModel.segmentedLinesByDimension.${segment}`, model.slice());\n\t\t\tdropElement.domHost.notifyPath('lineModels', model.slice());\n\t\t}\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n\n\t_groupCustomActionsChanged(e) {\n\t\tlet l = e ? e.length : 0;\n\t\tfor(let i = 0; i < l; i++)\n\t\t\tthis.notifyPath(`editorModel.groupCustomActions.${i}.children`);\n\t}\n}\n\nPolymer( LEGroup );","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {removeTopBottomBorderClass} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\n\nconst GHOST_X_OFFSET = 8;\nconst GHOST_Y_OFFSET = 150;\n\nexport class LEGroupLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-group-layout';\n\t\tthis.properties = {\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tlayoutLink: String,\n\t\t\tlayoutWidth: Number,\n\t\t\tlayoutLeft: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: '24px'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tlastSelectedGroup: Object\n\t\t};\n\t}\n\n\tget listeners() {\n\t\treturn {'side-toggle-clicked' : 'toggle'};\n\t}\n\n\tget observers() {\n\t\treturn ['_groupModelsAreChanged(editorModel, groupModels, rightSideButton)', '_spliceObserver(groupModels.splices)', '_createDragDropModel(groupModels)'];\n\t}\n\n\tready() {\n\t\tPolymer.RenderStatus.afterNextRender(this, function() {\n\t\t\tthis._resize = function() {\n\t\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\t\tthis._buildLayout();\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\t\tthis.fire('iron-signal', {name: 'col-widths-changed', data: {layout: this.editorModel.layout}});\n\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t}.bind(this);\n\t\t\twindow.addEventListener('resize', this._resize);\n\t\t});\n\t}\n\n\tdetached() {\n\t\twindow.removeEventListener('resize', this._resize);\n\t}\n\n\tget isMobile() {\n\t\treturn this.editorModel.deviceContext.isMobile;\n\t}\n\n\t_spliceObserver(splicedRecords) {\n\t\tif (!splicedRecords || splicedRecords.indexSplices[0].addedCount == 0)\n\t\t\treturn;\n\t\tthis.addedIndex = splicedRecords.indexSplices[0].index;\n\t\tthis.addedKey = splicedRecords.indexSplices[0].object[this.addedIndex].groupVO.key;\n\t\tif (!this.observersAttached) {\n\t\t\tthis._attachObservers();\n\t\t}\n\t}\n\n\ttoggle() {\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.closePanel();\n\t\t} else {\n\t\t\tthis.openPanel();\n\t\t}\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tthis.fire('iron-signal', {name: 'group-panel-toggled', data: {drawerState: this.drawerState}});\n\t\t});\n\t}\n\n\topenPanel() {\n\t\tthis.$.drawerPanel.style.left = '0px';\n\t\tif (!this.isMobile) {\n\t\t\tthis.$.mainPanel.style.paddingLeft = '280px';\n\t\t}\n\t\tthis.drawerState = 'open';\n\t}\n\n\tclosePanel() {\n\t\tthis.$.drawerPanel.style.left = '-256px';\n\t\tthis.$.mainPanel.style.paddingLeft = !this.isMobile && this.rightSideButton ? '24px' : '0px';\n\t\tthis.drawerState = 'closed';\n\t}\n\n\tgroupPanelCreated() {\n\t\tif (this.isMobile) {\n\t\t\tthis.debounce('resize', function(e) {\n\t\t\t\tthis._buildLayout();\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tthis.fire('iron-signal', {name: 'col-widths-changed', data: {layout: this.editorModel.layout}});\n\t\t\t\t});\n\t\t\t}, 50);\n\t\t}\n\t}\n\n\t_groupModelsAreChanged() {\n\t\t// Set default drawer state after groupModels is set to make it appear the same time as line items\n\t\tif (!this.drawerState)\n\t\t\tthis.drawerState = 'closed';\n\n\t\tthis.$.mainPanel.style.paddingLeft = this.rightSideButton && !this.isMobile ? '24px' : '0px';\n\t\t// Observe child nodes to see when a group is added or removed\n\t\tif (!this.observersAttached)\n\t\t\tthis._attachObservers();\n\n\t\tthis._buildLayout();\n\t}\n\n\t_buildLayout() {\n\t\tif (this.isMobile) return;\n\t\tlet layout = {},\n\t\t\tmd = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],\n\t\t\tactionsOnTheLeft = this.editorModel.actionsOnTheLeft,\n\t\t\tmultiDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled,\n\t\t\thasLines = this.editorModel.quoteModel.quoteVO.lineItems.length > 0;\n\t\tlayout.totalWidth = hasLines ? this._getMaxTableWidth(this._getAvailableWidth(), md, actionsOnTheLeft, multiDeleteEnabled) : this._getAvailableWidth();\n\t\tlayout.colWidths = this._calculateColWidths(layout, md, actionsOnTheLeft, multiDeleteEnabled);\n\t\tthis.set('editorModel.layout', layout);\n\t}\n\n\t_getAvailableWidth() {\n\t\tlet pageContainer = document.getElementById('sbPageContainer');\n\t\t// return early for tests to not fail as there is no pageContainer\n\t\tif (!pageContainer) return;\n\t\tlet availableWidth = Polymer.dom(pageContainer.root).querySelector('sb-line-editor').clientWidth;\n\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tavailableWidth -= 30 + 2; // group padding and borders\n\t\t\tif (this.editorModel.quoteModel.lineGroups.length > 1) {\n\t\t\t\tavailableWidth -= 24; //closed side panel width\n\t\t\t\tif (this.drawerState && this.drawerState == 'open') {\n\t\t\t\t\tavailableWidth -= 256; // expanded side panel width\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn availableWidth;\n\t}\n\n\t_getMaxTableWidth(availableWidth, md, actionsOnTheLeft, multiDeleteEnabled) {\n\n\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, this._getQuoteStandardFields(), md, actionsOnTheLeft, multiDeleteEnabled);\n\t\tthis.tableLayoutBuilder.build();\n\t\tlet maxWidth = this.tableLayoutBuilder.getTotalWidth();\n\n\t\tlet cols = this.editorModel.quoteModel.quoteVO.multiSegmentColumns,\n\t\t\tmultiSegmentFieldNames = this._getQuoteSegmentedFields();\n\t\tfor (let dimension in cols) {\n\t\t\tif (!cols.hasOwnProperty(dimension)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet fieldNames = multiSegmentFieldNames.concat(cols[dimension]).concat('total');\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(availableWidth, fieldNames, md, actionsOnTheLeft, multiDeleteEnabled);\n\t\t\tthis.tableLayoutBuilder.build();\n\t\t\tlet totalWidth = this.tableLayoutBuilder.getTotalWidth();\n\t\t\tif (totalWidth > maxWidth) {\n\t\t\t\tmaxWidth = totalWidth;\n\t\t\t}\n\t\t}\n\t\treturn maxWidth;\n\t}\n\n\t_calculateColWidths(layout, md, actionsOnTheLeft, multiDeleteEnabled) {\n\t\tlet colWidths = {};\n\n\n\t\tlet groups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (let i = 0, len = groups.length; i < len; i++) {\n\t\t\tlet groupModel = groups[i],\n\t\t\t\tgroupKey = groupModel.groupKey,\n\t\t\t\tcols = groupModel.quoteModel.grouped ? groupModel.groupVO.multiSegmentColumns : groupModel.quoteModel.quoteVO.multiSegmentColumns;\n\n\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getGroupStandardFields(groupKey), md, actionsOnTheLeft, multiDeleteEnabled);\n\t\t\tif (!colWidths[groupKey]) {\n\t\t\t\tcolWidths[groupKey] = {};\n\t\t\t}\n\t\t\tcolWidths[groupKey]['Standard'] = this.tableLayoutBuilder.build();\n\t\t\tlayout.leftOffset = this.tableLayoutBuilder.getLeftOffset();\n\n\t\t\tfor (let dim in cols) {\n\t\t\t\tif (!cols.hasOwnProperty(dim)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.tableLayoutBuilder = new TableLayoutBuilder(layout.totalWidth, this._getSegmentedFieldNames(groupModel, cols[dim]), md, actionsOnTheLeft, multiDeleteEnabled);\n\t\t\t\tcolWidths[groupKey][dim] = this.tableLayoutBuilder.build();\n\t\t\t}\n\t\t}\n\t\treturn colWidths;\n\t}\n\n\t_getQuoteStandardFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].standardSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this._getStandardFields(subsScope);\n\t}\n\n\t_getGroupStandardFields(groupKey) {\n\t\tlet group = this.editorModel.quoteModel.groupsByKey[groupKey];\n\t\treturn this._getStandardFields(group.standardSubscriptionScopeEditable);\n\t}\n\n\t_getStandardFields(subsScope) {\n\t\tlet fields = this.editorModel.fieldsetMap.lineFieldNames;\n\t\tif (subsScope) {\n\t\t\tfields = [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields);\n\t\t}\n\t\treturn fields;\n\t}\n\n\t_getQuoteSegmentedFields() {\n\t\tlet subsScope = false,\n\t\t\tgroups = this.editorModel.quoteModel.lineGroups;\n\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\tif (groups[i].segmentedSubscriptionScopeEditable) {\n\t\t\t\tsubsScope = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tlet multiSegmentSummaryFieldNames = this.editorModel.data.multiSegmentLineSummaryFieldNames;\n\t\treturn subsScope ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(multiSegmentSummaryFieldNames) : multiSegmentSummaryFieldNames;\n\t}\n\n\t_getSegmentedFieldNames(groupModel, colNames) {\n\t\tlet summaryFields = this.editorModel.data.multiSegmentLineSummaryFieldNames,\n\t\t\tfieldNames = groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(summaryFields) : summaryFields.slice();\n\t\tfor (let i = 0, len = colNames.length; i < len; i++) {\n\t\t\tfieldNames.push(colNames[i].replace(/\\W/g, ''));\n\t\t}\n\t\tfieldNames.push('total');\n\t\treturn fieldNames;\n\t}\n\n\t_attachObservers() {\n\t\tif (this.rightSideButton || (this.isMobile)) {\n\t\t\tthis.observersAttached = true;\n\t\t\tthis._observeNodes = Polymer.dom(this.$.groups).observeNodes(function (info) {\n\t\t\t\tlet addedNodes = info.addedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\" && node.groupModel.groupVO.key == this.addedKey)\n\t\t\t\t}.bind(this));\n\t\t\t\tlet removedNodes = info.removedNodes.filter(function(node) {\n\t\t\t\t\treturn (node.nodeName === \"SB-LE-GROUP\")\n\t\t\t\t});\n\t\t\t\tif (addedNodes[0] === removedNodes[0]) return;\n\t\t\t\tthis.processNewGroups(addedNodes);\n\t\t\t\tthis.processRemovedGroups(removedNodes);\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tprocessNewGroups(addedNodes) {\n\t\tif (this.addedKey && addedNodes.length > 0) {\n\t\t\t// Only runs this code if add group is clicked\n\t\t\tlet groupKey = this.addedKey;\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.closePanel();\n\t\t\t}\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\tPolymer.dom(this.$.groups).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t\tthis.addedKey = null;\n\t\t}\n\t}\n\n\tprocessRemovedGroups(removedNodes) {\n\t\tif (this.lastSelectedGroup && removedNodes.length == 1) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t\tthis.lastSelectedGroup = undefined;\n\t\t\tPolymer.dom(this.$.groups).unobserveNodes(this._observeNodes);\n\t\t\tthis.observersAttached = false;\n\t\t}\n\t}\n\n\ttoggleSelectedAndScroll(key) {\n\t\tlet groupElement = this.$$('#_' + key);\n\t\tif (this.lastSelectedGroup) {\n\t\t\tthis.toggleClass('selected-tab', false, this.lastSelectedGroup);\n\t\t}\n\t\tif (this.drawerState == 'open') {\n\t\t\tthis.toggleClass('selected-tab', true, groupElement);\n\t\t\tthis.lastSelectedGroup = groupElement;\n\t\t}\n\t\tif (!this.$$('#Group_' + key))\n\t\t\treturn;\n\t\tthis._scrollIntoView(this.$$('#Group_' + key));\n\t\tthis.$$('#_' + key).scrollIntoView(false);\n\t\tif (this.isMobile) {\n\t\t\tthis.$$('#Group_' + key).set('groupModel.groupExpanded', true);\n\t\t\tthis.$$('#Group_' + key).groupExpanded = true;\n\t\t}\n\t}\n\n\t_scrollIntoView(target) {\n\t\tthis.$$('#mainPanel').scrollTop = this.isMobile ? target.offsetTop : target.offsetTop - 15;\n\t}\n\n\tnavTo(e) {\n\t\te.stopPropagation();\n\n\t\tif (this.isMobile) {\n\t\t\tvar loadingSpinner = e.target.querySelector('.loadingSpinner');\n\t\t\tloadingSpinner.toggleClass('invisible', false);\n\t\t}\n\t\t\n\t\t// Wait for the spinner to render before proceeding.\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\tlet groupKey = Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\t\tthis.toggleSelectedAndScroll(groupKey);\n\t\t\tif (this.isMobile){\n\t\t\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t\t\tloadingSpinner.toggleClass('invisible', true);\n\t\t\t\t});\n\t\t\t\tthis.toggle();\n\t\t\t}\n\t\t});\n\t}\n\n\t_createDragDropModel() {\n\t\t// No editorModel means not mobile.\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet validTargets = new Set(['sb-droppable-sidePanelGroups']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'div', validTargets,\n\t\t\tthis.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\tonTrack(e) {\n\t\tif (this.isMobile || !AppContext.isDesktop) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\t// Get ghost from lineEditor\n\t\tlet dd = this.dragDrop;\n\t\tdd.ghost = this.dragDrop.lineEditor.$.ghost;\n\n\t\tdd.dragIndex = dragElement.dataIndex;\n\t\tdd.dragGroupModel = this.groupModels[dd.dragIndex];\n\t\tlet groupLayout = this.$$('#groupLayout');\n\t\tthis.toggleAttribute('hidden', true, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop;\n\t\thoverElement = this.dragDrop._findSidePanelGroupValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tif(hoverElement.id === 'placeholder') {\n\t\t\thoverElement = hoverElement.ref === 'before' ? hoverElement.previousElementSibling : hoverElement.nextElementSibling;\n\t\t}\n\t\tdd.hoverOver = {\"comp\": hoverElement, \"phLoc\": 'both'};\n\t\tdd.targetHost = this;\n\t\tdd.highlightableElements = [];\n\t\tdd.highlightableElements.push(dd.hoverOver.comp); // Get the exact element whose border can be highlighted based on path from hoverOver\n\t\tdd.usePlaceholder = true;\n\t\tdd.enableHighLight = false;\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dd = this.dragDrop;\n\t\tthis.toggleAttribute('hidden', false, this.$.sbDroppableSidePanelGroups.querySelectorAll('.nav-item')[dd.dragIndex]);   // Unhide the drag element\n\t\tif (!dropElement) {return;}     // Return early if dropElement does not exist\n\t\tlet sideGrp = this.$.sbDroppableSidePanelGroups;\n\t\tlet maxIndex = sideGrp.querySelectorAll('.nav-item').length - 1;\n\n\t\tdd.dropIndex = dropElement.dataIndex;\n\t\tif (dropElementBefore){\n\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t} else{\n\t\t\t++dd.dropIndex;\n\t\t}\n\n\t\tremoveTopBottomBorderClass(dropElement);    // Remove highlighting if any on the drop element\n\t\tthis.splice('groupModels', dd.dragIndex, 1);\n\t\tif (dd.dropIndex < maxIndex){\n\t\t\tthis.splice('groupModels', dd.dropIndex, 0, dd.dragGroupModel);\n\t\t} else {\n\t\t\tthis.push('groupModels', dd.dragGroupModel);\n\t\t}\n\n\t\tdd.lineEditor.renumber();\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tdd.lineEditor.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n}\n\nPolymer(LEGroupLayout);","export class LESummaryRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-row';\n\t\tthis.properties = {\n\t\t\teditorModel: Object,\n\t\t\tgroupModel: Object,\n\t\t\tfieldNames: Array,\n\t\t\tcolWidths: Object\n\t\t};\n\t}\n\n\tcolWidthsChanged(e) {\n\t\tif (this.editorModel.deviceContext.isMobile) return;\n\t\t// this method is triggered on the 'col-widths-changed' iron signal\n\t\t// at this point we should have the updated groupModel in this component\n\t\t// and so we can use the groupKey to de-reference the colWidths\n\t\tthis.set('colWidths', e.detail.layout.colWidths[this.groupModel.groupKey]['Standard']);\n\t}\n\n\t_getColWidth(fieldName) {\n\t\tif (!this.colWidths) return;\n\t\treturn this.colWidths[fieldName] + 'px';\n\t}\n}\n\nPolymer( LESummaryRow );","\nexport class DiscountConverter {\n\tconstructor(lineModel, item) {\n\t\tthis.lineModel = lineModel;\n\t\tthis.isAdditionalDiscountField = (item === lineModel.fieldNames.ADDITIONAL_DISCOUNT_FIELD);\n\t\tthis._pullValueFromModel();\n\t\tthis._determineUnitAndDisplayValue();\n\t\tthis.setDiscountValue(this._displayValue);\n\t}\n\t\n\t_pullValueFromModel() {\n\t\tthis.value = this.isAdditionalDiscountField ? this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_FIELD) : this.lineModel.getField(this.lineModel.fieldNames.MARKUP_FIELD);\n\t}\n\n\t_determineUnitAndDisplayValue() {\n\t\tif (this.isAdditionalDiscountField) {\n\t\t\tthis.units = this.lineModel.editorModel.data.additionalDiscountUnitOptions;\n\t\t\tlet activeUnits = {};\n\t\t\tfor (let unit of this.units) {\n\t\t\t\tactiveUnits[unit.value] = true;\n\t\t\t}\n\t\t\tif (this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) && !activeUnits['Amount']) {\n\t\t\t\tlet nextActiveUnitValue = this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) && activeUnits['Percent'] ? 'Percent' : this._getFirstActiveUnitValue(activeUnits);\n\t\t\t\tthis.convertDiscountValue(nextActiveUnitValue);\n\t\t\t}\n\t\t\tif (this.lineModel.lineVO.targetCustomerAmount) {\n\t\t\t\tthis.unit = 'UnitOverride';\n\t\t\t\tthis._displayValue = this.lineModel.lineVO.targetCustomerAmount;\n\t\t\t} else if (this.lineModel.lineVO.targetCustomerTotal) {\n\t\t\t\tthis.unit = 'TotalOverride';\n\t\t\t\tthis._displayValue = this.lineModel.lineVO.targetCustomerTotal;\n\t\t\t} else if (this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD) != null) {\n\t\t\t\tthis.unit = 'Amount';\n\t\t\t\tthis._displayValue = this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD);\n\t\t\t} else if (this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD) != null) {\n\t\t\t\tthis.unit = 'Percent';\n\t\t\t\tthis._displayValue = this.lineModel.getField(this.lineModel.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD);\n\t\t\t} else {\n\t\t\t\tthis.unit = this.lineModel.editorModel.data.defaultAdditionalDiscountUnit.replace(/ /g,'');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.units = this.lineModel.editorModel.data.markupUnitOptions;\n\t\t\tif (this.lineModel.getField(this.fieldNames.MARKUP_AMOUNT_FIELD) != null) {\n\t\t\t\tthis.unit = 'Amount';\n\t\t\t\tthis._displayValue = this.lineModel.getField(this.fieldNames.MARKUP_AMOUNT_FIELD);\n\t\t\t} else if (this.lineModel.getField(this.fieldNames.MARKUP_RATE_FIELD) != null) {\n\t\t\t\tthis.unit = 'Percent';\n\t\t\t\tthis._displayValue = this.lineModel.getField(this.fieldNames.MARKUP_RATE_FIELD);\n\t\t\t} else {\n\t\t\t\tthis.unit = this.lineModel.editorModel.data.defaultMarkupUnit.replace(/ /g,'');\n\t\t\t}\n\t\t}\n\t}\n\n\t_getFirstActiveUnitValue(activeUnits) {\n\t\tfor (let value in activeUnits) {\n\t\t\tif (activeUnits[value]) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t}\n\n\tget displayValue() {\n\t\treturn this._displayValue !== undefined ? this._displayValue : null;\n\t}\n\t\n\tsetDiscountValue(value) {\n\t\tlet setAdditionalDiscountValues = () => {\n\t\t\tif (this.unit === 'Percent') {\n\t\t\t\tthis.record[this.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD] = value;\n\t\t\t} else if (this.unit === 'Amount') {\n\t\t\t\tthis.record[this.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = value;\n\t\t\t} else if (this.unit === 'UnitOverride') {\n\t\t\t\tthis.lineModel.lineVO.targetCustomerAmount = value;\n\t\t\t} else if (this.unit === 'TotalOverride') {\n\t\t\t\tthis.lineModel.lineVO.targetCustomerTotal = value;\n\t\t\t}\n\t\t\tthis.value = this.unproratedDiscount/(this.lineModel.lineVO.amountDiscountProrated ? this.record[this.fieldNames.PRORATE_MULTIPLIER_FIELD] : 1);\n\t\t}\n\t\tlet setMarkupValues = () => {\n\t\t\tif (this.unit === 'Percent') {\n\t\t\t\tthis.record[this.fieldNames.MARKUP_RATE_FIELD] = value;\n\t\t\t} else if (this.unit === 'Amount') {\n\t\t\t\tthis.record[this.fieldNames.MARKUP_AMOUNT_FIELD] = value;\n\t\t\t}\n\t\t\tthis.value = this.record[this.fieldNames.MARKUP_AMOUNT_FIELD] || (this.record[this.fieldNames.UNIT_COST_FIELD] ? this.record[this.fieldNames.UNIT_COST_FIELD] * value / 100 : null);\n\t\t}\n\n\t\tif (this.isAdditionalDiscountField){\n\t\t\tsetAdditionalDiscountValues();\n\t\t} else {\n\t\t\tsetMarkupValues();\n\t\t}\n\t\tthis._displayValue = value;\n\n\t\t// if value is not a number, then simply set it to zero\n\t\tif(isNaN(this.value))\n\t\t\tthis.value = 0;\n\t}\n\n\tget unproratedDiscount() {\n\t\tlet price = this.lineModel.getField(this.fieldNames.REGULAR_PRICE_FIELD);\n\t\t// The raw discount is calculated directly from the relevant discount field, and may need to be changed to undo\n\t\t// proration effects\n\t\tlet rawDiscount;\n\t\t// Modifier is what we need to multiply the raw discount by to get the true discount. Under normal use cases, it should be 1,\n\t\t// but it can be other values if we need to un-prorate the discount\n\t\tlet modifier;\n\t\tif (this.lineModel.getField(this.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD)) {\n\t\t\trawDiscount = price * (this.lineModel.getField(this.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD) / 100);\n\t\t\t// Percent discounts don't give a hoot about proration, so there's no modifier\n\t\t\tmodifier = 1;\n\t\t} else if (this.lineModel.lineVO.targetCustomerAmount) {\n\t\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t\t// For Unit Target Amount, the raw discount is calculated as the difference between the overridden price\n\t\t\t// and the regular price. As such, the multiplier is 1\n\t\t\trawDiscount = price - this.lineModel.lineVO.targetCustomerAmount;\n\t\t\tmodifier = 1;\n\t\t} else if (this.lineModel.lineVO.targetCustomerTotal) {\n\t\t\t// We check Unit and Total Overrides before we check Amount, because calculation causes the Amount Discount to be\n\t\t\t// set based on the values of Unit and Total Overrides.\n\n\t\t\t// For Total Target Amount, the raw discount is the difference between the overridden unit price and the regular price,\n\t\t\t// so the multiplier is 1\n\t\t\trawDiscount = price - (this.lineModel.lineVO.targetCustomerTotal / this.effectiveQuantity);\n\t\t\tmodifier = 1;\n\t\t} else if (this.lineModel.getField(this.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)) {\n\t\t\trawDiscount = this.lineModel.getField(this.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD);\n\t\t\t// If amountDiscountProrated is active, then our multiplier is our ProrateMultiplier, otherwise it's 1\n\t\t\tmodifier = this.lineModel.lineVO.amountDiscountProrated ? this.lineModel.getField(this.fieldNames.PRORATE_MULTIPLIER_FIELD) : 1;\n\t\t}\n\t\t// The adjusted discount is the actual difference between the regular unit price and the discounted price\n\t\treturn rawDiscount * modifier;\n\t}\n\n\tget effectiveQuantity() {\n\t\t// This method is duplicated from QuoteLineVO.cls\n\t\tlet quantity = this.record[this.fieldNames.QUANTITY_FIELD];\n\t\tlet priorQuantity = this.record[this.fieldNames.PRIOR_QUANTITY_FIELD];\n\t\tlet actualQuantity = this.record[this.fieldNames.EXISTING_FIELD] ? quantity - priorQuantity : quantity;\n\t\tif ((this.record[this.fieldNames.PRICING_METHOD_FIELD] == 'Block' || this.record[this.fieldNames.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab') && this.record[this.fieldNames.EXISTING_FIELD] && priorQuantity != null && quantity - priorQuantity == 0) {\n\t\t\treturn 0;\n\t\t}\n\t\telse if ((this.record[this.fieldNames.PRICING_METHOD_FIELD] == 'Block' || this.record[this.fieldNames.DISCOUNT_SCHEDULE_TYPE_FIELD] == 'Slab')) {\n\t\t\treturn 1;\n\t\t}\n\t\telse if (this.record[this.fieldNames.EXISTING_FIELD] && this.lineModel.dynamicSubscription && this.record[this.fieldNames.LIST_PRICE_FIELD] != 0 && actualQuantity == 0) {\n\t\t\treturn quantity;\n\t\t}\n\t\telse if (this.lineModel.groupModel.quoteModel.quoteVO.record[this.fieldNames.TYPE_FIELD] == 'Amendment' && !this.lineModel.subscription && actualQuantity < 0) {\n\t\t\treturn 0;\n\t\t} else {\n\t\t\treturn actualQuantity;\n\t\t}\n\t}\n\n\tconvertDiscountValue(discountUnit) {\n\t\tlet previousDisplayValue = this._displayValue;\n\t\tif (!discountUnit) {\n\t\t\treturn;\n\t\t}\n\t\tlet changeAdditionalDiscountUnit = () => {\n\t\t\tlet price = this.record[this.fieldNames.REGULAR_PRICE_FIELD];\n\t\t\tlet nullifyAll = () => {\n\t\t\t\tthis.record[this.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD] = null;\n\t\t\t\tthis.record[this.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = null;\n\t\t\t\tif (this.lineModel.lineVO.targetCustomerAmount) {\n\t\t\t\t\tthis.lineModel.lineVO.targetCustomerAmount = null;\n\t\t\t\t}\n\t\t\t\tif (this.lineModel.lineVO.targetCustomerTotal) {\n\t\t\t\t\tthis.lineModel.lineVO.targetCustomerTotal = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!price) {\n\t\t\t\tnullifyAll();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet unproratedDiscount = this.unproratedDiscount\n\n\t\t\t// Null out all the discount fields so we don't end up with conflicts.\n\t\t\tnullifyAll();\n\n\t\t\t// Assign the discount to the selected unit field\n\t\t\tif (discountUnit == 'Percent') {\n\t\t\t\t// The discount percent isn't affected by proration\n\t\t\t\treturn this.record[this.fieldNames.ADDITIONAL_DISCOUNT_RATE_FIELD] = (unproratedDiscount / price) * 100;\n\t\t\t} else if (discountUnit == 'Amount') {\n\t\t\t\t// Amount discount can be affected by proration, so we need to check that. If amountDiscount is prorated, then\n\t\t\t\t// we divide the discount by the prorate multiplier\n\t\t\t\tlet amountMultiplier = this.lineModel.lineVO.amountDiscountProrated ? this.record[this.fieldNames.PRORATE_MULTIPLIER_FIELD] : 1;\n\t\t\t\treturn this.record[this.fieldNames.ADDITIONAL_DISCOUNT_AMOUNT_FIELD] = unproratedDiscount / amountMultiplier;\n\t\t\t} else if (discountUnit == 'UnitOverride') {\n\t\t\t\t// Unit Override uses the unprorated discount\n\t\t\t\treturn this.lineModel.lineVO.targetCustomerAmount = price - unproratedDiscount;\n\t\t\t} else if (discountUnit == 'TotalOverride') {\n\t\t\t\t// Total Override uses the unprorated discount for each unit\n\t\t\t\treturn this.lineModel.lineVO.targetCustomerTotal = (price - unproratedDiscount) * this.effectiveQuantity;\n\t\t\t}\n\t\t}\n\t\tlet changeMarkupUnit = () => {\n\t\t\tlet cost = this.record[this.fieldNames.UNIT_COST_FIELD];\n\t\t\tif (discountUnit === 'Percent') {\n\t\t\t\tlet markup = this.record[this.fieldNames.MARKUP_AMOUNT_FIELD];\n\t\t\t\tif (markup == null) {\n\t\t\t\t\tmarkup = 0;\n\t\t\t\t}\n\t\t\t\tthis.record[this.fieldNames.MARKUP_AMOUNT_FIELD] = null;\n\t\t\t\treturn this.record[this.fieldNames.MARKUP_RATE_FIELD] = (cost != null) ? (markup / cost * 100) : null;\n\t\t\t} else {\n\t\t\t\tlet markup = this.record[this.fieldNames.MARKUP_RATE_FIELD];\n\t\t\t\tif (markup == null) {\n\t\t\t\t\tmarkup = 0;\n\t\t\t\t}\n\t\t\t\tthis.record[this.fieldNames.MARKUP_RATE_FIELD] = null;\n\t\t\t\treturn this.record[this.fieldNames.MARKUP_AMOUNT_FIELD] = (cost != null) ? (cost * (markup / 100)) : null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isAdditionalDiscountField){\n\t\t\tthis._displayValue = changeAdditionalDiscountUnit();\n\t\t} else {\n\t\t\tthis._displayValue = changeMarkupUnit();\n\t\t}\n\t\tthis.unit = discountUnit;\n\n\t\t// if display value is not a number, simply set it back to the previous display value\n\t\tif(isNaN(this._displayValue))\n\t\t\tthis._displayValue = !isNaN(previousDisplayValue) ? previousDisplayValue : null;\n\t}\n\n\tget record() {\n\t\treturn this.lineModel.lineVO.record;\n\t}\n\tget fieldNames() {\n\t\treturn this.lineModel.fieldNames;\n\t}\n\n}\n\n\n\t","import {Swiper} from '../sb-le-table-cell/Swiper.js';\nimport {Localizer} from '../sb-le-table-cell/Localizer.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\nimport {QuoteLineUpgradeHandler} from '../sb-le-table-cell/QuoteLineUpgradeHandler.js';\nimport {DiscountConverter} from 'quotes/layout/sb-le-table-cell/DiscountConverter.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nconst ICON_CLASS = 'sf-icon-chevrondown';\nconst TOP_LEVEL_CLASS = 'top-level';\nconst OPTION_CLASS = 'option';\nconst INDENT_CLASS = 'sbIndent';\n\nexport class LETableCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-cell';\n\n\t\tthis.properties = {\n\t\t\titem: String, /** required - field name */\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: { /** optional - data to be bound by the sb-group component */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldClass: String,\n\t\t\tdata: Object,\n\t\t\tdisplay: String,\n\t\t\tindex: Number,\n\t\t\tdetailsOnHover: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\teditable: Boolean,\n\t\t\tcalculateImmediately: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.calculateImmediately;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\n\t_onTap() {\n\t\t// this event must exist to expand rows on Android devices\n\t}\n\n\tget observers() {\n\t\treturn ['_modelIsChanged(model, index, viewport)',\n\t\t\t\t'_displayChanged(display)',\n\t\t\t\t'_dataOrValueChanged(data, value, item)',\n\t\t\t\t'_updateOriginalValue(model, item)',\n\t\t\t\t'_editableChanged(editable, model, item)']; // TODO Why include model and item here?\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'tap': '_onTap',\n\t\t\t'datepicker-opened': '_datePickerOpened',\n\t\t\t'sb-field-on-change-field': '_handleFieldValueChanged'\n\t\t};\n\t}\n\n\tattached() {\n\t\tthis.isAttached = true;\n\n\t\tif(this.wasModelIsChangedCalledBeforeAttached)\n\t\t\tthis._modelIsChanged();\n\n\t\tif (this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] && this.model.groupModel.quoteModel.isAmendment && this.item === this.constants.QUANTITY_FIELD) {\n\t\t\t// Logic for automatic upgrade source quantity ratio enforcement lives in separate class UpgradeAssetQuantityCalculator\n\t\t\tthis.quoteLineUpgradeHandler = new QuoteLineUpgradeHandler(this.model);\n\t\t\tif (this.quoteLineUpgradeHandler.getSourceLineVO() && this.quoteLineUpgradeHandler.getUpgradeLineVO()) {\n\t\t\t\tthis.addEventListener('value-changed', this._quantityChanged);\n\t\t\t\tthis.assetUpgradeQuantityCalculator = new AssetUpgradeQuantityCalculator(this.quoteLineUpgradeHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Listeners\n\t// TODO: ALL date picker logic should be encapsulated inside of date picker\n\t_datePickerOpened(e) {\n\t\tlet dateContainer = e.detail.dateContainer,\n\t\t\tdatepicker    = e.detail.datepicker,\n\t\t\tdateRow       = datepicker.offsetParent;\n\n\t\tlet dateRowRect       = dateRow.getBoundingClientRect(),\n\t\t\tdateContainerRect = dateContainer.getBoundingClientRect();\n\n\t\tdatepicker.style.left = `${-dateRowRect.left + dateContainerRect.left}px`;\n\t\tdatepicker.style.top  = `${dateContainerRect.bottom - dateRowRect.top}px`;\n\n\t\tif ((dateContainerRect.left + datepicker.offsetWidth) > window.innerWidth) {\n\t\t\tdatepicker.style.left = '';\n\t\t\tdatepicker.style.right = dateRowRect.right - dateContainerRect.right + 17 + 'px'\n\t\t}\n\n\t\t// If there isn't enough space to display the bottom of the calendar, we align it to the top\n\t\t// Do not uncomment this code until a design decision is made.\n\t\t// if ((dateContainerRect.bottom + datepicker.offsetHeight) > window.innerHeight) {\n\t\t// \tdatepicker.style.top = '';\n\t\t// \tdatepicker.style.bottom = `${dateRowRect.bottom - dateContainerRect.top}px`;\n\t\t// }\n\t\t// We shouldn't stop propagation; however, not stopping it will cause the positions to be set, again\n\t\t// TODO: Find the source of the the positions being reset if propagation isn't stopped.\n\t\te.stopPropagation();\n\t}\n\n\t// Observers\n\t_modelIsChanged() {\n\t\t// cannot call this before attached because this method may change this.value if a discount field\n\t\t// and that change gets overwritten to the bound value by standard Polymer processing if done before this component is attached\n\t\tthis.wasModelIsChangedCalledBeforeAttached = !this.isAttached;\n\t\tif(!this.isAttached || !this.model)\n\t\t\treturn;\n\n\t\tif (this.item === this.constants.SUBSCRIPTION_SCOPE_FIELD && !this.model.subscriptionScopeEditable)\n\t\t\treturn;\n\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\t// TODO: Custom segments editor should render segment labels editable without breaking primary mobile columns in segmented detail row\n\n\t\tlet editable = this._setEditable();\n\t\tif ((this.item === this.constants.ADDITIONAL_DISCOUNT_FIELD || this.item === this.constants.MARKUP_FIELD)) {\n\t\t\tthis.$.field.discountDetails = new DiscountConverter(this.model, this.item);\n\t\t\tif (!editable && !this.model.groupModel.quoteModel.isAmendment) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet fieldMD = this._setFieldMD();\n\t\tif (this._setFieldClassAndFieldContent(fieldMD))\n\t\t\treturn;\n\n\t\tif (fieldMD.defaultValue && this.value == null && !(fieldMD.controllingPicklist || fieldMD.dependentPicklist))\n\t\t\tthis.value = fieldMD.defaultValue;\n\n\t\t// Use case: Quote Subscription Term change calls updateQuote and creates new models\n\t\t// The usual JSQCNotifier isn't ran in this case so fields are never updated\n\t\tif (this.data && this.value != this.data[this.item]) {\n\t\t\tthis.value = this.data[this.item];\n\t\t}\n\n\t\tthis.$.field.editing = editable;\n\t\tthis.$.field.md = fieldMD;\n\t\tthis.$.field.property = this.item;\n\t}\n\n\tresetDiscount(e) {\n\t\t// e.detail is undefined if event originates from line editor\n\t\tif (this.$.field.discountDetails && (!e.detail.groupKey || e.detail.groupKey == this.model.groupModel.groupVO.key)) {\n\t\t\tthis.$.field.discountDetails.setDiscountValue(null);\n\t\t\tthis.value = null;\n\t\t}\n\t}\n\n\t_updateOriginalValue() {\n\t\t// Avoids data marked as dirty when front end operation (i.e. delete lines, sort lines, etc) from displaying dirty when they shouldn't be\n\t\tif (this.model.lineVO) {\n\t\t\tthis.model.lineVO._transient_ = this.model.lineVO._transient_ || {};\n\t\t\tthis.model.lineVO._transient_.original = this.model.lineVO._transient_.original || JSON.parse(JSON.stringify(this.model.lineVO.record));\n\t\t}\n\t\tlet originalRecord = this.get('model.lineVO._transient_.original');\n\t\t// Setting originalValue will trigger observer in Field.js which updates its originalFormattedValue for dirty check\n\t\t// In case this.item is additional discount field we must divide by quantity to ensure that dirty check in Field.js works correctly\n\t\tthis.$.field.originalValue = this.item !== this.constants.ADDITIONAL_DISCOUNT_FIELD ? originalRecord[this.item] : (originalRecord[this.item] / originalRecord[this.constants.QUANTITY_FIELD]);\n\t}\n\n\t_dataOrValueChanged() {\n\t\t// Make sure these match, group.js will update data first and trigger this before value has been updated\n\t\t// This will ensure the following logic is ran once with the correct information\n\t\tif (this.value != this.data[this.item])\n\t\t\treturn;\n\n\t\tthis.internal = true;\n\t\tif (this.model && this.item === this.constants.ADDITIONAL_DISCOUNT_FIELD && this.$.field.discountDetails) {\n\t\t\tthis.$.field.discountDetails = new DiscountConverter(this.model, this.item);\n\t\t} else {\n\t\t\tif (this.userChangedLookupValue) { // Update __r field on data so it persists on navigation or sort\n\t\t\t\tthis._updateRelationshipName();\n\t\t\t} else { // Update formatted display value\n\t\t\t\tthis._updateLookupDisplayValue();\n\t\t\t}\n\t\t}\n\t\tthis.$.field.value = this.value;\n\t\tthis.internal = false;\n\t\tthis.userChangedLookupValue = false;\n\t}\n\n\t_updateRelationshipName() {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\trfm.addRelationshipName(this.value, this.display, this.model.getFieldMD(this.item).referenceTo[0]);\n\t}\n\n\t_updateLookupDisplayValue() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, this.data);\n\t\tif(rfm.hasRelationship()) {\n\t\t\tthis.display = rfm.getRelationshipName();\n\t\t} else { // Re-evalulate display so rows without a lookup value don't inherit incorrect display when sorting\n\t\t\tthis.display = undefined;\n\t\t}\n\t}\n\n\t_displayChanged() {\n\t\tthis.userChangedLookupValue = !this.internal;\n\t}\n\n\t_setEditable() {\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif (this.item == this.constants.SEGMENT_LABEL_FIELD || this.index === 0 && this.isMobile) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn this.model.isEditable(this.item);\n\t\t}\n\t}\n\n\t_editableChanged() {\n\t\tthis.$.field.editing = this.model.isEditable(this.item);\n\t}\n\n\t_setFieldMD() {\n\t\t// substitute Net Total field metadata in case a segment label is passed into sb-field instead of a field label (ie. SBQQ__ProductName__c)\n\t\tlet fieldMD = this.model.getFieldMD(this.item) ? this.model.getFieldMD(this.item) : this.model.getFieldMD(this.constants.NET_TOTAL_FIELD);\n\t\tfieldMD.CurrencyIsoCode = this.model.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\t// Applying quantity scale to quantity fields in order of priority (product qs -> package settings qs -> default field qs)\n\t\tif (this.constants.QUANTITY_FIELDS && this.constants.QUANTITY_FIELDS.has(this.item)) {\n\t\t\tif (this.model.lineVO.productQuantityScale != null) {\n\t\t\t\tfieldMD = Object.assign({}, fieldMD, {scale: this.model.lineVO.productQuantityScale});\n\t\t\t}\n\t\t}\n\t\treturn fieldMD;\n\t}\n\n\t/**\n\t * Sets class and content of the field container.\n\t * @param {Object} fieldMD MD of the field to determine text-alignment\n\t * @return {Boolean} returns true if the field is overriden and should not continue to set sb-field properties\n\t */\n\t_setFieldClassAndFieldContent(fieldMD) {\n\t\tlet fieldClass = '';\n\t\tif (this.model.editorModel.data.settings.productHierarchyVisualized && !this.model.segmented) {\n\t\t\tif (!this.isMobile) {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD) {\n\t\t\t\t\tif (this.model.bundle) {\n\t\t\t\t\t\tfieldClass += `${ICON_CLASS} `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.model.component) {\n\t\t\t\t\t\t\tfieldClass += `${TOP_LEVEL_CLASS} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.model.component) {\n\t\t\t\t\t\tif (!this.model.bundle) {\n\t\t\t\t\t\t\tfieldClass += `${OPTION_CLASS} `;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfieldClass += `${INDENT_CLASS}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.item === this.constants.PRODUCT_NAME_FIELD || this.item === this.constants.NET_TOTAL_FIELD) {\n\t\t\t\t\tfieldClass += `${INDENT_CLASS}${this.record[this.constants.OPTION_LEVEL_FIELD]}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency') {\n\t\t\tfieldClass += ' right';\n\t\t}\n\n\t\tif (fieldMD.type == 'boolean') {\n\t\t\tfieldClass += ' center';\n\t\t}\n\n\t\tif (this.model.bundled && this.item === this.constants.LIST_PRICE_FIELD) {\n\t\t\tthis.overrideValue = AppContext.properties.i18n.value().l('Included');\n\t\t\tfieldClass += ' overridden';\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tlet localizedValue = Localizer.getLocalizedValue(this.model, this.item);\n\t\tif (localizedValue) {\n\t\t\tthis.overrideValue = localizedValue;\n\t\t\tfieldClass += ' overridden';\n\t\t\tthis.fieldClass = fieldClass;\n\t\t\treturn true;\n\t\t}\n\t\tthis.fieldClass = fieldClass;\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Invoked on the 'value-changed' event for automatic upgrade source quantity ratio enforcement\n\t * Fires 'upgarde-asset-quantity-changed' with index of line that needs its quantity re-rendered based upon change to target line. Listened for in LEGroup.js\n\t * @param {object} e - event object\n\t */\n\t_quantityChanged(e) {\n\t\tif (this.model.internalUpdate) {\n\t\t\treturn;\n\t\t}\n\t\tthis.assetUpgradeQuantityCalculator.setQuantitiesByRatio();\n\t\tlet indexes = this.quoteLineUpgradeHandler.getIndexes();\n\n\t\tlet sourceLineVO = this.quoteLineUpgradeHandler.getSourceLineVO();\n\t\tlet upgradeLineVO = this.quoteLineUpgradeHandler.getUpgradeLineVO();\n\n\t\t// index is the position in standardLines array that the line which needs its quantity to be updated based upon the change to the target line\n\t\tthis.fire('upgrade-asset-quantity-changed', {\n\t\t\tsourceIndex: indexes[\"sourceIndex\"],\n\t\t\tupgradeIndex: indexes[\"upgradeIndex\"],\n\t\t\tsourceLineVO: sourceLineVO,\n\t\t\tupgradeLineVO: upgradeLineVO\n\t\t});\n\t}\n\n\t_handleFieldValueChanged() {\n\t\tif (this.calculateImmediately) {\n\t\t\tthis.fire('calculate-immediately');\n\t\t}\n\t\tif (this.item == this.constants.PRICE_EDITABLE_FIELD) {\n\t\t\tthis.fire('price-editable-changed');\n\t\t}\n\t}\n\n\t_showDetails(e) {\n\t\tlet type = e.type;\n\t\tif (this.model.segmented && !(/__c$/.test(this.item)) && (this.item != 'total')) {\n\t\t\tthis.detailsOnHover = type == 'mouseenter';\n\t\t}\n\t}\n\n\t_getLineModel() {\n\t\tif ( this.item != 'total' && this.model.segmentsByLabel != null ) {\n\t\t\tlet lineModelKeys = Object.keys(this.model.segmentsByLabel);\n\t\t\tlet lineModelKeysLength = lineModelKeys.length;\n\t\t\tfor (let i = 0; i < lineModelKeysLength; i++ ) {\n\t\t\t\t// Need to take out the white space from the lineModelkeys\n\t\t\t\tlet key = lineModelKeys[i].replace(/\\W/g, '');\n\t\t\t\tif ( key == this.item ) {\n\t\t\t\t\treturn this.model.segmentsByLabel[lineModelKeys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.model;\n\t}\n\n\t_getRecord() {\n\t\treturn this._getLineModel().lineVO.record;\n\t}\n\n\t// Getters\n\tget constants() {\n\t\treturn this.model.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.model.lineVO.record;\n\t}\n\n\tset record(val) {\n\t\tthis.model.lineVO.record = val;\n\t}\n}\n\nPolymer( LETableCell );","export class Localizer {\n\n\t/**\n\t * Retrives the localized value of a field if it exists.\n\t * @return {String} - Localized value if it exists.\n\t */\n\tstatic getLocalizedValue(model, item, lookupNameField) {\n\t\tlet constants = model.editorModel.constants;\n\t\tlet productLocalization = model.groupModel.quoteModel.quoteVO.localizationByFieldByProductId[model.getField(constants.PRODUCT)];\n\t\tlet fieldMD = model.getFieldMD(item);\n\t\tif (!productLocalization || !fieldMD) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet prefix = model.editorModel.data.developerPrefix;\n\t\tlet fieldName = (fieldMD && fieldMD.calculatedFormula && fieldMD.calculatedFormula.indexOf(`${prefix}Product__r`) === 0) ? fieldMD.calculatedFormula.split('.')[1].replace(prefix, '') : fieldMD.name;\n\n\t\tlet productFieldLocalization = lookupNameField ? productLocalization[fieldName][lookupNameField] : productLocalization[fieldName];\n\t\tif (!productFieldLocalization) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn productFieldLocalization.record[constants.TEXT_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.LONG_TEXT_AREA_FIELD] ||\n\t\t\tproductFieldLocalization.record[constants.RICH_TEXT_AREA_FIELD];\n\t}\n\n}\n\n\n","export class QuoteLineUpgradeHandler {\n\n    constructor(model) {\n        this.model = model;\n        this.indexes = {};\n    }\n\n    isSourceLine() {\n        return this.model.existing;\n    }\n\n    getLine() {\n        return this.model.lineVO;\n    }\n\n    getLines() {\n        return this.model.groupModel.standardLines;\n    }\n\n    /**\n     * Takes into account bundleKeptTogether setting in case source or upgrade option is moved from one group to another\n     * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line\n     * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n     */\n    getSourceOrUpgrade(source) {\n        let sourceOrUpgradeLineVO;\n        if (this.model.editorModel.data.settings.bundleKeptTogether) {\n            sourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, this.model.groupModel);\n        } else {\n            let groups = this.model.groupModel.quoteModel.lineGroups;\n            for (let i = 0, groupCount = groups.length; i < groupCount; i++) {\n                if (sourceOrUpgradeLineVO) {\n                    break;\n                }\n                sourceOrUpgradeLineVO = this._findLineWithTargetAssetId(source, groups[i]);\n            }\n        }\n        return sourceOrUpgradeLineVO;\n    }\n\n    /**\n     * Sets the index that will be sent to LEGroup.js for the correct lineVO's quantity that should be re-rendered\n     * @param {Object} source - determines whether the line (opposite of initial target) should be the source or the upgrade line, if null should be set to source\n     * @param {groupModel} group - ensures that bundleKeptTogether setting works for source and upgrade options that will be moved from one group to another\n     * returns {lineVO} line - the lineVO which needs its quantity changed based upon the initial change to the target lineVO\n     */\n    _findLineWithTargetAssetId(source, group) {\n        let seekExistingLine = source ? false : true;\n        let lineVO; // Either the source or the target lineVO (the opposite of the one that is updated by the user)\n        let targetAssetId = this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD];\n\n        for (let i = 0, lineCount = group.standardLines.length; i < lineCount; i++) {\n            let line = group.standardLines[i];\n            if (line.lineVO.record[this.constants.UPGRADED_ASSET_FIELD] === targetAssetId && line.lineVO.record[this.constants.EXISTING_FIELD] === seekExistingLine) {\n                let key = seekExistingLine ? \"sourceIndex\" : \"upgradeIndex\";\n                this.indexes[key] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n                lineVO = line.lineVO;\n            }\n            if (this.model.lineVO.key === line.lineVO.key) {\n                let key2 = (!this.indexes[\"sourceIndex\"] && this.model.existing) ? \"sourceIndex\" : \"upgradeIndex\";\n                this.indexes[key2] = i; // Add indexes so LEGroup knows the correct indexes to set during notifyPath\n            }\n        }\n        return lineVO;\n    }\n\n    setSourceAndUpgrade(sourceLineVO, upgradeLineVO) {\n        this.sourceLineVO = sourceLineVO;\n        this.upgradeLineVO = upgradeLineVO;\n    }\n\n    getSourceIdField() {\n        return this.constants.PRODUCT;\n    }\n\n    getUpgradeConversionRateField() {\n        return this.constants.UPGRADE_CONVERSION_RATE;\n    }\n\n    getSourceCurrentQuantityField(sourceLineVO) {\n        return sourceLineVO.record[this.constants.QUANTITY_FIELD];\n    }\n\n    getUpgradeCurrentQuantityField(upgradeLineVO) {\n        return upgradeLineVO.record[this.constants.QUANTITY_FIELD];\n    }\n\n    getSourcePriorQuantity(sourceLineVO) {\n        return sourceLineVO.record[this.constants.PRIOR_QUANTITY_FIELD];\n    }\n\n    didSourceQuantityChange(didUserChangeSourceLine) {\n        return didUserChangeSourceLine;\n    }\n\n    didUpgradeQuantityChange(didUserChangeSourceLine) {\n        return !didUserChangeSourceLine;\n    }\n\n    isSelected() {\n        return true;\n    }\n\n    setUpdatedQuantity(sourceLineVO, upgradeLineVO, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n        sourceLineVO.record[this.constants.QUANTITY_FIELD] = sourceQtyAfterUpdate;\n        upgradeLineVO.record[this.constants.QUANTITY_FIELD] = upgradeQtyAfterUpdate;\n    }\n\n    getIndexes() {\n        return this.indexes;\n    }\n\n    getSourceLineVO() {\n        return this.sourceLineVO;\n    }\n\n    getUpgradeLineVO() {\n        return this.upgradeLineVO;\n    }\n\n    // Getters\n    get constants() {\n        return this.model.fieldNames;\n    }\n}\n","const SWIPE_DISTANCE = 75;\nconst OPEN_DISTANCE = -185; // Must be in sync with sb-group.less .swipe{left}\nconst SWIPE_MARGIN = 50; // Must be in sync with sb-group.less .swipe{left}\nlet swiping = false;\n\nexport class Swiper {\n\tconstructor(cell) {\n\t\tthis.cell = cell;\n\t\tthis.primaryCells = cell.parentElement.querySelectorAll('.primary');\n\t}\n\n\t/**\n\t * Mobile swipe action\n\t * @param  {object} detail - event detail\n\t */\n\tswipe(detail) {\n\t\tif (!this.leTableRow)\n\t\t\tthis.leTableRow = this.cell.domHost.domHost;\n\t\tlet open = this.cell.classList.contains('open'); /** mobile state that determines if the line item has been swiped opened to access line actions */\n\n\t\tswitch( detail.state ) {\n\t\t\tcase 'start':\n\t\t\t\tif (Math.abs(detail.dy) > SWIPE_MARGIN || ((!open && detail.dx > 0) || (open && detail.dx < 0)))\n\t\t\t\t\treturn;\n\t\t\t\tswiping = true;\n\t\t\t\tthis.leTableRow.classFollows('open', null, this.leTableRow.$$('.tr'));\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.position = 'relative';\n\t\t\t\tbreak;\n\t\t\tcase 'track':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < pcLength; i++)\n\t\t\t\t\tthis.primaryCells[i].style.left = `${(open ? OPEN_DISTANCE : 0) + detail.dx}px`;\n\t\t\t\tbreak;\n\t\t\tcase 'end':\n\t\t\t\tif (!swiping)\n\t\t\t\t\treturn;\n\t\t\t\tswiping = false;\n\t\t\t\tfor (var i = 0, pcLength = this.primaryCells.length; i < this.primaryCells.length; i++) {\n\t\t\t\t\tthis.primaryCells[i].style.left = '';\n\t\t\t\t\tthis.primaryCells[i].style.position = '';\n\t\t\t\t\tif (detail.dx < -SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', this.primaryCells[i]);\n\t\t\t\t\t\topen = true;\n\t\t\t\t\t} else if (detail.dx > SWIPE_DISTANCE) {\n\t\t\t\t\t\tthis.primaryCells[i].classFollows('open', null, this.primaryCells[i]);\n\t\t\t\t\t\topen = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (open)\n\t\t\t\t\tthis.leTableRow.classFollows('open', this.leTableRow.$$('.tr'));\n\t\t}\n\t}\n}","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class LETableHeader {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header';\n\t\tthis.properties = {\n\t\t\tlineModels: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tfieldClasses: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconstants: Object,\n\t\t\tfields: Object,\n\t\t\tsettings: Object,\n\t\t\tactionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false,\n\t\t\t\tcomputed: '_getActionsPlacement(settings)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t]\n\t}\n\n\t_getActionsPlacement() {\n\t\treturn this.settings.actionsColumnPlacement == 'Left';\n\t}\n\n\t/**\n\t * Loops through field and column names and updates group array for both standard and segmented table header row\n\t * @private\n\t */\n\t_buildRows() {\n\t\tlet group = [],\n\t\t\tfieldsRenderedAsNumber = {};\n\n\t\t// loop through standard line field names to update group and identify the fields that are rendered as number\n\t\tfor (let i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\tgroup.push(fieldName);\n\n\t\t\t// create a map of field labels to indicate the fields that are rendered as number - for styling purposes on the cell level\n\t\t\tlet fieldMD = this.fields[fieldName];\n\t\t\tif (fieldMD && (fieldMD.type == 'number' || fieldMD.type == 'double' || fieldMD.type == 'percent' || fieldMD.type == 'currency')) {\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[fieldName]] = true;\n\t\t\t} else if (fieldMD && fieldMD.type == 'boolean') {\n\t\t\t\tthis.fieldClasses[fieldMD.name] = 'center';\n\t\t\t}\n\t\t}\n\n\t\t// loop through column names (there are column names only when the quote/group has segmented lines) to update group and identify the fields that are rendered as number\n\t\tif (this.columnNames) {\n\t\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\t\tgroup.push(columnName);\n\t\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap[columnName]] = true;\n\t\t\t}\n\t\t\t// TODO: Localize this string\n\t\t\tgroup.push('total');\n\t\t\tthis.fieldClasses[this.constants.SEGMENT_LABEL_FIELD] = 'hiddenInMobile';\n\t\t\tfieldsRenderedAsNumber[this.fieldLabelsMap['total']] = true;\n\t\t}\n\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\t\tif (this.header && this.header.group.length != group.length) {\n\t\t\tthis.header.destroyGroup();\n\t\t}\n\n\t\t// model needs to be assigned before the group; otherwise the model will not be attached to the elements sb-group creates\n\t\tthis.header = this.$.header;\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.header.model = fieldsRenderedAsNumber;\n\t\tthis.header.model.isStandard = !(this.columnNames && this.columnNames.length > 0);\n\t\tthis.header.model.settings = this.settings;\n\t\tthis.header.itemClassMap = this.fieldClasses;\n\t\tthis.header.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.header.columnWidths = this.columnWidths;\n\t\tif(!this.header.group) // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\t\tthis.header.group = group;\n\t\tthis.data = this.fieldLabelsMap;\n\n\t\t// if this header is for a segmented table, set the icon class\n\t\t// column names for a standard products table is null\n\t\tif (this.columnNames) {\n\t\t\tthis.expansionIconClass = 'sf-icon-right';\n\t\t}\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.header || this.viewport && this.viewport.isMobile()) return;\n\t\tthis.header.columnWidths = this.columnWidths;\n\t}\n\n\t/**\n\t * Expands all lines in the table to display segment details (uses the Segmented Line Field Set)\n\t */\n\ttoggleAllLinesExpansion() {\n\t\tlet expanded = this.expansionIconClass != 'sf-icon-right';\n\t\tthis.expansionIconClass = !expanded ? 'sf-icon-down' : 'sf-icon-right';\n\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\tthis.set('lineModels.' + i + '.lineVO.expanded', !expanded);\n\t\t\tthis.set('lineModels.' + i + '.expandedIconClass', this.expansionIconClass);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of each line in this table in order to toggle the \"checked\" state of each line item\n\t */\n\ttoggleAllCheckBoxes() {\n\t\tfor (let i = 0, l = this.lineModels.length; i < l; i++) {\n\t\t\tthis.set('lineModels.' + i + '.selected', this.selected);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the \"selected\" property of the multi delete checkbox to false after action that causes updateQuote to run in LineEditor.js\n\t */\n\tdeselectCheckbox() {\n\t\tthis.set('selected', false);\n\t}\n}\n\nPolymer( LETableHeader );","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\nexport class LETableHeaderCell {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-header-cell';\n\t\tthis.properties = {\n\t\t\tbyOrder: String,\n\t\t\tmodel: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_modelChanged'\n\t\t\t},\n\t\t\tshowSortableHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_showSortableHeader(model)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() {\n\t\t\t\t\tthis.constants = new Constants(AppContext.org.prefix + '__');\n\t\t\t\t\treturn AppContext.org.prefix;\n\t\t\t\t}\n\t\t\t},\n\t\t\toverflowTrue: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\t_modelChanged() {\n\t\tPolymer.dom(this.$.headerCell).observeNodes(function() {\n\t\t\tlet headerNode = this.$$('#header');\n\t\t\tthis.toggleClass('right', this.model[this.value], headerNode);\n\t\t\tlet bundlesVisualized = (this.model.settings && this.model.settings.productHierarchyVisualized && this.model.isStandard && this.getAttribute('item') === this.constants.PRODUCT_NAME_FIELD);\n\t\t\tthis.toggleClass('bundlesVisualized', bundlesVisualized, headerNode);\n\t\t}.bind(this));\n\t}\n\n\tsortLines(e) {\n\t\tlet newSort = \"\";\n\n\t\tlet headers = this.parentElement.children;\n\n\t\tfor(let i = 0; i < headers.length; i++) {\n\t\t\theaders[i].toggleClass('asc', false, headers[i].$$('#header'));\n\t\t\theaders[i].toggleClass('desc', false, headers[i].$$('#header'));\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowup', true, headers[i].$$('#arrow')) : null;\n\t\t\theaders[i].$$('#arrow') ? headers[i].toggleClass('sf-icon-arrowdown', false, headers[i].$$('#arrow')) : null;\n\t\t\tPolymer.dom(headers[i]).classList.remove('column-selected');\n\t\t}\n\n\t\tif (!this.byOrder){\n\t\t\tnewSort = 'asc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'asc'){\n\t\t\tnewSort = 'desc';\n\t\t\tthis.toggleClass('sf-icon-arrowup', false, this.$$('#arrow'));\n\t\t\tthis.toggleClass('sf-icon-arrowdown', true, this.$$('#arrow'));\n\t\t} else if (this.byOrder === 'desc') {\n\t\t\tnewSort = '';\n\t\t}\n\n\t\tthis.sortByField = newSort ? this._getKeyByValue(this.value, this.data) : null;\n\t\tthis.toggleClass('column-selected', newSort);\n\t\tthis.byOrder = newSort;\n\t\tif (newSort){\n\t\t\tthis.toggleClass(newSort, true, this.$$('#header'));\n\t\t}\n\t\tthis.fire('table-header-sort-clicked', {order: this.byOrder, field: this.sortByField});\n\t}\n\n\t_showSortableHeader() {\n\t\t//Make sure segmented line detail and 'Additional Disc.' field headers are not sortable.\n\t\tif (this.model.lineVO || this.getAttribute('item') === this.constants.ADDITIONAL_DISCOUNT_FIELD || this.classList.contains('hoverFieldHeader')) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t_getKeyByValue(value, object) {\n\t\tfor(let prop in object ) {\n\t\t\tif( object.hasOwnProperty( prop ) ) {\n\t\t\t\tif( object[ prop ] === value )\n\t\t\t\t\treturn prop;\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer( LETableHeaderCell );","import {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from '../../../common/core/AppContext.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class LETableRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-table-row';\n\n\t\tthis.listeners = {\n\t\t\t'row-swiped': 'onRowSwiped',\n\t\t\t'price-editable-changed' : 'handleListPriceEditability'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tdata: Object,\n\t\t\tfieldNames: Array,\n\t\t\tfieldLabelsMap: Object,\n\t\t\tcolumnNames: Array,\n\t\t\tcolumnWidths: Object,\n\t\t\tmobileCols: Array,\n\t\t\tlineNumber: Number,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t},\n\t\t\tisDesktopAndHasNoActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisDesktopAndHasActionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmdqFields: {\n\t\t\t\ttype: Set,\n\t\t\t\tvalue: new Set()\n\t\t\t},\n\t\t\texpandDisabled: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshowCheckbox: Boolean\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(fieldNames, columnNames, lineModel, columnWidths, viewport)',\n\t\t\t'_lineRecordChanged(lineModel.*)',\n\t\t\t'_columnWidthsChanged(columnWidths)',\n\t\t\t'_expanded(expanded)',\n\t\t\t'_toggleSelection(lineModel, expandDisabled)'];\n\t}\n\n\tonRowSwiped(e) {\n\t\tthis.expandDisabled = e.detail.isOpen;\n\t}\n\n\t/**\n\t * Loops through field sets and segments and updates data map and group array for both standard and segmented table row\n\t * @private\n\t */\n\t_buildRow() {\n\n\t\t// data and group objects are consumed by <sb-group> component in forming the group of cells in the table\n\t\tlet data = {},\n\t\t\tgroup = [],\n\t\t\titemClassMap = {};\n\n\t\tif (!this.columnNames) {\n\t\t\t// standard lines\n\t\t\tdata = this.lineModel.lineVO.record;\n\t\t\tgroup = this.fieldNames;\n\t\t\tfor (var l = 0, len = group.length; l < len; l++) {\n\t\t\t\tlet fieldName = this.fieldNames[l];\n\t\t\t\tif (!this.lineModel.isFieldRendered(fieldName, this.isMobile)) {\n\t\t\t\t\titemClassMap[fieldName] = this.isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t\t}\n   \t\t\t}\n\t\t} else {\n\t\t\t// segmented lines\n\t\t\t// update data and group for the field names in the summary quote line field set\n\t\t\tfor (var i = 0, len = this.fieldNames.length; i < len; i++) {\n\t\t\t\tlet fieldName = this.fieldNames[i];\n\t\t\t\tdata[fieldName] = this.record[fieldName];\n\t\t\t\tif (!this.lineModel.isFieldRendered(fieldName, this.isMobile)) {\n\t\t\t\t\titemClassMap[fieldName] = this.isMobile ? 'hiddenInMobile' : 'hiddenInDesktop';\n\t\t\t\t}\n\t\t\t\tgroup.push(fieldName);\n\t\t\t}\n\n\t\t\t// create a map to store net totals by columns and populate the columnLabels array\n\t\t\tlet totalsByColumns = {};\n\t\t\tfor (var j = 0, len = this.lineModel.segments.length; j < len; j++) {\n\t\t\t\tlet segment = this.lineModel.segments[j],\n\t\t\t\t\tlabel = segment.lineVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\\W/g, '');\n\t\t\t\ttotalsByColumns[label] = segment.lineVO.record[this.constants.NET_TOTAL_FIELD];\n\t\t\t}\n\n\t\t\t// update data and group for the columns (one-time and time-based segments)\n\t\t\tif (!this.isMobile) {\n\t\t\t\tfor (var k = 0, len = this.columnNames.length; k < len; k++) {\n\t\t\t\t\tlet label = this.columnNames[k].replace(/\\W/g, '');\n\t\t\t\t\t// if a line item does not have a column, pass in null and that is displayed as a blank cell\n\t\t\t\t\tdata[label] = (totalsByColumns[label] >= 0) ? totalsByColumns[label] : null;\n\t\t\t\t\tgroup.push(label);\n\t\t\t\t\tthis.mdqFields.add(label);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO: Update for localization\n\t\t\tdata['total'] = this.quoteVO.multiSegmentRowTotals[this.record[this.constants.SEGMENT_KEY_FIELD]];\n\t\t\tgroup.push('total');\n\t\t\tthis.mdqFields.add('total');\n\t\t\titemClassMap['total'] = 'hiddenInMobile';\n\t\t}\n\t\t// Set lineNumber on initial render\n\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\n\t\t// Flags to display invalid pricebook/opportunity messages\n\t\t// If the opportunity line item does not exist and the quote is a primary quote, then we need the tooltip warning, check for == false in case of null or undefined\n\t\tthis.invalidPricebookEntry = this.lineModel.lineVO.validPricebookEntryExists == false;\n\t\tthis.opportunityWarning = this.lineModel.groupModel.quoteModel.isPrimary && this.lineModel.lineVO.opportunityLineItemExists == false && this.invalidPricebookEntry;\n\t\t// If there is not a valid pricebook entry for the line item and the opportunity warning is not already displayed,\n\t\t// display the invalid pricebook entry warning\n\t\tthis.invalidEntryWarning = this.invalidPricebookEntry && !this.opportunityWarning;\n\n\t\tthis.isDesktopAndHasActionsOnTheLeft   = !this.isMobile && this.lineModel.editorModel.actionsOnTheLeft;\n\t\tthis.isDesktopAndHasNoActionsOnTheLeft = !this.isMobile && !this.lineModel.editorModel.actionsOnTheLeft;\n\n\t\t// Make sure the \"open\" class isn't there when the row is built.\n\t\tif (this.$$('.tr').classList.contains('open'))\n\t\t\tthis.classFollows('open', null, this.$$('.tr'));\n\n\t\t// ensure not undefined so paper-checkbox gets a false value\n\t\t// paper-checkbox should always get a false value for selected when row is built, should only be true before an action takes place, once action completed should always be unselected\n\t\t// prevents watermark in the checkbox and blue background for checkbox if a previous line was selected prior to any action\n\t\tthis.set('lineModel.selected', false);\n\n\t\tthis.row = this.$$('#row');\n\t\t// ensure the group is destroyed and rebuilt with up-to-date information only when columns of the table is changed\n\t\t// ie. when you ungroup a quote with PoT, the PoT column should not be displayed.\n\t\tif (this.row && this.row.group.length != group.length) {\n\t\t\tthis.row.destroyGroup();\n\t\t}\n\n\t\t// Necessary for swipe container to apply correct classes in mobile but should be removed in future\n\t\tif (this.isMobile) {\n\t\t\tPolymer.dom.flush();\n\t\t}\n\n\t\tthis.data = undefined; // ensures sb-group buildGroup observer method is only invoked after this.data is set below\n\t\tthis.groupClass = (this.viewport && this.viewport.isMobile()) ? 'tgroup' : 'leGroup';\n\t\tthis.itemClassMap = itemClassMap;\n\t\tthis.widths = this.columnWidths;\n\t\tthis.model = this.lineModel;\n\t\t// TODO this is a temp fix for major release to avoid possible regression. The real fix should be relying on data as our lineVO object and not using model to reference actual data changing\n\t\tif(this.row && this.row.template) // since our model is actually a data wrapper, we need to ensure its assigned to template before data\n\t\t\tthis.row.template.model = this.lineModel;\n\t\tthis.primaryItems = this.mobileCols || [];\n\t\tthis.groupDisplay = this.fieldLabelsMap;\n\t\tif (!this.row || !this.row.group)\n\t\t\tthis.group = group;  // if group is already set on row, no need to set it again as changing a group dynamically is no longer supported on sb-group\n\t\tthis.data = data;\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tif (this.isMobile && this.row && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\t// If expanded is not already set, set the lineVO so that the MDQ drawers are closed when navigating from somewhere else\n\t\t\tif (this.expanded == null) {\n\t\t\t\tthis.lineModel.lineVO.expanded = false;\n\t\t\t} else {\n\t\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\t\tevt.initEvent('tap', true, false);\n\t\t\t\tlet cell = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (!this.isMobile) {\n\t\t\tthis.listen(this, 'track', 'onTrack')\n\t\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'row', 'sb-le-table-cell', 'root');\n\t\t\tthis.signaler.signalOnFocus('sb-row-focus-signal');\n\t\t}\n\t}\n\n\t_columnWidthsChanged() {\n\t\tif (!this.row || this.lineModel.editorModel.deviceContext.isMobile) return;\n\t\tthis.widths = this.columnWidths;\n\t}\n\n\n\t//Redirect to segmented lines or standard lines component\n\tonTrack(e) {\n\t\tif ((this.viewport && this.viewport.isMobile()) || !AppContext.isDesktop) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let a = 0, l = Polymer.dom(e).path.length; a < l; a ++){\n\t\t\tif (Polymer.dom(e).path[a].nodeName === 'SB-DIALOG') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.domHost.onTrack(e);\n\t}\n\n\t// Getters\n\tget quoteVO() {\n\t\treturn this.lineModel.editorModel.quoteModel.quoteVO;\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\tget record() {\n\t\treturn this.lineModel.lineVO.record;\n\t}\n\n\t// Helper methods\n\t\n\t_lineRecordChanged(e) {\n\t\tif(e.path === 'lineModel.lineVO.fieldVisibility')\n\t\t\tthis._visibilityChanged();\n\t\telse if(e.path === 'lineModel.lineVO.fieldEditability')\n\t\t\tthis._editabilityChanged();\n\t\telse {\n\t\t\tlet path = e.path.split('.')[e.path.split('.').length - 1];\n\t\t\tif (!e.path.endsWith('__c') && !e.path.endsWith('__r') && !this.mdqFields.has(path)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (path == this.constants.PRICE_EDITABLE_FIELD) {\n\t\t\t\tthis.handleListPriceEditability();\n\t\t\t}\n\t\t\tthis.lineNumber = this.record[this.constants.NUMBER_FIELD];\n\t\t\tthis.set(`data.${path}`, e.value);\n\t\t}\n\t}\n\n\t_visibilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tfor(let field in this.lineModel.lineVO.fieldVisibility) {\n\t\t\tlet visible = this.lineModel.isFieldRendered(field, this.viewport.isMobile());\n\t\t\tlet classes = [ { class: 'hiddenInMobile', value: !visible}, { class: 'hiddenInDesktop', value: !visible} ];\n\t\t\tthis.row.set('itemClassMap.' + field, classes );\n\t\t}\n\t}\n\n\t_editabilityChanged() {\n\t\tthis.row = this.row || this.$$('#row');\n\t\tthis.row.itemEditableMap = this.lineModel.lineVO.fieldEditability;\n\t}\n\n\texpand(e) {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$$('#row').fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\t_expanded() {\n\t\tif(!this.viewport || !this.viewport.isMobile() || this.expandDisabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableEditableFields();\n\t\tthis.toggleLineExpansion();\n\t}\n\n\t/**\n\t * Expands line to display segment details (uses the Segmented Line Field Set)\n\t */\n\ttoggleLineExpansion() {\n\t\t// Only change this value if expanded on component does not match so it doesn't override it during a server call\n\t\tif (this.lineModel.lineVO.expanded != this.expanded) {\n\t\t\tthis.set('lineModel.lineVO.expanded', !this.lineModel.lineVO.expanded);\n\t\t}\n\t\tthis.set('lineModel.expandedIconClass', !this.lineModel.lineVO.expanded ? 'sf-icon-right' : 'sf-icon-down');\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$$('#row').root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\thandleListPriceEditability() {\n\t\t// If fieldEditability is defined, it means that the page security plugin has already determined field editability, so don't override it\n\t\tif (!this.lineModel.lineVO.fieldEditability) {\n\t\t\tthis.row = this.row || this.$$('#row');\n\t\t\tlet editableMap = {};\n\t\t\teditableMap[this.constants.LIST_PRICE_FIELD] = this.lineModel.isEditable(this.constants.LIST_PRICE_FIELD);\n\t\t\tthis.row.itemEditableMap = editableMap;\n\t\t}\n\t}\n\n\ttoggleOptional(e) {\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.lineModel.groupModel.groupVO.key) {\n\t\t\tthis.set(`data.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_toggleSelection(e) {\n\t\tlet multiLineDeleteEnabled = this.lineModel ? this.lineModel.editorModel.data.settings.multiLineDeleteEnabled : true;\n\t\tlet mobileDrawerOpened = this.isMobile && e.detail && e.detail.drawerState === 'open';\n\t\tthis.showCheckbox = multiLineDeleteEnabled && !this.expandDisabled && !mobileDrawerOpened;\n\t}\n}\n\nPolymer( LETableRow );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from '../../../common/core/sb-page-container/PageContainer.js';\nimport {RowFocusSignaler} from 'common/signal/RowFocusSignaler.js';\n\nexport class SegmentedDetailRow {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-detail-row';\n\t\tthis.properties = {\n\t\t\tlineModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\thighlightRowOnFocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tobserver: '_highlightRowOnFocus'\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_lineRecordChanged(lineModel.segments.*)',\n\t\t\t\t'_lineModelChanged(lineModel)',\n\t\t\t\t'_setGroup(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap)'\n\t\t];\n\t}\n\n\tget constants() {\n\t\treturn this.lineModel.editorModel.constants;\n\t}\n\n\t_lineModelChanged() {\n\t\tthis.dimension = this.lineModel.lineVO.dimensionType;\n\t\tthis.segmentModel = this.lineModel.segmentsByLabel[this.columnName] ? this.lineModel.segmentsByLabel[this.columnName] : new LineModel({key: null, record: {}}, this.lineModel.groupModel);\n\t\tthis.itemClassMap[this.constants.SEGMENT_LABEL_FIELD] = 'hiddenInDesktop';\n\n\t\t// Ensures that the expanded property matches the lineVO's expanded property\n\t\t// Simulates a tap event so group.js can pick up on the change\n\t\tlet column = this.$$('#column');\n\t\tif (this.viewport && this.viewport.isMobile() && column && ((this.lineModel.lineVO.expanded || false) != (this.expanded || false))) {\n\t\t\tlet evt = document.createEvent(\"HTMLEvents\");\n\t\t\tevt.initEvent('tap', true, false);\n\t\t\tlet cell = Polymer.dom(column.root).querySelectorAll('sb-le-table-cell')[0];\n\t\t\tif (cell) {\n\t\t\t\tcell.dispatchEvent(evt);\n\t\t\t}\n\t\t}\n\t}\n\n\t_setGroup() {\n\t\tif(!this.$.column.group)\n\t\t\tthis.$.column.group = this.detailFieldNames;\n\t}\n\n\tready() {\n\t\tthis.expanded = false;\n\t}\n\n\t/**\n\t * Propagates value changes on each segment separately so sb-group can update the UI correctly\n\t * @param e\n\t * @private\n\t */\n\t_lineRecordChanged(e) {\n\t\t//if internal is set, we know this event was fired from the code itself and we should return early\n\t\tif (this.internal)\n\t\t\treturn;\n\t\t// Isolate the segment number from the path to notify the correct segment child\n\t\tvar firstIndex = e.path.indexOf('#');\n\t\tvar lastIndex = e.path.indexOf('.',firstIndex);\n\t\tvar segmentNumber = e.path.substring(firstIndex + 1, lastIndex);\n\t\tif (!this._pathRefersToMySegmentRecord(segmentNumber)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.set(`segmentRecord.${e.path.split('.')[e.path.split('.').length -1]}`, e.value);\n\t}\n\n\t_pathRefersToMySegmentRecord(segmentNumber) {\n\t\tif (!this.segmentRecord) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.lineModel.segments[segmentNumber]) {\n\t\t\treturn false;\n\t\t}\n\t\tvar referencedSegmentVO = this.lineModel.segments[segmentNumber].lineVO;\n\t\tvar referencedKey = referencedSegmentVO.record[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar referencedIndex = referencedSegmentVO.record[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar referencedLabel = referencedSegmentVO.record[this.constants.SEGMENT_LABEL_FIELD];\n\t\tvar mySegmentKey = this.segmentRecord[this.constants.SEGMENT_KEY_FIELD];\n\t\tvar mySegmentIndex = this.segmentRecord[this.constants.SEGMENT_INDEX_FIELD];\n\t\tvar mySegmentLabel = this.segmentRecord[this.constants.SEGMENT_LABEL_FIELD];\n\t\treturn (referencedKey === mySegmentKey) && (referencedIndex === mySegmentIndex) && (referencedLabel === mySegmentLabel);\n\t}\n\n\texpand(e) {\n\t\tif(this.viewport && this.viewport.isMobile()) this.enableEditableFields();\n\t\tthis.$.column.fire('group-expanded', {path: Polymer.dom(e).path});\n\t}\n\n\tenableEditableFields() {\n\t\tlet cells = Polymer.dom(this.$.column.root).querySelectorAll('sb-le-table-cell');\n\t\tfor(var cell of cells)\n\t\t\tcell.$$('sb-field').renderReadOnly = false;\n\t}\n\n\ttoggleOptional(e) {\n\t\t// e.detail.groupKey is undefined if event originates from line editor\n\t\tif (!e.detail.groupKey || e.detail.groupKey == this.lineModel.groupModel.groupVO.key) {\n\t\t\tthis.set(`segmentRecord.${this.constants.OPTIONAL_FIELD}`, e.detail.toggleOptionalBoolean);\n\t\t}\n\t}\n\n\t_highlightRowOnFocus() {\n\t\tthis.signaler = this.signaler || new RowFocusSignaler(this, 'column', 'sb-le-table-cell');\n\t\tthis.signaler.signalOnFocus('sb-row-focus-signal', !this.highlightRowOnFocus);\n\t}\n}\n\nPolymer( SegmentedDetailRow );","import {AppContext} from 'common/core/AppContext.js';\nimport {Constants} from 'quotes/models/Constants.js';\n\nexport class LEFieldMD {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-field-md';\n\t\tthis.properties = {\n\t\t\tdata: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['getFieldNames(data, prefix)'];\n\t}\n\n\tready() {\n\t\tthis.$.describe.addEventListener('describe-changed', function(e) {\n\t\t\tlet md = e.detail.value.md,\n\t\t\t\tfieldsMap = {},// map of fields {objectName: {fieldNames: field}}\n\t\t\t\tfieldLabelsMap = {}; // map of fieldLabels {fieldName: fieldLabel} for easy access for the <sb-group> component\n\n\t\t\tif (!this.constants)\n\t\t\t\tthis.constants = new Constants(this.prefix);\n\n\t\t\tlet unitPriceFields = this.constants.UNIT_PRICE_FIELDS;\n\t\t\tlet quantityFields = this.constants.QUANTITY_FIELDS;\n\t\t\tfor (let item in md) {\n\t\t\t\tlet parts = item.split(\".\"),\n\t\t\t\t\tobjName = parts[0],\n\t\t\t\t\tfieldName = parts[1];\n\n\t\t\t\tif (!fieldsMap[objName]) {\n\t\t\t\t\tfieldsMap[objName] = {};\n\t\t\t\t}\n\t\t\t\t// Unit Price Fields always follow the package level unit price scale\n\t\t\t\t// Otherwise, if the field is type currency and the org is multi-currency, the scale will use currencyDecimalScale (defined by CurrencyType table)\n\t\t\t\tif (unitPriceFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.priceScale;\n\t\t\t\t} else if (md[item].type == 'currency' && this.settings.isMultiCurrencyOrg) {\n\t\t\t\t\tmd[item].scale = this.settings.currencyDecimalScale;\n\t\t\t\t} else if (quantityFields.has(md[item].name)) {\n\t\t\t\t\tmd[item].scale = this.settings.quantityScale || this.settings.quantityScale === 0 ? this.settings.quantityScale : md[item].scale;\n\t\t\t\t}\n\n\t\t\t\tfieldsMap[objName][fieldName] = md[item];\n\t\t\t\tfieldLabelsMap[fieldName] = md[item].label;\n\t\t\t}\n\n\t\t\tthis.md = {fieldsMap : fieldsMap, fieldLabelsMap: fieldLabelsMap};\n\t\t}.bind(this));\n\n\t\tthis.$.describe.addEventListener('error-changed', function(e) {\n\t\t\tthis.error = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\tgetFieldNames() {\n\t\t// Create an array of objectName.fieldName for retrieving field metadata\n\t\tlet fieldNames = [];\n\t\tfor (let obj in this.data) {\n\t\t\t// prefix object names only - field names are returned prefixed from the server\n\t\t\tfor (var i = 0, l = this.data[obj].length; i < l; i++) {\n\t\t\t\tlet fieldName = this.data[obj][i];\n\t\t\t\tfieldNames.push(obj + '.' + fieldName);\n\t\t\t}\n\t\t}\n\n\t\t// describe call is initiated when fields are bound here - they are not passed in through the html\n\t\tthis.$.describe.fields = fieldNames;\n\t}\n\n}\n\nPolymer( LEFieldMD );","import {LineModel} from 'quotes/models/LineModel.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class SegmentedLineDetails {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-line-details';\n\t\tthis.properties = {\n\t\t\tlineModel: { /** required - lineModel that is being rendered */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tgroupModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfieldNames: Array, /** required - names of the fields in the summary field set*/\n\t\t\tdetailFieldNames: Array, /** required - names of the fields in the segmented line field set*/\n\t\t\tfieldLabelsMap: Object, /** required - map of field names to labels*/\n\t\t\tcolumnNames: Array, /** required - names of the segment columns in the group*/\n\t\t\tactionsOnTheLeft: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false,\n\t\t\t\tcomputed: '_getActionsPlacement(lineModel)'\n\t\t\t},\n\t\t\titemClassMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRow(detailFieldNames, fieldNames, lineModel, columnWidths)',\n\t\t\t'_columnWidthsChanged(columnWidths)'\n\t\t];\n\t}\n\n\t_buildRow() {\n\t\tthis._setColumnWidths();\n\t\tthis.multiDeleteEnabled = this.lineModel.groupModel.quoteModel.editorModel.data.settings.multiLineDeleteEnabled;\n\t\t// TODO: How to show segment label if it is in the line editor segmented field set (we're manually rendering it for mobile)\n\t\tthis.itemClassMap[this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD] = 'hiddenInDesktop';\n\t\tthis.$.header.itemClassMap = this.itemClassMap;\n\t\t// need to assign sb-group component's group attribute from here otherwise the itemClassMap will not be taken into account\n\t\t// because itemClassMap is optional for sb-group\n\t\tthis.detailFieldNamesWithLabel = [this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD].concat(this.detailFieldNames);\n\t\tif(!this.$.header.group)\n\t\t\tthis.$.header.group = this.detailFieldNamesWithLabel;\n\t}\n\n\t/**\n\t * Sets column widths within segmented line drawers. Runs at every window resize\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tif (this.viewport && this.viewport.isMobile()) return;\n\t\tlet colWidths = this.columnWidths;\n\t\tif (!colWidths || !this.columnNames) {\n\t\t\treturn;\n\t\t}\n\t\t// get the width of the label column which should align with the last summary line field\n\t\tlet labelColWidth = 0;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += colWidths[field];\n\t\t}\n\t\tthis.fieldNamesColWidth = labelColWidth + 'px';\n\n\t\t// set width of each segment\n\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\tthis.colWidth = colWidths[columnName] + 'px';\n\t\t}\n\t\t// set width of the total column\n\t\tthis.totalColWidth = colWidths['total'] + 'px';\n\t}\n\n\t/**\n\t * Updates column widths based on window resizing or group side panel toggling\n\t * @private\n\t */\n\t_columnWidthsChanged() {\n\t\tthis._setColumnWidths();\n\t}\n\n\t// Helper methods\n\n\t_getActionsPlacement() {\n\t\treturn this.lineModel.editorModel.data.settings.actionsColumnPlacement == 'Left';\n\t}\n\n\t/**\n\t * Returns the lineVO.record of the segment. If the line does not have that segment, it returns an empty lineVO.record for rendering purposes.\n\t * @param label\n\t * @returns {lineVO.record}\n\t */\n\tgetSegmentRecord(label) {\n\t\treturn this.lineModel.segmentsByLabel[label] ? this.lineModel.segmentsByLabel[label].lineVO.record : new LineModel({key: null, record: {}}, this.lineModel.groupModel).lineVO.record;\n\t}\n\n\tsegmentExists(columnName) {\n\t\treturn !this.lineModel.segmentsByLabel[columnName] ? 'desktopOnly' : '';\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile()\n\t}\n}\n\nPolymer( SegmentedLineDetails );","import {Page} from '../../../common/core/Page.js';\nimport {EditorModel} from '../../models/EditorModel.js';\nimport {GroupModel} from 'quotes/models/GroupModel.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {removeTopBottomBorderClass} from 'quotes/models/DragDropModel.js';\nimport {JSQCPrecacheWorkerManager} from 'quotes/precaching/JSQCPrecacheWorkerManager.js';\nimport {OAuthClient} from 'common/data/client/OAuthClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nconst GHOST_X_OFFSET = 53;\nconst GHOST_Y_OFFSET = 77;\n/**\n *  <sb-line-editor>\n *\n *  Features:\n *\n **/\nexport class LineEditor extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-line-editor';\n\t\tthis.properties = Polymer.Base.extend( {\n\t\t\t/** raw data - coming from the server */\n\t\t\trawData: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_init'  //creates the fieldNamesByObjectNames map to retrieve metadata in one combined query\n\t\t\t},\n\t\t\t/** data - initialized and sanitized */\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_dataIsChanged'  //creates the fieldNamesByObjectNames map to retrieve metadata in one combined query\n\t\t\t},\n\t\t\t/** md - metadata requested from the metadata */\n\t\t\tmd: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** editorModel - created by the EditorModel from the data */\n\t\t\teditorModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\t/** groupModels - created by the groupModels from the data */\n\t\t\tgroupModels: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tquoteLevelTabs : {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tpageLoaded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, Page.properties );\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'le-action-tapped': '_executeCustomAction',\n\t\t\t'cseMobile-tapped': '_handleMobileCSE',         // Need to have special handler for mobile because of the tab is different\n\t\t\t'cse-tapped': '_handleCSE',\n\t\t\t'segmented-changed': '_handleCSEResponse',\n\t\t\t'change-ghost' : '_handleGhostChanges',\n\t\t\t'renumber-lines' : 'renumber',\n\t\t\t'validate-quantity-changed': '_displayUpgradeQuantityToast',\n\t\t\t'field-change-validated': '_updateFieldValidations',\n\t\t\t'calculate-immediately': '_calculateImmediately'\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['_createEditorModel(data, md)',\n\t\t\t\t'_errorEventHandled(error)',\n\t\t\t\t'_loadObjectMD(app.org)'];\n\t}\n\n\t_loadObjectMD() {\n\t\tlet prefix = this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t\tthis.mdObjects = [prefix + 'QuoteLineGroup__c', prefix + 'QuoteLine__c', prefix + 'Quote__c', prefix + 'DiscountTier__c', prefix + 'DiscountSchedule__c'];\n\t}\n\n\t_executeCustomAction(e) {\n\t\tlet customActionName = e.detail.customAction.eventHandlerName,\n\t\t\thasPermission = true;\n\n\t\tswitch (customActionName) {\n\t\t\tcase 'onAddProducts':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onSave':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onQuickSave':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t\tcase 'onFlagCalculate':\n\t\t\t\thasPermission = AppContext.user.hasQuoteEditPermission;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (hasPermission === false) {\n\t\t\tthis.errors = [this.i18n.l(\"Insufficient privileges to perform that action\")];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.eventDetail = e.detail;\n\t}\n\n\tattached() {\n\t\tdocument.addEventListener('LineEditor-cached', function() {\n\t\t\tthis.needsInit = true;\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Creates EditorModel (which contains the QuoteModel, GroupModels, and LineModels) from the server object,\n\t * Attaches Metadata that is queried separately onto the EditorModel\n\t * @param: data     - raw data from the server\n\t * @param: md       - metadata which will pull information from server to the client\n\t * @private\n\t */\n\t_createEditorModel() {\n\t\tif (this.ctx.params && this.ctx.params.cmd == 'onFlagCalculate') {\n\t\t\t// Special nastiness for running calculate command.\n\t\t\tthis.data.quote.calculationRequired = true;\n\t\t\tthis.ctx.params.cmd = null;\n\t\t}\n\t\tif (this.data.quote.calculationRequired) {\n\t\t\tthis.$.customActionServices.onFlagCalculate(this.pageLoaded);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editorModel = new EditorModel(this.data, this.md, this); // Ideally would only pass in 'this' but do not want to destabilize the app before the release\n\t\t// Attach metadata to the editorModel and add the segmented column labels\n\t\tthis._updateFieldLabelsMap();\n\n\t\tthis._handleGroupCustomActions(); // Ideally would be handled in the editorModel.\n\n\t\tthis.groupModels = this._getGroupModels();\n\t\tthis.rightSideButton = !this.editorModel.deviceContext.isMobile && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\t\tthis.quoteId = this.editorModel.quoteModel.quoteVO.record.Id;\n\n\t\tthis.hasQuoteFieldSet = (this.editorModel.fieldsetMap.quoteFieldNames.length > 0);\n\n\t\t// Assuming this.viewport is only not present during testing, in that case assume desktop\n\t\tthis._viewportChanged(this.editorModel.deviceContext.isMobile);\n\n\t\tthis.renumber();\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.ctx.params && this.ctx.params.cmd != null) {\n\t\t\tthis._executeCmd(this.ctx.params.cmd);\n\t\t\tthis.ctx.params.cmd = null;\n\t\t}\n\t\telse if (!this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]) {\n\t\t// Should be the last part of _createEditorModel\n\t\t\tthis._handleMissingPricebook();\n\t\t} else {\n\t\t\t// Run default custom actions if there are any\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}\n\t\tthis.pageLoaded = true;\n\t}\n\n\t_handleGroupCustomActions(notify) {\n\t\tif(!this.editorModel)\n\t\t\treturn;\n\n\t\tlet isExpanded = this.viewport && this.viewport.isDesktop() && this.viewport.M.up;\n\t\tthis.editorModel.groupCustomActions = !isExpanded ? [this.editorModel.groupMobileMenuButtonAction] : this.editorModel.customActionsByLocation.Group;\n\n\t\tif(!notify && !isExpanded) {\n\t\t\t// this ensures that in desktop when the viewport causes the group buttons to expand, that the first button have a label and correct borders\n\t\t\tthis.editorModel.groupCustomActions[0].label = this.editorModel.customActionsByLocation.Group[0].label;\n\t\t\tthis.editorModel.groupCustomActions[0].first = this.editorModel.customActionsByLocation.Group[0].first;\n\t\t\tthis.editorModel.groupCustomActions[0].eventHandlerName = this.editorModel.customActionsByLocation.Group[0].eventHandlerName;\n\t\t\tthis.editorModel.groupCustomActions[0].record = this.editorModel.customActionsByLocation.Group[0].record;\n\t\t}\n\n\t\tif(!notify || !this.groupModels)\n\t\t\treturn;\n\n\t\tfor(let i = 0, l = this.groupModels.length; i < l; i++)\n\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.groupCustomActions`);\n\t}\n\n\t_handleMissingPricebook() {\n\t\tthis.addEventListener('pricebook-saved', function(e) {\n\t\t\tthis.updateQuote(e.detail);\n\t\t\tthis._executeDefaultCustomAction();\n\t\t}.bind(this));\n\n\t\tlet retUrl = window.location.href;\n\t\tif (retUrl.indexOf('cp=1') > -1) {\n\t\t\tdocument.location.assign(this.editorModel.communityPrefix + '/' + this.editorModel.quoteModel.quoteVO.record.Id);\n\t\t\treturn;\n\t\t}\n\t\tlet userType = this.data.userType;\n\t\t// Only Standard and PowerPartner users can edit pricebooks\n\t\tif (userType != \"Standard\" && userType != \"PowerPartner\") {\n\t\t\tthis.errors = ['A PriceBook Id is missing. Please contact your administrator to resolve the issue.']; // TODO: update with labels\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$.pricebookDialog.open();\n\t}\n\n\t_updateFieldLabelsMap() {\n\t\tlet fieldLabelsMap = this.editorModel.md.fieldLabelsMap,\n\t\t\tlocalizedDimensions = this.editorModel.data.quote.localizedMultiSegmentColumns,\n\t\t\tdimensions = this.editorModel.data.quote.multiSegmentColumns;\n\n\t\tfor (let dim in dimensions) {\n\t\t\tlet segments = dimensions[dim];\n\t\t\tlet localizedSegments = localizedDimensions[dim];\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\n\t\t\t\tfieldLabelsMap[segments[i].replace(/\\W/g, '')] = localizedSegments[i];\n\t\t\t}\n\t\t}\n\t\t// TODO: Make sure this label is localized\n\t\tfieldLabelsMap['total'] = 'Total';\n\t}\n\n\t/**\n\t * Updates number field on each lineVO.record\n\t */\n\trenumber() {\n\t\tlet idx = 1,\n\t\t\tinvisibleIdx = 3000;\n\t\tfor (let i = 0, numOfGroups = this.groupModels.length; i < numOfGroups; i++) { // loop through each group model\n\t\t\tlet groupModel = this.groupModels[i];\n\t\t\tfor (let j = 0, numOfDimensions = groupModel.dimensions.length; j < numOfDimensions; j++) { //loop through each dimension for the current group\n\t\t\t\tlet dim = groupModel.dimensions[j],\n\t\t\t\t\tsegmentedLines = groupModel.segmentedLinesByDimension[dim];\n\t\t\t\tfor (let k = 0, numOfLines = segmentedLines.length; k < numOfLines; k++) { // loop through all the segmented summary lines for the current dimension\n\t\t\t\t\tlet segments = segmentedLines[k].segments;\n\t\t\t\t\tif (segmentedLines[k].visible) {\n\t\t\t\t\t\tthis.set(`groupModels.${i}.segmentedLinesByDimension.${dim}.${k}.lineVO.record.${this.editorModel.constants.NUMBER_FIELD}`, idx); // update the summary line's number field - this will get reflected in the UI\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.editorModel.constants.NUMBER_FIELD] = idx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tidx++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsegmentedLines[k].lineVO.record[this.editorModel.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\tfor (let m = 0, numOfSegments = segments.length; m < numOfSegments; m++) { // update each segment's number field\n\t\t\t\t\t\t\tsegments[m].lineVO.record[this.editorModel.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop through standard lines\n\t\t\tfor (let n = 0, len = groupModel.standardLines.length; n < len; n++) {\n\t\t\t\tif (groupModel.standardLines[n].visible) {\n\t\t\t\t\tthis.set(`groupModels.${i}.standardLines.${n}.lineVO.record.${this.editorModel.constants.NUMBER_FIELD}`, idx); // update the line's number field - this will get reflected in the UI\n\t\t\t\t\tidx++;\n\t\t\t\t} else {\n\t\t\t\t\tgroupModel.standardLines[n].lineVO.record[this.editorModel.constants.NUMBER_FIELD] = invisibleIdx;\n\t\t\t\t\tinvisibleIdx++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_updateFieldValidations(e) {\n\t\tthis.errors = e.detail.error ? [e.detail.error] : null;\n\t}\n\n\t_calculateImmediately() {\n\t\t// Prevent dependent pick-list value changes from triggering multiple calculates\n\t\tthis.debounce('calculateImmediately', function() {\n\t\t\tthis.$.customActionServices.onFlagCalculate(true);\n\t\t}.bind(this), 50);\n\t}\n\n\t_executeCmd(cmd) {\n\t\tlet quoteActions = this.editorModel.customActionsByLocation.Quote;\n\t\tif (!quoteActions|| quoteActions.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tfor (let i = 0, l = quoteActions.length; i < l; i++) {\n\t\t\tif (quoteActions [i].eventHandlerName === cmd) {\n\t\t\t\tthis._executeCustomAction({\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tcustomAction: quoteActions[i],\n\t\t\t\t\t\tmodel: this.editorModel.quoteModel\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t_executeDefaultCustomAction() {\n\t\tlet defaultCustomActions = this.editorModel.defaultCustomActions;\n\t\tif (!defaultCustomActions  || defaultCustomActions.length === 0 || this.data.quote.lineItems.length > 0 || this.data.quote.lineItemGroups.length > 1 || this.editorModel.quoteModel.grouped) {\n\t\t\treturn\n\t\t}\n\t\tlet eventHandlerName = this.editorModel.quoteModel.isRenewal ? \"onRenewSubscriptions\" : \"onAddProducts\";\n\t\tfor (let i = 0, l = defaultCustomActions.length; i < l; i++) {\n\t\t\tif (defaultCustomActions[i].eventHandlerName === eventHandlerName) {\n\t\t\t\tthis._executeCustomAction({detail:{customAction:defaultCustomActions[i], model:this.editorModel.quoteModel}});\n\t\t\t}\n\t\t}\n\t}\n\n\tviewportChanged() {\n\t\tthis._handleGroupCustomActions(true);\n\t\tif (this.viewport.isMobile()) {\n\t\t\tthis.isMobile = true;\n\t\t} else {\n\t\t\tthis.isMobile = false;\n\t\t}\n\t}\n\n\tbuildQuoteTabs() {\n\t\tif (!this.editorModel)\n\t\t\treturn;\n\n\t\tlet namesForQuoteLayout = [];\n\t\tif (this.editorModel.fieldsetMap.quoteFieldNames.length > 0)\n\t\t\tnamesForQuoteLayout.push('details');\n\t\tif (this.editorModel.quoteModel.grouped) {\n\t\t\tthis.toggleClass('maxHeight', true, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels.length > 0) {\n\t\t\t\tnamesForQuoteLayout.push('groups');\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.groupModels.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.toggleClass('maxHeight', false, this.$$('#quoteTabs'));\n\t\t\tif (this.groupModels[0]._groupHasSegmentedProducts()) {\n\t\t\t\tthis.buildUngroupedSegmentedTabs();\n\t\t\t\tnamesForQuoteLayout.push('segmented');\n\t\t\t}\n\t\t\tif (this.groupModels[0]._groupHasStandardProducts()) {\n\t\t\t\tnamesForQuoteLayout.push('standard');\n\t\t\t}\n\t\t}\n\n\t\tif (!this._renderTabs(namesForQuoteLayout)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$$('#quoteTabs')) {\n\t\t\tthis.$$('#quoteTabs').destroyTabs();\n\t\t}\n\n\t\tlet tabs = [];\n\n\t\tfor (let i = 0, l = namesForQuoteLayout.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i,\n\t\t\t\ttabName = namesForQuoteLayout[i],\n\t\t\t\tbind;\n\t\t\tswitch (tabName) {\n\t\t\t\tcase 'details':\n\t\t\t\t\tbind = ['groupModels','editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'groups':\n\t\t\t\t\tbind = ['groupModels', 'rightSideButton', 'editorModel'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'standard':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'segmented':\n\t\t\t\t\tbind = ['groupModels'];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttabs.push({name: tId, label: tabName, bind: bind});\n\t\t}\n\t\tthis.ungroupedMDQTabs = this.groupModels[0] ? this.groupModels[0].quoteMDQTabs : null;\n\t\tthis.selectedTabIndex = 0;\n\t\tthis.hideTabs = tabs.length == 1;\n\t\tthis.quoteLevelTabs = tabs;\n\t}\n\n\t/**\n\t * Determines whether or not the quote level tabs need to be rendered by comparing quoteLevelTabs and namesForQuoteLayout\n\t * @param namesForQuoteLayout\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_renderTabs(namesForQuoteLayout) {\n\t\tif (this.quoteLevelTabs.length !== namesForQuoteLayout.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.groupModels[0] && this.groupModels[0].quoteMDQTabs && this.ungroupedMDQTabs.length !== this.groupModels[0].quoteMDQTabs.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// In case tabs end up being the same length - can occur when going from grouped to ungrouped quotes\n\t\tfor (let i = 0, l = this.quoteLevelTabs.length; i < l; i++) {\n\t\t\tif (this.quoteLevelTabs[i].label !== namesForQuoteLayout[i]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t *\n\t * @returns {Array}         - Return a line groups array based on the QuoteModel\n\t * @private\n\t */\n\t_getGroupModels() {\n\t\treturn this.editorModel.quoteModel.lineGroups;\n\t}\n\n\t/**\n\t * Determines whether the quote is ungrouped and has no lines - used to display the empty quote message\n\t * @returns {boolean}\n\t * @private\n\t */\n\tquoteHasNoLines() {\n\t\tif (this.data.quote.lineItems.length == 0) {\n\t\t\tlet quoteModel = this.editorModel.quoteModel;\n\t\t\tthis.groupedQuoteHasNoGroups =  (quoteModel.grouped  && quoteModel.lineGroups.length == 0);\n\t\t\tthis.ungroupedQuoteHasNoLines =  !quoteModel.grouped;\n\n\t\t}\n\t}\n\n\t/**\n\t * Based on the parameter quoteVO, it will update the following things\n\t *  1. Update the data.quote with the update of the data.quote. It will automatically trigger an update to the EditorModel\n\t *  2. Update the groupModels so that it will get the update reference because it doesn't update this property automatically.\n\t *\n\t * @param quote      - QuoteVO\n\t * @private\n\t */\n\tupdateQuote(quote) {\n\t\tif (quote != undefined) {\n\t\t\t// Wait for jsqc calculate to finish before running the code below\n\t\t\tthis.set('data.quote', quote);\n\t\t\tif (this.data.settings.usesClientCalculator && this.data.quote.calculationRequired) {\n\t\t\t\tthis.$.customActionServices.onFlagCalculate(true, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// create the editor model just in case it hasn't been created yet\n\t\t\tif(!this.editorModel)\n\t\t\t\tthis._createEditorModel();\n\n\t\t\tthis.editorModel.createQuoteModel(quote);\n\t\t\tthis.editorModel.styleQuoteAndGroupActionButtons();\n\t\t\tlet groupModels = this._getGroupModels();\n\t\t\tthis._updateFieldLabelsMap();\n\n\t\t\tthis.set('groupModels', groupModels);\n\n\t\t\tthis.rightSideButton = (this.viewport && !this.viewport.isMobile()) && this.groupModels.length > 1 && this.editorModel.quoteModel.grouped;\n\t\t\t// Handles closing the group panel when a group is deleted and there is only one group left\n\t\t\tif (this.editorModel.quoteModel.lineGroups.length == 1) {\n\t\t\t\tthis.fire('iron-signal', {name: 'close-group-panel'});\n\t\t\t}\n\n\t\t\t// Update Group Count for badge\n\t\t\tthis.notifyPath('editorModel.quoteModel.lineGroups.length', this.editorModel.quoteModel.lineGroups.length);\n\t\t\tthis.set('editorModel.quoteModel', this.editorModel.quoteModel); // Used for quote totals\n\t\t\tthis.renumber();\n\t\t\tif (this.isMobile) {\n\t\t\t\tthis.buildQuoteTabs();\n\t\t\t}\n\t\t}\n\n\t\tthis.quoteHasNoLines();\n\n\t\tif (this.data.settings.multiLineDeleteEnabled) {\n\t\t\t// Fire iron signal for deselecting multi line delete checkbox listened for in LETableHeader\n\t\t\tthis.fire('iron-signal', { name: 'deselect-checkbox'});\n\t\t}\n\t}\n\n\t/**\n\t * Goes through all of the paths collected in JSQCNotifier and will update UI if the value doesn't match the original value.\n\t * @param notifier\n\t */\n\tupdateAfterJSQC(notifier, sortRequired) {\n\t\tif (!notifier) {\n\t\t\treturn;\n\t\t}\n\t\tObject.keys(notifier.pathsToNotify).forEach(function(path) {\n\t\t\tlet originalValue = notifier.originalPathValues[path];\n\t\t\tlet pathsToNotify = notifier.pathsToNotify;\n\t\t\tlet value = notifier.pathsToNotify[path].value;\n\t\t\tlet root = pathsToNotify[path].root;\n\t\t\t// QuoteLineModel paths will be updated through the sort method which creates brand new objects\n\t\t\tlet shouldNotify = !sortRequired || (sortRequired && root != 'QuoteLineModel');\n\t\t\tif( originalValue != value && shouldNotify ) {\n\t\t\t\tthis.notifyPath(path, undefined);\n\t\t\t\tthis.notifyPath(path, value);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tObject.keys(notifier.pathsToSet).forEach(function(path) {\n\t\t\tlet originalValue = notifier.originalPathValues[path];\n\t\t\tlet pathsToSet = notifier.pathsToSet;\n\t\t\tlet value = pathsToSet[path].value;\n\t\t\tlet root = pathsToSet[path].root;\n\t\t\t// QuoteLineModel paths will be updated through the sort method which creates brand new objects\n\t\t\tlet shouldNotify = !sortRequired || (sortRequired && root != 'QuoteLineModel');\n\t\t\tif( originalValue != value && shouldNotify ) {\n\t\t\t\tthis.set(path, undefined);\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\t_init() {\n\t\tif (this.needsInit) {\n\t\t\t// Only perform needs-init actions once, the first time rawData is set.\n\t\t\tlet inVFPage = typeof Visualforce !== 'undefined';\n\t\t\tif (inVFPage && this.rawData.settings.usesClientCalculator && this.rawData.settings.orgUrl && window.Worker) {\n\t\t\t\t// Currently, precaching is only supported in VF pages.\n\t\t\t\tnew JSQCPrecacheWorkerManager(this.rawData).beginPrecaching();\n\t\t\t}\n\t\t\tthis.needsInit = false;\n\t\t}\n\n\t\t// Perform Page Security Plugin action every time rawData is updated.\n\t\tif (typeof SB !== 'undefined' && SB.JSQC) {\n\t\t\tlet oauthClient = new OAuthClient(this.app.org.prefix);\n\t\t\tlet qc = new SB.JSQC(this.rawData.settings, this.rawData.quote, null);\n\t\t\t// Instantiate two instances of connection.  One will be for us and the other will be for the customer plugin\n\t\t\tlet connectionPromiseArray = [oauthClient.getConnection(), oauthClient.getConnection()];\n\t\t\tPromise.all(connectionPromiseArray).then(function(connections){\n\t\t\t\tqc.setConnection(connections[0]);\n\t\t\t\tqc.setCustomerOnlyConnection(connections[1]);\n\t\t\t\tthis.rawData.settings.displayedLookupMap = this.$.customActionServices.getDisplayedLookupNames(this.rawData);\n\t\t\t\tlet promise = qc.onLoad();\n\t\t\t\tpromise.then(function() {\n\t\t\t\t\tthis.data = this.rawData;\n\t\t\t\t}.bind(this), function(err) {\n\t\t\t\t\tthis.errors = [{\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\tmsg: err.message || err\n\t\t\t\t\t}];\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this), function(err) {\n\t\t\t\tthis.errors = [{\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmsg: err.message || err\n\t\t\t\t}];\n\t\t\t}.bind(this));\n\t\t}\n\t\telse {\n\t\t\tthis.data = this.rawData;\n\t\t}\n\t}\n\n\t/**\n\t * When data (quoteEditorModel) is returned from the server, creates a map of object names to field names\n\t * in order to query objects with the fields on their related fieldsets (instead of all fields on the objects)\n\t * When fieldNamesByObjectNames if bound, <sb-le-field-md> component will make the server call\n\t * @private\n\t */\n\t_dataIsChanged() {\n\t\t// MD is fetched everytime because the field set might have changed (Quote Line View functionality)\n\t\t// Currently, precaching is only supported in VF pages. If at some point we add support for Localhost, this will\n\t\t// change.\n\t\tlet prefix = this.data.developerPrefix;\n\t\tlet fieldNamesByObjectNames = {}; // obj to store fields by object name {'SBQQ__QuoteLine__c': ['SBQQ__ProductCode__c',...],'SBQQ__QuoteLineGroup__c': ['SBQQ__Optional__c',...] }\n\n\t\t// combine all quote line field sets avoiding duplicates\n\t\tlet fieldNames = [],\n\t\t\tfieldNameSet = new Set(),\n\t\t\tfieldSets = ['lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone', 'multiSegmentLineFieldNames', 'multiSegmentLineSummaryFieldNames'];\n\t\tfor (let i = 0, len = fieldSets.length; i< len; i++) {\n\t\t\tlet fieldSet = this.data[fieldSets[i]],\n\t\t\t\tnumOfFields = fieldSet && fieldSet.length;\n\t\t\tif (numOfFields) {\n\t\t\t\tfor (let j= 0; j< numOfFields; j++) {\n\t\t\t\t\tlet name = fieldSet[j];\n\t\t\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\t\t\tfieldNameSet.add(name);\n\t\t\t\t\t\tfieldNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// add fields that are not part of a field set but needed in the UI\n\t\tlet additionalFields = [`${prefix}SubscriptionScope__c`, `${prefix}SegmentLabel__c`, `${prefix}StartDate__c`, `${prefix}EndDate__c`, `${prefix}PriceEditable__c`];\n\t\tfor (let k = 0, ln = additionalFields.length;k < ln; k++) {\n\t\t\tlet name = additionalFields[k];\n\t\t\tif (!fieldNameSet.has(name)) {\n\t\t\t\tfieldNameSet.add(name);\n\t\t\t\tfieldNames.push(name);\n\t\t\t}\n\t\t}\n\t\t// Concat with empty array to avoid pushing unwanted fields into field set array\n\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName] = [].concat(fieldNames);\n\t\tlet lineEditorSubtotalsField = this.data.settings.lineEditorSubtotalsField;\n\t\tif (!lineEditorSubtotalsField || lineEditorSubtotalsField == 'Default') {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteLineObjectName].push(lineEditorSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorSubtotalsField);\n\t\t}\n\n\t\t// add quote level fields\n\t\tfieldNamesByObjectNames[this.data.quoteObjectName] = [].concat(this.data.quoteFieldNames);\n\t\tfor (let m = 0, n = this.data.quoteFieldNames.length; m < n; m++) {\n\t\t\tfieldNameSet.add(this.data.quoteFieldNames[m]);\n\t\t}\n\t\tlet lineEditorTotalsField = this.data.settings.lineEditorTotalsField;\n\t\t if (!lineEditorTotalsField || lineEditorTotalsField == 'Default') {\n\t\t\tif (this.data.quote.applyAdditionalDiscountLast) {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}CustomerAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}CustomerAmount__c`);\n\t\t\t} else {\n\t\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(`${prefix}NetAmount__c`);\n\t\t\t\tfieldNameSet.add(`${prefix}NetAmount__c`);\n\t\t\t}\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[this.data.quoteObjectName].push(lineEditorTotalsField);\n\t\t\tfieldNameSet.add(lineEditorTotalsField);\n\t\t}\n\n\t\t// add group level fields\n\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`] = [].concat(this.data.groupFieldNames);\n\t\tfor (let o = 0, p = this.data.groupFieldNames.length; o < p; o++) {\n\t\t\tfieldNameSet.add(this.data.groupFieldNames[o]);\n\t\t}\n\t\tlet lineEditorGroupSubtotalsField = this.data.settings.lineEditorGroupSubtotalsField;\n\t\tif (!lineEditorGroupSubtotalsField || lineEditorGroupSubtotalsField == 'Default') {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(`${prefix}NetTotal__c`);\n\t\t\tfieldNameSet.add(`${prefix}NetTotal__c`);\n\t\t} else {\n\t\t\tfieldNamesByObjectNames[`${prefix}QuoteLineGroup__c`].push(lineEditorGroupSubtotalsField);\n\t\t\tfieldNameSet.add(lineEditorGroupSubtotalsField);\n\t\t}\n\n\t\t// add discount tier and discount schedule fields\n\t\tfieldNamesByObjectNames[`${prefix}DiscountTier__c`] = this.data.discountScheduleModalFieldNames;\n\t\tfieldNamesByObjectNames[`${prefix}DiscountSchedule__c`] = ['Name', `${prefix}DiscountUnit__c`];\n\n\t\tthis.fieldNameSet = fieldNameSet;\n\t\tthis.$.md.data = fieldNamesByObjectNames;\n\t}\n\n\t/**\n\t * General error event handler for line editor page.\n\t * @private\n\t */\n\t_errorEventHandled() {\n\t\tif (this.error) {\n\t\t\tif (this.error.validations) {\n\t\t\t\t// Handles validation exceptions coming from server\n\t\t\t\tthis.errors = this.error.validations;\n\t\t\t} else {\n\t\t\t\t// Handles standard error messages coming from server, in array format in case of multiple errors\n\t\t\t\tthis.errors = [this.error.message];\n\t\t\t}\n\t\t}\n\t\tthis.$.customActionServices.showSpinner = false;\n\t}\n\n\t_handleMobileCSE(e) {\n\t\tthis._openDialog({dialog: 'cseDialog', groupModelKey: null});\n\t}\n\n\t_handleCSE(e) {\n\t\tthis._openDialog(e.detail);\n\t}\n\n\t_handleCSEResponse(e) {\n\t\tthis.updateQuote(e.detail.quoteVO);\n\t\tthis.$.customActionServices.onFlagCalculate(true);\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t_openDialog(action) {\n\t\tif (action.dialog === 'cseDialog') {\n\t\t\tlet cseDialog = this.$.cseDialog;\n\t\t\tlet segments = this.editorModel.quoteModel.groupsByKey[action.groupModelKey].segmentedLinesByDimension.Custom[0].segmentsByLabel;\n\t\t\tlet segmentsArray = [];\n\t\t\tObject.keys(segments).forEach(function(key) {\n\t\t\t\tlet lineModel = segments[key];\n\t\t\t\tif ( lineModel.lineVO.dimensionType == lineModel.groupModel.editorModel.constants.CUSTOM_VALUE) {\n\t\t\t\t\tsegmentsArray.push(lineModel);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcseDialog.dataLineModels = segmentsArray;\n\t\t}\n\t\tthis.$[action.dialog].$.dialog.toggle();\n\t}\n\n\ttoggleGroupPanel() {\n\t\tif (this.viewport.isMobile()) {\n\t\t\tthis.fire('iron-signal', { name: 'toggle-panel-clicked'});\n\t\t}\n\t}\n\n\t/**\n\t * Changes the primary columns used for mobile and desktop.\n\t * @param  {Boolean} isMobile -flag for whether viewport.XS.only is true (mobile) or false (desktop).\n\t */\n\t_viewportChanged(isMobile) {\n\t\tif (!this.editorModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('hidden', !isMobile, Polymer.dom(this.root).querySelector('.fixedActions'));\n\t\t// Use primitive to ensure that the primaryMobileCols array actually changed\n\t\tlet standardPrimaryMobileColsLength = this.editorModel.standardPrimaryMobileCols.length;\n\t\tthis.editorModel.standardPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tlet segmentedPrimaryMobileColsLength = this.editorModel.segmentedPrimaryMobileCols.length;\n\t\tthis.editorModel.segmentedPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.PRODUCT_NAME_FIELD, 'total'] : [];\n\t\tthis.editorModel.segmentedDetailsPrimaryMobileCols = (isMobile) ? [this.editorModel.constants.SEGMENT_LABEL_FIELD, this.editorModel.constants.NET_TOTAL_FIELD] : [];\n\n\t\tif (this.groupModels &&\n\t\t\t(standardPrimaryMobileColsLength !== this.editorModel.standardPrimaryMobileCols.length ||\n\t\t\tsegmentedPrimaryMobileColsLength !== this.editorModel.segmentedPrimaryMobileCols.length)) { // Avoid loops if primaryMobileCols did not change\n\t\t\tfor (let i = 0; i < this.groupModels.length; i++) {\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.standardPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedPrimaryMobileCols`);\n\t\t\t\tthis.notifyPath(`groupModels.${i}.editorModel.segmentedDetailsPrimaryMobileCols`);\n\t\t\t}\n\t\t}\n\n\t\tif (isMobile) {\n\t\t\tthis.buildQuoteTabs();\n\t\t}\n\n\t\tthis.isMobileRendered = isMobile;\n\t\tthis.isDesktopRendered = !isMobile;\n\t}\n\n\tbuildUngroupedSegmentedTabs() {\n\t\tif (!this.groupModels || this.groupModels.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet tabs = [],\n\t\t\tdimensions = this.groupModels[0].dimensions;\n\n\t\tfor (let i = 0, len = dimensions.length; i < len; i++) {\n\t\t\tlet dimension = dimensions[i];\n\t\t\tif (this.groupModels[0].hasVisibleSegmentedLines[dimension]) {\n\t\t\t\tlet tId = \"t\" + i;\n\t\t\t\tlet tab = {name: tId, key: dimension, label: this.groupModels[0].quoteModel.quoteVO.localizedDimensionNames[dimension], bind: ['groupModel']};\n\t\t\t\tif ( dimension == 'Custom') {\n\t\t\t\t\ttab.iconId = tId + '-' + this.groupModels[0].groupKey;\n\t\t\t\t\ttab.iconClass = 'sb-icon-pencil';\n\t\t\t\t\ttab.iconEvent = 'cseMobile';\n\t\t\t\t}\n\t\t\t\ttabs.push(tab);\n\t\t\t}\n\t\t}\n\t\tthis.groupModels[0].quoteMDQTabs = tabs;\n\t\tif(!this.ungroupedMDQTabs) {\n\t\t\tthis.ungroupedMDQTabs = tabs;\n\t\t}\n\t}\n\n\t_openCSE() {\n\t\tlet e = {\n\t\t\tdialog: event.currentTarget.attributes.dialog.value\n\t\t};\n\t\tthis.$.cseDialog.$.dialog.toggle();\n\t}\n\n\t/**\n\t * Displays toast warning if user enters a number greater than the max quantity of either the upgrade or source for auto quanitty ratio enforcement.\n\t * @param  {Object} e - event object containing the valid and invalid quantity to notify user of max quantity enforcement.\n\t */\n\t_displayUpgradeQuantityToast(e) {\n\t\tlet invalidQuantity = e.detail.invalidQuantity;\n\t\tlet validQuantity = e.detail.validQuantity;\n\n\t\t// Set to null to avoid toast messages stacking on top of each other in UI\n\t\tthis.errors = null;\n\n\t\tif(invalidQuantity > 0) {\n\t\t\tlet errorMessage = this.i18n.l('Exceeded maximum quantity available. Value has been reduced to {0}', [validQuantity]);\n\t\t\tthis.errors = [{\n\t\t\t\ttype: 'warning',\n\t\t\t\tmsg: errorMessage\n\t\t\t}];\n\t\t}\n\t}\n\n\tdestampGroups() {\n\t\tthis.isMobileRendered = false;\n\t\tthis.isDesktopRendered = false;\n\t}\n\n\t/**\n\t * Displays guided messages product alert modal during save or quickSave event called from LECustomActionServices.js\n\t * @param service {String} - determines whether the save or quickSave service action was performed\n\t * @param guidedMessages {Array} - contains strings with the product alert guided messages\n\t */\n\thandleProductRuleAlertModal(serviceType, guidedMessages) {\n\t\tif (!guidedMessages || guidedMessages.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.$.productAlertModal.cancelCB = null;\n\t\tif (serviceType === 'saveService') {\n\t\t\tthis.$.productAlertModal.displayContinueButton = true;\n\t\t\tthis.$.productAlertModal.continueCB = () => {\n\t\t\t\t// Pass true to ensure validation process is called in LECustomActionServices navigateToReturnUrl\n\t\t\t\tthis.$.customActionServices.navigateToReturnUrl(true);\n\t\t\t};\n\t\t}\n\t\tthis.$.productAlertModal.alerts = guidedMessages;\n\t}\n\n}\n\nPolymer( LineEditor );","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method to create an object capable of loading discount schedules and account summaries, and\n * posting those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, accountId) {\n\n\tfunction executeSequence() {\n\t\tvar scheduleMap = extractScheduleMapFromQuote();\n\t\tif (Object.keys(scheduleMap).length != 0) {\n\t\t\tvar context = {\n\t\t\t\t'schedules': scheduleMap,\n\t\t\t\t'overrides': {}, // If we're precaching, then obviously nothing can be overridden yet, so send empty object.\n\t\t\t\t'account': accountId\n\t\t\t};\n\t\t\treturn apex.load(prefix, 'DiscountAndAccountCallout', 'AllDiscountsAndAccounts', context)\n\t\t\t\t.then(function(results) {\n\t\t\t\t\tresultPoster({successful: true, provider: 'DiscountAndAccountCallout', uid: 'AllDiscountsAndAccounts', results: results});\n\t\t\t\t}, function(err) {\n\t\t\t\t\tself.postMessage({err: true, sequence: 'DiscountScheduleSequence', msg: err.message || err});\n\t\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\t\n\tfunction extractScheduleMapFromQuote() {\n\t\t// If the prefix is 'SBQQ', it means we're in a managed install, and all Salesforce CPQ objects will have an \n\t\t// SBQQ__ prefix.\n\t\tvar fieldPrefix = prefix == 'SBQQ' ? 'SBQQ__' : '';\n\t\tvar scheduleMap = {};\n\t\tvar volumeDiscountField = fieldPrefix + 'DiscountSchedule__c';\n\t\tvar termDiscountField = fieldPrefix + 'TermDiscountSchedule__c';\n\t\tvar productField = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar vId = line.record[volumeDiscountField];\n\t\t\tvar tId = line.record[termDiscountField];\n\t\t\tvar cId = line.costScheduleId;\n\t\t\t\n\t\t\tif (vId != null) {\n\t\t\t\tif (scheduleMap[vId] == null) {\n\t\t\t\t\tscheduleMap[vId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[vId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (tId != null) {\n\t\t\t\tif (scheduleMap[tId] == null) {\n\t\t\t\t\tscheduleMap[tId] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[tId].push(line.record[productField]);\n\t\t\t}\n\n\t\t\tif (cId != null) {\n\t\t\t\tif (scheduleMap[convertTo18(cId)] == null) {\n\t\t\t\t\tscheduleMap[convertTo18(cId)] = [];\n\t\t\t\t}\n\t\t\t\tscheduleMap[convertTo18(cId)].push(line.record[productField]);\n\t\t\t}\n\t\t});\n\t\treturn scheduleMap;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n *\n * Exports a factory method to create an object capable of retrieving SFDC Field Metadata.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} referencedFieldMap Which fields must be queried\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, referencedFieldMap) {\n\n\tfunction executeSequence() {\n\t\tvar fullNames = determineMetadataFullNames();\n\t\tif (fullNames.length == 0) {\n\t\t\t// If there's no metadata to query, then just return;\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn apex.md('CustomField', fullNames)\n\t\t\t\t.then(function (mdResults) {\n\t\t\t\t\t// For field metadata, we create a Universal ID by concatenating all of the field names together using\n\t\t\t\t\t// ','.\n\t\t\t\t\tvar uid = fullNames.join(',');\n\t\t\t\t\tresultPoster({successful: true, provider: 'CustomField', uid: uid, results: mdResults});\n\t\t\t\t})\n\t\t}\n\t}\n\n\tfunction determineMetadataFullNames() {\n\t\tif (referencedFieldMap == null) {\n\t\t\treturn [];\n\t\t}\n\t\t// The callout prefix we're given is 'SBQQ', then it means we're on a managed install, so all of the Salesforce CPQ\n\t\t// objects will have an SBQQ__ prefix.\n\t\tvar objectPrefix = prefix == 'SBQQ' ? 'SBQQ__' : '';\n\t\tvar fullNames = [];\n\t\tvar lineType = objectPrefix + 'QuoteLine__c';\n\t\tvar quoteType = objectPrefix + 'Quote__c';\n\t\tvar groupType = objectPrefix + 'QuoteLineGroup__c';\n\t\t// For all field sets, create the field's full name by adding the object name to the beginning.\n\t\tfor (var key in referencedFieldMap) {\n\t\t\tvar typeName;\n\t\t\tif (key === 'Quote Line') {\n\t\t\t\ttypeName = lineType;\n\t\t\t} else if (key === 'Group') {\n\t\t\t\ttypeName = groupType;\n\t\t\t} else if (key === 'Quote') {\n\t\t\t\ttypeName = quoteType;\n\t\t\t} else {\n\t\t\t\ttypeName = key;\n\t\t\t}\n\t\t\tif (referencedFieldMap.hasOwnProperty(key)) {\n\t\t\t\treferencedFieldMap[key].forEach(function(fieldName) {\n\t\t\t\t\tfullNames.push(typeName + '.' + fieldName);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn fullNames;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product Option fields that must be queried\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\n\tfunction executeSequence() {\n\t\tvar optionIds = getOptionIdsFromLines();\n\t\tvar context = {\n\t\t\t'requiredIds': optionIds,\n\t\t\t'requiredFields': referencedFields || []\n\t\t};\n\t\tapex.setOptions({escape: false});\n\t\treturn apex.load(prefix, 'ProductOptionServiceProvider.ProductOptionLoader', 'AllOptions', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'ProductOptionServiceProvider.ProductOptionLoader', uid: 'AllOptions', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'OptionSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getOptionIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'ProductOption__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value && !uniquenessMap[value]) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for an object that can load information about price rules, summary variables,\n * assets, and subscriptions.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {String} accountId ID of the account on this quote\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, accountId) {\n\tfunction executeSequence() {\n\t\treturn loadPriceRules()\n\t\t\t.then(function(ruleRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'PriceRuleServiceProvider.PriceRuleReader', uid: 'PriceRules', results: ruleRecords});\n\t\t\t\treturn loadSummaryVariables(ruleRecords);\n\t\t\t})\n\t\t\t.then(function(svRecords) {\n\t\t\t\tresultPoster({successful: true, provider: 'SummaryVariableServiceProvider.SummaryVariableLoader', uid: 'SummaryVariables', results: svRecords});\n\t\t\t\treturn loadAssetsAndSubscriptions(svRecords);\n\t\t\t})\n\t\t\t.then(function(assetAndSubRecs) {\n\t\t\t\tresultPoster({successful: true, provider: 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', uid: 'AssetsAndSubs', results: assetAndSubRecs});\n\t\t\t})\n\t\t\t.catch(function(err) {\n\t\t\t\tself.postMessage({err: true, sequence: 'Price Rule Sequence', msg: err.msg || err});\n\t\t\t})\n\t}\n\n\t/**\n\t * Queries active Calculator-scoped price rules from the org.\n\t * @returns {Promise} Resolves to a list of records\n\t */\n\tfunction loadPriceRules() {\n\t\treturn apex.read(prefix, 'PriceRuleServiceProvider.PriceRuleReader', 'PriceRules');\n\t}\n\n\tfunction loadSummaryVariables(ruleRecords) {\n\t\tvar neededIds = getSummaryVariableIds(ruleRecords);\n\t\tvar svContext = {\n\t\t\t'svIds': neededIds\n\t\t};\n\t\treturn apex.load(prefix, 'SummaryVariableServiceProvider.SummaryVariableLoader', 'SummaryVariables', svContext);\n\t}\n\n\tfunction getSummaryVariableIds(ruleRecords) {\n\t\tvar recordPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\tvar filterVarField = recordPrefix + 'FilterVariable__c';\n\t\tvar testedVarField = recordPrefix + 'TestedVariable__c';\n\t\tvar sourceVarField = recordPrefix + 'SourceVariable__c';\n\t\tvar condRelationship = recordPrefix + 'PriceConditions__r';\n\t\tvar actionRelationship = recordPrefix + 'PriceActions__r';\n\t\tvar svIds = [];\n\t\tvar condIdCollector = function(condRecord) {\n\t\t\tif (condRecord[filterVarField]) {\n\t\t\t\tsvIds.push(condRecord[filterVarField]);\n\t\t\t}\n\t\t\tif (condRecord[testedVarField]) {\n\t\t\t\tsvIds.push(condRecord[testedVarField]);\n\t\t\t}\n\t\t};\n\t\tvar actionIdCollector = function(action) {\n\t\t\tif (action[sourceVarField]) {\n\t\t\t\tsvIds.push(action[sourceVarField]);\n\t\t\t}\n\t\t};\n\t\tif (ruleRecords.length > 0) {\n\t\t\truleRecords.forEach(function(rule) {\n\t\t\t\tif (rule[condRelationship] && rule[condRelationship].records.length > 0) {\n\t\t\t\t\trule[condRelationship].records.forEach(condIdCollector);\n\t\t\t\t}\n\t\t\t\tif (rule[actionRelationship] && rule[actionRelationship].records.length > 0) {\n\t\t\t\t\trule[actionRelationship].records.forEach(actionIdCollector);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn svIds;\n\t}\n\n\n\tfunction loadAssetsAndSubscriptions(svRecords) {\n\t\tif (!accountId) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t\tvar recordPrefix = prefix == '' ? '' : 'SBQQ__';\n\t\tvar targetObjectField = recordPrefix + 'TargetObject__c';\n\t\tvar filterField = recordPrefix + 'FilterField__c';\n\t\tvar constraintField = recordPrefix + 'ConstraintField__c';\n\t\tvar aggregateField = recordPrefix + 'AggregateField__c';\n\n\t\tvar assetFields = [];\n\t\tvar subscriptionFields = [];\n\t\tfor (var svId in svRecords) {\n\t\t\tif (svRecords.hasOwnProperty(svId)) {\n\t\t\t\tvar svRec = svRecords[svId];\n\t\t\t\tif (svRec[targetObjectField] == 'Asset') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tassetFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t} else if (svRec[targetObjectField] == 'Subscription') {\n\t\t\t\t\tif (svRec[filterField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[filterField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[constraintField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[constraintField]);\n\t\t\t\t\t}\n\t\t\t\t\tif (svRec[aggregateField] != null) {\n\t\t\t\t\t\tsubscriptionFields.push(svRec[aggregateField]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar context = {\n\t\t\t'accountId': accountId,\n\t\t\t'assetFields': assetFields,\n\t\t\t'subscriptionFields': subscriptionFields\n\t\t};\n\n\t\treturn apex.load(prefix, 'AssetAndSubscriptionServiceProvider.AssetAndSubLoader', 'AssetsAndSubs', context);\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}\n","/**\n * Created by jfeingold on 10/14/16.\n */\nmodule.exports = runnerFactory;\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Array} referencedFields The Product fields that must be included\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, referencedFields) {\n\tvar fieldPrefix = prefix == '' ? '' : 'SBQQ__';\n\tfunction executeSequence() {\n\t\tvar productIds = getProductIdsFromLines();\n\t\tvar pricebookFilter = [];\n\t\tif (quote.record[fieldPrefix + 'PricebookId__c']) {\n\t\t\tpricebookFilter.push(quote.record[fieldPrefix + 'PricebookId__c']);\n\t\t}\n\t\tvar currencyFilter = [];\n\t\tif (quote.record['CurrencyIsoCode']) {\n\t\t\tcurrencyFilter.push(quote.record['CurrencyIsoCode']);\n\t\t}\n\t\tvar context = {\n\t\t\t'requiredIds': productIds,\n\t\t\t'productFields': referencedFields,\n\t\t\t'pricebookFilter': pricebookFilter,\n\t\t\t'currencyFilter': currencyFilter\n\t\t};\n\t\tapex.setOptions({escape: false});\n\t\treturn apex.load(prefix, 'ProductServiceProvider.ProductLoader', 'AllProducts', context)\n\t\t\t.then(function (results) {\n\t\t\t\tresultPoster({\n\t\t\t\t\tsuccessful: true,\n\t\t\t\t\tprovider: 'ProductServiceProvider.ProductLoader',\n\t\t\t\t\tuid: 'AllProducts',\n\t\t\t\t\tresults: results\n\t\t\t\t});\n\t\t\t}, function (err) {\n\t\t\t\tresultPoster({err: true, sequence: 'ProductSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction getProductIdsFromLines() {\n\t\tvar uniquenessMap = {};\n\t\tvar values = [];\n\t\tvar fieldName = fieldPrefix + 'Product__c';\n\t\tquote.lineItems.forEach(function(line) {\n\t\t\tvar value = line.record[fieldName];\n\t\t\tif (value != null && uniquenessMap[value] == null) {\n\t\t\t\tuniquenessMap[value] = true;\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t});\n\t\treturn values;\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","/**\n * Created by jfeingold on 10/13/16.\n * \n * Exports a factory method for creating an object that can query related records referenced by the quote, lines, or groups,\n * and post those results back to the main thread.\n */\nmodule.exports = runnerFactory;\nvar convertTo18 = require('../IdConverter.js');\n\n/**\n * Returns an object containing an executeSequence() method.\n * @param {Object} apex Provides access to SFDC data\n * @param {String} prefix The prefix used for callouts. Either 'SBQQ' or an empty string\n * @param {Function} resultPoster self.postMessage() passed in from the worker thread\n * @param {Object} quote Quote data\n * @param {Object} lookupFieldMap A map from lookup field names to the objects targeted by those fields\n * @param {Object} referencedFieldMap A map from objects to the required fields on those objects\n * @returns {{executeSequence: executeSequence}}\n */\nfunction runnerFactory(apex, prefix, resultPoster, quote, lookupFieldMap, referencedFieldMap) {\n\tfunction executeSequence() {\n\t\tvar context = {\n\t\t\t'queryInfo': {}\n\t\t};\n\t\t\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.quoteLookups, [quote]);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.groupLookups, quote.lineItemGroups);\n\t\tsweepModelsForLookupIds(context, lookupFieldMap.lineLookups, quote.lineItems);\n\t\t\n\t\treturn apex.load(prefix, 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', 'AllAdditionalLookups', context)\n\t\t\t.then(function(results) {\n\t\t\t\tresultPoster({successful: true, provider: 'JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader', uid: 'AllAdditionalLookups', results: results});\n\t\t\t}, function(err) {\n\t\t\t\tresultPoster({err: true, sequence: 'RelatedRecordSequence', msg: err.message || err});\n\t\t\t});\n\t}\n\t\n\tfunction sweepModelsForLookupIds(context, lookupFields, models) {\n\t\t// If there are lookup relationships to test, and records to test them against...\n\t\tif (lookupFields && models && models.length > 0) {\n\t\t\t// For every lookup field on this object type...\n\t\t\tfor (var key in lookupFields) {\n\t\t\t\tif (lookupFields.hasOwnProperty(key)) {\n\t\t\t\t\t// Get the SObject type the field points to.\n\t\t\t\t\tvar targetType = lookupFields[key];\n\t\t\t\t\t// Check that field on each record to see if it has a value\n\t\t\t\t\tmodels.forEach(function(model) {\n\t\t\t\t\t\tvar id = model.record[key];\n\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\tvar convertedId = convertTo18(id);\n\t\t\t\t\t\t\tif (!convertedId) {\n\t\t\t\t\t\t\t\t// If the ID didn't convert properly, we skip it\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else if (!context.queryInfo[targetType]) {\n\t\t\t\t\t\t\t\t// If the context doesn't contain query info for this object type yet, add it.\n\t\t\t\t\t\t\t\t// We need the Id and the referenced fields on this object.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType] = {\n\t\t\t\t\t\t\t\t\t'referencedFields': referencedFieldMap[targetType],\n\t\t\t\t\t\t\t\t\t'referencedIds': [convertedId]\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// If the context already has query info for this object type, we just add the ID to the\n\t\t\t\t\t\t\t\t// list of those we're querying for.\n\t\t\t\t\t\t\t\tcontext.queryInfo[targetType]['referencedIds'].push(convertedId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn {\n\t\texecuteSequence: executeSequence\n\t};\n}","import {LineModel} from 'quotes/models/LineModel.js';\nimport {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nexport class SegmentedLines {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-segmented-lines';\n\t\tthis.properties = {\n\t\t\t// Segment Summary line column names\n\t\t\tfieldNames: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t//\n\t\t\tquoteLineFields: {\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\t// Each column name for the pricing and the customized\n\t\t\tcolumnNames: {\n\t\t\t\ttype: Array\n\t\t\t},\n\t\t\t// Currency MD which are from NetTotal__c so that we can format the subtotals and total will the correct currency format\n\t\t\tcurrencyMd: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_getNetTotalFieldMd(groupModel)'\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t}\n\n\t// Observers\n\tget observers() {\n\t\treturn ['_render(groupModel)',\n\t\t\t\t'_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)',\n\t\t\t\t'_showSubtotal(groupModel.*)'];\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths();\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths();\n\t}\n\n\t/**\n\t * Triggered by change to segmentedLinesByDimension map\n\t * @param e - the event that contains the dimensions that will get set and notified to lineModels\n\t * @private\n\t */\n\t_segmentedLinesByDimensionChanged(e) {\n\t\tlet parts,\n\t\t\tisCurrentDimension;\n\t\t// handles splices by setting the updated segmentedLinesByDimension array- TODO: is there a better way?\n\t\tparts = e.path.split(`.`);\n\t\tisCurrentDimension = parts.indexOf(this.dimension) >= 0 ? true : false;\n\t\tif (parts[parts.length - 1] == 'splices' && isCurrentDimension) {\n\t\t\tlet spliceChanges = e.value.indexSplices;\n\t\t\tif (spliceChanges[0].removed && spliceChanges[0].object.length === 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = false;\n\t\t\t} else if (spliceChanges[0].addedCount > 0) {\n\t\t\t\tthis.hasVisibleSegmentedLines = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Dereference groupModel and editorModel to build MDQ rows\n\t * @private\n\t */\n\t_render() {\n\t\tif(!this.groupModel) return;\n\t\tthis.dimension = this.attributes.key.value;\n\t\tthis.hasVisibleSegmentedLines = this.groupModel.hasVisibleSegmentedLines[this.dimension];\n\t\tthis.fieldNames = this._getFields();\n\t\tthis.lineModels = this.groupModel.segmentedLinesByDimension[this.dimension];\n\t\tthis.linkPaths(`groupModel.segmentedLinesByDimension.${this.dimension}`, 'lineModels');\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis.settings = this.editorModel.data.settings;\n\t\tthis.detailFieldNames = this.editorModel.fieldsetMap.multiSegmentLineFieldNames;\n\n\t\t// column names are either on the groupVO or on the quoteVO depending on the state of the quote\n\t\t// Columns, totals for subtotals and totals\n\t\tlet multiSegmentColumns = this.groupModel.groupVO.multiSegmentColumns;\n\t\tif (multiSegmentColumns && Object.keys(multiSegmentColumns).length > 0) {\n\t\t\tthis.columnNames = multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension];\n\t\t} else {\n\t\t\tthis.columnNames = this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension];\n\t\t\tthis.headerColumnNames = this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension];\n\t\t}\n\n\t\tthis.netMultiSegmentTotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t}\n\n\t_getFields() {\n\t\tlet fields = this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;\n\t\treturn this.groupModel.segmentedSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(fields) : fields;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tlet colWidths = null;\n\t\t// TODO: Why do we need the check for the dimension - looks like this table is trying to re-render for a deleted group- why?\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout && this.groupModel.segmentedLinesByDimension[this.dimension]) {\n\t\t\tcolWidths = this.editorModel.layout.colWidths[this.groupModel.groupKey][this.dimension];\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\t// get the width of the subtotal label column which should align with the last summary line field\n\t\tlet labelColWidth = offset;\n\t\tfor (let i = 0, l = this.fieldNames.length; i < l; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 'px';\n\n\t\t// set widths of each segment total\n\t\tfor (let j = 0, len = this.columnNames.length; j < len; j++) {\n\t\t\tlet columnName = this.columnNames[j].replace(/\\W/g, '');\n\t\t\tthis.subtotalColWidth = columnWidths[columnName] + 'px';\n\t\t}\n\t\t// set width of the total column\n\t\tthis.totalColWidth = columnWidths['total'] + 'px';\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setColumnWidths();\n\t}\n\n\tonTrack(e) {\n\t\tthis.domHost.domHost._onTrack(e);\n\t}\n\n\t/**\n\t * Return the raw editorModel from usps. Once the package is arrived, it will return the updated editorModel\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\t/**\n\t * Return the quoteVO from usps. Once the package is arrived, it will return the updated quoteVO\n\t * @returns {groupModel.quoteModel.editorModel|{data, developerPrefix, constants}}\n\t */\n\tget quoteVO() {\n\t\treturn this.editorModel.quoteModel.quoteVO;\n\t}\n\n\t/**\n\t * Return the multiSegmentColumnTotals based on the column name which are one-time and currency column names\n\t * @param columnName\n\t * @returns {*[]}\n\t */\n\tgetMultiSegmentColumnTotal(columnName) {\n\t\tif (this.groupModel.multiSegmentColumnTotals[this.dimension])\n\t\t\treturn [this.groupModel.multiSegmentColumnTotals[this.dimension][columnName]];\n\t}\n\n\tgetMultiSegmentTotalField() {\n\t\tif (this.groupModel.netMultiSegmentTotal)\n\t\t\treturn this.groupModel.netMultiSegmentTotal[this.dimension];\n\t}\n\n\t_showSubtotal() {\n\t\tif (!this.currencyMd) {\n\t\t\tthis.currencyMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (this.editorModel.data.settings.lineEditorSubtotalsField != \"doNotDisplay\") {\n\t\t\tthis._getNetTotalFieldMd();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t/**\n\t * Return the Quote line object from the net total field\n\t *\n\t * @returns {*}\n\t * @private\n\t */\n\t_getNetTotalFieldMd() {\n\t\tlet priceScale;\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\tpriceScale = settings.currencyDecimalScale;\n\t\t} else {\n\t\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay' || subtotalField == null) {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t\t} else {\n\t\t\t\tpriceScale = this.editorModel.md.fieldsMap[settings.developerPrefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t\t}\n\t\t}\n\t\treturn { type: \"currency\", scale: priceScale, CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t}\n\n\t/**\n\t *  Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e      - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\t// False parameter added because we don't care about bundleKeptTogether for segmented line sorting\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], e.detail.field, e.detail.order, false, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension], lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${this.dimension}`, model.slice());\n\t\t\t// Still needed to update UI after sorting\n\t\t\tthis.notifyPath('lineModels', model.slice());\n\t\t} else {\n\t\t\tthis.groupModel.segmentedLinesByDimension[this.dimension] = model;\n\t\t}\n\t}\n\n}\n\nPolymer( SegmentedLines );","import {depthFirstLineItemsTreeSort} from 'quotes/sb-line-sort/QuoteLineSort.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {DragDropModel} from 'quotes/models/DragDropModel.js';\nimport {isComponent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsShareParent} from 'quotes/models/DragDropModel.js';\nimport {ifLineElementsAreParentChild} from 'quotes/models/DragDropModel.js';\nimport {removeTableRowBorderClass} from 'quotes/models/DragDropModel.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableLayoutBuilder} from 'common/layout/table-layout-builder/TableLayoutBuilder.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\n\nconst GHOST_X_OFFSET = 9;\nconst GHOST_Y_OFFSET = 147;\nexport class StandardLines {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-standard-lines';\n\t\tthis.properties = {\n\t\t\tgroupModel: { /** required - built from the LineEditor from the incoming data */\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsettings: Object,\n\t\t\tfieldNames: Array,\n\t\t\tquoteLineFields: Object,\n\t\t\tfieldLabelsMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tsubtotal: {\n\t\t\t\ttype: Number\n\t\t\t},\n\t\t\tsubtotalMd: Object,\n\t\t\tdragDrop: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.addEventListener('table-header-sort-clicked', this._onSortLinesByHeader);\n\t\tthis.summaries = this.groupModel.quoteModel.grouped ? this.groupModel.groupVO.summaries : this.groupModel.quoteModel.quoteVO.summaries;\n\t\tlet validTargets = new Set(['sb-droppable-standardRows', 'sb-droppable-emptyTable', 'sb-droppable-sidePanelGroups']);\n\t\tthis.dragDrop = new DragDropModel(this, this.editorModel.data.settings.bundleKeptTogether, 'sb-le-table-row',\n\t\t\t\t\t\tvalidTargets, this.dragFunc.bind(this), this.trackFunc.bind(this), this.dropFunc.bind(this), GHOST_X_OFFSET, GHOST_Y_OFFSET);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_buildRows(groupModel)',\n\t\t\t'_updatePrimaryMobileColumns(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)',\n\t\t\t'_lineSplicesListener(groupModel.standardLines.splices)',\n\t\t\t'_showSubtotal(groupModel.*)'\n\t\t];\n\t}\n\n\tget editorModel() {\n\t\treturn this.groupModel.quoteModel.editorModel;\n\t}\n\n\tget md() {\n\t\treturn this.editorModel.md;\n\t}\n\n\tget prefix() {\n\t\treturn this.editorModel.data.developerPrefix;\n\t}\n\n\t/**\n\t *  Updates fieldNames reference and binds the header data\n\t * @private\n\t */\n\t_buildRows() {\n\t\tthis.actionsOnTheLeft = this.editorModel.actionsOnTheLeft;\n\t\tthis.multiLineDeleteEnabled = this.editorModel.data.settings.multiLineDeleteEnabled;\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.editorModel.fieldsetMap, 'lineFieldNames', 'lineFieldNamesTablet', 'lineFieldNamesPhone');\n\t\tthis._setFieldNames();\n\t\tthis.columnWidths = {};\n\t\tthis._setColumnWidths();\n\t\tthis.columnNames = null;\n\t\tthis.fieldLabelsMap = this.editorModel.md.fieldLabelsMap;\n\t\tthis.quoteLineFields = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\t\tthis.settings = this.editorModel.data.settings;\n\t}\n\n\t/**\n\t * Sets columnWidths object on the component. This object handles the table alignment.\n\t * @private\n\t */\n\t_setColumnWidths() {\n\t\tlet colWidths = null;\n\t\t// Check if layout exists for tests - some tests implement group or row component directly which would not have the layout\n\t\tif (!this.editorModel.deviceContext.isMobile && this.editorModel.layout) {\n\t\t\tcolWidths = this.editorModel.layout.colWidths[this.groupModel.groupKey]['Standard'];\n\t\t\tthis._setSubtotalColumnWidth(colWidths, this.editorModel.layout.leftOffset);\n\t\t}\n\t\tthis.set('columnWidths', colWidths);\n\t}\n\n\t/**\n\t * Sets column widths within the subtotal row\n\t * @param columnWidths - object\n\t * @private\n\t */\n\t_setSubtotalColumnWidth(columnWidths, offset) {\n\t\t// get the width of the subtotal label column which should align with the field before Net Total\n\t\tlet labelColWidth = offset;\n\n\t\tlet len = this.fieldNames.length;\n\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\tlet field = this.fieldNames[i];\n\t\t\tlabelColWidth += columnWidths[field];\n\t\t}\n\t\tthis.labelColWidth = labelColWidth + 'px';\n\n\t\tlet lastColWidth = columnWidths[this.editorModel.constants.NET_TOTAL_FIELD];\n\t\tthis.subtotalColWidth = lastColWidth + 'px';\n\t}\n\n\tcolWidthsChanged() {\n\t\tthis._setColumnWidths();\n\t}\n\n\tgetStandardColWidths() {\n\t\tif (this.editorModel.deviceContext.isMobile) return;\n\t\treturn this.editorModel.layout.colWidths[this.groupModel.groupKey]['Standard'];\n\t}\n\n\t_showSubtotal() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tif (!this.subtotalMd) {\n\t\t\tthis.subtotalMd = { type: \"currency\", scale: this._getPriceScale(), CurrencyIsoCode: this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode };\n\t\t}\n\t\tif (settings.lineEditorSubtotalsField != \"doNotDisplay\" && this.groupModel.standardLines.length > 0) {\n\t\t\tthis._getSubtotal();\n\t\t\tthis.showSubtotal = true;\n\t\t} else {\n\t\t\tthis.showSubtotal = false;\n\t\t}\n\t}\n\n\t_getPriceScale() {\n\t\tlet settings = this.editorModel.data.settings;\n\t\tlet subtotalField = settings.lineEditorSubtotalsField;\n\t\tif (settings.isMultiCurrencyOrg) {\n\t\t\treturn settings.currencyDecimalScale;\n\t\t}\n\t\tif (subtotalField == 'Default' || subtotalField == 'doNotDisplay'|| subtotalField == null) {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][this.editorModel.constants.NET_TOTAL_FIELD].scale;\n\t\t} else {\n\t\t\treturn this.editorModel.md.fieldsMap[this.prefix + 'QuoteLine__c'][subtotalField].scale;\n\t\t}\n\t}\n\n\t_getSubtotal() {\n\t\tlet subtotalField,\n\t\t\tsubtotal,\n\t\t\tsettings = this.editorModel.data.settings,\n\t\t\tpriceScale = this._getPriceScale(),\n\t\t\tlines = this.groupModel.standardLines;\n\n\t\tif (settings.lineEditorSubtotalsField == 'Default' || settings.lineEditorSubtotalsField == null) {\n\t\t\tsubtotalField = this.editorModel.constants.NET_TOTAL_FIELD;\n\t\t} else { // Custom subtotals field\n\t\t\tsubtotalField = settings.lineEditorSubtotalsField;\n\t\t}\n\n\t\tsubtotal = lines.reduce( ( prev, curr ) => {\n\t\t\tif (isNaN(curr.lineVO.record[subtotalField])) {\n\t\t\t\treturn prev;\n\t\t\t} else {\n\t\t\t\treturn prev + curr.lineVO.record[subtotalField];\n\t\t\t}\n\t\t}, 0);\n\n\t\tthis.subtotal = subtotal.toFixed(priceScale);\n\t}\n\n\tonTrack(e) {\n\t\tthis.dragDrop._onTrack(e);\n\t}\n\n\tdragFunc(dragElement) {\n\t\tlet dd = this.dragDrop;\n\t\t// Get ghost from lineEditor\n\t\tdd.ghost = dd.lineEditor.$.ghost;\n\n\t\tthis.lineModelsByKey = this.groupModel.quoteModel.lineModelsByKey;\n\n\t\tdd.dragKeys = [];\n\t\tdd.dragStandardIndexes = [];\n\t\tdd.dragMdqIndexesByDim = {};\n\t\tdd.dragLineModels = [];\n\t\tdd.dragGroupModel = dragElement.lineModel.groupModel;\n\n\t\t/*Set DragDropModel Instance Variables(dragKeys, dragLineModels, dragIndexes, & dragTargetElementIndex) */\n\t\tdd.dragKeys.push(dragElement.lineModel.lineVO.key);\n\t\t//Run only if keep bundle together setting is true.\n\t\tif (dd.keepBundleTogether)\n\t\t\tthis._getBundleWithChildren(dd.dragKeys[0], dd.dragKeys);  //Update list of dragged elements' line keys\n\n\t\tdd.dragKeys.forEach(function(key){   //Update list of dragged elements' line models\n\t\t\tlet lm = this.lineModelsByKey[key];\n\t\t\tdd.dragLineModels.push(lm);\n\t\t\tif (!this.lineModelsByKey[key].segmented) {\n\t\t\t\tdd.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines, key));\n\t\t\t} else {\n\t\t\t\tif (dd.dragMdqIndexesByDim[lm.dimensionType]) {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key));\n\t\t\t\t} else {\n\t\t\t\t\tdd.dragMdqIndexesByDim[lm.dimensionType] = [this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[lm.dimensionType], key)];\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tdd.dragTargetElementIndex = this._getLineIndexFromKey(this.groupModel.standardLines, dragElement.lineModel.lineVO.key );\n\n\t\t//Toggle 'hidden' attribute true to hide standard rows being dragged from page.\n\t\tfor(let j = 0, index; j < dd.dragStandardIndexes.length; j++){\n\t\t\tindex = dd.dragStandardIndexes[j];\n\t\t\tthis.set(`groupModel.standardLines.${index}.hidden`, true);\n\t\t}\n\n\t\t//Toggle 'hidden' attribute true to hide mdq rows being dragged from page.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor(let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++){\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdd.ghostField = dragElement.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD];\n\t}\n\n\ttrackFunc(hoverElement) {\n\t\tlet dd = this.dragDrop,\n\t\t\tkeepBundleTogether = this.groupModel.editorModel.data.settings.bundleKeptTogether,\n\t\t\tlastIndex = this.groupModel.standardLines.length - 1;\n\n\t\thoverElement = dd._findTableRowValidTarget(hoverElement);\n\t\tif (!hoverElement) {\n\t\t\tdd.hoverOver = null;\n\t\t\treturn;\n\t\t}\n\t\tswitch (dd.targetClass) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd._updateTableRowHoverOverObject(hoverElement, lastIndex);\n\t\t\t\tif (!dd.hoverOver) {return;}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.domHost;\n\t\t\t\tdd.usePlaceholder = true;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tdd.hoverOver = dd.sourceElement.lineModel.component ? null : {\"comp\": hoverElement};\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tif (!isComponent(dd.sourceElement)) {\n\t\t\t\t\tdd.hoverOver =  {\"comp\": hoverElement};\n\t\t\t\t} else {\n\t\t\t\t\tdd.hoverOver = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdd.targetHost = dd.hoverOver.comp.parentNode.parentNode;\n\t\t\t\tdd.usePlaceholder = false;\n\t\t\t\tdd.enableHighLight = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdropFunc(dragElement, dropElement, className, dropElementBefore) {\n\t\tlet dropLeGroup,\n\t\t\tdragLeGroup = dragElement.domHost.domHost,\n\t\t\tdd = this.dragDrop;\n\t\tdd.dropKey = null;\n\t\tdd.dropIndex = null;\n\t\tdd.dropGroupModel = null;\n\t\t//  Unhide standard rows being dragged.\n\t\tfor(let k = 0, indH, l = dd.dragStandardIndexes ? dd.dragStandardIndexes.length : 0; k < l; k++){\n\t\t\tindH = dd.dragStandardIndexes[k];\n\t\t\tthis.set(`groupModel.standardLines.${indH}.hidden`, false);\n\t\t}\n\t\t//  Unhide segmented rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!dropElement) return;\n\t\t// Update the subscription scope editable property to determine whether to display the 'Percent of Total Scope'\n\t\tif (dragElement.lineModel.subscriptionScopeEditable) {\n\t\t\tdd.dragGroupModel._updateStandardSubscriptionScopeEditable(dragElement.lineModel);\n\t\t\tthis._setFieldNames();\n\t\t\tthis._setColumnWidths();\n\t\t}\n\t\t//  Remove standard rows being dragged.\n\t\tthis.splice('groupModel.standardLines', dd.dragTargetElementIndex, dd.dragStandardIndexes.length);\n\n\t\tswitch(className) {\n\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\tdd.dropKey = dropElement.lineModel.lineVO.key;\n\t\t\t\tdd.dropGroupModel = dropElement.lineModel.groupModel;\n\t\t\t\tdd.dropIndex = this._getLineIndexFromKey(dd.dropGroupModel.standardLines, dd.dropKey);\n\t\t\t\tdropLeGroup = dropElement.domHost.domHost;\n\t\t\t\tif (dropElementBefore){\n\t\t\t\t\tdd.dropIndex = dd.dropIndex >= 0 ? dd.dropIndex : 0;\n\t\t\t\t} else{\n\t\t\t\t\t++ dd.dropIndex;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\tdropLeGroup = dropElement.parentNode.parentNode.parentNode.host ? dropElement.parentNode.parentNode.parentNode.host : dropElement.parentNode.parentNode.parentNode;\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\tlet dropGroupId = 'Group' + dropElement.getAttribute('id');\n\t\t\t\tlet groupContainer = dd._findParentCustomElement(dropElement, 'groupContainer','id');\n\t\t\t\tdropLeGroup = groupContainer.querySelector(`#${dropGroupId}`);\n\t\t\t\tdd.dropGroupModel = dropLeGroup.groupModel;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let l = 0; l < dd.dragLineModels.length; l ++) {\n\t\t\t//Splice into new location\n\t\t\tif (!dd.dragLineModels[l].segmented) {\n\t\t\t\tif (dd.dragLineModels[l].subscriptionScopeEditable) {\n\t\t\t\t\tdd.dropGroupModel.standardSubscriptionScopeEditable = true;\n\t\t\t\t\tPolymer.RenderStatus.afterNextRender(Polymer.dom(dropLeGroup.root).querySelector('#standardLines'), () => {\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setFieldNames();\n\t\t\t\t\t\tPolymer.dom(dropLeGroup.root).querySelector('#standardLines')._setColumnWidths();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tswitch(className) {\n\t\t\t\t\tcase 'sb-droppable-standardRows':\n\t\t\t\t\t\tdropElement.domHost.splice('groupModel.standardLines', dd.dropIndex, 0, dd.dragLineModels[l]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'sb-droppable-emptyTable':\n\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'sb-droppable-sidePanelGroups':\n\t\t\t\t\t\tdropLeGroup.push('groupModel.standardLines', dd.dragLineModels[l]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Update line model's group properties\n\t\t\t\tdd.dragLineModels[l].groupModel = dd.dropGroupModel;\n\t\t\t\tdd.dragLineModels[l].lineVO.parentGroupKey = dd.dropGroupModel.groupKey;\n\t\t\t\tdd.dropIndex++;\n\t\t\t} else {\n\t\t\t\tif (dd.dragGroupModel.groupKey === dd.dropGroupModel.groupKey) return;  //  Only add segment row if group is different\n\t\t\t\tif (!dd.dropGroupModel.dimensions.includes(dd.dragLineModels[l].segmentType)) {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToEmptyTable(dd.dragLineModels[l]);\n\t\t\t\t} else {\n\t\t\t\t\tdropLeGroup.addSegmentedLineToExistingTab(dd.dragLineModels[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//  Remove mdq rows being dragged.\n\t\tif (Object.keys(dd.dragMdqIndexesByDim).length != 0 ) {\n\t\t\tfor (let k in dd.dragMdqIndexesByDim) {\n\t\t\t\tdd.dragMdqIndexesByDim[k].reverse();\n\t\t\t\tfor (let l = 0, index; l < dd.dragMdqIndexesByDim[k].length; l++) {\n\t\t\t\t\tindex = dd.dragMdqIndexesByDim[k][l];\n\t\t\t\t\tthis.set(`groupModel.segmentedLinesByDimension.${k}.${index}.hidden`, false);\n\t\t\t\t\tif(dd.dragGroupModel.groupKey !== dd.dropGroupModel.groupKey){  //  Only remove segment row if group is different\n\t\t\t\t\t\tlet mdqLm = dragLeGroup.groupModel.segmentedLinesByDimension[k][index];\n\t\t\t\t\t\tdragLeGroup.removeSegmentedLine(mdqLm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.fire('renumber-lines');\n\t\tif (this.editorModel.data.settings.usesClientCalculator) {\n\t\t\t// Must be called for cloneLines to work with JSQC, passes in true for deep renumbering\n\t\t\tthis.editorModel.quoteModel.renumberIndexes(true);\n\t\t}\n\t}\n\n\t_getBundleWithChildren(key, keyArray) {\n\t\tlet length;\n\t\tif (this.dragDrop.linesByParentKey[key]) {\n\t\t\tlength = this.dragDrop.linesByParentKey[key].length;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tfor (let j = 0; j < length; j ++) {\n\t\t\tlet nextKey = this.dragDrop.linesByParentKey[key][j].lineVO.key;\n\t\t\tkeyArray.push(nextKey);\n\t\t\tif (this.dragDrop.linesByParentKey[nextKey]){\n\t\t\t\tthis._getBundleWithChildren(nextKey, keyArray);\n\t\t\t}\n\t\t}\n\t}\n\n\t_getLineIndexFromKey(/*Standard Lines Array*/ lines, /*Array of line keys*/ key) {\n\t\tlet index;\n\t\tfor (let i = 0; i < lines.length; i++){\n\t\t\tif (lines[i].lineVO.key === key){\n\t\t\t\tindex = i;\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getStandardLineIndexesFromKeys(/*Standard Lines Array*/ lines, /*Array of line keys*/ keys) {\n\t\tlet indexes = [];\n\t\tfor(let j = 0; j < keys.length; j++){\n\t\t\tindexes.push(this._getStandardLineIndexFromKey(lines, keys[j]));\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t/**\n\t * Assigns fields to the table by viewport. Users can create fieldsets for tablet and phone separately.\n\t * We honor these user created fieldsets by this logic.\n\t * @private\n\t */\n\t_setFieldNames() {\n\t\tthis.fieldSet = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tif (this.fieldSetName != this.fieldSet.name) {\n\t\t\tthis.fieldSetName = this.fieldSet.name;\n\t\t}\n\t\tthis.fieldNames = this._getFields();\n\t}\n\n\t_getFields() {\n\t\treturn this.groupModel.standardSubscriptionScopeEditable ? [this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields) : this.fieldSet.fields;\n\t}\n\n\t/**\n\t * Updates fieldset assignment at viewport change\n\t */\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t\tthis._setFieldNames();\n\t}\n\n\t/**\n\t * Updates column width assignments on group panel toggle\n\t * @param e\n\t */\n\tgroupPanelToggled(e) {\n\t\tthis.drawerState = e.detail.drawerState;\n\t\tthis._setColumnWidths();\n\t}\n\n\tgroupPanelCreated(e) {\n\t\tthis._setColumnWidths();\n\t}\n\n\t/**\n\t * Catches \"table-header-sort-clicked\" event fired from le-table-header-cell child element\n\t *  1. Sends stand line items model to 'QuoteLineSort' module to be sorted based on a field.\n\t *  2. Update rendering of line models.\n\t *\n\t * @param e      - \"table-header-sort-clicked\" event\n\t * @private\n\t */\n\t_onSortLinesByHeader(e) {\n\t\t// Call tree sorting function\n\t\tlet bundleKeptTogether = this.editorModel.data.settings.bundleKeptTogether;\n\t\tthis.sortLines(this.groupModel.standardLines, e.detail.field, e.detail.order, bundleKeptTogether, true);\n\t}\n\n\tsortLinesRequired(e) {\n\t\tlet notify = e.detail.notify;\n\t\tlet lineSortField = e.detail.lineSortField;\n\t\tthis.sortLines(this.groupModel.standardLines, lineSortField, 'asc', false, notify);\n\t}\n\n\tsortLines(lines, lineSortField, order, bundleKeptTogether, notify) {\n\t\tlet nameField;\n\t\tif(lineSortField && this.settings.lineLookups[lineSortField]) {\n\t\t\t// If this is a lookup field, we need to grab the name field and relationship field so that we can sort correctly\n\t\t\t// Split the relationship field with the lookup name field so we can look at correct data when sorting\n\t\t\tlet lineSortRelationshipField = RelationshipFieldManager.getRelationshipField(lineSortField, this.settings.lineLookups[lineSortField]),\n\t\t\t\tfieldNames = lineSortRelationshipField.split(\".\")\n\t\t\tnameField = fieldNames[1]; // \"Name\", for example\n\t\t\tlineSortField = fieldNames[0]; // \"Product__r\", for example\n\t\t}\n\t\tlet model = depthFirstLineItemsTreeSort(lines, lineSortField, order, bundleKeptTogether, nameField);\n\t\tif (notify) {\n\t\t\tthis.set('groupModel.standardLines', model.slice());\n\t\t} else {\n\t\t\tthis.groupModel.standardLines = model;\n\t\t}\n\t}\n\n\t_updatePrimaryMobileColumns() {\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(this.groupModel.editorModel.standardPrimaryMobileCols && this.groupModel.editorModel.standardPrimaryMobileCols.length > 0 && this.fieldSet.name.endsWith('Phone'))\n\t\t\tthis.groupModel.editorModel.standardPrimaryMobileCols[0] = this.fieldSet.fields[0];\n\t}\n\n\t_lineSplicesListener(changeRecord) {\n\t\tif(!changeRecord) return;   //when a new groupModel is assigned, changeRecord is undefined\n\t\tthis.set('groupModel.hasVisibleStandardLines', this.groupModel._groupHasStandardProducts());\n\t\tthis._showSubtotal();\n\t}\n}\n\nPolymer( StandardLines );","import {ProductViewModel} from 'products/config/viewmodel/ProductViewModel.js'\n\nexport class ProductMessenger {\n\n\tconstructor(quote, product, prefix, currencyIsoCode, extender) {\n\t\tthis.quote = quote;\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.extender = extender;\n\t\tthis.currencyIsoCode = currencyIsoCode;\n\t\tif(this.product && !this.product.initialized)\n\t\t\tthis._initializeProduct(this.product);\n\t}\n\n\tgetRequest() {\n\t\tlet message = {quote: this.quote.record};\n\n\t\tif(!this.product)\n\t\t\treturn message;\n\n\t\tmessage.product = {\n\t\t\tconfiguredProductId: this.product.configuration.configuredProductId,\n\t\t\tlineItemId: this.product.configuration.lineItemId,\n\t\t\tlineKey: this.product.configuration.lineItemKey,\n\t\t\tconfigurationAttributes: this._createConfigAttributesMap(),\n\t\t\toptionConfigurations: this._createFeatureOptionsMap(),\n\t\t\tconfigurationData: {} // Empty object which ultimately maps to externalConfigurationData\n\t\t};\n\t\tmessage.products = [];\n\n\t\tthis._appendReadOnlyProperties(message, this.product.configuration);\n\t\treturn message;\n\t}\n\n\tgetResponse(message) {\n\t\tif(!message)\n\t\t\treturn;\n\n\t\tlet clones = [];\n\t\tif(message.products) {\n\t\t\t// create the appropriate number of clones from the base product before merging changes into the base product\n\t\t\tfor(let i = 0, l = message.products.length; i < l; i++)\n\t\t\t\tclones.push(this._cloneProduct(i));\n\t\t}\n\n\t\tthis._extendResponseQuote(message.quote);\n\t\tthis._extendResponseProduct(this.product, message.product);\n\n\t\treturn {\n\t\t\tquote: this.quote,\n\t\t\tproduct: this.product,\n\t\t\tproducts: this._extendResponseProducts(message.products, clones),\n\t\t\toptionNotifications: this._getResponseOptionPaths()\n\t\t};\n\t}\n\n\t/** getRequest helper methods **/\n\n\t_appendReadOnlyProperties(obj, config) {\n\t\tobj.readOnly = {};\n\t\tlet line = this._getMatchingQuoteLine(config);\n\t\tif(line) obj.readOnly.line = line.record;\n\t}\n\n\t_getMatchingQuoteLine(config) {\n\t\tif(config == null || config.lineItemKey == null)\n\t\t\treturn null;\n\n\t\tlet lines = this.quote.lineItems.filter(function(line) {\n\t\t\treturn line.key === config.lineItemKey;\n\t\t}.bind(this));\n\n\t\treturn lines.length === 1 ? lines[0] : null;\n\t}\n\n\t_createConfigAttributesMap() {\n\t\tvar map = {};\n\t\tfor (let i = 0, l = this.product.configurationAttributes.length; i < l; i++)\n\t\t\tmap[this.product.configurationAttributes[i].targetFieldName] = null;\n\n\t\tthis.extender.extend(map, this.product.configuration.configurationData);\n\t\treturn map;\n\t}\n\n\t// This doesn't support nested bundles or available options in an option selection method 'Add' feature (or dynamic feature)\n\t_createFeatureOptionsMap() {\n\t\tlet featuresMap = {};\n\t\tlet features = this.product.features;\n\t\tfor (let i = 0, l= features.length; i < l; i++) {\n\t\t\tvar featureName = features[i].record.Name;\n\t\t\tfeaturesMap[featureName] = [];\n\t\t\tlet optionConfigurations = features[i]._transient_.optionConfigurations;\n\t\t\tif (optionConfigurations)\n\t\t\t\tfor (let j = 0, ll = optionConfigurations.length; j < ll; j++)\n\t\t\t\t\tfeaturesMap[featureName].push(this._createPseudoOptionConfiguration(optionConfigurations[j]));\n\t\t}\n\t\treturn featuresMap;\n\t}\n\n\t_createPseudoOptionConfiguration(optionConfiguration) {\n\t\tlet pseudoOptionConfig =  {\n\t\t\toptionId: optionConfiguration.record.Id,\n\t\t\tselected: optionConfiguration.selected,\n\t\t\tProductCode: optionConfiguration.record[this.prefix + 'ProductCode__c'],\n\t\t\tProductName: optionConfiguration.record[this.prefix + 'ProductName__c'],\n\t\t\tQuantity: optionConfiguration.record[this.prefix + 'Quantity__c'],\n\t\t\tconfigurationData: {}\n\t\t};\n\t\tthis._appendReadOnlyProperties(pseudoOptionConfig, optionConfiguration);\n\t\treturn pseudoOptionConfig;\n\t}\n\n\t/** getResponse helper methods **/\n\n\t_extendResponseQuote(responseQuote) {\n\t\tif(responseQuote != null)\n\t\t\tthis.extender.extend(this.quote.record, this._sanitizeObject(responseQuote));\n\t}\n\n\t_extendResponseProduct(product, responseProduct, productKey) {\n\t\tif(!responseProduct)\n\t\t\treturn;\n\n\t\tthis._extendResponseConfigurationData(product, responseProduct.configurationData);\n\t\tthis._extendResponseConfigurationAttributes(product, responseProduct.configurationAttributes);\n\t\tthis._extendResponseOptionConfigurations(product, responseProduct.optionConfigurations, productKey);\n\t}\n\n\t_extendResponseConfigurationData(product, responseConfigurationData) {\n\t\tif(responseConfigurationData != null)\n\t\t\tthis.extender.extend(product.configuration.externalConfigurationData, this._sanitizeObject(responseConfigurationData));\n\t}\n\n\t_extendResponseConfigurationAttributes(product, responseConfigurationAttributes) {\n\t\tif(responseConfigurationAttributes != null)\n\t\t\tthis.extender.extend(product.configuration.configurationData, this._sanitizeObject(responseConfigurationAttributes));\n\t}\n\n\t_extendResponseOptionConfigurations(product, responseOptionConfigurations, parentProductKey) {\n\t\t// first build map by option Id of the response options\n\t\tlet responseOptionConfigurationsByOptionId = {};\n\t\tfor(let feature in responseOptionConfigurations) {\n\t\t\tlet featureOptionConfigurations = responseOptionConfigurations[feature];\n\t\t\tfor(let optionConfiguration of featureOptionConfigurations) {\n\t\t\t\tlet optionId = optionConfiguration.optionId;\n\t\t\t\tif(optionId) responseOptionConfigurationsByOptionId[optionId] = optionConfiguration;\n\t\t\t}\n\t\t}\n\n\t\t// now loop over the product options and update quantity, selected, and external config data from the response options\n\t\tlet options = product.options;\n\t\tfor(let option of options) {\n\t\t\tlet sourceOption = responseOptionConfigurationsByOptionId[option.record.Id];\n\t\t\tif(!sourceOption)\n\t\t\t\tcontinue;\n\n\t\t\tif(parentProductKey)\n\t\t\t\toption.parentProductKey = parentProductKey;\n\t\t\tif(sourceOption.configurationData != null) {\n\t\t\t\toption.externalConfigurationData = option.externalConfigurationData || {};\n\t\t\t\tthis.extender.extend(option.externalConfigurationData, this._sanitizeObject(sourceOption.configurationData));\n\t\t\t}\n\n\t\t\tif(sourceOption.selected != null)\n\t\t\t\toption.selected = sourceOption.selected;\n\n\t\t\tif(sourceOption.Quantity != null && option.selected)\n\t\t\t\toption.record[this.prefix + 'Quantity__c'] = sourceOption.Quantity;\n\t\t}\n\t}\n\n\t_extendResponseProducts(responseProducts, clones) {\n\t\tif(!responseProducts || responseProducts.length === 0)\n\t\t\treturn [];\n\n\t\tlet products = [];\n\t\tfor(let i = 0, l = responseProducts.length; i < l; i++) {\n\t\t\tlet product = clones[i];\n\t\t\tthis._extendResponseProduct(product, responseProducts[i], product.productKey);\n\t\t\tthis._resetFeatureOptionConfiguration(product);\n\t\t\tproducts.push(product);\n\t\t}\n\t\treturn products;\n\t}\n\n\t_cloneProduct(index) {\n\t\tlet clone = JSON.parse(JSON.stringify(this.product)); // clones the product\n\t\t// assign the clone a unique product key to distinguish this cloned product in the configurator from its source product\n\t\t// as the source product and its clone will always have the same record Id\n\t\tclone.productKey = this._buildProductKey(this.product.record.Id, index);\n\t\tthis._enableSaveToLineEditor(clone);\n\t\treturn clone;\n\t}\n\n\t_buildProductKey(productId, index) {\n\t\tlet prefix = index < 10 ? '00' : (index < 100 ? '0' : '');\n\t\tlet suffix = prefix + index;\n\t\treturn productId.substring(0, 15) + suffix;\n\t}\n\n\t_enableSaveToLineEditor(clone) {\n\t\t// in order to save this cloned product to the line editor, we must nil out the lineItemKey and the lineItemId\n\t\tclone.configuration.lineItemKey = null; // simply null this out since its a Integer type on server\n\t\tdelete clone.configuration.lineItemId; // must delete this as its an Id type on server (so can't null it out)\n\t}\n\n\t_resetFeatureOptionConfiguration(product) {\n\t\t// first clear all feature option configurations\n\t\tlet features = product.features || [];\n\t\tfor(let feature of features)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\t// now sync the feature option configurations by simply instantiating a ProductViewModel\n\t\t// if we don't do this and this cloned product is never selected in the configurator, then the cloned product will not save properly\n\t\tthis._initializeProduct(product);\n\t}\n\n\t_initializeProduct(product) {\n\t\tlet prefix = this.prefix.endsWith('__') ? this.prefix.substring(0, this.prefix.length - 2) : this.prefix;\n\t\tnew ProductViewModel(this.quote.record.Id, product, prefix, this.quote.record.CurrencyIsoCode);\n\t}\n\n\t_getResponseOptionPaths() {\n\t\treturn ['selected', `record.${this.prefix}Quantity__c`];\n\t}\n\n\t_sanitizeObject(object) {\n\t\treturn JSON.parse(JSON.stringify(object, function(key, value) {\n\t\t\tif(key.endsWith('__c') && value instanceof Object) // custom fields cannot have an object value\n\t\t\t\treturn JSON.stringify(value);\n\t\t\treturn value;\n\t\t}));\n\t}\n}\n","export class ConfiguratorSearch {\n\tconstructor(searchFilters, prefix) {\n\t\tthis.searchFilters = searchFilters;\n\t\tthis.prefix = prefix;\n\t}\n\n\tcontainsFeature(feature) {\n\t\tlet featureInput = this.searchFilters[this.prefix + 'Feature__c'];\n\t\tif (featureInput !== null && featureInput !== undefined)\n\t\t\treturn ((feature.record.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 )||\n\t\t\t\t\t(feature.untranslatedRecord !== undefined && feature.untranslatedRecord.Name.toLowerCase().indexOf(featureInput.toLowerCase()) !== -1 ));\n\t\treturn true;\n\t}\n\n\thasVisibleOptions(options) {\n\t\tlet allFiltered = true;\n\t\tif (options.length > 0) {\n\t\t\tfor (let i = 0, numOptions = options.length; i < numOptions; i++) {\n\t\t\t\tif (!options[i].hidden) {\n\t\t\t\t\tallFiltered = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !allFiltered;\n\t\t}\n\t\treturn !this.hasFilterValues();\n\t}\n\n\tallOptionsHiddenByRule(options) {\n\t\tlet allFiltered = true;\n\t\tfor (let option of options) {\n\t\t\tif (option.hiddenByRule === false || option.hiddenByRule == null) {\n\t\t\t\tallFiltered = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn allFiltered;\n\t}\n\n\thasRequiredConfigAttributes(feature, model) {\n\t\tlet configAttributes = model.configAttributesByFeatureId[feature.record.Id];\n\t\tif (configAttributes) {\n\t\t\tfor (let configAttr of configAttributes)\n\t\t\t\tif (configAttr.required)\n\t\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\thasConfigAttributes(feature, model) {\n\t\treturn model.configAttributesByFeatureId[feature.record.Id] ? true : false;\n\t}\n\n\tsetOptionVisibility(options) {\n\t\tlet _options = JSON.parse(JSON.stringify(options));\n\t\t//let _options = Object.assign({}, options);\n\t\tfor (let i = 0, numOptions = _options.length; i < numOptions; i++) {\n\t\t\tlet filtered = false;\n\t\t\tif(_options[i].record[this.prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\t_options[i].hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(_options[i].isUpgrade) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet searchKeys = Object.keys(this.searchFilters);\n\t\t\tfor (let j = 0, numFilters = searchKeys.length; j < numFilters; j++) {\n\t\t\t\tlet filter = searchKeys[j];\n\t\t\t\tlet filterValue = this.searchFilters[filter];\n\t\t\t\tif (filter === this.prefix + 'Feature__c')\n\t\t\t\t\tcontinue;\n\t\t\t\tif (filterValue !== null &&\n\t\t\t\t\t(_options[i].record[filter] && _options[i].record[filter].toLowerCase().indexOf(filterValue.toLowerCase()) === -1) &&\n\t\t\t\t\t(_options[i].untranslatedRecord[filter] === undefined || _options[i].untranslatedRecord[filter].toLowerCase().indexOf(filterValue.toLowerCase()) === -1)) {\n\t\t\t\t\tfiltered = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t_options[i].hidden = _options[i].hiddenByRule || filtered;\n\t\t}\n\t\treturn _options;\n\t}\n\n\thasFilterValues() {\n\t\tfor (let filter in this.searchFilters) {\n\t\t\tif (this.searchFilters[filter] !== null)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}","import {LocalizeFields} from 'products/localization/LocalizeFields.js';\n\nexport class ProductViewModel {\n\tconstructor(qId, product, prefix, currencyIsoCode, fId) {\n\t\tthis.init(product, qId, prefix, currencyIsoCode, fId);\n\t}\n\n\tinit(product, qId, prefix, currencyIsoCode, fId) {\n\t\tthis.product = product || this.product;\n\t\tthis.qId = qId || this.qId; // Quote Id\n\t\tthis.prefix = prefix ? (prefix + '__') : (this.prefix || '');\n\t\tthis.currencyIsoCode = currencyIsoCode || this.currencyIsoCode;\n\t\tthis.featureLookupId =  fId || this.featureLookupId; // refers to the Feature that drives the Option Lookup Page\n\t\tthis.optionsById = {}; // Map that organizes Options by Option Id\n\t\tthis.optionIndexById = {}; // Map that organizes option-indeces by Id\n\t\tthis.optionsByFeatureId = {}; // Map that organizes Options by Feature Id\n\t\tthis.featuresWithOptionsOrConfigAttr = []; // List of Features with at least one Option or a Configuration Attribute\n\t\tthis.featureIdsWithOptionsOrConfigAttr = {};\n\t\tthis.featureIdsWithSelectionMethodAdd = {}; // List of Feature Ids for features with optionSelectionMethod 'Add'\n\t\tthis.featureIdsWithSelectionMethodClick = {}; // List of Feature Ids for features with optionSelectionMethod 'Click'\n\t\tthis.featureIdsWIthSelectionMethodDynamic = {}; // List of Feature Ids for features with optionSelectionMethod 'Dynamic'\n\t\tthis.configAttributesByFeatureId = {}; // Map that organizes Configuration Attributes by Feature Id\n\t\tthis.configurationAttributeValueMap = {}; // Map that stores configuration attributes to values\n\t\tthis.configurationAttributeModelMap = {}; //Map that organizes useful information about Configuration Attributes\n\t\tthis.configurationAttributeTargetFieldMap = {}; // Map of target fields to its list of configuration attributes ids\n\t\tthis.configurationAttributeApplyToOptionMap = {}; // Map of the configuration attributes that apply to product options for the bundle\n\t\tthis.optionActionsByOptionId = {}; // Map that organizes Option Actions by Option Id\n\t\tthis.attributeValueMap = {}; // Map of Configuration Attributes by field name so that value is shared across common fields\n\t\tthis.productRulesActions = {}; // Map of required actions generated by product rules\n\t\tthis.originalDataByOptionIds = {}; //Map of optionIds to its original price, discount amount, and discount rate\n\t\tthis.optionDataByOptionIds = {}; // Map of optionIds to its updated optionData\n\t\tthis.featureIdByOptionId = {}; //Map of optionIds to their corresponding featureIds\n\t\tthis.productOptionConfigurationsMap = {}; //Map of the product.configuration.optionConfigurations by option Id\n\t\tthis.initializeProduct();\n\t\tthis.product.initialized = true;\n\t}\n\n\tgetFeature(featureId) {\n\t\tif (featureId === undefined || featureId === 'null')\n\t\t\tfeatureId = null;\n\t\treturn this.product.features.find(feature => feature.record.Id === featureId);\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.optionsById[optionId];\n\t}\n\n\tgetOptionsByFeatureId(featureId) { // Used by the Product Option Table to display the options insides each Feature Table\n\t\tif (featureId === null || featureId === 'null')\n\t\t\tfeatureId = 'Other';\n\n\t\tif (this.isOptionLookupViewModel()) {\n\t\t\t//option lookup doesn't need to bind to the original object. this allows us to bind directly to the selected property in the configurator\n\t\t\t//if slow, strip fieldSet data & id into new object instead of cloning\n\t\t\tvar options = [];\n\t\t\tthis.optionsByFeatureId[featureId].forEach( option => {\n\t\t\t\tlet dummy = JSON.parse(JSON.stringify(option));\n\t\t\t\tdummy.selected = false;\n\t\t\t\toptions.push(dummy);\n\t\t\t});\n\t\t\treturn options;\n\t\t}\n\n\t\tlet feature = this.getFeature(featureId);\n\n\t\tfor (let option of feature._transient_.optionConfigurations) {\n\t\t\tif (feature.optionSelectionMethod !== 'Click')\n\t\t\t\toption.selected = true;\n\t\t}\n\n\t\treturn feature._transient_.optionConfigurations;\n\t}\n\n\tmaxOptionsMet(feature) {\n\t\tlet maxOptions = this.prefix + 'MaxOptionCount__c';\n\t\treturn feature._transient_.optionConfigurations.length >= feature.record[maxOptions];\n\t}\n\n\tsetOptionSelected(optionId, selected) {\n\t\tlet option = this.optionsById[optionId],\n\t\t\tisClick = this.featureIdsWithSelectionMethodClick[this.featureIdByOptionId[optionId]];\n\t\tif (!option.record[this.prefix + 'Required__c'] && isClick) // This code is hacked in because TableRow fired a selection change during initialization that sets selected to false\n\t\t\toption.selected = selected;\n\t}\n\n\tsetConfigurationAttributesToOptions(option) {\n\t\tfor(let attribute in this.configurationAttributeApplyToOptionMap)\n\t\t\toption.record[attribute] = this.product.configuration.configurationData[attribute]\n\t}\n\n\tgetOptionLayout() {\n\t\tlet optionLayout = this.prefix + 'OptionLayout__c';\n\t\treturn this.product.record[optionLayout] || 'Sections';\n\t}\n\n\tgetTabFeaturesMap() {\n\t\tlet featureCategoryLabels = this.product.featureCategoryLabels;\n\n\t\tlet featuresWithoutCategory = this.featuresWithOptionsOrConfigAttr.filter(feature => {\n\t\t\treturn feature.record[this.prefix + 'Category__c'] === undefined;\n\t\t});\n\t\tlet tabFeaturesMap = {};\n\t\t//Displays features as tabs (tabs without categories).\n\t\tlet featuresLength = this.featuresWithOptionsOrConfigAttr.length;\n\n\t\tif (featuresLength === featuresWithoutCategory.length) {\n\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\ttabFeaturesMap[feature.record.Name] = [feature];\n\t\t\t});\n\t\t} else {\n\t\t\t// loop through categories to ensure we add category names as keys to the tabFeaturesMap in the correct order\n\t\t\t// ordering matters as an Object.keys call on this map upstream will return an array of keys in the same order\n\t\t\t// in which the keys were added to the object - W-3534213\n\t\t\tthis.product.featureCategories.forEach(category => {\n\t\t\t\tthis.featuresWithOptionsOrConfigAttr.forEach(feature => {\n\t\t\t\t\tlet featureCategory = feature.record[this.prefix + 'Category__c'];\n\n\t\t\t\t\tif (featureCategory === undefined)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif (featureCategory === featureCategoryLabels[category])\n\t\t\t\t\t\ttabFeaturesMap[category] !== undefined ? tabFeaturesMap[category].push(feature) : tabFeaturesMap[category] = [feature];\n\t\t\t\t});\n\t\t\t});\n\t\t\tif (featuresWithoutCategory.length !== 0) {\n\t\t\t\ttabFeaturesMap[\"Other\"] = (tabFeaturesMap[\"Other\"] || []);\n\t\t\t\ttabFeaturesMap[\"Other\"] = tabFeaturesMap[\"Other\"].concat(featuresWithoutCategory);\n\t\t\t}\n\t\t}\n\t\treturn tabFeaturesMap;\n\t}\n\n\tcheckAtLeastOneFeatureHasCategory() {\n\t\treturn !!this.featuresWithOptionsOrConfigAttr.find(feature =>\n\t\t\tfeature.record[this.prefix + 'Category__c'] != null && feature.record[this.prefix + 'Category__c'] !== 'Other'\n\t\t);\n\t}\n\n\tisAppliedImmediately(optionId) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c';\n\t\treturn this.getOption(optionId).record[appliedImmediately];\n\t}\n\n\tinitializeProduct() {\n\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\tthis.product = this.localizer.localizeProduct(this.product);\n\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tselectedOptions = [];\n\n\n\t\tif (!this.featureLookupId) {\n\t\t\tthis.initConfigAttributesById();\n\t\t\tthis.initConfigurationAttributeMap();\n\t\t}\n\n\t\tfor (let option of this.product.options)\n\t\t\tthis.initOptionInfo(option, selectedOptions);\n\n\t\tthis.buildOptionConfigurationMap();\n\n\t\tfor (let feature of this.product.features) {\n\t\t\tfeature.optionSelectionMethod = this.getOptionSelectionMethod(feature);\n\t\t\tif (!feature._transient_)\n\t\t\t\tfeature._transient_ = {};\n\t\t\tthis.initFeatureOptionConfigurations(feature);\n\n\t\t\tif (this.optionsByFeatureId[feature.record.Id] || this.configAttributesByFeatureId[feature.record.Id] || feature.optionSelectionMethod === 'Dynamic') {\n\t\t\t\tthis.featuresWithOptionsOrConfigAttr.push(feature);\n\t\t\t\tthis.featureIdsWithOptionsOrConfigAttr[feature.record.Id] = feature;\n\t\t\t\tif (feature.optionSelectionMethod === 'Add')\n\t\t\t\t\tthis.featureIdsWithSelectionMethodAdd[feature.record.Id] = true;\n\t\t\t\tif (feature.optionSelectionMethod === 'Click')\n\t\t\t\t\tthis.featureIdsWithSelectionMethodClick[feature.record.Id] = true;\n\t\t\t\tif (feature.optionSelectionMethod === 'Dynamic')\n\t\t\t\t\tthis.featureIdsWIthSelectionMethodDynamic[feature.record.Id] = true;\n\t\t\t}\n\t\t}\n\n\t\tfor (let option of selectedOptions) { // set added and disabledData for added options\n\t\t\tlet feature = this.getFeature(option.record[featureLabel] || 'Other'), configuredOption;\n\t\t\tif (option.selectionType === 'radio' && option.hidden && feature.visibleSelected)\n\t\t\t\t\toption.selected = false; // don't selected hidden options in radio feature if visible option selected\n\t\t\tif (this.getOptionSelectionMethod(feature) === 'Add') {\n\t\t\t\tconfiguredOption = feature._transient_.optionConfigurations.find(function (opt) { return opt.record.Id === option.record.Id; });\n\t\t\t\tif (!configuredOption) {\n\t\t\t\t\tfeature._transient_.optionConfigurations.push(option);\n\t\t\t\t} else {// On reconfigure, following data needs to be defined for duplicate added option in configurator as well as in option lookup\n\t\t\t\t\tconfiguredOption.added = true;\n\t\t\t\t\tconfiguredOption.configured = option.configured;\n\t\t\t\t\tthis.setOptionDisabledData(configuredOption);\n\t\t\t\t}\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tthis.setOptionDisabledData(option);\n\t\t}\n\t}\n\n\tinitOptionInfo(option, selectedOptions) {\n\t\tlet featureLabel = this.prefix + 'Feature__c',\n\t\t\tquantityLabel = this.prefix + 'Quantity__c',\n\t\t\tminQuantityLabel = this.prefix + 'MinQuantity__c',\n\t\t\trecordSelected = this.prefix + 'Selected__c',\n\t\t\trecordRequired = this.prefix + 'Required__c',\n\t\t\tunitPrice = this.prefix + 'UnitPrice__c',\n\t\t\tfeatureId = option.record[featureLabel] || 'Other';\n\n\t\t//configuration attributes can be configured so that the value in them is applied to all the options\n\t\tthis.setConfigurationAttributesToOptions(option);\n\t\toption.valueChanged = false;\n\t\toption.record[unitPrice] = option.record[unitPrice] == null ? undefined : option.record[unitPrice];\n\t\toption.hidden = (option.hiddenByRule && option.hidden) || option.record[unitPrice] === undefined;\n\t\toption.removed = option.removed || option.selected === false && option.record[recordSelected];\n\t\toption.selected = option.selected === undefined ? ( (option.record[recordSelected] && !option.removed) || option.record[recordRequired] ) : option.selected;\n\n\t\tif (!option._transient_)\n\t\t\toption._transient_ = {};\n\n\t\tif (!option.selected)\n\t\t\tthis.setOptionDisabledData(option);\n\t\telse if (selectedOptions != null)\n\t\t\tselectedOptions.push(option); // disabledData may be derived differently for some selected options\n\n\t\tif(option.isUpgrade === true)\n\t\t\toption.hidden = true;\n\t\tif (!option.record[featureLabel] && !this.product.mappedFeaturelessOptions) {\n\t\t\tthis.product.features.push(this.createOtherOptionsFeature(this.product.virtualFeatureTitle));\n\t\t\tthis.product.mappedFeaturelessOptions = true;\n\t\t}\n\t\tif (option.record[quantityLabel] === undefined) {\n\t\t\toption.recordHasQuantity = false;\n\t\t\toption.record[quantityLabel] = option.record[minQuantityLabel] === undefined ? 1 : option.record[minQuantityLabel];\n\t\t}\n\t\tif (option.record[recordRequired])\n\t\t\toption.required = true; // do this so Actions.js can know to disable trashcan without needing the prefix\n\n\t\tthis.optionsById[option.record.Id] = option;\n\t\tthis.featureIdByOptionId[option.record.Id] = featureId;\n\t\tthis.addToOptionByFeatureId(featureId, option);\n\t\tthis.originalDataByOptionIds[option.record.Id] = {\n\t\t\tunitPrice: option.record[this.prefix+'UnitPrice__c'],\n\t\t\tdiscountAmount: option.record[this.prefix+'DiscountAmount__c'],\n\t\t\tdiscountRate: option.record[this.prefix+'Discount__c'],\n\t\t\tquantity: option.record[quantityLabel]\n\t\t};\n\t}\n\n\tcreateOtherOptionsFeature(name) {\n\t\treturn {\n\t\t\taddOptionButtonLabel: \"Add Option\",\n\t\t\taddOptionDialogTitle: \"Add Option\",\n\t\t\tinstructionsText: null,\n\t\t\trecord: {\n\t\t\t\tId: 'Other',\n\t\t\t\tName: name\n\t\t\t},\n\t\t\tsearchFilters: null\n\t\t}\n\t}\n\n\tgetOptionSelectionMethod(feature) { // change to init since you are setting it in beginning\n\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn feature.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\tif (this.product.record[this.prefix + 'OptionSelectionMethod__c'] != null)\n\t\t\treturn this.product.record[this.prefix + 'OptionSelectionMethod__c'];\n\t\t//Defaults to Option Selection Method 'Click' if unspecified.\n\t\treturn 'Click';\n\t}\n\n\tsetOptionDisabledData(option, duplicate) {\n\t\t//Both properties disable manual selection. 'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t//Only non-duplicate required options or system options are DISABLED\n\t\t//Only options affected by option constraints are CONSTRAINED, which is set altered after initialization\n\t\toption.disabledData = option.disabledData || {\n\t\t\t'disabled':  ((!!option.record[this.prefix + 'Required__c'] && !option.added) || !!option.record[this.prefix + 'System__c']),\n\t\t\t'constrained': false\n\t\t};\n\t\tif (duplicate) { //Needs to run on reconfigure to allow duplicates of added required options to be deleted/selected\n\t\t\tlet original = this.optionsById[option.record.Id];\n\t\t\toriginal.disabledData = {'disabled': false, 'constrained': false};\n\t\t\toption.disabledData.disabled = false;\n\t\t}\n\t}\n\n\tinitFeatureOptionConfigurations(feature) {\n\t\tif (feature._transient_.optionConfigurations == null)\n\t\t\tfeature._transient_.optionConfigurations = [];\n\n\t\tif (this.optionsByFeatureId[feature.record.Id] == null)\n\t\t\treturn;\n\n\t\tlet displayRadio = feature.record[this.prefix + 'MaxOptionCount__c'] === 1;\n\t\tlet notInitialized = feature._transient_.optionConfigurations.length === 0;\n\t\tlet featureId = feature.record.Id || 'Other';\n\t\tlet isClick = feature.optionSelectionMethod === 'Click';\n\t\tlet isDynamic = feature.optionSelectionMethod === 'Dynamic';\n\t\tlet unsortedOptionConfigs = [];\n\t\tfor (let option of this.optionsByFeatureId[featureId]) {\n\t\t\tfeature.visibleSelected = feature.visibleSelected || (!option.hidden && option.selected);\n\t\t\toption.selectionType = displayRadio ? 'radio' : 'checkbox';\n\t\t\toption.record[this.prefix + 'ConfiguredSKU__c'] = this.product.record.Id;\n\t\t\tif (isDynamic) { // TODO: Look into this and see why these properties can be set in OptionLookup but not Dynamic Lookup\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t}\n\t\t\tif (this.featureLookupId) {\n\t\t\t\toption._transient_.rowActions = []; // define this as we have downstream observers on this property even in option lookup\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t//OptionLookup does not need to do the following\n\t\t\tthis.initOptionActions(option, !isClick);\n\t\t\tthis.initReconfiguredOption(option, feature, notInitialized, isClick, unsortedOptionConfigs);\n\t\t}\n\n\t\tif (unsortedOptionConfigs.length>0)\n\t\t\tthis.sortAndAddOptionConfigs(feature, unsortedOptionConfigs, !isClick);\n\t}\n\n\t//the product stores some attributes that are not available on the option\n\t//specifically for options that have already been configured additional properties exist under the product.optionConfigurations array\n\t//this does a mixin for all the properties\n\tsetOptionProductConfigurationData(option) {\n\t\tlet config = this.getProductOptionConfigurationData(option.record.Id, option.index);\n\t\tif (config === undefined)\n\t\t\treturn;\n\n\t\tfor (let i in config) {\n\t\t\tif (option.hasOwnProperty(i))\n\t\t\t\tcontinue;\n\n\t\t\toption[i] = config[i];\n\t\t}\n\t}\n\n\t//the product has an array of options with data that is not available on the option itself\n\t//here we setup a map for accessing that data\n\tgetProductOptionConfigurationData(optionId, index) {\n\t\tif (this.productOptionConfigurationsMap[optionId][index] !== undefined)\n\t\t\treturn this.productOptionConfigurationsMap[optionId][index];\n\t\telse\n\t\t\tthis.buildOptionConfigurationMap();\n\n\t\treturn this.productOptionConfigurationsMap[optionId][index];\n\t}\n\n\tbuildOptionConfigurationMap() {\n\t\tif (!this.product.features[0] || this.product.features[0]._transient_ != null)\n\t\t\treturn;\n\t\tfor (let optionConfiguration of this.product.configuration.optionConfigurations) {\n\t\t\tthis.productOptionConfigurationsMap[optionConfiguration.optionId] = this.productOptionConfigurationsMap[optionConfiguration.optionId] || [];\n\t\t\tthis.productOptionConfigurationsMap[optionConfiguration.optionId].push(optionConfiguration);\n\t\t}\n\t}\n\n\tinitOptionActions(option, isNotClick) {\n\t\tlet actions = [];\n\t\tif (isNotClick) {\n\t\t\tactions.push({\n\t\t\t\ticon: 'sf-icon-delete',\n\t\t\t\ttitle: 'Delete',\n\t\t\t\tposition: 'left',\n\t\t\t\tmobileDisabled: true,\n\t\t\t\thidden: false,\n\t\t\t\tinvisible: false,\n\t\t\t\tonTapFunction: function() { this.fire('delete-tapped', { Id: this.data.record.Id, index: this.index }); }\n\t\t\t});\n\t\t}\n\t\tif (option.configurable) {\n\t\t\tactions.push({\n\t\t\t\ticon: 'sf-icon-custom_apps',\n\t\t\t\ttitle: 'Configure',\n\t\t\t\tposition: 'left',\n\t\t\t\tmobileDisabled: false,\n\t\t\t\thidden: false,\n\t\t\t\tinvisible: false,\n\t\t\t\tconfigurationRequired: option.configurationRequired,\n\t\t\t\tonTapFunction: function () { this.fire('configure-tapped', { Id: this.data.record.Id, index: this.index }); }\n\t\t\t});\n\t\t} else {\n\t\t\tactions.push({\n\t\t\t\ticon: 'sf-icon-custom_apps',\n\t\t\t\ttitle: 'Configure',\n\t\t\t\tposition: 'left',\n\t\t\t\tmobileDisabled: false,\n\t\t\t\thidden: false,\n\t\t\t\tinvisible: true,\n\t\t\t\tonTapFunction: function () { this.fire('configure-tapped', { Id: this.data.record.Id, index: this.index }); }\n\t\t\t});\n\t\t}\n\n\t\toption._transient_.rowActions = actions;\n\t}\n\n\taddToOptionByFeatureId(featureId, option) {\n\t\tthis.optionsByFeatureId[featureId] = this.optionsByFeatureId[featureId] || [];\n\t\tthis.optionsByFeatureId[featureId].push(option);\n\t}\n\n\tinitConfigAttributesById() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tif (attr[i].featureId === null) {\n\t\t\t\tif (!this.configAttributesByFeatureId.featureless)\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId.featureless.push(attr[i]);\n\t\t\t} else {\n\t\t\t\tif (!this.configAttributesByFeatureId[attr[i].featureId])\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId] = [attr[i]];\n\t\t\t\telse\n\t\t\t\t\tthis.configAttributesByFeatureId[attr[i].featureId].push(attr[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitConfigurationAttributeMap() {\n\t\tlet attr = this.product.configurationAttributes;\n\t\tlet numAttributes = attr.length;\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\t//Providing a map for values since attributes for a single field need to reference the same value\n\t\t\tthis.attributeValueMap[attr[i].targetFieldName] = '';\n\t\t\tlet configurationAttributeValue = this.product.configuration.configurationData[attr[i].targetFieldName];\n\t\t\t// never assign an undefined value here or the configuration attribute will not display\n\t\t\tthis.configurationAttributeValueMap[attr[i].myId] = configurationAttributeValue !== undefined ? configurationAttributeValue : null;\n\t\t\t// the bundleId is the product's product key if a cloned product, otherwise just the product's record Id\n\t\t\tlet bundleId = this.product.productKey || this.product.record.Id;\n\t\t\tthis.configurationAttributeModelMap[attr[i].myId] = {\n\t\t\t\ttargetFieldName: attr[i].targetFieldName,\n\t\t\t\tvalue: this.product.configuration.configurationData[attr[i].targetFieldName],\n\t\t\t\trequired: attr[i].required,\n\t\t\t\thidden: attr[i].hidden,\n\t\t\t\tmyId: attr[i].myId,\n\t\t\t\tbundleId: bundleId,\n\t\t\t\tautoSelect: attr[i].autoSelect,\n\t\t\t\tshownValues: attr[i].shownValues,\n\t\t\t\thiddenValues: attr[i].hiddenValues\n\t\t\t};\n\t\t\tlet ids = this.configurationAttributeTargetFieldMap[attr[i].targetFieldName] || [];\n\t\t\tids.push(attr[i].myId);\n\t\t\tthis.configurationAttributeTargetFieldMap[attr[i].targetFieldName] = ids;\n\t\t\t//set a map of attributes that will be applied to options\n\t\t\tif(attr[i].applyToProductOptions === true && this.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] === undefined)\n\t\t\t\tthis.configurationAttributeApplyToOptionMap[attr[i].targetFieldName] = true;\n\t\t}\n\t}\n\n\tinitReconfiguredOption(option, feature, notInitialized, isClick, unsortedOptionConfigs) {\n\t\tlet configsArray = this.productOptionConfigurationsMap[option.record.Id];\n\t\tif (!configsArray || option.removed) {\n\t\t\tif (notInitialized && isClick)\n\t\t\t\treturn feature._transient_.optionConfigurations.push(option);\n\t\t\treturn;\n\t\t}\n\n\t\tlet requiredOptionAdded = {};\n\t\tfor (let i=0;i<configsArray.length;i++) {\n\t\t\tlet clonedOption;\n\t\t\t//Always clone the option if it is not selected through Click method\n\t\t\tif (!isClick) {\n\t\t\t\tclonedOption = JSON.parse(JSON.stringify(option));\n\t\t\t\tclonedOption._transient_.rowActions = option._transient_.rowActions; //we lose the rowActions when we stringify, so adding them back\n\t\t\t\tif (requiredOptionAdded[clonedOption.record.Id] === true)\n\t\t\t\t\tclonedOption.required = false;\n\t\t\t\telse\n\t\t\t\t\trequiredOptionAdded[clonedOption.record.Id] = true;\n\t\t\t}\n\t\t\tlet productOption = clonedOption != null ? clonedOption : option;\n\t\t\tproductOption.index = i;\n\t\t\tthis.setOptionProductConfigurationData(productOption);\n\t\t\tthis.setOptionConfigurations(productOption, configsArray[i]);\n\n\t\t\tif (notInitialized) {\n\t\t\t\tif (isClick)\n\t\t\t\t\tfeature._transient_.optionConfigurations.push(productOption);\n\t\t\t\telse\n\t\t\t\t\tunsortedOptionConfigs.push(productOption);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetOptionConfigurations(option, config) {\n\t\toption.selected = option.selected !== false;\n\t\tfor (let key in config.optionData) {\n\t\t\tif (key !== 'attributes')\n\t\t\t\toption.record[key] = config.optionData[key];\n\t\t}\n\t}\n\n\tgetHasUpgradeOptions(feature) {\n\t\tif(feature.record.Id === 'Other') {\n\t\t\tfor (let i = 0; i < feature._transient_.optionConfigurations.length; i++) {\n\t\t\t\tif (feature._transient_.optionConfigurations[i].isUpgrade === true) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn feature.containsUpgrades;\n\t\t}\n\t}\n\n\tsortAndAddOptionConfigs(feature, unsorted, isNotClick) {\n\t\tlet duplicate;\n\t\tfor (let optionConfig of unsorted) {\n\t\t\tif (!!optionConfig) {\n\t\t\t\tif (isNotClick) {\n\t\t\t\t\toptionConfig.added = true;\n\t\t\t\t\tduplicate = !!feature._transient_.optionConfigurations.filter(o => {return o.record.Id === optionConfig.record.Id;});\n\t\t\t\t}\n\t\t\t\tthis.setOptionDisabledData(optionConfig, duplicate);\n\t\t\t\tfeature._transient_.optionConfigurations.push(optionConfig);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcreateConstraintsHoverMessages(constraintsByConstrained) {\n\t\tthis.optionConstraintsByConstrained = constraintsByConstrained;\n\t\tfor (let option of this.product.options) {\n\t\t\tthis.createConstraintHoverMessage(option);\n\t\t}\n\t}\n\n\tcreateConstraintHoverMessage(option) {\n\t\tif (!this.optionConstraintsByConstrained[option.record.Id])\n\t\t\treturn;\n\n\t\tlet constraint = this.optionConstraintsByConstrained[option.record.Id],\n\t\t\tmessage = {'Requires': [], 'Excludes': []},\n\t\t\tconstraintMessage = [];\n\n\t\tconstraint.ungroupedConstraints.forEach(function(ungrouped) {\n\t\t\tlet type = ungrouped.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = message[type].length ? ('and ' ) : type + ': ',\n\t\t\t\tconstraining = this.optionsById[ungrouped.option].record[this.prefix + 'ProductName__c'];\n\t\t\tmessage[type].push(operator + constraining);\n\t\t}.bind(this));\n\n\t\tObject.keys(constraint.groups).forEach(function(groupName, i) {\n\t\t\tlet group = constraint.groups[groupName],\n\t\t\t\ttype = group.type === 'Dependency' ? 'Requires' : 'Excludes',\n\t\t\t\toperator = message[type].length ? (i == 0 && constraint.ungroupedConstraints[0] ? 'and ' : 'or ') : type + ': ',\n\t\t\t\tstatement = '';\n\n\t\t\tgroup.options.forEach(function(groupedOption, index) {\n\t\t\t\tlet constraining = this.optionsById[groupedOption].record[this.prefix + 'ProductName__c'];\n\t\t\t\toperator = index === 0 ? operator : ' and ';\n\t\t\t\tstatement += (operator + constraining);\n\t\t\t}.bind(this));\n\n\t\t\tmessage[type].push(statement);\n\t\t}.bind(this));\n\n\t\tif (message.Requires.length)\n\t\t\tfor (let requirement of message.Requires) { constraintMessage.push(requirement); }\n\t\tif (message.Excludes.length)\n\t\t\tfor (let exclusion of message.Excludes) { constraintMessage.push(exclusion); }\n\n\t\toption.constraintMessage = constraintMessage;\n\t}\n\n\toptionSystemOrRequired(id) {\n\t\tlet option = this.optionsById[id];\n\t\treturn option.record[this.prefix + 'System__c'] || option.record[this.prefix + 'Required__c'];\n\t}\n\n\tisOptionLookupViewModel() {\n\t\treturn !!this.featureLookupId;\n\t}\n}\n","import {Page} from 'common/core/Page.js';\n\nconst TILE = 'tile';\n\n/**\n * ProductSearch class for the ProductSearch page\n */\nexport class ProductSearch extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-search';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tcategories: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return {}; },\n\t\t\t\tobserver: '_categoriesChanged'\n\t\t\t},\n\t\t\tflatcats: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return []; }\n\t\t\t},\n\t\t\tproducts: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return []; }\n\t\t\t},\n\t\t\tsearchcats: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: function() { return []; }\n\t\t\t},\n\t\t\tsearchContext: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() { return { label: 'All' }; }\n\t\t\t},\n\t\t\tshowTiles: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function() { return TILE; }\n\t\t\t}\n\t\t}, Page.properties );\n\t}\n\n\tready() {\n\t\tthis._loadCategoryMenu().then( function( cats ) {\n\t\t\tthis.categories = cats;\n\t\t}.bind(this) );\n\n\t\tthis._loadProducts().then( function( rows ) {\n\t\t\tthis.products = rows;\n\t\t}.bind(this) );\n\t}\n\n\t_showFavorites() {\n\t}\n\n\t_showCategory(e) {\n\t\tif( e && e.model && e.model.item && e.model.item.id ) {\n\t\t\tlet categoryId = e.model.item.id;\n\t\t\tthis.products = products.filter( function(e,i) {\n\t\t\t\treturn e.cat == categoryId;\n\t\t\t})\n\t\t}\n\t}\n\n\t_loadCategoryMenu() {\n\t\treturn Promise.resolve( categories ); // TODO: get real data\n\t}\n\n\t_loadProducts() {\n\t\treturn Promise.resolve( products ); // TODO: get real data\n\t}\n\n\t_categoriesChanged( nv ) {\n\t\t// flatten them into easy to use UI array\n\t\tlet f = [];\n\t\tflatten( f, nv, 0 );\n\t\tthis.flatcats = f;\n\t\tthis.searchcats = f.filter( function( e, i ) {\n\t\t\treturn e && e.indent == 0;\n\t\t})\n\t}\n\n\t_toggleLayout() {\n\t\tthis.showTiles = this.showTiles ? false : TILE; // truthy or falsely, not pure boolean type\n\t}\n\n\t_setSearchContext(e) {\n\t\tthis.searchContext = e.model.item;\n\t\te.preventDefault();\n\t}\n\n\t_formatMoney( value ) {\n\t\treturn this.i18n.format( value, {currency: 'USD', style: 'currency'} );\n\t}\n}\n\nPolymer( ProductSearch );\n\n/**\n * Flatten the categories object into easy-to-use array\n * @param  {Array} flat  the output array\n * @param  {Object} cats  the categories\n * @param  {int} level the level number, zero-based\n * @return {null}\n */\nfunction flatten( flat, cats, level ) {\n\tlet keys = cats ? Object.keys(cats) : [],\n\t\t\tlen = keys.length;\n\n\tfor( let i=0; i < len; i++ ) {\n\t\tlet item = cats[keys[i]];\n\t\tflat.push( { label: item.label, id: keys[i], indent: level } );\n\t\tif( item.kids )\n\t\t\tflatten( flat, item.kids, level + 1 );\n\t}\n}\n\nlet products = [\n\t{ id: 1, name: 'Magic Mouse 2', code: 'MM2', price: 79.00, cat: '1014', desc: 'Featuring a new design, Magic Mouse 2 is completely rechargeable, so you’ll eliminate the use of traditional batteries. It’s lighter, has fewer moving parts thanks to its built-in battery and continuous bottom shell, and has an optimized foot design — all helping Magic Mouse 2 track easier and move with less resistance across your desk. And the Multi-Touch surface allows you to perform simple gestures such as swiping between web pages and scrolling through documents. Magic Mouse 2 is ready to go right out of the box and pairs automatically with your Mac.' },\n\t{ id: 2, name: 'Magic Trackpad 2', code: 'TPAD2', price: 129.00, cat: '1014', desc: 'Redesigned and rechargeable, Magic Trackpad 2 includes a built-in battery and brings Force Touch to the desktop for the first time. Four force sensors underneath the trackpad surface allow you to click anywhere, and detect subtle differences in the amount of pressure you apply, bringing increased functionality to your fingertips and enabling a deeper connection to your content. Magic Trackpad 2 also features an edge-to-edge glass surface area that is nearly 30 percent larger than the previous trackpad. This design, along with a lower profile, makes scrolling and swiping through your favorite content more productive and comfortable than ever.' },\n\t{ id: 3, name: 'Magic Keyboard', code: 'KEY', price: 99.00, cat: '1014', desc: 'The Magic Keyboard combines a sleek new design with a built-in rechargeable battery and enhanced key features. With an improved scissor mechanism beneath each key for increased stability, as well as optimized key travel and a lower profile, the Magic Keyboard provides a remarkably comfortable and precise typing experience. It pairs automatically with your Mac, so you can get to work right away. And the battery is incredibly long-lasting — it will power your keyboard for about a month or more between charges.' },\n\t{ id: 4, name: 'Naim Audio mu-so Wireless Speaker System', code: 'AUDO', price: 1499.95, cat: '1014', desc: 'Naim Audio\\'s mu-so is a wireless music system finely tuned to deliver high-quality sound. Commanding 450 watts of power through six custom-designed speakers, mu-so provides a music experience that has to be heard to be believed.' },\n\t{ id: 5, name: 'Microsoft Word', code: 'WORD', price: 79.00, cat: '1022', desc: 'Create, polish, and share beautiful documents. Now sharing and collaborating with the team is a breeze. The new Word allows you to co-author and edit documents with multiple people at the same time—whether you’re in the same room or across the globe. And cloud integration makes sharing docs a cinch.' },\n\t{ id: 6, name: 'Microsoft Excel', code: 'EXCEL', price: 89.00, cat: '1022', desc: 'Analyze and visualize your data in new and intuitive ways. Turn numbers into insights with the new Excel. PivotTable Slicers help you discover patterns in large volumes of data, and Recommended Charts gives you the best charts to communicate your data. One-Click Forecasting automatically scans worksheets for data trends and formats them into charts and tables.' },\n\t{ id: 7, name: 'Microsoft Office 365 1-year', code: 'OFFICE-1', price: 149.00, cat: '1021', desc: 'Great for 1 PC or Mac, and 1 iPad, Office 365 helps you get things done from virtually anywhere, on all your devices. Plus, every new upgrade is included so you’ll always have the most up-to-date versions or applications.' },\n\t{ id: 8, name: 'Microsoft Office 365 2-year', code: 'OFFICE-2', price: 289.00, cat: '1021', desc: 'Great for 1 PC or Mac, and 1 iPad, Office 365 helps you get things done from virtually anywhere, on all your devices. Plus, every new upgrade is included so you’ll always have the most up-to-date versions or applications.' },\n\t{ id: 9, name: 'Microsoft Office 365 3-year', code: 'OFFICE-3', price: 329.00, cat: '1021', desc: 'Great for 1 PC or Mac, and 1 iPad, Office 365 helps you get things done from virtually anywhere, on all your devices. Plus, every new upgrade is included so you’ll always have the most up-to-date versions or applications.' },\n\t{ id: 10, name: 'Macbook Air', code: 'MBOOK-AIR', price: 1299.00, cat: '1012', desc: 'Fifth-generation Intel Core processors in MacBook Air give you more time to do more things. Add that to an array of other smart and efficient features, and you have an incredible amount of power in your hands. While carrying next to nothing.' },\n\t{ id: 11, name: 'Macbook Pro', code: 'MBOOK-PRO', price: 2499.00, cat: '1012', desc: 'A groundbreaking Retina display. A new force-sensing trackpad. All-flash architecture. Powerful dual-core and quad-core Intel processors. Together, these features take the notebook to a new level of performance. And they will do the same for you in everything you create.' },\n\t{ id: 12, name: 'Mac Pro', code: 'M-PRO', price: 4300.00, cat: '1011', desc: 'When we began work on the new Mac Pro, we considered every element that defines a pro computer — graphics, storage, expansion, processing power, and memory. And we challenged ourselves to find the best, most forward-looking way possible to engineer each one of them. When we put it all together, the result was something entirely new. Something radically different from anything before it. Something that provides an extremely powerful argument against the status quo' }\n];\n\nlet categories = {\n\t'1020': {\n\t\tlabel: 'Software',\n\t\tkids: {\n\t\t\t'1021': { label: 'Subscriptions' },\n\t\t\t'1022': { label: 'Licenses' }\n\t\t}\n\t},\n\t'1010': {\n\t\tlabel: 'Hardware',\n\t\tkids: {\n\t\t\t'1011': { label: 'Servers' },\n\t\t\t'1012': { label: 'Laptops' },\n\t\t\t'1013': { label: 'Routers' },\n\t\t\t'1014': { label: 'Accessories' }\n\t\t}\n\t},\n\t'1030': {\n\t\tlabel: 'Services',\n\t\tkids: {\n\t\t\t'1031': { label: 'Training' },\n\t\t\t'1032': { label: 'Support' }\n\t\t}\n\t}\n};\n","export class OptionUpgradeHandler {\n\n\tconstructor(prefix, options, option) {\n\t\tthis.prefix = prefix;\n\t\tthis.options = options;\n\t\tthis.option = option;\n\t}\n\n\tisSourceLine() {\n\t\treturn this.option.priorBundledQuantity != null;\n\t}\n\n\tgetLine() {\n\t\treturn this.option;\n\t}\n\n\tgetLines() {\n\t\treturn this.options;\n\t}\n\n\tgetSourceOrUpgrade(sourceOp, upgradeOp) {\n\t\tfor(let i = 0; i < this.options.length; i++) {\n\t\t\tlet sourceOption = sourceOp || this.options[i];\n\t\t\tlet upgradeOption = upgradeOp || this.options[i];\n\n\t\t\tif(upgradeOption.sourceProductIds && (upgradeOption.sourceProductIds.indexOf(sourceOption.record[this.prefix + 'OptionalSKU__c']) != -1)) {\n\t\t\t\treturn this.options[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSourceAndUpgrade(sourceOption, upgradeOption) {\n\t\tthis.sourceOption = sourceOption;\n\t\tthis.upgradeOption = upgradeOption;\n\t}\n\n\tgetSourceIdField() {\n\t\treturn this.prefix + 'OptionalSKU__c';\n\t}\n\n\tgetUpgradeConversionRateField() {\n\t\treturn this.prefix + 'UpgradeConversionRate__c';\n\t}\n\n\tgetSourceCurrentQuantityField(sourceOption) {\n\t\treturn sourceOption.selected ? sourceOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetUpgradeCurrentQuantityField(upgradeOption) {\n\t\treturn upgradeOption.selected ? upgradeOption.record[this.prefix + 'Quantity__c'] : 0;\n\t}\n\n\tgetSourcePriorQuantity(sourceOption) {\n\t\treturn sourceOption.priorBundledQuantity;\n\t}\n\n\tdidSourceQuantityChange(didUserChangeSourceOption, sourceOption, upgradeOption) {\n\t\treturn upgradeOption.selected && (didUserChangeSourceOption || !sourceOption.selected);\n\t}\n\n\tdidUpgradeQuantityChange(didUserChangeSourceOption, sourceOption) {\n\t\treturn sourceOption.selected && !didUserChangeSourceOption\n\t}\n\n\tisSelected(option) {\n\t\treturn option.selected;\n\t}\n\n\tsetUpdatedQuantity(sourceOption, upgradeOption, sourceQtyAfterUpdate, upgradeQtyAfterUpdate) {\n\t\tif(sourceOption.selected) {\n\t\t\tsourceOption.record[this.prefix + 'Quantity__c'] = sourceQtyAfterUpdate;\n\t\t}\n\n\t\tif(upgradeOption.selected) {\n\t\t\tupgradeOption.record[this.prefix + 'Quantity__c'] = upgradeQtyAfterUpdate;\n\t\t}\n\t}\n\n\tgetSourceOption() {\n\t\treturn this.sourceOption;\n\t}\n\n\tgetUpgradeOption() {\n\t\treturn this.upgradeOption;\n\t}\n\n\tsetUpgradedAssetId() {\n\t\tlet sourceOption = this.getSourceOrUpgrade(null, this.option);\n\t\tthis.option.upgradedAssetId = sourceOption.upgradedAssetId;\n\t}\n}\n","export class OptionConstraintsHandler {\n\tconstructor(product, prefix) {\n\t\tthis.product = product;\n\t\tthis.prefix = prefix;\n\t\tthis.messages = {};\n\t\tthis.setOptionConstraints();\n\t}\n\n\tsetOptionConstraints() {\n\t\tif (!this.product.constraints)\n\t\t\treturn null;\n\n\t\tlet constraintType = this.prefix + 'Type__c',\n\t\t\tconstrainedOption = this.prefix + 'ConstrainedOption__c',\n\t\t\tconstrainingOption = this.prefix + 'ConstrainingOption__c',\n\t\t\tconstraintGroup = this.prefix + 'OptionConstraintGroup__c',\n\t\t\tconstraints = {\n\t\t\t\tbyConstraining: {},\n\t\t\t\tbyConstrained: {}\n\t\t\t};\n\n\t\tthis.product.constraints.forEach(constraint => {\n\t\t\tlet type = constraint.record[constraintType],\n\t\t\t\tconstrainedId = constraint.record[constrainedOption],\n\t\t\t\tconstrainingId = constraint.record[constrainingOption],\n\t\t\t\tgroups = constraint.record[constraintGroup] ? constraint.record[constraintGroup].split(', ') : null;\n\n\t\t\t//1- .byConstraining to reference constrained option and type on selection\n\t\t\tif (constraints.byConstraining[constrainingId]) {\n\t\t\t\tconstraints.byConstraining[constrainingId].push({\n\t\t\t\t\ttype: type,\n\t\t\t\t\toption: constrainedId\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconstraints.byConstraining[constrainingId] = [{\n\t\t\t\t\ttype: type,\n\t\t\t\t\toption: constrainedId\n\t\t\t\t}];\n\t\t\t}\n\t\t\t//2- .byConstrained to reference all constraining options on reference to constrained\n\t\t\tif (constraints.byConstrained[constrainedId]) {\n\t\t\t\tif (groups) {\n\t\t\t\t\tgroups.forEach(group => {\n\t\t\t\t\t\tif (constraints.byConstrained[constrainedId].groups[group]) {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group].options.push(constrainingId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group] = {\n\t\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\t\toptions: [constrainingId]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainedId].ungroupedConstraints.push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconstraints.byConstrained[constrainedId] = {\n\t\t\t\t\tungroupedConstraints: [],\n\t\t\t\t\tgroups: {}\n\t\t\t\t};\n\t\t\t\tif (groups) {\n\t\t\t\t\tgroups.forEach(group => {\n\t\t\t\t\t\tif (constraints.byConstrained[constrainedId].groups[group]) {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group].options.push(constrainingId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconstraints.byConstrained[constrainedId].groups[group] = {\n\t\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\t\toptions: [constrainingId]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainedId].ungroupedConstraints = [{\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t}\n\t\t\t//3- Ungrouped exclusion constraints are reflexive\n\t\t\tif (type === 'Exclusion' && !groups) {\n\t\t\t\tif (constraints.byConstraining[constrainedId]) {\n\t\t\t\t\tconstraints.byConstraining[constrainedId].push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstraining[constrainedId] = [{\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainingId\n\t\t\t\t\t}];\n\t\t\t\t}\n\t\t\t\tif (constraints.byConstrained[constrainingId]) {\n\t\t\t\t\tconstraints.byConstrained[constrainingId].ungroupedConstraints.push({\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\toption: constrainedId\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.byConstrained[constrainingId] = {\n\t\t\t\t\t\tungroupedConstraints: [{\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\toption: constrainedId\n\t\t\t\t\t\t}],\n\t\t\t\t\t\tgroups: {}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.optionConstraints = constraints;\n\t}\n\n\thandleOptionConstraints(changedOptionId, selected) {\n\t\tif (!this.optionConstraints || !this.optionConstraints.byConstraining[changedOptionId])\n\t\t\treturn;\n\n\t\tlet result = [],\n\t\t\taddedOrSelected = selected || this.getOption(changedOptionId).added;\n\t\t// Can't depend on option selection always firing before constraints handling\n\t\tthis.getOption(changedOptionId).selected = selected;\n\n\t\tthis.optionConstraints.byConstraining[changedOptionId].forEach(constraint => {\n\t\t\tlet disabledState = this.optionIsConstrained(constraint, changedOptionId, addedOrSelected);\n\t\t\tresult.push({optionId: constraint.option, disabledState: disabledState});\n\t\t});\n\n\t\treturn result;\n\t}\n\n\toptionIsConstrained(constraint, changedOptionId, selected) {\n\t\tlet constraintType = constraint.type,\n\t\t\tconstrainedOption = this.optionConstraints.byConstrained[constraint.option],\n\t\t\thasGroupConstraints = Object.keys(constrainedOption.groups).length > 0,\n\t\t\tconstraintObj = this.isConstrainedByUngrouped(constrainedOption);\n\n\t\tif (constraintObj.constrained)\n\t\t\treturn true;\n\n\t\tif (hasGroupConstraints)\n\t\t\treturn this.isConstrainedByGrouped(constrainedOption.groups);\n\n\t\treturn this.getUnaffectedDisabledState(changedOptionId, selected, constraintType === 'Dependency', constraintObj.requiredConditionMet);\n\t}\n\n\tisConstrainedByUngrouped(constrainedOption) {\n\t\tlet excludedConstrained = false,\n\t\t\trequiredConstrained = false,\n\t\t\trequiredConditionMet = false,\n\t\t\tungroupedConstraints = constrainedOption.ungroupedConstraints,\n\t\t\tlen = ungroupedConstraints ? ungroupedConstraints.length : -1,\n\t\t\ti = 0;\n\n\t\twhile (!excludedConstrained && i < len) {\n\t\t\tlet associatedOption = this.getOption(ungroupedConstraints[i].option),\n\t\t\t\tassociatedType = ungroupedConstraints[i].type;\n\n\t\t\tif (associatedType === 'Exclusion') {\n\t\t\t\texcludedConstrained = this.isSelected(associatedOption);\n\t\t\t} else if (associatedType === 'Dependency' && !requiredConditionMet) {\n\t\t\t\trequiredConditionMet = this.isSelected(associatedOption);\n\t\t\t\trequiredConstrained = !requiredConditionMet;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn {'constrained': excludedConstrained || requiredConstrained, 'requiredConditionMet': requiredConditionMet};\n\t}\n\n\tisConstrainedByGrouped(groups) {\n\t\tlet constrained = false,\n\t\t\tconstrainedByDependency = true,\n\t\t\tconstrainedByExclusion = false,\n\t\t\tlen = Object.keys(groups).length,\n\t\t\ti = 0;\n\n\t\twhile (i < len) {\n\t\t\tlet constrainedWithinGroup = false,\n\t\t\t\tgroup = groups[Object.keys(groups)[i]],\n\t\t\t\ttype = group.type,\n\t\t\t\toptions = group.options,\n\t\t\t\tlen2 = options.length,\n\t\t\t\tj = 0;\n\n\t\t\tif (type === 'Dependency' && constrainedByDependency && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1)\n\t\t\t\t\t\tconstrainedByDependency = false;\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByDependency;\n\t\t\t}\n\n\t\t\tif (type === 'Exclusion' && !constrainedByExclusion) {\n\t\t\t\twhile (!constrainedWithinGroup && j < len2) {\n\t\t\t\t\tlet option = this.getOption(options[j]);\n\t\t\t\t\tconstrainedWithinGroup = !this.isSelected(option);\n\t\t\t\t\tif (!constrainedWithinGroup && j === len2 - 1) {\n\t\t\t\t\t\tconstrainedByExclusion = true;\n\t\t\t\t\t}\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tconstrained = constrainedByExclusion;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\treturn constrained;\n\t}\n\n\tgetOption(optionId) {\n\t\treturn this.product.options.find(option => option.record.Id === optionId);\n\t}\n\n\tisSelected(option) {\n\t\treturn (option && (option.selected || option.added || !!option.priorOptionExists));\n\t}\n\n\tgetUnaffectedDisabledState(optId, selected, isDependency, requiredConditionMet) {\n\t\tif (isDependency) {\n\t\t\treturn requiredConditionMet ? false : !(selected || !!this.getOption(optId).priorOptionExists);\n\t\t}\n\t\telse\n\t\t\treturn selected || !!this.getOption(optId).priorOptionExists;\n\t}\n\n\toptionShouldBeDisabled(optId) {\n\t\tlet constrainedOption = this.optionConstraints.byConstrained[optId],\n\t\t\thasUngroupedConstraints, hasGroupedConstraints, constrainingId, selected, constraint;\n\n\t\tif (!constrainedOption)\n\t\t\treturn false;\n\n\t\thasUngroupedConstraints = constrainedOption.ungroupedConstraints.length >= 1;\n\t\thasGroupedConstraints = Object.keys(constrainedOption.groups).length >= 1;\n\n\t\t// Just need one applicable constrainingId to examine all related constraints via optionIsConstrained()\n\t\tif (hasUngroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.ungroupedConstraints[0].option;\n\t\t} else if (hasGroupedConstraints) {\n\t\t\tconstrainingId = constrainedOption.groups[Object.keys(constrainedOption.groups)[0]].options[0];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\n\t\tselected = this.isSelected(this.getOption(constrainingId));\n\t\tconstraint = this.optionConstraints.byConstraining[constrainingId].find( c => { return c.option === optId; });\n\n\t\treturn this.optionIsConstrained(constraint, constrainingId, selected);\n\t}\n}","import {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class ProductReconfigurer {\n\n\tconstructor(product, quoteType) {\n\t\tthis.product = product;\n\t\tthis.product.quoteType = quoteType;\n\t}\n\n\treconfigure(configuration) {\n\t\tlet selectedOptions = {};\n\t\t// attaches nestedOptionModel on initial reconfigure over the product's loaded configuration\n\t\t// if loading from cache, it continues over the passed-in configuration object\n\t\tif (!configuration)\n\t\t\tthis.product.nestedOptionModel = this.product.nestedOptionModel || new NestedOptionsModel(this.product.configuration, true);\n\t\telse\n\t\t\tthis.product.configuration = configuration;\n\t\t// port pertinent data from configuration VO to option VO on initialization\n\t\tif (!!this.product.configuration.optionConfigurations.length) {\n\t\t\tthis.buildOptionConfiguration(this.product.configuration.optionConfigurations, selectedOptions);\n\t\t\tfor (let option of this.product.options) {\n\t\t\t\tif (selectedOptions[option.record.Id]) {\n\t\t\t\t\t//option.configuration = selectedOptions[option.record.Id];\n\t\t\t\t\toption.isDynamicOption = selectedOptions[option.record.Id].isDynamicOption;\n\t\t\t\t\toption.upgradedAssetId = selectedOptions[option.record.Id].upgradedAssetId;\n\t\t\t\t\toption.priorBundledQuantity = selectedOptions[option.record.Id].priorBundledQuantity;\n\n\t\t\t\t\tif(selectedOptions[option.record.Id].configured === true || selectedOptions[option.record.Id].optionConfigurations) {\n\t\t\t\t\t\toption.configured = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toption.selected = option.selected === true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let option of this.product.options) {\n\t\t\t\tif (option.configuration)\n\t\t\t\t\tdelete option.configuration;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildOptionConfiguration(optionConfigs, selectedOptions) {\n\t\tlet segmentedMap = {};\n\t\tfor (var i=0;i<optionConfigs.length;i++) {\n\t\t\tlet config = optionConfigs[i];\n\t\t\t//W-013982: optionConfigurations lists each segmented line and this was causing duplicate options to show up\n\t\t\tif(segmentedMap[config.optionId] === true)\n\t\t\t\tcontinue;\n\t\t\tif(config.isSegmented)\n\t\t\t\tsegmentedMap[config.optionId] = true; //keeping track of segmented options\n\n\t\t\tselectedOptions[config.optionId] = this.buildStrippedOptionData(config, i);\n\t\t}\n\t}\n\n\tbuildStrippedOptionData(config, index) {\n\t\tif (config.optionConfigurations.length === 0) {\n\t\t\tlet productConfiguration = ProductReconfigurer.newConfiguration(config.optionId, config.optionData, config.isDynamicOption, index);\n\t\t\tproductConfiguration.configured = config.configured;\n\t\t\tif (this.product.quoteType === 'Amendment') {\n\t\t\t\tproductConfiguration.upgradedAssetId = config.upgradedAssetId;\n\t\t\t\tproductConfiguration.priorBundledQuantity = config.priorBundledQuantity;\n\t\t\t}\n\t\t\treturn productConfiguration;\n\t\t}\n\n\t\tlet optionConfigurations = config.optionConfigurations.length > 0;\n\t\treturn { optionId: config.optionId, optionData: config.optionData, optionConfigurations: optionConfigurations, index: index };\n\t}\n\n\tstatic newConfiguration(optionId, optionData, isDynamicOption, index) {\n\t\treturn { optionId: optionId, optionData: optionData, isDynamicOption: isDynamicOption, index: index };\n\t}\n}\n","import {AppContext} from 'common/core/AppContext.js';\nimport {NestedOptionsModel} from '../model/nestedOptions/NestedOptionsModel.js';\n\nexport class RuleProcessor {\n\tconstructor(data, product) {\n\t\tthis.prefix = AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\tthis.data = data;\n\t\tthis.product = product;\n\t\tthis.validationMessages = [];\n\t\tthis.productRulesActions = {};\n\t\tthis.optionDataByOptionIds = {};\n\t}\n\n\tgetValidationMessages() {\n\t\treturn this.validationMessages;\n\t}\n\n\tgetProductRulesActions() {\n\t\treturn this.productRulesActions;\n\t}\n\n\tgetOptionDataByOptionIds() {\n\t\treturn this.optionDataByOptionIds;\n\t}\n\n\tinit() {\n\t\tthis.initValidationMessages();\n\n\t\tif (this.product) {\n\t\t\tthis.initProductRulesActions();\n\t\t\tthis.initOptionDataByOptionIds();\n\t\t}\n\t}\n\n\tinitValidationMessages() {\n\t\tif (this.data.validationMessages) {\n\t\t\tfor (var message of this.data.validationMessages)\n\t\t\t\tthis.validationMessages.push(message);\n\t\t} else {\n\t\t\tfor (let product of this.data.configuredProducts) {\n\t\t\t\tfor (var message of product.configuration.validationMessages)\n\t\t\t\t\tthis.validationMessages.push(message);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitProductRulesActions(onLoad) {\n\t\tlet selectedOptionIds = {}, disabledOptionIds = {}, hiddenOptionIds = {}; // Actions returned from server\n\t\tlet selectOptions = {}, deselectOptions = {}, showOptions = {}, hideOptions = {}, enableOptions = {}, disableOptions = {}; // Actions required for client side\n\t\tfor (var serverOption of this.data.optionConfigurations)\n\t\t\t\tselectedOptionIds[serverOption.optionData.Id || serverOption.optionId] = true;\n\t\tif (this.data.disabledOptionIds != null) {\n\t\t\tfor (var disabledOption of this.data.disabledOptionIds)\n\t\t\t\tdisabledOptionIds[disabledOption] = true;\n\t\t}\n\t\tif (this.data.hiddenOptionIds != null) {\n\t\t\tfor (var hiddenOption of this.data.hiddenOptionIds)\n\t\t\t\thiddenOptionIds[hiddenOption] = true;\n\t\t}\n\n\t\tif (onLoad)\n\t\t\treturn this.assignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds);\n\n\t\tfor (var option of this.product.options) {\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\tthis.handleProductActions(hiddenOptionIds, option, showOptions, hideOptions, 'hidden');\n\t\t\tthis.handleProductActions(disabledOptionIds, option, enableOptions, disableOptions, 'disabled');\n\t\t\tthis.handleProductActions(selectedOptionIds, option, deselectOptions, selectOptions, 'selected');\n\t\t}\n\n\t\tthis.productRulesActions = {\n\t\t\tshowOptions: showOptions, hideOptions: hideOptions, selectOptions: selectOptions,\n\t\t\tdeselectOptions: deselectOptions, enableOptions: enableOptions, disableOptions: disableOptions\n\t\t};\n\t}\n\n\tinitOptionDataByOptionIds() {\n\t\tlet optionConfigurations = this.data.optionConfigurations;\n\n\t\tfor(let i=0; i<optionConfigurations.length; i++) {\n\t\t\tthis.optionDataByOptionIds[optionConfigurations[i].optionId] = {\n\t\t\t\toptionData: optionConfigurations[i].optionData,\n\t\t\t\tlistPrice: optionConfigurations[i].listPrice\n\t\t\t};\n\t\t}\n\t}\n\n\thandleProductActions(ids, option, positiveAction, negativeAction, action) {\n\t\tif (action === 'disabled') {\n\t\t\tif (ids[option.record.Id] && (option.disabledData && !option.disabledData.disabled))\n\t\t\t\treturn negativeAction[option.record.Id] = true;\n\t\t\tif (!ids[option.record.Id] && (option.disabledData && option.disabledData.disabled))\n\t\t\t\treturn positiveAction[option.record.Id] = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (ids[option.record.Id] && !option[action])\n\t\t\treturn negativeAction[option.record.Id] = true;\n\t\tif (!ids[option.record.Id] && option[action])\n\t\t\treturn positiveAction[option.record.Id] = true;\n\t}\n\n\tassignProductRules(selectedOptionIds, disabledOptionIds, hiddenOptionIds) {\n\t\tlet systemLabel = this.prefix + 'System__c';\n\t\tthis.product.rulesProcessed = true;\n\t\tfor (var option of this.product.options) {\n\t\t\tif (this.optionNotInPricebook(option))\n\t\t\t\tcontinue;\n\t\t\t// always define selected property, allows disabling of record-selected product on load\n\t\t\toption.selected = option.selectedByRule = !!selectedOptionIds[option.record.Id];\n\t\t\tif (disabledOptionIds[option.record.Id])\n\t\t\t\t//Both properties disable manual selection.\n\t\t\t\t//'Disabled' allows for selection via record or product rule, 'Constrained' enforces option is not selected\n\t\t\t\toption.disabledData = {\n\t\t\t\t\t'disabled': true,\n\t\t\t\t\t'constrained': !!option.record[systemLabel] && !option.selectedByRule\n\t\t\t\t};\n\t\t\tif (hiddenOptionIds[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tinitDescendantLevelRules(product) {\n\t\t //Descendant Product Rules overwrite any nested option configurations if the rule because these rules are invoked after the manual configurations\n\t\tlet indices = {};\n\t\tfor (var i=0;i<this.data.optionConfigurations.length;i++) {\n\t\t\tlet optionConfig = this.data.optionConfigurations[i];\n\t\t\tindices[optionConfig.optionId] = indices[optionConfig.optionId] === undefined ? 0 : (indices[optionConfig.optionId] + 1);\n\n\t\t\tlet parentInfo = {'optionId': this.data.optionId, 'index' : this.data.index || 0},\n\t\t\t\tchildInfo = {'optionId': optionConfig.optionId, 'index': indices[optionConfig.optionId]};\n\t\t\tproduct.nestedOptionModel.handleDescendantRules([parentInfo, childInfo], optionConfig.optionConfigurations, optionConfig.hiddenOptionIds, optionConfig.disabledOptionIds);\n\t\t}\n\t}\n\n\toptionNotInPricebook(option) {\n\t\treturn option.record[this.prefix + 'UnitPrice__c'] === undefined || option.record[this.prefix + 'UnitPrice__c'] === null;\n\t}\n}","export class ProductAlert {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-alert';\n\t\tthis.properties = {\n\t\t\talerts: Array,\n\t\t\tcontinueCB: Object,\n\t\t\tcancelCB: Object,\n\t\t\tdisplayContinueButton: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.$.dialog.addEventListener('sb-close-dialog', this._onCancel.bind(this));\n\t}\n\n\tget observers() {\n\t\treturn ['init(alerts)'];\n\t}\n\n\tinit() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonRevise() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\ttoggle() {\n\t\tthis.$.dialog.toggle();\n\t}\n\n\tonContinue() {\n\t\tif(typeof this.continueCB === 'function')\n\t\t\tthis.continueCB();\n\t}\n\n\t_onCancel() {\n\t\tif (typeof this.cancelCB === 'function') {\n\t\t\tthis.cancelCB();\n\t\t} else {\n\t\t\tthis.$.dialog.toggle();\n\t\t}\n\t}\n}\n\nPolymer(ProductAlert);","export class ConfigTree {\n\tconstructor(root /* unstructured tree Object */) {\n\t\tthis.root = root;\n\t\tthis.idProperties = ['optionId', 'index'];\n\t\tthis.buildSubtree(this.root);\n\t}\n\n\tbuildSubtree(obj) { //adds index property to configuration as it is built\n\t\tlet indices = {};\n\t\tthis._buildNode(obj);\n\t\tobj.getChildren(obj).forEach( child => {\n\t\t\tindices[child.optionId] = indices[child.optionId] || child.index || 0;\n\t\t\tif (child.index === undefined || indices[child.optionId] === child.index) {\n\t\t\t\tchild.index = indices[child.optionId];\n\t\t\t\tindices[child.optionId]++;\n\t\t\t}\n\t\t\tthis.buildSubtree(child);\n\t\t});\n\t}\n\n\tgetFromPath(path) {\n\t\tlet currentLevel = this.root;\n\t\tfor (let i = 0, l = path.length; i<l; i++) {\n\t\t\tcurrentLevel = this._findOnLevel(path[i], currentLevel);\n\t\t}\n\t\treturn currentLevel;\n\t}\n\n\t_buildNode(obj) {\n\t\tobj.nodeId = this._buildId(obj);\n\t\tobj.getChildren = function () {\n\t\t\treturn this.optionConfigurations;\n\t\t}.bind(obj);\n\t}\n\n\t_buildId(properties) {\n\t\tlet id = '';\n\t\tfor (let key of this.idProperties) {\n\t\t\tid += '_' + properties[key];\n\t\t}\n\t\treturn id;\n\t}\n\n\t_findOnLevel(idProperties, obj) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\tobj = obj || this.root;\n\t\treturn obj.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n}\n","import {Page} from 'common/core/Page.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getGroupKey(ctx.params)'\n\t\t\t},\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.smLoadService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t}.bind(this));\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.$.drawer.togglePanel();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0)\n\t\t\treturn this.navigateToAssetUpgradeRoute();\n\n\t\tthis.onCancel();\n\t}\n\n\tnavigateToAssetUpgradeRoute(){\n\t\tlet queryParams = {\n\t\t\tqId: this.lineEditorModel.quote.record.Id,\n\t\t\tpIds: Object.keys(this.selectedProducts)\n\t\t};\n\n\t\tif(this.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.groupKey;\n\t\treturn this.nav('#', queryParams, ['asset', 'upgrade'], false);\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tthis.nav('#', {'qId': this.lineEditorModel.quote.record.Id}, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.af.runService(this.actionId);\n\t\tthis.$.drawer.$.drawer.closeDrawer();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.af.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetLookupObjects = ['Asset'];\n\t}\n\n\tget actionId() {\n\t\treturn this.ctx.params.aId;\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params.groupKey;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t}\n}\n\nPolymer(AssetLookup);","import {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {RecordGrouper} from 'common/layout/data/RecordGrouper.js'\nimport {Page} from 'common/core/Page.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class AssetUpgrade{\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-asset-upgrade';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tupgrades: Array,\n\t\t\tupgradeSourceMap: Object,\n\t\t\tupgradeTargetMap: Object,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tvalidationMessages: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tassetHeaderSelectable: { //this property is used in the HTML binding to disable the header checkbox/radio button\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t},  Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'renderUpgrades(upgrades, recordKeys)',\n\t\t\t'getUpgrades(ctx.params.pIds)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tready() {\n\t\tthis.initializeServiceSpinners();\n\t\tthis.initializeProperties();\n\t\tthis.preLoadObjects();\n\t\tthis.handleUpgradeSelected();\n\t\tthis.handleMetaDataResponse(); //metadata response\n\t\tthis.handleAddProductResponse(); //add products response\n\t\tthis.handleLineEditorModelResponse(); //line editor response\n\t\tthis.handleSelectionResponse(); //response with available upgrades\n\t}\n\n\t/**\n\t * W-3583510 (GUS) These properties were storing values set during previous navigation to this route.\n\t * We redefine them here as they should be initialized every time this component is used\n\t */\n\tinitializeProperties() {\n\t\tthis.upgradeSourceMap = {};\n\t\tthis.upgradeTargetMap = {};\n\t}\n\n\tinitializeServiceSpinners() {\n\t\tthis.$.addProducts.background = false;\n\t\tthis.$.smSelectService.background = false;\n\t}\n\n\tonSelect() {\n\t\tlet upgrades = this.getSelectedUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\tnavigateToLineEditor() {\n\t\tlet quoteId = this.lineEditorModel ? this.lineEditorModel.quote.record.Id : this.ctx.params.qId;\n\t\tthis.nav('#', {'qId': quoteId}, ['quote', 'le'], false);\n\t}\n\n\trenderUpgrades() {\n\t\tfor(let upgrade of this.upgrades){\n\t\t\t//build a map of the source upgrades, upgrade selected must be true for all source upgrades when clicking select\n\t\t\tthis.upgradeSourceMap[upgrade.record.Product2Id] = {\n\t\t\t\tupgradeSelected : false,\n\t\t\t\tId: upgrade.record.Id,\n\t\t\t\tname: upgrade.record.Name\n\t\t\t};\n\t\t\t//for each target upgrade we build a map of the source upgrades\n\t\t\tfor(let upgradeTarget of upgrade.availableUpgrades) {\n                let upgradeProduct2Id = upgrade.record.Product2Id;\n\n\t\t\t\tif (this.upgradeTargetMap.hasOwnProperty(upgradeTarget.record.Id)) {\n                    this.upgradeTargetMap[upgradeTarget.record.Id].sourceProducts[upgradeProduct2Id] = {'upgradeSelected' : false };\n\t\t\t\t} else {\n\t\t\t\t\tlet sourceProductObject = {};\n                    sourceProductObject[upgradeProduct2Id] = {'upgradeSelected' : false};\n\n                    this.upgradeTargetMap[upgradeTarget.record.Id] = {\n                        sourceProducts : sourceProductObject\n                    };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.upgradeResults = this.upgrades; //this creates the rows\n\t}\n\n\tgetUpgrades() {\n\t\tif (this.ctx.params.pIds === undefined)\n\t\t\tthis.navigateToLineEditor();\n\t\tthis.$.smSelectService.selectedProducts = this.ctx.params.pIds.split(',');\n\t}\n\n\t//returns data structured for use in the product configurator\n\tgetSelectedProducts() {\n\t\tlet selectedUpgrades = this.getSelectedUpgrades(),\n\t\t\tselectedProducts = {};\n\n\t\tfor(let upgrade of selectedUpgrades || [])\n\t\t\tselectedProducts[upgrade.record.Id] = {\n\t\t\t\trecord: upgrade.record,\n\t\t\t\tupgradedAssetId: upgrade.upgradedAssetId\n\t\t\t};\n\n\t\treturn selectedProducts;\n\t}\n\n\tapplyUpgrades() {\n\t\tlet upgrades = this.$.upgrades.getUpgrades();\n\t\tif(upgrades === false) //unable to process upgrades, this currently means a selection is missing\n\t\t\treturn;\n\n\t\tthis.$.addProducts.products = upgrades;\n\t}\n\n\t//builds up the data expected on the server for getting a new quote based on the upgrade selections\n\tgetSelectedUpgrades() {\n\t\tlet addProductsArray = [],\n\t\t\tvalidationMessages = [];\n\n\t\tfor(let i in this.upgradeTargetMap){\n\t\t\tlet targetProduct = this.upgradeTargetMap[i];\n\n\t\t\tfor(let sourceProductId in targetProduct.sourceProducts) {\n\t\t\t\tlet sourceProduct = this.upgradeSourceMap[sourceProductId];\n\n                if(sourceProduct.upgradeSelected === true)\n                    continue; //an upgrade has already been selected for the source product\n\n                sourceProduct.upgradeSelected = targetProduct.sourceProducts[sourceProductId].upgradeSelected;\n                sourceProduct.upgrade = targetProduct.rowData;\n\t\t\t}\n\t\t}\n\n\t\tfor(let i in this.upgradeSourceMap) {\n\t\t\tif (this.upgradeSourceMap[i].upgradeSelected === false) { //return if an upgrade isn't selected\n\t\t\t\tvalidationMessages.push('You must select and upgrade for ' + this.upgradeSourceMap[i].name);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//array of selected upgrades that gets passed to addProducts on the server\n\t\t\taddProductsArray.push(\n\t\t\t\t{\n\t\t\t\t\trecord: this.upgradeSourceMap[i].upgrade, //record is the selected record\n\t\t\t\t\tupgradedAssetId: this.upgradeSourceMap[i].Id} //upgradedAssetId is the Id of the upgrade record, not product record\n\t\t\t)\n\t\t}\n\t\tthis.validationMessages = validationMessages;\n\n\t\tif(validationMessages.length > 0)\n\t\t\treturn;\n\n\t\treturn addProductsArray;\n\t}\n\n\thandleUpgradeSelected() {\n\t\t//when an upgrade is selected, update the map to be used when clicking the select button\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e); //deselect all upgrades in a group of available upgrades\n\t\t\tlet selected = e.detail.selected,\n\t\t\t\tupgradeTargetMap = this.upgradeTargetMap[e.detail.rowData.Id];\n            upgradeTargetMap.sourceProducts[e.detail.rowData._transient_.sourceProduct].upgradeSelected = selected\t;\n\t\t\tupgradeTargetMap.rowData = selected === true ? e.detail.rowData : undefined;\n\t\t}.bind(this));\n\t}\n\n\t//build the metadata required for the rows to render\n\thandleMetaDataResponse() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tlet recordKeys = [],\n\t\t\t\tfieldLabels = [],\n\t\t\t\tfieldLabelMap = {},\n\t\t\t\ttypeMap = {},\n\t\t\t\tlabelTypeMap = {},\n\t\t\t\titemTypeMap = {},\n\t\t\t\tfields = e.detail.value.fields;\n\t\t\tfields.forEach(function(field) {\n\t\t\t\tlet key = field.name;\n\t\t\t\trecordKeys.push(key);\n\t\t\t\tfieldLabels.push(field.label);\n\t\t\t\tfieldLabelMap[key] = field.label;\n\t\t\t\ttypeMap[key] = {type: field.type};\n\t\t\t\tlabelTypeMap[field.label.replace(/\\W/g, '')] = field.type;\n\t\t\t\titemTypeMap[key] = field.type;\n\t\t\t}.bind(this));\n\t\t\tthis.headerClassMap = new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build();\n\t\t\tthis.rowClassMap = new TableClassBuilder(recordKeys, 'Td', itemTypeMap).build();\n\t\t\tthis.typeMap = typeMap;\n\t\t\tthis.recordKeys = recordKeys;\n\t\t\tthis.fieldLabels = fieldLabels;\n\t\t\tthis.fieldLabelMap = fieldLabelMap;\n\t\t}.bind(this));\n\t}\n\n\n\thandleAddProductResponse() {\n\t\tthis.$.addProducts.addEventListener('psm-response-changed', function (e) {\n\t\t\tif(e.detail.value.quote === undefined)\n\t\t\t\treturn;\n\n\t\t\tthis.lineEditorModel.quote = e.detail.value.quote;\n\t\t\tif (e.detail.value.configuredProducts !== undefined && e.detail.value.configuredProducts.length > 0)\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\telse\n\t\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\t//when a target asset requires configuration we need to route to the configurator\n\thandleConfigurableProducts(e) {\n\t\tlet response = e.detail.value;\n\t\tlet queryParams = {};\n\t\tlet configProductIds = this.getConfigProductIds(response);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tqueryParams.pId = configProductIds;\n\t\tresponse.selectedProducts = this.getSelectedProducts();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfigProductIds(products) {\n\t\tlet productIds = [];\n\t\tfor (let product of products.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.$.addProducts.quote = this.$.smSelectService.quote = this.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectionResponse() {\n\t\tthis.$.smSelectService.useCache = false; //we don't want this service to cache because it will cause the configurator to read the wrong cache data\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\t//if no upgrades are available return to the line editor\n\t\t\tif (e.detail.value[0] === undefined || Array.isArray(e.detail.value[0].availableUpgrades) === false)\n\t\t\t\treturn this.navigateToLineEditor();\n\t\t\tthis.upgrades = e.detail.value;\n\t\t}.bind(this));\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.assetUpgradeObjects = ['Product2'];\n\t}\n\n\tget fieldPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (e.detail.selected === false || e.detail.selected === undefined)\n\t\t\treturn;\n\t\tlet root = Polymer.dom(e).rootTarget, //this is the current row\n\t\t\trows = Polymer.dom(root.parentElement).querySelectorAll('sb-table-row'); //this collects all the rows\n\n\t\tfor (let row of rows)\n\t\t\tif (row.selectionType === 'radio' && row !== root)\n\t\t\t\trow.selected = false;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t}\n\n\t// build our own data to pass into table row\n\t// in case of upgrades to the same product so we have a handle of the source product it's upgrading from\n\tbuildRowDataArray(upgrade) {\n\t\tlet availableUpgrades = [];\n\n        for(let availableUpgrade of upgrade.availableUpgrades || []){\n            availableUpgrade.record._transient_ = { sourceProduct: upgrade.record.Product2Id};\n            availableUpgrades.push(availableUpgrade);\n        }\n\n        return availableUpgrades;\n\t}\n}\n\nPolymer(AssetUpgrade);","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class CheckboxFactory {\n\n\tconstructor(value, disabled, hidden) {\n\t\tthis.value = value;\n\t\tthis.disabled = disabled;\n\t\tthis.hidden = hidden;\n\t}\n\n\tnewFormField() {\n\t\tlet ff = new FormField('sb-checkbox');\n\t\tff.addAttribute('value', 2, 'value', this.value);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('hide', 1, 'hide', this.hidden);\n\n\t\tff.formattedValue = { value: this.value, label: '' };\n\t\treturn ff;\n\t}\n}","import {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {InputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class DatePickerFactory {\n\n\tconstructor(value, editable, disabled, i18n, renderReadOnly, type, viewport) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.i18n = i18n;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.type = type;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t}\n\n\tnewFormField() {\n\t\tif(!this.editable)\n\t\t\treturn this.newFormattedDate();\n\n\t\tif(this.viewport && this.viewport.isMobile())\n\t\t\treturn this.newMobileDatePicker();\n\n\t\treturn this.newDatePicker();\n\t}\n\n\tnewMobileDatePicker() {\n\t\treturn new InputFactory(this.value, this.editable, this.disabled, this.type, 'dateInput', this.type).newFormField();\n\t}\n\n\tnewDatePicker() {\n\t\tlet ff = new FormField('sb-datepicker');\n\t\tff.addAttribute('selected-date', 2, 'value', this.value);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('is-blank', 1, 'isBlank', true);\n\t\tff.addAttribute('use-mask', 1, 'useMask', !this.renderReadOnly);\n\n\t\t// add event names\n\t\tff.readOnlyKeyEvent = 'sb-date-esc';\n\t\tff.readOnlyBlurEvent = 'sb-date-blur';\n\t\tff.changeEvent = 'selected-date-changed';\n\n\t\tthis.setFormattedValue(ff, this.getFormattedValue());\n\t\treturn ff;\n\t}\n\n\tnewFormattedDate() {\n\t\tlet formattedValue = this.getFormattedValue();\n\t\tlet ff = new SimpleFieldFactory(formattedValue, this.type).newFormField();\n\t\tthis.setFormattedValue(ff, formattedValue);\n\t\treturn ff;\n\t}\n\n\tgetFormattedValue() {\n\t\treturn this.i18n.format(this.value, { date: true });\n\t}\n\n\tsetFormattedValue(ff, formattedDate) {\n\t\tff.formattedValue = { value: this.value, label: formattedDate };\n\t}\n}","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class DiscountFactory {\n\n\tconstructor(disabled, renderReadOnly, discountDetails, inputType, pattern, numberFormatter) {\n\t\tthis.disabled = disabled;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.discountDetails = discountDetails;\n\t\tthis.inputType = inputType;\n\t\tthis.pattern = pattern;\n\t\tthis.numberFormatter = numberFormatter\n\t}\n\n\tnewFormField() {\n\t\tlet ff = new FormField('sb-discount');\n\t\tff.addAttribute('discount-details', 1, 'discountDetails', this.discountDetails);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('render-read-only', 1, 'renderReadOnly', this.renderReadOnly);\n\t\tff.addAttribute('input-type', 1, 'inputType', this.inputType);\n\t\tff.addAttribute('pattern', 1, 'pattern', this.pattern);\n\t\tff.addAttribute('formatter', 1, 'formatter', this.numberFormatter);\n\n\t\tff.readOnlyBlurEvent = 'sb-discount-blur';\n\t\tff.changeEvent = 'sb-discount-change';\n\n\t\tlet label = this.numberFormatter.format(this.discountDetails.displayValue);\n\t\tlet discountUnit = this.getDiscountUnit();\n\t\tlet unit = label != null && label !== '' ? discountUnit.label : ''; // no unit if label is nil\n\t\tff.formattedValue = {value: this.discountDetails.value, label: label, unit: unit, unitValue: discountUnit.value};\n\n\t\tff.addAttribute('display-value', 1, 'displayValue', label);\n\t\tff.addAttribute('original', 1, 'original', ff.formattedValue);\n\t\treturn ff;\n\t}\n\n\tgetDiscountUnit() {\n\t\tif(!this.discountDetails || !this.discountDetails.units || this.isNil(this.discountDetails.value))\n\t\t\treturn {label: '', value: ''};\n\n\t\tfor(let unit of this.discountDetails.units) {\n\t\t\tif(unit.value === this.discountDetails.unit)\n\t\t\t\treturn {label: unit.label, value: unit.value};\n\t\t}\n\t}\n\n\tisNil(value) {\n\t\treturn value === undefined || value === null || value === '' || isNaN(value);\n\t}\n}","import {CheckboxFactory} from 'common/forms/sb-checkbox/factory/CheckboxFactory.js';\nimport {DatePickerFactory} from 'common/forms/sb-datepicker/factory/DatePickerFactory.js';\nimport {NumericFieldFactory} from 'common/forms/sb-field/factory/NumericFieldFactory.js';\nimport {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {LookupFactory} from 'common/forms/sb-lookup/factory/LookupFactory.js';\nimport {SelectFactory} from 'common/forms/sb-select/factory/SelectFactory.js';\nimport {TextFieldFactory} from 'common/forms/sb-field/factory/TextFieldFactory.js';\n\nexport class FieldFactory {\n\n\tconstructor(value, editable, disabled, hidden, index, metadata, i18n, renderReadOnly, selectOptions, referenceDetails, discountDetails, preventNumericAlignment) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.hidden = hidden;\n\t\tthis.index = index;\n\t\tthis.metadata = metadata;\n\t\tthis.i18n = i18n;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.selectOptions = selectOptions;\n\t\tthis.referenceDetails = referenceDetails;\n\t\tthis.discountDetails = discountDetails;\n\t\tthis.preventNumericAlignment = preventNumericAlignment;\n\t}\n\n\tnewFormField(type) {\n\t\tswitch( type ) {\n\t\t\tcase 'boolean':\n\t\t\tcase 'checkbox':\n\t\t\t\treturn new CheckboxFactory(this.value, this.disabled, this.hidden).newFormField();\n\t\t\tcase 'date':\n\t\t\tcase 'datetime':\n\t\t\t\treturn new DatePickerFactory(this.value, this.editable, this.disabled, this.i18n, this.renderReadOnly, type).newFormField();\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn new NumericFieldFactory(this.value, this.editable, this.disabled, this.metadata, this.i18n, this.renderReadOnly,\n\t\t\t\t\tthis.discountDetails, this.index == 0 ? 'first numberInput' : 'numberInput', type).newFormField(); // keep double equals to allow coercion if index is a string\n\t\t\tcase 'id':\n\t\t\tcase 'reference':\n\t\t\t\treturn new LookupFactory(this.value, this.editable, this.disabled, this.metadata, this.referenceDetails, this.renderReadOnly, type).newFormField();\n\t\t\tcase 'picklist':\n\t\t\tcase 'multipicklist':\n\t\t\t\treturn new SelectFactory(this.value, this.editable, this.disabled, type, this.metadata, this.i18n, !this.renderReadOnly, this.selectOptions).newFormField();\n\t\t\tcase 'string':\n\t\t\tcase 'textarea':\n\t\t\t\treturn new TextFieldFactory(this.value, this.editable, this.disabled, this.metadata, this.renderReadOnly, type).newFormField();\n\t\t\tdefault:\n\t\t\t\treturn new SimpleFieldFactory(this.value, type).newFormField();\n\t\t}\n\t}\n\n}","let FRONT_BINDING = { 0: '', 1: '[[', 2: '{{' };\nlet BACK_BINDING = { 0: '', 1: ']]', 2: '}}' };\n\nexport class FormField {\n\n\tconstructor(name) {\n\t\tthis.name = name;\n\t\tthis.attributes = [];\n\t\tthis.events = [];\n\t}\n\n\taddAttribute(name, binding, variable, value, equals) {\n\t\tthis.attributes.push( { name: name, binding: binding, variable: variable, value: value, equals: equals || '=' } );\n\t}\n\n\taddEvent(event, variable, handler) {\n\t\tthis.events.push( { event: event, variable: variable, handler: handler } );\n\t}\n\n\tsetInnerText(variable, binding, value) {\n\t\tthis.innerText =  { variable: variable, binding: binding, value: value };\n\t}\n\n\tget formattedValue() {\n\t\treturn this._formattedValue;\n\t}\n\n\tset formattedValue(formattedValue) {\n\t\tthis._formattedValue = formattedValue != null && Object.keys(formattedValue).indexOf('label') !== -1 ? formattedValue : { value: formattedValue, label: formattedValue };\n\t}\n\n\tget defaultValue() {\n\t\treturn this._defaultValue;\n\t}\n\n\tset defaultValue(defaultValue) {\n\t\tthis._defaultValue = defaultValue;\n\t}\n\n\tget readOnlyKeyEvent() {\n\t\treturn this._readOnlyKeyEvent || 'keyup';\n\t}\n\n\tset readOnlyKeyEvent(readOnlyKeyEvent) {\n\t\tthis._readOnlyKeyEvent = readOnlyKeyEvent;\n\t}\n\n\tget readOnlyBlurEvent() {\n\t\treturn this._readOnlyBlurEvent || 'blur';\n\t}\n\n\tset readOnlyBlurEvent(readOnlyBlurEvent) {\n\t\tthis._readOnlyBlurEvent = readOnlyBlurEvent;\n\t}\n\n\tget changeEvent() {\n\t\treturn this._changeEvent || 'change';\n\t}\n\n\tset changeEvent(changeEvent) {\n\t\tthis._changeEvent = changeEvent;\n\t}\n\n\tget numeric() {\n\t\treturn !!(this._numeric);\n\t}\n\n\tset numeric(numeric) {\n\t\tthis._numeric = numeric;\n\t}\n\n\tget html() {\n\t\treturn this._html;\n\t}\n\n\tattachTo(template, readOnlyKeyHandler, readOnlyBlurHandler, changeHandler, hiddenField, focusOnAttached) {\n\t\tthis._html = `<${this.name}`;\n\n\t\t// add attributes\n\t\tfor(let i in this.attributes) {\n\t\t\tlet attribute = this.attributes[i];\n\t\t\tthis._html += ` ${attribute.name}${attribute.equals}\"${FRONT_BINDING[attribute.binding]}${attribute.variable}${BACK_BINDING[attribute.binding]}\"`;\n\t\t\ttemplate[attribute.variable] = attribute.value;\n\t\t}\n\n\t\t// add events\n\t\tfor(let j in this.events) {\n\t\t\tlet event = this.events[j];\n\t\t\tthis._html += ` on-${event.event}=\"${event.variable}\"`;\n\t\t\ttemplate[event.variable] = event.handler;\n\t\t}\n\n\t\t// add specific event handlers if provided\n\t\tif(readOnlyKeyHandler)\n\t\t\tthis._html += ` on-${this.readOnlyKeyEvent}=\"${readOnlyKeyHandler}\"`;\n\n\t\tif(readOnlyBlurHandler)\n\t\t\tthis._html += ` on-${this.readOnlyBlurEvent}=\"${readOnlyBlurHandler}\"`;\n\n\t\tif(changeHandler)\n\t\t\tthis._html += ` on-${this.changeEvent}=\"${changeHandler}\"`;\n\n\t\t// add other miscellaneous properties if provided\n\t\tif(hiddenField)\n\t\t\tthis._html += ` hidden$=\"[[${hiddenField}]]\"`;\n\n\t\tif(focusOnAttached)\n\t\t\tthis._html += ' focus-on-attached=\"true\"';\n\n\t\t// place holder for apply focus\n\t\tthis._html += ' apply-focus=\"[[applyFocus]]\"';\n\n\t\tthis._html += `>`;\n\n\t\tif(this.innerText) {\n\t\t\tthis._html  += `${FRONT_BINDING[this.innerText.binding]}${this.innerText.variable}${BACK_BINDING[this.innerText.binding]}`;\n\t\t\ttemplate[this.innerText.variable] = this.innerText.value;\n\t\t}\n\n\t\tthis._html += `</${this.name}>`;\n\t}\n}","import {DiscountFactory} from 'common/forms/sb-discount/factory/DiscountFactory.js';\nimport {InputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {NumberFormatter} from 'common/forms/NumberFormatter.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {Locale} from 'common/forms/Locale.js';\n\nexport class NumericFieldFactory {\n\n\tconstructor(value, editable, disabled, metadata, i18n, renderReadOnly, discountDetails, inputClass, type, viewport) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.discountDetails = discountDetails;\n\t\tthis.inputClass = inputClass;\n\t\tthis.type = type;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t\tthis.numberFormatter = new NumberFormatter(editable, metadata, i18n, type, viewport);\n\t}\n\tnewFormField() {\n\t\tlet inputType = this.isMobile() && !Locale.isCommaDecimal() ? 'number' : 'text';\n\t\tif(this.discountDetails) {\n\t\t\tlet ff = new DiscountFactory(this.disabled, this.renderReadOnly, this.discountDetails, inputType, null, this.numberFormatter).newFormField();\n\t\t\tff.numeric = true;\n\t\t\treturn ff;\n\t\t}\n\n\t\tlet formattedValueAllowCurrency = this.numberFormatter.format(this.value, true);\n\t\tlet formattedValue = !this.editable ? formattedValueAllowCurrency : this.numberFormatter.format(this.value, false);\n\t\tlet ff = new InputFactory(formattedValue, this.editable, this.disabled, this.type, this.inputClass, inputType, this.renderReadOnly).newFormField();\n\t\tff.formattedValue = {value: this.value, label: formattedValueAllowCurrency};\n\t\tff.numeric = true;\n\t\treturn ff;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class SimpleFieldFactory {\n\n\tconstructor(value, type, fieldClass) {\n\t\tthis.value = value;\n\t\tthis.type = type;\n\t\tthis.fieldClass = fieldClass;\n\t}\n\n\tnewFormField() {\n\t\tlet ff = new FormField('sb-html');\n\t\tff.addAttribute('value', 1, 'value', this.value);\n\t\tff.addAttribute('type', 1, 'type', this.type);\n\t\tif(this.fieldClass)\n\t\t\tff.addAttribute('class', 1, 'fieldClass', this.fieldClass, '$=');\n\n\t\treturn ff;\n\t}\n}","import {TextareaFactory} from 'common/forms/sb-textarea/factory/TextareaFactory.js';\nimport {InputFactory} from 'common/forms/sb-input/factory/InputFactory.js';\nimport {RichTextEditorFactory} from 'common/forms/sb-rte/factory/RichTextEditorFactory.js';\n\nexport class TextFieldFactory {\n\n\tconstructor(value, editable, disabled, metadata, renderReadOnly, type) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.metadata = metadata;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.type = type;\n\t}\n\n\tnewFormField() {\n\t    if (this.metadata.extraTypeInfo === 'richtextarea')\n\t    \treturn new RichTextEditorFactory(this.value, this.editable, this.disabled, this.type, this.renderReadOnly, this.metadata).newFormField();\n\n\t\tif(this.metadata.maxLength > 255 || this.metadata.format === 'multiline' || this.type === 'textarea' )\n\t\t\treturn new TextareaFactory(this.value, this.editable, this.disabled, this.type, this.renderReadOnly).newFormField();\n\n\t\treturn new InputFactory(this.value, this.editable, this.disabled, this.type, 'textInput', 'text', this.renderReadOnly).newFormField();\n\t}\n}","import {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class InputFactory {\n\n\tconstructor(value, editable, disabled, type, inputClass, inputType, renderReadOnly, pattern) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.inputClass = inputClass;\n\t\tthis.type = type;\n\t\tthis.inputType = inputType || 'text';\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.pattern = pattern;\n\t}\n\n\tnewFormField() {\n\t\tif(this.editable)\n\t\t\treturn this.newInput();\n\n\t\treturn new SimpleFieldFactory(this.value, this.type).newFormField();\n\t}\n\n\tnewInput() {\n\t\tlet ff = new FormField('sb-input');\n\t\tff.addAttribute('value', 2, 'value', this.value);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('input-class', 1, 'inputClass', this.inputClass);\n\t\tff.addAttribute('input-type', 1, 'inputType', this.inputType);\n\t\tff.addAttribute('render-read-only', 1, 'renderReadOnly', this.renderReadOnly);\n\t\tff.addAttribute('pattern', 1, 'pattern', this.pattern);\n\n\t\tff.readOnlyKeyEvent = 'sb-input-key';\n\t\treturn ff;\n\t}\n}","import {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class LookupFactory {\n\n\tconstructor(value, editable,disabled, metadata, referenceDetails, renderReadOnly, type) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.metadata = metadata;\n\t\tthis.referenceDetails = referenceDetails;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.type = type;\n\t}\n\n\tnewFormField() {\n\t\tif(!this.editable)\n\t\t\treturn this.newReferenceLink();\n\n\t\treturn this.newLookup();\n\t}\n\n\tnewLookup() {\n\t\tlet ff = new FormField('sb-lookup');\n\t\tlet label =  this.getLabel();\n\t\tff.formattedValue = { value: this.value, label: label };\n\n\t\tff.addAttribute('id', 0, 'lookup');\n\t\tff.addAttribute('value', 2, 'value', this.value);\n\t\tff.addAttribute('label', 1, this.referenceDetails.refDisplayName, ff.formattedValue.label);\n\t\tff.addAttribute('label-name', 1, 'labelName', this.referenceDetails.refDisplayName);\n\t\tff.addAttribute('table-name', 1, 'refTable', this.referenceDetails.refTable);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('field-full-name', 1, 'fieldFullName', this.metadata.tableName + '.' + \tthis.metadata.name);\n\t\tff.addAttribute('field-label', 1, 'fieldLabel', this.metadata.label);\n\t\tff.addAttribute('revert-on-escape', 1, 'revertOnEscape', this.renderReadOnly);\n\t\tff.addAttribute('calculate-list-position', 1, 'calculateListPosition', false);\n\t\tff.addAttribute('has-filter', 1, 'hasFilter', !!(this.metadata.filteredLookupInfo));\n\t\tff.addAttribute('record', 1, 'record', this.referenceDetails.record);\n\n\t\t// add event names\n\t\tff.readOnlyKeyEvent = 'sb-type-esc';\n\t\tff.readOnlyBlurEvent = 'sb-type-blur';\n\t\tff.changeEvent = 'lookup-value-changed';\n\n\t\treturn ff;\n\t}\n\n\tnewReferenceLink() {\n\t\tlet ff = new FormField('span');\n\t\tlet label = this.getLabel(true);\n\t\tff.addAttribute('value', 2, '_value_', this.value); // _value_ not a typo, so please leave it\n\t\tff.addAttribute('class', 1, 'link', 'link', '$=');\n\t\tff.setInnerText(this.referenceDetails.refDisplayName, 1, label);\n\t\tff.formattedValue = { value: this.value, label: label };\n\n\t\tff.addEvent('tap', 'refClick', function(e) {\n\t\t\twindow.open(window.location.origin + '/' + e.target.value);\n\t\t});\n\t\treturn ff;\n\t}\n\n\textractRefDisplay() {\n\t\tlet property = this.referenceDetails.property;\n\t\tlet obj = this.referenceDetails.obj;\n\t\tlet refObjects = this.referenceDetails.refObjects;\n\n\t\tlet fieldName = property.Name ? property.Name : this.metadata.name;\n\t\tif(!fieldName)\n\t\t\treturn;\n\n\t\tlet pos = fieldName.lastIndexOf('Id');\n\t\tlet refObj = pos >= 0 ? fieldName.substring(0, pos) : (fieldName.lastIndexOf('__c') >= 0 ? fieldName.replace('__c', '__r') : null);\n\n\t\tlet refType = obj[refObj] ? obj[refObj].attributes.type : null;\n\n\t\tif (refObj && obj[refObj] && refObjects && refType && refObjects[refType]) {\n\t\t\tlet nameProp = refObjects[refType].nameField.fieldName;\n\t\t\tif (this.obj[refObj][nameProp])\n\t\t\t\treturn this.obj[refObj][nameProp];\n\n\t\t\treturn obj[refObj].Id;\n\t\t}\n\t}\n\n\tgetLabel(extractRefDisplay) {\n\t\tlet label = this.referenceDetails[this.referenceDetails.refDisplayName];\n\t\tif(label) return label;\n\n\t\tif(extractRefDisplay)\n\t\t\tlabel = this.extractRefDisplay();\n\n\t\treturn label || this.value || '';\n\t}\n}","const NAME_MAP = {\n\tContract: 'ContractNumber',\n\tCase: 'CaseNumber'\n};\n\nexport class LookupNameMapper {\n\n\tconstructor(tableName) {\n\t\tthis.tableName = tableName;\n\t}\n\n\tgetNameField() {\n\t\treturn NAME_MAP[this.tableName] || 'Name';\n\t}\n}","import {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {AppContext} from 'common/core/AppContext.js'\n\nexport class LookupQueryBuilder {\n\n\tconstructor(tableName, searchField, hasFilter, lookupFieldFullName, resultsLimit, currentRecordFields, currentRecord, applyMruOptimization, fields) {\n\t\tthis.tableName = tableName;\n\t\tthis.searchField = searchField;\n\t\tthis.hasFilter = hasFilter;\n\t\tthis.lookupFieldFullName = lookupFieldFullName;\n\t\tthis.resultsLimit = resultsLimit;\n\t\tthis.currentRecordFields = currentRecordFields;\n\t\tthis.currentRecord = currentRecord;\n\t\tthis.applyMruOptimization = applyMruOptimization;\n\t\tthis.selectFields = fields && fields.fieldNames ? LookupQueryBuilder._buildFields(fields) : [this.searchField];\n\t}\n\n\tbuild(searchValue = '') {\n\t\tlet searchCriteria = '%';\n\t\tif(searchValue != null && searchValue !== '') {\n\t\t\tsearchCriteria = searchValue.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"').replace(/'/g, \"\\\\'\").replace(/%/g, '\\\\%').replace(/[*]+/g, '%');\n\t\t\tif (!searchCriteria.endsWith('%'))\n\t\t\t\tsearchCriteria += '%';\n\t\t}\n\n\t\tlet noWildcardSearchValue = searchValue.replace(/\\*/g, '');\n\t\tlet scope = this.getScope(noWildcardSearchValue);\n\t\tlet scopeClause = '';\n\n\t\tif(this.hasFilter)\n\t\t\tscopeClause = ` USING SCOPE ${scope}, LOOKUP ${this.lookupFieldFullName}`;\n\t\telse if(scope === 'mru')\n\t\t\tscopeClause = ' USING SCOPE mru';\n\n\t\tlet orderByClause = scope === 'mru' ? 'ORDER BY LastViewedDate DESC' : `ORDER BY ${this.searchField}`;\n\t\tlet query = `SELECT Id, ${this.selectFields.join(',')} FROM ${this.tableName}${scopeClause} WHERE ${this.searchField} LIKE '${searchCriteria}' ${orderByClause} LIMIT ${this.resultsLimit}`;\n\n\t\t// if has filter, has current record fields, and has a current record then lets add the bind clause to the query\n\t\tif(this.hasFilter && this.currentRecordFields && Object.keys(this.currentRecordFields).length > 0 && this.currentRecord) {\n\t\t\tlet index = 0;\n\t\t\tfor(let currentRecordField in this.currentRecordFields) {\n\t\t\t\tlet value = typeof this.currentRecord.getValue === 'function' ? this.currentRecord.getValue(currentRecordField) : this.currentRecord[currentRecordField];\n\t\t\t\tlet type = this.currentRecordFields[currentRecordField];\n\t\t\t\tif(this.omitField(value, type))\n\t\t\t\t\tcontinue;\n\t\t\t\tif(index === 0)\n\t\t\t\t\tquery += ' BIND ';\n\t\t\t\tif(index++ > 0)\n\t\t\t\t\tquery += ', ';\n\t\t\t\tquery += `${currentRecordField} = ${this.getBindValue(value, type)}`;\n\t\t\t}\n\t\t}\n\t\treturn query;\n\t}\n\n\tgetScope(searchValue) {\n\t\tif (!this.applyMruOptimization)\n\t\t\treturn 'everything';\n\n\t\tlet searchValueLength = searchValue == null ? 0 : searchValue.length;\n\t\tif (searchValueLength > 2)\n\t\t\treturn 'everything';\n\n\t\tlet lang = AppContext.user.lang;\n\t\t// if searchValue is at least one character and user's language is Chinese, Japanese, Korean or Thai then scope is everything\n\t\t// why?...see description for 'q' parameter at https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/resources_search_suggest_records.htm\n\t\t// see language codes at https://developer.salesforce.com/docs/atlas.en-us.api_meta.meta/api_meta/meta_translations.htm\n\t\tif (searchValueLength > 0 && (lang === 'zh_CN' || lang === 'zh_TW' || lang === 'ja' || lang === 'ko' || lang === 'th'))\n\t\t\treturn 'everything';\n\n\t\treturn 'mru';\n\t}\n\n\tomitField(value, type) {\n\t\treturn value == null && (this.isNumericType(type) || this.isLookupType(type));\n\t}\n\n\tgetBindValue(value, type) {\n\t\tif(value == null)\n\t\t\treturn \"''\";\n\n\t\tif(value === true || value === false)\n\t\t\treturn value;\n\n\t\tif(this.isNumericType(type))\n\t\t\treturn value;\n\n\t\treturn `'${value}'`;\n\t}\n\n\tisNumericType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'double':\n\t\t\tcase 'number':\n\t\t\tcase 'currency':\n\t\t\tcase 'percent':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisLookupType(type) {\n\t\tswitch(type) {\n\t\t\tcase 'id':\n\t\t\tcase 'reference':\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic _buildFields(fields) {\n\t\tlet fieldNames = [].concat(fields.fieldNames);\n\n\t\tlet relationships = [];\n\t\tfor(let lookupField of fields.fieldsOfTypeLookup)\n\t\t\trelationships.push(RelationshipFieldManager.getRelationshipField(lookupField.name, lookupField.table));\n\t\tif(relationships.length > 0)\n\t\t\tfieldNames = fieldNames.concat(relationships);\n\n\t\treturn fieldNames;\n\t}\n}","import {AppContext} from 'common/core/AppContext.js';\nimport {I18n} from 'common/core/sb-i18n/I18n.js';\n\nlet config = {\n\tinline: false,\n\tfont_formats: 'Arial=Arial,sans-serif;Courier=Courier,monospace;Dosis=Dosis,sans-serif;Droid Sans=Droid Sans,sans-serif;Droid Serif=Droid Serif,serif;Helvetica=Helvetica,sans-serif;Merriweather=Merriweather,sans-serif;Montserrat=Montserrat,sans-serif;Noto Sans JP=Noto Sans JP,sans-serif;Noto Sans KR=Noto Sans KR,sans-serif;Noto Sans SC=Noto Sans SC,sans-serif;Noto Sans TC=Noto Sans TC,sans-serif;Open Sans=Open Sans,sans-serif;PT Sans=PT Sans,sans-serif;PT Serif=PT Serif,serif;Roboto=Roboto,sans-serif;Roboto Light=Roboto:300,sans-serif;Times=Times,serif;Titillium Web=Titillium Web,sans-serif;',\n\tforced_root_block: '',\n\tmenubar: false,\n\ttoolbar1: 'cut copy paste | undo redo | styleselect formatselect fontselect fontsizeselect | link image table',\n\ttoolbar2: 'bold italic underline strikethrough subscript superscript removeformat | numlist bullist | outdent indent | blockquote | alignleft aligncenter alignright alignjustify | code',\n\tplugins: 'link image code table'\n};\n\nconst FONTS = \"//fonts.googleapis.com/css?family=Dosis|Droid+Sans|Droid+Serif|Merriweather|Montserrat|Open+Sans|PT+Sans|PT+Serif|Roboto:300,400|Titillium+Web\";\n\ntinymce.baseURL = '/common/staticresources/tinymce'; // default\ntinymce.suffix = '.min';\n\nexport class RichTextEditorDialog {\n\n    beforeRegister() {\n    \tthis.is = 'sb-rte-dialog';\n    \tthis.properties = {\n   \t\t\tvalue: {\n   \t\t\t\ttype: String,\n\t\t\t\tobserver:  '_valueChanged',\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\ti18n: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.properties.i18n.value();\n\t\t\t\t}\n\t\t\t}\n   \t\t}\n   \t}\n\n\tready() {\n\t\tlet sheets = document.querySelectorAll( 'head > link[rel=stylesheet]' ),\n\t\t\tlen = sheets ? sheets.length : 0;\n\n\t\t// add web fonts if not already in document\n\t\tfor( let i=0; i < len; i++ ) {\n\t\t\tif( sheets[i].getAttribute('href') == FONTS )\n\t\t\t\treturn;\n\t\t}\n\n\t\tlet link = document.createElement( 'link' );\n\t\tlink.setAttribute( 'rel', 'stylesheet' );\n\t\tlink.setAttribute( 'href', FONTS );\n\t\tdocument.head.appendChild( link );\n\t}\n\n\t_initialize() {\n\t\tconfig.inline = true;\n\t\tconfig.target = Polymer.dom(this.root).querySelector('#rte');\n\n\t\ttinymce.init( config ).then( function( editors ) {\n\t\t\tthis.editor = editors[0];\n\t\t\ttry {\n\t\t\t\tthis.editor.setContent( this.value );\n\t\t\t} catch(e) {}\n\n\t\t\tthis.editor.on('blur', function(e) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tif (this.$.dialog.show)\n\t\t\t\t\t\tthis.$.rte.focus();\n\t\t\t\t}.bind(this), 10);\n\t\t\t}.bind(this));\n\n\t\t\tthis.$.rte.focus();\n\n\t\t}.bind(this)).catch( function(err) {\n\t\t\tconsole.error( err );\n\t\t});\n\t}\n\n\tonSave() {\n\t\tlet content = this.editor.getContent();\n\t\tthis.value = content !== \"Click to edit description.\" ? content : null;\n\t\tthis.rte.value = this.value;\n\t\tthis.rte.fire('rte-value-changed');\n\t\tthis.close();\n\t}\n\n\tonCancel() {\n\t\tthis.rte.fire('rte-esc', { keyCode: 27 } );\n\t\tthis.close();\n\t}\n\n\topen() {\n\t\tthis.$.dialog.open();\n\t\tif (this.value === \"Click to edit description.\" || this.value == undefined)\n\t\t\tthis.value = null;\n\t\tthis.$.rte.focus();\n\t\tPolymer.dom(this.root).querySelector('.title').innerHTML = this.i18n.l(`Edit ${this.rte.label}`); // Needed for Safari and FF to update title correctly\n\t\tthis._initialize();\n\n\t\tthis.addEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\tclose() {\n\t\tthis.rte.fire('rte-blur');\n\t\tthis.$.dialog.close();\n\t\tif (this.value === \"Click to edit description.\")\n\t\t\tthis.value = null;\n\t\tthis.$.rte.blur();\n\t\t// Must call remove every time, because there can only been one instance of an editor on a page at a given time\n\t\ttinymce.remove();\n\n\t\tthis.removeEventListener('sb-rte-cancel', this.onCancel);\n\t}\n\n\tstatic setBaseUrl( u ) {\n\t\tif( u )\n\t\t\ttinymce.baseURL = u;\n\t}\n\n\t_valueChanged() {\n\t\tPolymer.dom(this.$.rte).innerHTML = this.value;\n\t}\n\n}\n\nPolymer ( RichTextEditorDialog );","import {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\n\nexport class RichTextEditorFactory {\n\n\tconstructor(value, editable, disabled, type, renderReadOnly, metadata, viewport) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.type = type;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t\tthis.metadata = metadata;\n\t\tthis.viewport = viewport || PageContainer.getViewport();\n\t}\n\n\tnewFormField() {\n\t\tthis.isMobile = this.viewport && this.viewport.isMobile();\n\t\tif (this.editable && !this.isMobile) {\n\t\t\treturn this.newRichTextEditor();\n\t\t}\n\n\t\t// In cases of mobile, not editable, etc.\n\t\treturn new SimpleFieldFactory(this.value, this.type).newFormField();\n\t}\n\n\tnewRichTextEditor() {\n\t\tlet ff = new FormField('sb-rte');\n\t\tff.addAttribute('value', 1, 'value', this.value);\n\t\tff.addAttribute('render-read-only', 1, 'renderReadOnly', this.renderReadOnly);\n\t\tff.addAttribute('label', 1, 'label', this.metadata.label);\n\n\t\tff.readOnlyKeyEvent = 'rte-esc';\n\t\tff.readOnlyBlurEvent = 'rte-blur';\n\t\tff.changeEvent = 'rte-value-changed';\n\n\t\treturn ff;\n\t}\n}","import {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\nimport {Select} from 'common/forms/sb-select/Select.js';\n\nexport class SelectFactory {\n\n\tconstructor(value, editable, disabled, type, metadata, i18n, useNoneLabel, options) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.type = type;\n\t\tthis.metadata = metadata;\n\t\tthis.i18n = i18n;\n\t\tthis.useNoneLabel = useNoneLabel;\n\t\tthis.options = options;\n\t}\n\n\tnewFormField() {\n\t\tlet multiSelect = this.type === 'multipicklist';\n\t\tif(this.editable)\n\t\t\treturn this.newSelectList(multiSelect);\n\n\t\treturn new SimpleFieldFactory(this.getLabel(multiSelect), this.type).newFormField();\n\t}\n\n\tnewSelectList(multiSelect) {\n\t\tlet ff = new FormField('sb-select');\n\t\tif(this.metadata.defaultValue && !this.value && !this.metadata.controllerName && !this.metadata.restrictedPicklist) {\n\t\t\tthis.value = this.metadata.defaultValue;\n\t\t\tff.defaultValue = this.value;\n\t\t}\n\t\tff.addAttribute('id', 0, 'picklist');\n\t\tff.addAttribute('value', 2, 'value', this.value);\n\t\tff.addAttribute('md', 1, 'md', this.metadata);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('options', 1, 'options', this.options);\n\t\tff.addAttribute('is-required', 1, 'isRequired', !!(this.metadata.required));\n\t\tff.addAttribute('multi-select', 1, 'multiSelect', multiSelect);\n\t\tif(this.useNoneLabel)\n\t\t\tff.addAttribute('none-label', 1, 'noneLabel', `--${this.i18n.l(\"None\")}--`);\n\t\tif(this.metadata.precision != null)\n\t\t\tff.addAttribute('size', 1, 'size', this.metadata.precision);\n\n\t\tff.formattedValue = { value: this.value, label: this.getLabel(multiSelect) };\n\t\treturn ff;\n\t}\n\n\tgetLabel(multiSelect) {\n\t\tif(!this.options)\n\t\t\treturn this.value;\n\n\t\tlet values = Select.getValues(this.value, multiSelect);\n\t\tif(values.length === 0)\n\t\t\treturn this.value;\n\n\t\tlet label = null;\n\t\tfor(let option of this.options) {\n\t\t\tif(values.indexOf(option.value) !== -1) {\n\t\t\t\tif(multiSelect && label != null)\n\t\t\t\t\tlabel += (';' + option.label);\n\t\t\t\telse\n\t\t\t\t\tlabel = option.label;\n\t\t\t}\n\t\t}\n\t\treturn label || this.value;\n\t}\n}","import {SimpleFieldFactory} from 'common/forms/sb-field/factory/SimpleFieldFactory.js';\nimport {FormField} from 'common/forms/sb-field/factory/FormField.js';\n\nexport class TextareaFactory {\n\n\tconstructor(value, editable, disabled, type, renderReadOnly) {\n\t\tthis.value = value;\n\t\tthis.editable = editable;\n\t\tthis.disabled = disabled;\n\t\tthis.type = type;\n\t\tthis.renderReadOnly = renderReadOnly;\n\t}\n\n\tnewFormField() {\n\t\tif(this.editable)\n\t\t\treturn this.newTextarea();\n\n\t\treturn new SimpleFieldFactory(this.value, this.type).newFormField();\n\t}\n\n\tnewTextarea() {\n\t\tlet ff = new FormField('sb-textarea');\n\t\tff.addAttribute('value', 2, 'value', this.value);\n\t\tff.addAttribute('disabled', 1, 'disabled', this.disabled);\n\t\tff.addAttribute('render-read-only', 1, 'renderReadOnly', this.renderReadOnly);\n\n\t\tff.readOnlyKeyEvent = 'sb-textarea-key';\n\t\treturn ff;\n\t}\n}","export class LESummaryCell {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-le-summary-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\tsummaries: Object,\n\t\t\teditorModel: Object\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['observer(summaries, editorModel)'];\n\t}\n\n\tobserver() {\n\t\tlet md = this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName];\n\n\t\tlet lc = cache[this.item];\n\t\tif (!lc) {\n\t\t\tcache[this.item] = this.item.toLowerCase();\n\t\t\tlc = cache[this.item];\n\t\t}\n\t\tif (this.summaries && md[this.item]) {\n\t\t\tmd[this.item].CurrencyIsoCode = this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode;\n\t\t\tthis.$.field.value = this.summaries[lc];\n\t\t\tthis.$.field.md = md[this.item];\n\t\t}\n\t}\n}\n\nlet cache = {};\n\nPolymer( LESummaryCell );","export class GroupTabs {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-group-tabs';\n\n\t\tthis.properties = {\n\t\t\tisGroupFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupFieldPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPage(pageType)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildPage(groupModel)'];\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModel) {return;}\n\t\tthis.pageType = this.attributes.label.value;\n\t\tthis.groupObjectName = this.groupModel.groupObjectName;\n\t\tif (this.groupModel.groupMDQTabs) {\n\t\t\tthis.tabs = this.groupModel.groupMDQTabs;\n\t\t}\n\t\tthis.hideTabs = this.tabs ? this.tabs.length == 1 && this.tabs[0].key != 'Custom' : false;\n\t}\n\n\t_setIsGroupFieldPage(pageType) {\n\t\treturn pageType === \"details\";\n\t}\n\n\t_setIsStandardLinesPage(pageType) {\n\t\treturn pageType === \"standard\";\n\t}\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === \"segmented\";\n\t}\n}\n\nPolymer(GroupTabs);","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class QuoteTabs {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-quote-tabs';\n\n\t\tthis.properties = {\n\t\t\tisQuoteFieldPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsQuoteFieldPage(pageType)'\n\t\t\t},\n\t\t\tisGroupsPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsGroupsPage(pageType)'\n\t\t\t},\n\t\t\tisSegmentedLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsSegmentedLinesPage(pageType)'\n\t\t\t},\n\t\t\tisStandardLinesPage: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setIsStandardLinesPage(pageType)'\n\t\t\t},\n\t\t\teditorModel: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tgroupModels: {\n\t\t\t\tnotify: true,\n\t\t\t\ttype: Object\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['buildPage(groupModels)', '_groupModelsChanged(groupModels.*)'];\n\t}\n\n\t_groupModelsChanged(e) {\n\t\tif (this.groupModels.length == 1 && e.path != 'groupModels' && !this.groupModels[0].quoteModel.grouped) {\n\t\t\t// Remove first two parts of path which are usually groupsModels and then the index\n\t\t\t// Convert groupModels.#0 to groupModel for ungrouped quote\n\t\t\tlet parts = e.path.split('.');\n\t\t\tlet path = parts.splice(2, parts.length).join('.');\n\t\t\tthis.set('groupModel.' + path, e.value);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t}\n\n\tattached() {\n\t\tthis.resize();\n\t}\n\n\tbuildPage() {\n\t\tif (!this.groupModels)\n\t\t\treturn;\n\n\t\tthis.pageType = this.attributes.label.value;\n\t\tif (this.pageType != 'details' && this.pageType != 'groups') {\n\t\t\tthis.groupModel = this.groupModels[0];\n\t\t\tthis.quoteModel = this.groupModel.quoteModel;\n\t\t}\n\t\tif (this.pageType == 'segmented' && this.groupModel.quoteMDQTabs) {\n\t\t\tthis.segmentedTabs = this.groupModel.quoteMDQTabs;\n\t\t}\n\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t// If it meets the above criteria, do not render the tab\n\t\tthis.hideTabs = this.segmentedTabs ? this.segmentedTabs.length == 1 && this.segmentedTabs[0].key != 'Custom' : false;\n\t\tthis.resize();\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\thandleResize() {\n\t\twindow.addEventListener('resize', function(e) {\n\t\t\tthis.resize();\n\t\t}.bind(this));\n\t}\n\n\tresize() {\n\t\tif (this.domHost) {\n\t\t\t// Check the sb-tabs above this to see if it only has one tab and that it is not 'Custom'\n\t\t\t// If it meets the above criteria, do not render the tab\n\t\t\tlet tabHeight = this.domHost.tabs.length == 1 && this.domHost.tabs[0].key != 'Custom'  ? 0 : 43;\n\t\t\tthis.layoutHeight = this.domHost.getBoundingClientRect().height - tabHeight + 'px';\n\t\t\tPolymer.dom(this).parentNode.style.height = this.layoutHeight;\n\t\t}\n\t}\n\n\t_setIsQuoteFieldPage(pageType) {\n\t\treturn pageType === \"details\";\n\t}\n\n\t_setIsGroupsPage(pageType) {\n\t\treturn pageType === \"groups\";\n\t}\n\n\t_setIsStandardLinesPage(pageType) {\n\t\treturn pageType === \"standard\";\n\t}\n\t_setIsSegmentedLinesPage(pageType) {\n\t\treturn pageType === \"segmented\";\n\t}\n}\n\nPolymer(QuoteTabs);","import {Util} from 'common/Util.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {PageHeader} from 'common/core/sb-page-header/PageHeader.js';\nimport {ProductMessenger} from 'products/config/message/ProductMessenger.js';\n\n// We ship the api name for Product Code as 'Product Code' for Field picklist on Custom Action Condition\n// However, the api name for Product Code in Product is 'ProductCode'\n// TODO: Will need to use MetaDataUtils.js to grab the correct API Name instead of hard coding it as a map\nconst API_FIELD_NAME_MAP = {'Product Code' : 'ProductCode'};\n\nexport class CustomActions {\n\tbeforeRegister() {\n\t\tthis.is = 'sb-custom-actions';\n\t\tthis.properties = {\n\t\t\tcustomActions: Array,\n\t\t\tproducts: Array,\n\t\t\tisClassic: Boolean,\n\t\t\tproductIndex: Number,\n\t\t\tfirstItem: Object,\n\t\t\tremainingItems: Array,\n\t\t\tprefix: String,\n\t\t\tcustomActionsExist: Boolean,\n\t\t\tmoreThanOneCustomActionsExist: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmenuClosed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tobserver: '_viewportChanged',\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttonsCollapsed: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t\t,\n\t\t\tmessenger: {\n\t\t\t\ttype: Object,\n\t\t\t\tcomputed: '_newMessenger(quote, products, productIndex, prefix)'\n\t\t\t},\n\t\t\tquote: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpopupResponse: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_updateQuoteFromPopupResponse'\n\t\t\t},\n\t\t\tlaunchExternalName: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: \"Launch External\"\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['init(customActions, products, prefix, productIndex, isClassic, menuClosed)']\n\t}\n\n\tinit() {\n\t\t// This check removes all custom actions when bundles have multiple products in classic view.\n\t\tif (this.isClassic && this.products.length > 1) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\n\t\tlet showExternalAction = this.products[this.productIndex].record[this.prefix + 'ExternallyConfigurable__c'];\n\t\tlet urlKey = this.prefix + \"URL__c\";\n\t\tlet labelKey = this.prefix + \"Label__c\";\n\t\tlet page = this.prefix + \"Page__c\";\n\t\tlet targetKey = this.prefix + \"URLTarget__c\";\n\t\tlet labelUrlMap = [];\n\t\tthis.customActions.forEach(customAction => {\n\t\t\tif (customAction[urlKey] !== undefined && customAction[page] === 'Product Configurator' && this.checkCustomActionsConditionsMet(customAction, showExternalAction)) {\n\t\t\t\tlabelUrlMap.push({\n\t\t\t\t\tlabel: customAction[labelKey],\n\t\t\t\t\turl: customAction[urlKey],\n\t\t\t\t\ttarget: customAction[targetKey]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (labelUrlMap.length == 0) {\n\t\t\tthis.classList.add(\"hide\");\n\t\t\tthis.customActionsExist = false;\n\t\t\treturn;\n\t\t}\n\t\tthis.firstItem = labelUrlMap[0];\n\t\tif (labelUrlMap.length > 1) {\n\t\t\tthis.remainingItems = labelUrlMap.slice(1);\n\t\t\tthis.moreThanOneCustomActionsExist = true;\n\t\t}\n\t\tthis.customActionsExist = true;\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t\tthis.classList.remove(\"hide\");\n\t}\n\n\t_itemSelected(e) {\n\t\tlet id = e.target.id;\n\t\tlet targetItem = (id === \"firstItem\") ? this.firstItem : this.remainingItems[id];\n\t\tif(targetItem.target === 'Popup')\n\t\t\tthis.handlePopup(targetItem.url);\n\t\telse\n\t\t\tthis.handleNav(targetItem.url);\n\t}\n\n\thandlePopup(url, autoLaunched) {\n\t\tthis.$.popup.url = url;\n\t\tthis.$.popup.autoLaunched = autoLaunched;\n\t\tthis.$.popup.messenger = this.messenger;\n\t\tthis.$.popup.open();\n\t}\n\n\thandleNav(url) {\n\t\tif (this._isLightningExperience()) {\n\t\t\tsforce.one.navigateToURL(url);\n\t\t} else {\n\t\t\twindow.location.href = url;\n\t\t}\n\t}\n\n\t_isLightningExperience() {\n\t\treturn (typeof sforce !== 'undefined') && sforce && (!!sforce.one);\n\t}\n\n\tcheckCustomActionsConditionsMet(customAction, showExternalAction) {\n\t\tlet conditionsKey = this.prefix + \"Custom_Action_Conditions__r\";\n\t\tlet fieldKey = this.prefix + \"Field__c\";\n\t\tlet operatorKey = this.prefix + \"Operator__c\";\n\t\tlet filterValueKey = this.prefix + \"FilterValue__c\";\n\n\t\tif (customAction.Name === this.launchExternalName && !showExternalAction)\n\t\t\treturn false;\n\n\t\treturn (customAction[conditionsKey] === undefined) || customAction[conditionsKey].records.some(val => {\n\t\t\t\tif (val[fieldKey] === undefined || val[filterValueKey] === undefined || val[operatorKey] === undefined)\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Get the correct api name if necessary\n\t\t\t\tlet fieldName = API_FIELD_NAME_MAP[val[fieldKey]] || val[fieldKey];\n\n\t\t\t\treturn Util.arithmeticOperatorConversion(this.products[this.productIndex].record[fieldName],\n\t\t\t\t\tval[filterValueKey], val[operatorKey])\n\t\t\t});\n\t}\n\n\t_changeMenu(e) {\n\t\tthis.menuClosed = PageHeader.changeMenu(e, this.menuClosed, this.$$('#remainingItems'), 'open', this);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\t_viewportChanged() {\n\t\tthis.buttonsCollapsed = this.viewport && !this.viewport.isMobile() && this.viewport.M.up ? false : true;\n\t}\n\n\t_newMessenger() {\n\t\treturn new ProductMessenger(this.quote, this.products[this.productIndex], this.prefix, this.currencyIsoCode, Polymer.Base);\n\t}\n\n\t_updateQuoteFromPopupResponse() {\n\t\tthis.quote = this.popupResponse.quote;\n\t}\n}\n\nPolymer(CustomActions);","export class AttributeItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true,\n\t\t\t\tobserver: '_notifyAttributeChanged'\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tmd: Object,\n\t\t\tdata: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setAttributeMD(item, model, targetField)',\n\t\t\t'setTargetField(item, model)',\n\t\t\t'setRequired(value, model, attributeMD)',\n\t\t\t'setLabel(md)'\n\t\t];\n\t}\n\n\tsetRequired() {\n\t\t//because autoSelect disables the attribute, it doesn't make sense for it to be required\n\t\tif (this.attributeMD.required === false || this.attributeMD.autoSelect === true)\n\t\t\treturn;\n\t\tthis.toggleClass('mandatory-no-value', this.isValidValue() === false, this.$.attributeField);\n\t}\n\n\tisValidValue() {\n\t\treturn !!(this.value !== undefined && this.value !== null && this.value !== '');\n\t}\n\n\tsetAttributeMD() {\n\t\tthis.attributeMD = this.model.attributeMD[this.item];\n\t\tthis.$.field.disabled = this.attributeMD.autoSelect; //autoSelect set to true disabled the attribute\n\t\tthis.hidden = this.attributeMD.hidden; //a configuration attribute can be hidden which means don't show on the UI\n\t\tlet md = JSON.parse(JSON.stringify(this.model.fields[this.targetField])); //don't reflect changes back to cache\n\t\tif(md.type === 'picklist')\n\t\t\tmd.picklistValues = this.getPicklistValues(md.picklistValues);\n\n\t\tthis.md = md;\n\t}\n\n\tsetTargetField() {\n\t\tthis.$.field.record = this;\n\t\tthis.targetField = this.model.attributeMD[this.item].targetFieldName;\n\t}\n\n\tsetLabel() {\n\t\tthis.label = this.md.label;\n\t}\n\n\tgetPicklistValues(defaultValues) {\n\t\tif(this.attributeMD === undefined)\n\t\t\treturn defaultValues;\n\n\t\tif(!this.attributeMD.shownValues && !this.attributeMD.hiddenValues)\n\t\t\treturn defaultValues;\n\n\t\tlet shownValues = this.attributeMD.shownValues || [];\n\t\tif(!this.attributeMD.shownValues) {\n\t\t\tfor (let item of defaultValues)\n\t\t\t\tshownValues.push(item.value);\n\t\t}\n\n\t\tlet hiddenValues = this.attributeMD.hiddenValues || [];\n\t\treturn defaultValues.filter(function(item) {\n\t\t\treturn shownValues.indexOf(item.value) !== -1 && hiddenValues.indexOf(item.value) === -1;\n\t\t});\n\t}\n\n\t_notifyAttributeChanged(e) {\n\t\tif (!this.model)\n\t\t\treturn;\n\t\tthis.fire('sb-config-attribute-changed', {\n\t\t\tId: this.item,\n\t\t\tbundleId: this.model.attributeMD[this.item].bundleId,\n\t\t\tchanged: true,\n\t\t\tpath: true //this should always be set to true because any change to a value even if falsey should be considered a change\n\t\t});\n\t}\n\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\tgetValue(name) {\n\t\tlet ids = this.model.attributeFieldMD[name];\n\t\tif(ids && ids.length > 0)\n\t\t\treturn this.data[ids[0]];\n\t}\n\n\tsetValue(path, value) {\n\t\tthis.set('data.' + path, value);\n\t}\n\n\tequals(attributeItem) {\n\t\treturn this.data === attributeItem.data;\n\t}\n}\n\nPolymer(AttributeItem);\n","import {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class AttributeTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-attribute-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tposition: String,\n\t\t\tmodel: Object,\n\t\t\tconfigAttributes: Object,\n\t\t\taddedClass: String,\n\t\t\tmd: Object,\n\t\t\tshowTable: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'generateColumns(featureId, model, configAttributes, md)',\n\t\t\t'getMD(configAttributes, model)',\n\t\t\t'bindDataToModel(configAttributes.*)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.optionFieldMetadata.addEventListener('md-changed', function (e) {\n\t\t\tthis.setMD(e);\n\t\t}.bind(this));\n\t}\n\n\tgetMD() {\n\t\tlet attributeFields = {},\n\t\t\tattributeModelData = this.model.configurationAttributeModelMap;\n\t\tfor (let i in attributeModelData)\n\t\t\tattributeFields[attributeModelData[i].targetFieldName] = null;\n\n\t\tthis.$.optionFieldMetadata.fields = Object.keys(attributeFields);\n\t}\n\n\tsetMD(e) {\n\t\tthis.md = {\n\t\t\tfields: e.detail.value.fieldsByObject[this.model.prefix + 'ProductOption__c'],\n\t\t\tattributeMD: this.model.configurationAttributeModelMap,\n\t\t\tattributeFieldMD: this.model.configurationAttributeTargetFieldMap\n\t\t};\n\t}\n\n\tgenerateColumns() {\n\t\tlet column1Group = [], column2Group = [], column3Group = [];\n\t\tlet featureAttributes = this.model.configAttributesByFeatureId[this.featureId] || [];\n\t\tlet numAttributes = featureAttributes.length;\n\t\tlet featureAttributesByFieldName = {};\n\t\tfor (let i = 0; i < numAttributes; i++) {\n\t\t\tlet targetAttribute = featureAttributes[i].myId;\n\t\t\tthis.md.attributeMD[targetAttribute].processed = true;\n\t\t\tlet targetFieldName = featureAttributes[i].targetFieldName;\n\n\t\t\tlet featureAttributeIds = featureAttributesByFieldName[targetFieldName] || [];\n\t\t\tfeatureAttributeIds.push(targetAttribute);\n\t\t\tfeatureAttributesByFieldName[targetFieldName] = featureAttributeIds;\n\n\t\t\tif (featureAttributes[i].position == this.position || !this.position) {\n\t\t\t\tif (featureAttributes[i].columnOrder == 1)\n\t\t\t\t\tcolumn1Group.push(targetAttribute);\n\t\t\t\telse if (featureAttributes[i].columnOrder == 2)\n\t\t\t\t\tcolumn2Group.push(targetAttribute);\n\t\t\t\telse\n\t\t\t\t\tcolumn3Group.push(targetAttribute);\n\t\t\t}\n\t\t}\n\t\tthis.normalizeData(featureAttributesByFieldName);\n\n\t\tthis.setColumns(column1Group, column2Group, column3Group);\n\t}\n\n\t/**\n\t * Its possible that other configuration attributes for this product\n\t * have been changed before these attributes have been stamped in since in mobile feature details are\n\t * stamped in only when the feature is expanded and not when the configurator page is rendered.\n\t * Also tabs don't stamp the content in until the tab has been clicked\n\t * Thus, we need to see if there exists any processed configuration attributes with the same target field\n\t * and update this feature's equivalent configuration attribute with that value to simulate the two-way\n\t * binding of those attributes that did not take place because the attributes were not yet stamped in.\n\t */\n\tnormalizeData(featureAttributesByFieldName) {\n\t\t// loop through all the configuration attributes in this feature by the target field of the attribute\n\t\tfor(let targetFieldName in featureAttributesByFieldName) {\n\t\t\tlet featureAttributes = featureAttributesByFieldName[targetFieldName];\n\t\t\tlet bundleAttributes = this.md.attributeFieldMD[targetFieldName];\n\n\t\t\t// return early if there are not more bundle attributes for a given target field\n\t\t\t// then there are feature attributes for the same target field\n\t\t\tif(bundleAttributes.length <= featureAttributes.length)\n\t\t\t\treturn;\n\n\t\t\t// loop through bundle attributes to find any that are not in this feature\n\t\t\t// and any that have already been processed\n\t\t\tfor (let bundleAttribute of bundleAttributes) {\n\n\t\t\t\t// if this bundle attribute is in this feature, then continue\n\t\t\t\tif (featureAttributes.indexOf(bundleAttribute) !== -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if this bundle attribute has not yet been processed (i.e. its feature has not yet been expanded)\n\t\t\t\t// then simply continue as the user could have yet changed its value\n\t\t\t\tif(!this.md.attributeMD[bundleAttribute].processed)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// we have found a bundle attribute for the same target field that is not in this feature\n\t\t\t\t// and has been processed, so lets sync its value with this features attribute value\n\t\t\t\tfor(let featureAttribute of featureAttributes)\n\t\t\t\t\tthis.configAttributes[featureAttribute] = this.configAttributes[bundleAttribute];\n\n\t\t\t\t// since the syncing is complete, we can move on to the next target field\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetColumns(column1Group, column2Group, column3Group) {\n\t\tif (column1Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.firstColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.firstColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.firstColumn.model = this.md;\n\t\t\tif(!this.$.firstColumn.group)\n\t\t\t\tthis.$.firstColumn.group = column1Group;\n\t\t}\n\t\tif (column2Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.secondColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.secondColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.secondColumn.model = this.md;\n\t\t\tif(!this.$.secondColumn.group)\n\t\t\t\tthis.$.secondColumn.group = column2Group;\n\t\t}\n\t\tif (column3Group.length > 0) {\n\t\t\tthis.showTable = true;\n\t\t\tthis.$.thirdColumn.overridePropagateFromParentToChild(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.setFromChildToParentExtension(this.captureCallBack);\n\t\t\tthis.$.thirdColumn.model = this.md;\n\t\t\tif(!this.$.thirdColumn.group)\n\t\t\t\tthis.$.thirdColumn.group = column3Group;\n\t\t}\n\t}\n\n\t//The purpose of this code is to bypass groups propagateFromParentToChild handler\n\t//We have a unique case for updating the elements for a given group\n\tcaptureCallBack(e) {\n\t\tlet elements = this.elements,\n\t\t\tattributeId = e.path.split('.')[1];\n\t\tif (attributeId === undefined)\n\t\t\treturn;\n\n\t\tlet targetField = this.model.attributeMD[attributeId].targetFieldName;\n\t\tfor (let i = 0, l = elements.length; i < l; i++) {\n\t\t\tlet elementId = elements[i].item.split('.')[0];\n\t\t\tif (elementId === attributeId)\n\t\t\t\tcontinue;\n\n\t\t\tif (this.model.attributeMD[elements[i].item].targetFieldName === targetField)\n\t\t\t\telements[i].value = e.value;\n\t\t}\n\t}\n\n\tbindDataToModel(e) {\n\t\tif (e.path === undefined || e.path === 'configAttributes')\n\t\t\treturn;\n\n\t\t//update the product view model with the data change\n\t\tlet targetField = this.model.configurationAttributeModelMap[e.path.split('.')[1]].targetFieldName;\n\t\tthis.model.product.configuration.configurationData[targetField] = e.value;\n\t}\n\n\tisMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\nPolymer(AttributeTable);\n","export class ProductBundlesFilterItem {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-filter-item';\n\t\tthis.properties = {\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\titem: String,\n\t\t\tmodel: Object,\n\t\t\tlabel: String\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn ['setFieldData(model)'];\n\t}\n\n\tsetFieldData() {\n\t\tlet md;\n\t\tfor (let i = 0, numFields = this.model.length; i < numFields; i++) {\n\t\t\tif (this.model[i].name === this.item) {\n\t\t\t\tthis.label = this.model[i].label;\n\t\t\t\t// allow pick list types, but convert all other to string types\n\t\t\t\tmd = this.model[i].type === 'picklist' ? this.model[i] : { type: 'string' };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.$.field.editing = true;\n\t\tthis.$.field.property = this.item;\n\t\tthis.$.field.md = md;\n\t}\n\n\tclear() {\n\t\tthis.value = null;\n\t}\n}\n\nPolymer(ProductBundlesFilterItem);\n","import {ConfiguratorSearch} from '../../search/ConfiguratorSearch.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\n\nexport class ProductBundlesLayout {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-bundles-layout';\n\t\tthis.properties = {\n\t\t\tproductIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\tconfiguredProducts: Array,\n\t\t\tsetToSections: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tisClassic: Boolean,\n\t\t\tnoHeader: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasSelected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tobserver: 'formatBundlesLayout'\n\t\t\t},\n\t\t\tdrawerState: String,\n\t\t\tqId: String,\n\t\t\tsearchFilters: Array, //array of fields for md\n\t\t\tsearchValuesByFilter: Object, //keymap of filter fields vs inputs\n\t\t\tsearchFieldMD: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(viewport)'\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setMD(searchFilters)',\n\t\t\t'initSearchFilter(searchFieldMD, prefix)',\n\t\t\t'_updateProductFromPopupResponse(popupResponse, configuredProducts)',\n\t\t\t'_resize(configuredProducts.*)'\n\t\t];\n\t}\n\n\t_resize() {\n\t\tthis.resize();\n\t}\n\n\tinitSearchFilter() {\n\t\tthis.$.group.group = this.searchFilters;\n\t\tthis.$.group.model = this.searchFieldMD;\n\t\tthis.$.group.data = this.searchValuesByFilter;\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix);\n\t}\n\n\tready() {\n\t\tthis.handleResize();\n\t\tthis.handlePanelSlide();\n\t\tthis.handlePanelEvents();\n\t\tthis.handleMD();\n\t}\n\n\thandlePanelEvents() {\n\t\tthis.addEventListener('side-toggle-clicked', function () {\n\t\t\tthis.toggle();\n\t\t}.bind(this));\n\t\tthis.addEventListener('iron-select', function () {\n\t\t\tif (this.$.drawer.selected == 'drawer')\n\t\t\t\tthis.drawerState = 'open';\n\t\t\telse\n\t\t\t\tthis.drawerState = 'closed';\n\t\t}.bind(this));\n\t\tthis.addEventListener('x-clicked', function () {\n\t\t\tthis.$.search.closeDrawer();\n\t\t}.bind(this));\n\t\tthis.addEventListener('enter-keypress', function() {\n\t\t\tif (this.searchFilters)\n\t\t\t\tthis.applyFilters();\n\t\t}.bind(this));\n\t}\n\n\thandleMD() {\n\t\tthis.$.md.addEventListener('md-changed', function (e) {\n\t\t\tthis.searchFieldMD = e.detail.value.fields;\n\t\t\tthis.selectBundle();\n\t\t}.bind(this));\n\t}\n\n\tnavTo(e) {\n\t\tlet target = Polymer.dom(e).rootTarget.id.split('_')[1];\n\t\tlet numBundles = this.configuredProducts.length;\n\t\tlet index = this.productIndex;\n\t\tfor (let i = 0; i < numBundles; i++) {\n\t\t\tif (this.getProductId(i) === target)\n\t\t\t\tindex = i;\n\t\t}\n\t\t// enable the selection of the tapped item\n\t\tthis.setSelected(target, true);\n\n\t\tif (!this.isMobile && this.isClassic)\n\t\t\tthis.$$('#Bundle' + target).scrollIntoView();\n\t\telse\n\t\t\tthis.fire('bundle-panel-clicked', index);\n\t}\n\n\ttoggle() {\n\t\tthis.toggleTransition(true);\n\t\tthis.$.drawer.togglePanel();\n\t}\n\n\tclassicOrSelectedIndex(item, configuredProductIndex) {\n\t\treturn ((this.isClassic && !this.isMobile) ||\n\t\t(this.configuredProducts[this.productIndex] === item) ||\n\t\t(!this.productIndex && configuredProductIndex === 0) ||\n\t\t((this.productIndex >= this.configuredProducts.length) && configuredProductIndex === 0));\n\t}\n\n\thandleResize() {\n\t\tlet sfSidebar = document.querySelector('#sidebarCell');\n\t\tif (sfSidebar) {\n\t\t\tsfSidebar.addEventListener('click', this.resize.bind(this));\n\t\t}\n\t\twindow.addEventListener('resize', this.resize.bind(this));\n\t}\n\n\tresize() {\n\t\tthis.toggleTransition(false);\n\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\thandlePanelSlide() {\n\t\tif (!this.isMobile) {\n\t\t\t//check for which drawers are open\n\t\t\tthis.addEventListener('iron-select', function () {\n\t\t\t\tif (this.$.drawer.selected === 'drawer') {\n\t\t\t\t\tthis._setBundleContainerWidth(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._setBundleContainerWidth(true);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tif (this.isMobile) {\n\t\t\tthis.addEventListener('iron-deselect', function (e) {\n\t\t\t\tif (e.detail.item.id === 'drawer') {\n\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tselectBundle() {\n\t\t//add scrim to search panel\n\t\tthis.$.search.$$('#scrim').style.width = '100%';\n\n\t\tif (this.isMobile) {\n\t\t\tthis.navWidth = 0;\n\t\t\t//add scrim to bundle list in mobile\n\t\t\tthis.$.drawer.$$('#scrim').style.width = '100%';\n\t\t}\n\t\tif (this.configuredProducts.length === 1)\n\t\t\tthis.navWidth = 0;\n\n\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\n\t\tif (!this.isClassic || this.isMobile) {\n\t\t\tlet targetId = this.getProductId(this.productIndex);\n\n\t\t\tthis.fire('bundle-name-changed', {name: this.configuredProducts[this.productIndex].record.Name});\n\t\t\tPolymer.dom(this.$.panel).observeNodes(function () {\n\t\t\t\tthis.setSelected(targetId, false);\n\t\t\t}.bind(this));\n\t\t}\n\t\tthis.resize();\n\t}\n\n\tbuildPanelIfMultipleBundesAndNotMobile() {\n\t\tif (this.configuredProducts.length  === 1 || this.isMobile)\n\t\t\treturn;\n\n\t\tthis.panelWidth = 256;\n\t\tthis.navWidth = 24;\n\t\tthis.$.panel.rightSideButton = true;\n\t\tthis.toggleTransition(false);\n\t\tif (this.isOpen === \"1\") {\n\t\t\tthis.$.drawer.selected = 'drawer';\n\t\t\tthis.drawerState = 'open';\n\t\t\tthis._setBundleContainerWidth(false);\n\t\t}\n\t\telse {\n\t\t\tthis.$.drawer.selected = 'main';\n\t\t\tthis.drawerState = 'closed';\n\t\t\tthis._setBundleContainerWidth(true);\n\t\t}\n\t}\n\n\t_setBundleContainerWidth(isDrawerOpen) {\n\t\tif (this.configuredProducts && this.configuredProducts.length < 2) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggleClass('open', !isDrawerOpen, this.$.bundleContainer);\n\t\tthis.toggleClass('close', isDrawerOpen, this.$.bundleContainer);\n\t}\n\n\ttoggleTransition(enable) {\n\t\t// enables/disables the transition for the drawer\n\t\tthis.$.drawer._transition = enable;\n\t\t// enables/disables the transition for the content\n\t\tthis.toggleClass('transition', enable, this.$.bundleContainer);\n\t}\n\n\tdefaultState() {\n\t\tif (this.isOpen === \"1\")\n\t\t\treturn 'drawer';\n\t\treturn 'main';\n\t}\n\n\ttoggleSearch() {\n\t\tthis.$.search.togglePanel();\n\t}\n\n\trefocus() {\n\t\tthis.$.search.querySelector('#searchPanel').querySelector('sb-group').$$('sb-product-bundles-filter-item').$$('sb-field').$$('div#f').firstChild.focus();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clear.focus();\n\t}\n\n\tsetMD() {\n\t\tthis.$.md.object = 'ProductOption__c';\n\t\tthis.$.md.fields = this.searchFilters;\n\t}\n\n\tapplyFilters() {\n\t\tthis.$.clear.focus();\n\t\tthis.$.search.closeDrawer();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix);\n\t}\n\n\tclearFields() {\n\t\tthis.fire('iron-signal', {name: 'sb-clear-product-filter'});\n\t\tthis.blur();\n\t\tthis.configSearch = new ConfiguratorSearch(this.searchValuesByFilter, this.prefix);\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\t}\n\n\tgetProductId(productIndex, underscorePrefix) {\n\t\tlet product = this.configuredProducts[productIndex];\n\t\t// product key is the unique identifier of a product if a cloned product\n\t\tlet id = product.productKey || product.record.Id;\n\t\tlet prefix = underscorePrefix ? '_' : '';\n\t\treturn prefix + id;\n\t}\n\n\tsetSelected(targetId, clearPrevious) {\n\t\tif (clearPrevious)\n\t\t\tthis.removeAllSelected();\n\t\tthis.toggleClass('selected-tab', true, this.$$('#_' + targetId));\n\t}\n\n\tremoveAllSelected() {\n\t\tlet navItems = Polymer.dom(this.root).querySelectorAll('div.nav-item');\n\t\tfor (let navItem of navItems)\n\t\t\tthis.toggleClass('selected-tab', false, navItem);\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_updateProductFromPopupResponse() {\n\t\tlet products = this.popupResponse.products;\n\t\tif(!products || products.length === 0)\n\t\t\treturn;\n\n\t\tlet numConfiguredProducts = this.configuredProducts.length;\n\t\tfor(let product of products)\n\t\t\tthis.push('configuredProducts', product);\n\n\t\tif(numConfiguredProducts === 1)\n\t\t\tthis.buildPanelIfMultipleBundesAndNotMobile();\n\t}\n\n\tformatBundlesLayout() {\n\t\tthis.toggleClass('multiple-bundles', this.hasMultipleBundles, this.$.bundleContainer);\n\t}\n}\n\nPolymer(ProductBundlesLayout);","import {FieldSetHandler} from '../../../../common/layout/fields/FieldSetHandler.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {AppContext} from 'common/core/AppContext.js';\n\nexport class ProductFeature {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = \"sb-product-feature\";\n\n\t\tthis.listeners = {\n\t\t\t'selection-changed': 'handleSelectionCounter'\n\t\t};\n\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tmaxOptions: Object,\n\t\t\tfeature: Object,\n\t\t\tfieldSetKey: String,\n\t\t\tfieldSetHandler: Object,\n\t\t\ttabNames: {\n\t\t\t\ttype: Array,\n\t\t\t\treadOnly: true,\n\t\t\t\tvalue: [\"options\", \"attributes\"]\n\t\t\t},\n\t\t\ttabs: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobile(viewport)\"\n\t\t\t},\n\t\t\thasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setHasConfigAttributes(model, featureId)\"\n\t\t\t},\n\t\t\tmobileHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\thasOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: \"_setHasOptions(model, featureId)\"\n\t\t\t},\n\t\t\tmobileHasOptions: Boolean,\n\t\t\thasOptionsAndConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions)'\n\t\t\t},\n\t\t\tmobileHasOptionsAndConfigAttributes: Boolean,\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasInstructions(feature)'\n\t\t\t},\n\t\t\tmobileHasInstructions: Boolean,\n\t\t\texpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tselectedOptions: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: 0\n\t\t\t},\n\t\t\thasSelectedOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_hasSelectedOptions(selectedOptions)'\n\t\t\t},\n\t\t\tfeatureIndex: Number,\n\t\t\tconfigAttributes:{\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasUpgradedOptions(feature)'\n\t\t\t},\n\t\t\tmobileRendering: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tmobileExpanded: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'render(featureId, model)',\n\t\t\t'buildTabs(viewport, model, featureId)',\n\t\t\t'featureChanged(feature)',\n\t\t\t'initFieldSet(model, fieldSetKey, fieldSetHandler)'\n\t\t];\n\t}\n\n\t_setHasUpgradedOptions() {\n\t\treturn this.model.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_hasSelectedOptions(selectedOptions) {\n\t\treturn !selectedOptions;\n\t}\n\n\trender() {\n\t\tif (!this.model.featureIdsWithOptionsOrConfigAttr[this.featureId])\n\t\t\treturn;\n\t\tthis.setFeatureAndOptionSelectionMethod();\n\t\tthis.setOptionsDetails();\n\t\tthis.setFieldSetHandler();\n\t\tthis.renderFeatureInDesktopOrMobileView();\n\t\tthis.initSelectedOptions();\n\t\tthis.handleDeleteOptions();\n\t\tthis.handleOptionChangedByRule();\n\t}\n\n\tbuildTabs() {\n\t\tif (!this.isMobile)\n\t\t\treturn;\n\n\t\tlet i18n = AppContext.properties.i18n.value();\n\t\tlet optionsTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: i18n.l(\"Options\"),\n\t\t\tpageComponent: \"sb-product-option-table\",\n\t\t\tattributes: [ { name: 'id', value: 'ot' } ],\n\t\t\tbind: [ \"model\", \"featureId\", \"fieldSet\", \"fieldSetName\", \"routeSource\", \"isClickSelection\",\n\t\t\t\t\"disabledStateMap\", \"configSearch\", \"hasUpgradeOptions\"]\n\t\t};\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'configAttributesTop' }, { name: 'added-class', value: 'header-attributes' } ],\n\t\t\tbind: [ \"featureId\", \"model\", \"configAttributes\"]\n\t\t};\n\t\tthis.tabs = [optionsTab, attributesTab];\n\t}\n\n\tsetFieldSetHandler() {\n\t\tthis.fieldSetHandler = new FieldSetHandler(this.model.product.optionFieldSets, 'OptionConfiguration',\n\t\t\t'OptionConfigurationTablet', 'OptionConfigurationPhone');\n\t}\n\n\tsetFeatureAndOptionSelectionMethod() {\n\t\tthis.feature = this.model.getFeature(this.featureId);\n\t}\n\n\tsetOptionsDetails() {\n\t\tthis.isClickSelection = this.feature.optionSelectionMethod === 'Click';\n\t\tthis.routeSource = 'Configurator';\n\t}\n\n\tfeatureChanged() {\n\t\tlet configurationFieldSet = this.feature.record[this.model.prefix + 'ConfigurationFieldSet__c'];\n\t\tthis.fieldSetKey = configurationFieldSet === undefined ? null : configurationFieldSet;\n\t}\n\n\tsetFieldSetFromViewport() {\n\t\tlet fs = this.fieldSetHandler.getByViewport(this.viewport);\n\t\tthis.fieldSet = fs.fields;\n\t\tthis.fieldSetName = fs.name;\n\t}\n\n\tinitFieldSet() {\n\t\tif(this.fieldSetKey) {\n\t\t\tthis.fieldSet = this.model.product.optionFieldSets[this.fieldSetKey];\n\t\t\tthis.fieldSetName = this.fieldSetKey;\n\t\t} else {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\t_setIsMobile(viewport) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (viewport) {\n\t\t\treturn viewport.isMobile();\n\t\t}\n\t}\n\n\t_setHasConfigAttributes(model, featureId) {\n\t\tlet configAttributes = this.model.configAttributesByFeatureId[featureId];\n\n\t\tif(!configAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < configAttributes.length; i++) {\n\t\t\tif(!configAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setHasOptions() {\n\t\treturn !!this.model.optionsByFeatureId[this.featureId] || this.model.featureIdsWIthSelectionMethodDynamic[this.featureId];\n\t}\n\n\t_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions) {\n\t\treturn hasConfigAttributes && hasOptions;\n\t}\n\n\t_setHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.viewport = e.detail.viewport;\n\n\t\tif(!this.fieldSetKey) {\n\t\t\tthis.setFieldSetFromViewport();\n\t\t}\n\t}\n\n\trenderFeatureInDesktopOrMobileView() {\n\t\tthis.toggleClass(\"group\", !this.isMobile, this.$.feature);\n\t}\n\n\tapplyFilters() {\n\t\tlet featureOptions = this.model.getOptionsByFeatureId(this.featureId);\n\t\tlet configSearch = new ConfiguratorSearch(this.searchFilters, featureOptions);\n\t\tthis.filtered = !configSearch.hasOptions || !configSearch.containsFeature(this.feature);\n\t}\n\n\tmobileExpand(e) {\n\t\tif(this.mobileExpanded) {\n\t\t\tthis.expand(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.mobileRendering)\n\t\t\treturn; // already tapped on it and its still rendering so nothing more to do here\n\n\t\t// setting this to true displays the loading spinner\n\t\tthis.mobileRendering = true;\n\n\t\t// removing the 'first' class removes the chevron\n\t\tthis.toggleClass('first', false, this.$$('header'));\n\n\t\t// Wait for the spinner to render before proceeding\n\t\tPolymer.RenderStatus.afterNextRender(this, () => {\n\t\t\t// set all the boolean properties that drives the mobile dom-if rendering\n\t\t\tthis.mobileHasInstructions = this.hasInstructions;\n\t\t\tthis.mobileHasOptionsAndConfigAttributes = this.hasOptionsAndConfigAttributes;\n\t\t\tthis.mobileHasConfigAttributes = this.hasConfigAttributes;\n\t\t\tthis.mobileHasOptions = this.hasOptions;\n\t\t\tPolymer.dom(this.$.feature).observeNodes(function () {\n\t\t\t\t// nodes have been stamped in, so lets finish the expanding process\n\t\t\t\tthis.mobileExpanded = true;\n\t\t\t\tthis.mobileRendering = false;\n\t\t\t\t// adding the 'first' class back re-adds the chevron\n\t\t\t\tthis.toggleClass('first', true, this.$$('header'));\n\t\t\t\tthis.expand(e);\n\t\t\t}.bind(this));\n\t\t});\n\t}\n\n\texpand(e) {\n\t\tthis.expanded = !this.expanded;\n\t\tthis.fire('feature-expanded', {expanded: this.expanded, path: Polymer.dom(e).path});\n\t}\n\n\tinitSelectedOptions() {\n\t\tlet prefix = AppContext.org.prefix !== '' ? AppContext.org.prefix + '__' : '';\n\t\tvar options = this.model.getOptionsByFeatureId(this.featureId);\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].selected)\n\t\t\t\tthis.selectedOptions++;\n\n\t\t\tif(options[i].record[prefix + 'UnitPrice__c'] === undefined) {\n\t\t\t\tconsole.warn('Option is missing entry in selected pricebook => ' + options[i].record[prefix + 'ProductCode__c'] + ': ' + options[i].record[prefix + 'ProductName__c']);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSelectionCounter(e) {\n\t\tif(!e.detail.changed)\n\t\t\treturn;\n\n\t\tif (e.detail.selectionType === 'radio') {\n\t\t\t// When selected, a radio can have either one option or no options\n\t\t\tthis.selectedOptions = e.detail.selected ? 1 : 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.selectedOptions && !e.detail.selected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectedOptions += (e.detail.selected ? 1 : -1);\n\t}\n\n\thandleDeleteOptions(e) {\n\t\tthis.addEventListener('delete-tapped', function(e) {\n\t\t\tif (this.selectedOptions > 0)\n\t\t\t\tthis.selectedOptions--;\n\t\t});\n\t}\n\n\thandleOptionChangedByRule(e) {\n\t\tthis.addEventListener('option-changed-by-rule', function(e) {\n\t\t\te.detail.added ? this.selectedOptions++ : this.selectedOptions--;\n\t\t});\n\t}\n}\n\nPolymer(ProductFeature);","export class ProductFeatureCategoryList {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-category-list';\n\t\tthis.properties = {\n\t\t\tcategoryNamesOrFeatures: Array,\n\t\t\thasCategories: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'setHasCategories(model)',\n\t\t\t'setCategoryNamesOrFeatures(model, hasCategories)'\n\t\t];\n\t}\n\n\tsetHasCategories(model) {\n\t\tthis.hasCategories = model.checkAtLeastOneFeatureHasCategory();\n\t}\n\n\tsetCategoryNamesOrFeatures(model, hasCategories) {\n\t\tif (hasCategories) {\n\t\t\tthis.categoryNamesOrFeatures = Object.keys(model.getTabFeaturesMap());\n\t\t} else {\n\t\t\tthis.categoryNamesOrFeatures = model.featuresWithOptionsOrConfigAttr;\n\t\t}\n\t}\n\n\tgetFeaturesByCategory(categoryName) {\n\t\tvar map = this.model.getTabFeaturesMap();\n\n\t\treturn map[categoryName];\n\t}\n}\n\nPolymer(ProductFeatureCategoryList);","import {Page} from '../../../../common/core/Page.js';\nimport {PageContainer} from '../../../../common/core/sb-page-container/PageContainer.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\n\nexport class ProductFeatureLayout extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-layout';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tqId: String, // quoteId needed for building PVM\n\t\t\tproduct: Object,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tconfigAttributes: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tfeatures: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: '_setFeatures(model)'\n\t\t\t},\n\t\t\tvp: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tisMobile: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobile(vp)'\n\t\t\t},\n\t\t\thasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\thasFeaturelessConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: '_setHasFeaturelessConfigAttributes(configAttributes)'\n\t\t\t},\n\t\t\tisMobileAndHasConfigAttributes: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: '_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes)'\n\t\t\t},\n\t\t\tisSectionLayout: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tisPaginationRequired: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabsForFeatureLayout: Object,\n\t\t\ttabsForTabsAndWizardLayout: Object,\n\t\t\tselectedTabIndex: {\n\t\t\t\ttype: Number,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConstraintsHandler: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {},\n\t\t\t\tcomputed: 'setOptionConstraintsHandler(model)'\n\t\t\t},\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tconfigSearch: Object,\n\t\t\tlistenersAttached: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'_setConfigAttributes(model)', // Must be ran before render, thus it must be ordered in the array before render (W-3837959)\n\t\t\t'render(model, isSectionLayout)',\n\t\t\t'buildModel(product, qId, currencyIsoCode)',\n\t\t\t'handleProductRulesResponse(model, disabledStateMap, product.configuration.*)',\n\t\t\t'_setOptionData(model, product.configuration.optionDataByOptionIds)',\n\t\t\t'_updateProductFromPopupResponse(popupResponse, model)',\n\t\t\t'_createConstraintsHoverMessages(model, optionConstraintsHandler)'\n\t\t];\n\t}\n\n\tbuildModel() {\n\t\tthis.model = new ProductViewModel(this.qId, this.product, this.app.org.prefix, this.currencyIsoCode);\n\t}\n\n\t_setConfigAttributes() {\n\t\tthis.configAttributes = this.model.configurationAttributeValueMap;\n\t}\n\n\t_setHasFeaturelessConfigAttributes() {\n\t\tlet featurelessConfigAttributes = this.model.configAttributesByFeatureId['featureless'];\n\n\t\tif(!featurelessConfigAttributes) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(let i = 0; i < featurelessConfigAttributes.length; i++) {\n\t\t\tif(!featurelessConfigAttributes[i].hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_setFeatures(model) {\n\t\treturn model.featuresWithOptionsOrConfigAttr;\n\t}\n\n\t_setIsMobile(vp) {\n\t\t// Must include the `if` statement since the tests do not bootstrap PageContainer\n\t\tif (vp) {\n\t\t\treturn vp.isMobile();\n\t\t}\n\t}\n\n\t_setHasConfigAttributes(configAttributes) {\n\t\treturn !!Object.keys(configAttributes).length;\n\t}\n\n\t_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes) {\n\t\treturn isMobile && hasFeaturelessConfigAttributes;\n\t}\n\n\tviewportChanged(e) {\n\t\tthis.vp = e.detail.viewport;\n\t}\n\n\trender() {\n\t\tlet optionLayout = this.model.getOptionLayout();\n\t\tif (this.isMobile) {\n\t\t\toptionLayout = 'Sections';\n\n\t\t\tif (this.hasFeaturelessConfigAttributes) {\n\t\t\t\tthis.buildFeatureLayoutTabs();\n\t\t\t\tthis.handleOptionSelectionChanged();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.isSectionLayout) {\n\t\t\toptionLayout = 'Sections';\n\t\t}\n\n\t\tif ( !this.isMobile && (optionLayout === 'Tabs' || this.model.checkAtLeastOneFeatureHasCategory()) ) {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = false;\n\t\t} else if (optionLayout === 'Wizard') {\n\t\t\tthis.buildTabsAndWizardLayoutTabs();\n\t\t\tthis.isPaginationRequired = true;\n\t\t} else if (optionLayout === 'Sections' || optionLayout === 'None') {\n\t\t\tthis.isSectionLayout = true;\n\t\t}\n\t\tthis.handleOptionSelectionChanged();\n\t\tthis.listenersAttached = true;\n\t}\n\n\tbuildFeatureLayoutTabs() {\n\t\tlet featuresTab = {\n\t\t\tname: \"t1\",\n\t\t\tlabel: this.i18n.l(\"Features\"),\n\t\t\tpageComponent: \"sb-product-feature-category-list\",\n\t\t\tbind: [ \"model\", \"configAttributes\", \"disabledStateMap\", \"configSearch\"]\n\t\t};\n\n\t\tlet attributesTab = {\n\t\t\tname: \"t2\",\n\t\t\tlabel: this.i18n.l(\"Attributes\"),\n\t\t\tpageComponent: \"sb-attribute-table\",\n\t\t\tattributes: [ { name: 'id', value: 'globalConfigAttributes' }, { name: 'added-class', value: 'header-attributes' }, { name: 'feature-id', value: 'featureless' } ],\n\t\t\tbind: [\"model\", \"configAttributes\"]\n\t\t};\n\n\t\tthis.tabsForFeatureLayout = [featuresTab, attributesTab];\n\t}\n\n\tbuildTabsAndWizardLayoutTabs() {\n\t\tlet tabFeaturesMap = this.model.getTabFeaturesMap(),\n\t\t\tfeatureKeys = Object.keys(tabFeaturesMap),\n\t\t\ttabs = [];\n\t\tfor (let i = 0, l = featureKeys.length; i < l; i++) {\n\t\t\tlet tId = \"t\" + i;\n\t\t\ttabs.push({name: tId, label: featureKeys[i]});\n\t\t}\n\t\tthis.isSectionLayout = false;\n\t\tthis.tabsForTabsAndWizardLayout = tabs;\n\t}\n\n\tsetOptionConstraintsHandler() {\n\t\treturn new OptionConstraintsHandler(this.model.product, this.model.prefix);\n\t}\n\n\thandleOptionSelectionChanged() {\n\t\tif (this.listenersAttached)\n\t\t\treturn;\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tif (e && e.detail) {\n\t\t\t\tif (e.detail.selected === false && this.model.getOption(e.detail.Id).added) {\n\t\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\t\toption.added = false;\n\t\t\t\t\toption.removed = true;\n\t\t\t\t}\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, e.detail.selected);\n\t\t\t}\n\t\t});\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tif (e && e.detail && !this.hasSameOptionAdded(e.detail.Id)) {\n\t\t\t\tlet option = this.model.getOption(e.detail.Id);\n\t\t\t\toption.added = false;\n\t\t\t\toption.removed = true;\n\t\t\t\tthis.handleOptionConstraints(e.detail.Id, false);\n\t\t\t}\n\t\t}.bind(this));\n\t\tthis.fireSelectionStatesForAddFeatures();\n\t}\n\n\thasSameOptionAdded(optionId) {\n\t\tlet fId = this.model.getOption(optionId).record[this.model.prefix + 'Feature__c'],\n\t\t\tfeature = this.model.getFeature(fId),\n\t\t\toptions = feature ? feature._transient_.optionConfigurations : [];\n\n\t\tfor (let i = 0, l = options.length; i < l; i++) {\n\t\t\tif (options[i].record.Id === optionId)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfireSelectionStatesForAddFeatures() {\n\t\tfor (let featureId of Object.keys(this.model.featureIdsWithSelectionMethodAdd)) {\n\t\t\tlet options = this.model.optionsByFeatureId[featureId];\n\t\t\tif (options !== undefined)\n\t\t\t\toptions.forEach( option => {\n\t\t\t\t\tthis.handleOptionConstraints(option.record.Id, option.selected);\n\t\t\t\t});\n\t\t}\n\t}\n\n\thandleOptionConstraints(optionId, selected) {\n\t\tlet disabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected);\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\thandleProductRulesResponse() {\n\t\tif (!this.domHost || !this.product.configuration.productRulesActions)\n\t\t\treturn;\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.enableOptions))\n\t\t\tif (!this.model.optionSystemOrRequired(id)) // do NOT override system or required properties\n\t\t\t\tthis.product.configuration.productRulesActions.enableOptions[id] = !this.optionConstraintsHandler.optionShouldBeDisabled(id);\n\t\t\telse\n\t\t\t\tdelete this.product.configuration.productRulesActions.enableOptions[id];\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.disableOptions))\n\t\t\tif (!this.model.optionSystemOrRequired(id)) // do NOT override system or required properties\n\t\t\t\tthis.product.configuration.productRulesActions.disableOptions[id] = this.optionConstraintsHandler.optionShouldBeDisabled(id);\n\t\t\telse\n\t\t\t\tdelete this.product.configuration.productRulesActions.enableOptions[id];\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.hideOptions))\n\t\t\tthis.handleShownAndHiddenOptions(this.model.featureIdByOptionId[id], true);\n\t\tfor (var id of Object.keys(this.product.configuration.productRulesActions.showOptions))\n\t\t\tthis.handleShownAndHiddenOptions(this.model.featureIdByOptionId[id], false);\n\n\t\tthis.set('model.productRulesActions', this.product.configuration.productRulesActions);\n\t\tdelete this.product.configuration.productRulesActions;\n\t}\n\n\thandleShownAndHiddenOptions(featureId, hideOption) {\n\t\tlet checkVisibleOptions = hideOption ? this.featureContainsOneVisibleOptions : this.featureContainsNoVisibleOptions;\n\t\tif (checkVisibleOptions.call(this, featureId)) {\n\t\t\tlet index = this.features.findIndex(feature => { return feature.record.Id === featureId; });\n\t\t\tthis.set(['features', index, 'hidden'], hideOption);\n\t\t}\n\t}\n\n\t_setOptionData() {\n\t\tif (!this.domHost)\n\t\t\treturn;\n\t\tthis.set('model.optionDataByOptionIds', this.product.configuration.optionDataByOptionIds);\n\t\tdelete this.product.configuration.optionDataByOptionIds;\n\t}\n\n\tfeatureContainsOneVisibleOptions(featureId) {\n\t\tlet visibleOptions = 0,\n\t\t\toptions = this.model.optionsByFeatureId[featureId],\n\t\t\tl = options.length,\n\t\t\ti = 0;\n\n\t\twhile (visibleOptions <= 1 && i < l) {\n\t\t\tif (!options[i].hidden)\n\t\t\t\tvisibleOptions++;\n\t\t\ti++\n\t\t}\n\n\t\treturn visibleOptions === 1;\n\t}\n\n\tfeatureContainsNoVisibleOptions(featureId) {\n\t\tlet noVisibleOptions = true,\n\t\t\toptions = this.model.optionsByFeatureId[featureId],\n\t\t\tl = options.length,\n\t\t\ti = 0;\n\n\t\twhile (noVisibleOptions && i < l) {\n\t\t\tif (!options[i].hidden)\n\t\t\t\tnoVisibleOptions = false;\n\t\t\ti++\n\t\t}\n\n\t\treturn noVisibleOptions;\n\t}\n\n\t_updateProductFromPopupResponse() {\n\t\tthis.model.init(this.popupResponse.product);\n\t\tthis._setConfigAttributes();\n\t\tthis.set('model.optionNotifications', this.popupResponse.optionNotifications);\n\t}\n\n\t_createConstraintsHoverMessages() {\n\t\tif (this.model.optionConstraintsByConstrained)\n\t\t\treturn;\n\n\t\tthis.model.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n}\n\nPolymer(ProductFeatureLayout);","import {AppContext} from 'common/core/AppContext.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class ProductFeatureList{\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-feature-list';\n\t\tthis.properties = {\n\t\t\tfeatures: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tmodel: Object,\n\t\t\tlabel: String,\n\t\t\tspinner: { //a loading spinner for when we are stamping in the content\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tshow: { //used to show/hide the component.  needs to default to false for FF to get the perf benefits\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\ttabs: { //determines if this component was initialized from a tab\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * For tabs we don't need to load the content until the tab is clicked\n\t * This gets setup here\n\t */\n\tinitLazyTabRendering() {\n\t\tthis.show = this.isMobile() === true || this.tabs === false;\n\t\tif(this.show === false) {\n\t\t\tthis.addEventListener('sb-tab-selected', this.handleTabSelected.bind(this));\n\t\t\t// handles when feature's options are attached per lazy rendering but after product rules actions were run\n\t\t\t// want to run filter feature code at this time to ensure the feature is shown or hidden based on the output of the product rules actions\n\t\t\tthis.addEventListener('sb-options-attached-after-actions', this.filterFeatureHandler.bind(this));\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t//'init(features)',\n\t\t\t'initFeatures(label, model)',\n\t\t\t'filterFeatures(configSearch, features, model, model.productRulesActions, show)',\n\t\t\t'handleFeatureExpandEvent(features)',\n\t\t\t'initLazyTabRendering(tabs, viewport)'\n\t\t];\n\t}\n\n\tinitFeatures() {\n\t\tthis.features = this.features || this.model.getTabFeaturesMap()[this.label];\n\t}\n\n\tfilterFeatures() {\n\t\tif(!this.show)\n\t\t\treturn; // no need to process features filtering until this feature list is shown\n\n\t\tfor (let i = 0, numFeatures = this.features.length; i < numFeatures; i++)\n\t\t\tthis.filterFeatureByIndex(i);\n\t}\n\n\tfilterFeatureHandler(e) {\n\t\tthis.filterFeatureById(e.detail.featureId);\n\t}\n\n\tfilterFeatureById(featureId) {\n\t\tfor(let i = 0, l = this.features.length; i < l; i++) {\n\t\t\tif(this.features[i].record.Id === featureId) {\n\t\t\t\tthis.filterFeatureByIndex(i);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfilterFeatureByIndex(featureIndex) {\n\t\tlet featureOptions = this.configSearch.setOptionVisibility(this.model.optionsByFeatureId[this.features[featureIndex].record.Id] || []);\n\t\tlet isHidden = !this.configSearch.hasRequiredConfigAttributes(this.features[featureIndex], this.model);\n\t\tlet selectionMethod = this.features[featureIndex].record[this.prefix + 'OptionSelectionMethod__c'];\n\n\t\tif (this.configSearch.allOptionsHiddenByRule(featureOptions) && (selectionMethod !== 'Dynamic' || (selectionMethod === 'Dynamic' && this.model.maxOptionsMet(this.features[featureIndex]))))\n\t\t\tisHidden = !this.configSearch.hasConfigAttributes(this.features[featureIndex], this.model);\n\t\telse {\n\t\t\tif (selectionMethod === \"Click\")\n\t\t\t\tisHidden = isHidden && (!this.configSearch.containsFeature(this.features[featureIndex]) || !this.configSearch.hasVisibleOptions(featureOptions));\n\t\t\telse {\n\t\t\t\tif (this.model.maxOptionsMet(this.features[featureIndex]))\n\t\t\t\t\tisHidden = isHidden && (!this.configSearch.containsFeature(this.features[featureIndex]) || !this.configSearch.hasVisibleOptions(this.features[featureIndex]._transient_.optionConfigurations));\n\t\t\t\telse\n\t\t\t\t\tisHidden = isHidden && (!this.configSearch.containsFeature(this.features[featureIndex]) || !this.configSearch.hasVisibleOptions(featureOptions));\n\t\t\t}\n\t\t}\n\t\tthis.set('features.' + featureIndex + '.hidden', isHidden);\n\t}\n\n\thandleFeatureExpandEvent() {\n\t\t//if (!this.model.optionsByFeatureId[this.features[0].record.Id])\n\t\t//\treturn;\n\t\tthis.addEventListener('feature-expanded', function(e) {\n\t\t\tlet nodes = e.detail.path;\n\n\t\t\tnodes.forEach(function(node) {\n\n\t\t\t\tif (node.id === 'feature-header') {\n\t\t\t\t\twhile (node.nextElementSibling) {\n\t\t\t\t\t\tnode.classList.toggle('expanded', e.detail.expanded);\n\t\t\t\t\t\tnode = node.nextElementSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Listens for sb-tab-selected which is fired when the tab for the feature list is clicked\n\t * We then render this component/enable the content inside the dom-if by setting show to true (W-3597046)\n\t */\n\thandleTabSelected() {\n\t\tif (this.show === true)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.async(this.renderComponent.bind(this), 0); //async ensures the spinner is up\n\t}\n\n\t/**\n\t * Toggles the dom-if on\n\t */\n\trenderComponent() {\n\t\tif(this.renderingComponent)\n\t\t\treturn;\n\n\t\tthis.renderingComponent = true;\n\t\tPolymer.RenderStatus.afterNextRender(this, function () {\n\t\t\tthis.show = true;\n\t\t\tthis.spinner = false;\n\t\t\tthis.renderingComponent = false;\n\t\t}.bind(this));\n\t}\n\n\tget prefix() {\n\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t}\n\n\t/**\n\t * @returns {Boolean} is the device mobile?\n\t */\n\tisMobile() {\n\t\treturn !!(this.viewport && this.viewport.isMobile());\n\t}\n}\n\nPolymer(ProductFeatureList);","import {AppContext} from 'common/core/AppContext.js';\nimport {RelationshipFieldManager} from 'common/relationship/RelationshipFieldManager.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\n\nexport class OptionCell {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-cell';\n\t\tthis.properties = {\n\t\t\titem: String,\n\t\t\titemLabel: String,\n\t\t\tvalue: {\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tmodel: Object,\n\t\t\tdata: Object,\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn AppContext.org.prefix ? AppContext.org.prefix + '__' : '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tselected: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tindex: Number,\n\t\t\tdisplay: String,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function() {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'buildCell(itemLabel, model, data, prefix)',\n\t\t\t'setItemLabel(item)',\n\t\t\t'_displayChanged(value, display, item, data, field)'\n\t\t];\n\t}\n\n\tbuildCell() {\n\t\tthis.field = this.getField();\n\t\tif (this.itemLabel === this.prefix + 'Quantity__c')\n\t\t\tthis.initQuantityCell();\n\t\telse if (this.itemLabel === this.prefix + 'UnitPrice__c')\n\t\t\tthis.initUnitPriceCell();\n\t\telse\n\t\t\tthis.initCell();\n\t}\n\n\tgetQuantityEditable() {\n\t\treturn this.getFieldRecordValue('QuantityEditable__c') || this.data.recordHasQuantity === false;\n\t}\n\n\tgetPriceEditable() {\n\t\treturn this.getFieldRecordValue('PriceEditable__c') === 'Yes' && this.getFieldRecordValue('Bundled__c') === false;\n\t}\n\n\tgetField() {\n\t\treturn this.model.fieldDetails[this.item];\n\t}\n\n\tinitQuantityCell() {\n\t\t//if this is an MDQ option that has already been selected on a previous configuration, we don't create a field, but instead show a warning icon\n\t\tif(this.data.hasDimension === true && this.data.isSegmented === true && this.data.configured === true)\n\t\t\treturn this.mdqWarningIcon = true;\n\t\tthis.editable = this.getQuantityEditable();\n\t\tif (this.getFieldRecordValue('ProductQuantityScale__c') !== undefined)\n\t\t\tthis.field.scale = this.getFieldRecordValue('ProductQuantityScale__c');\n\t\telse if (AppContext.org.quantityScale !== undefined)\n\t\t\tthis.field.scale = AppContext.org.quantityScale;\n\n\t\tthis.$.field.preventNumericAlignment = true;\n\t\tthis.attachQuantityChangeCallback();\n\t\tthis.initCell();\n\t}\n\n\tinitUnitPriceCell() {\n\t\tthis.editable = this.getPriceEditable();\n\t\tthis.initCell();\n\t}\n\n\tinitCell() {\n\t\t// if mobile and the first column then not editable (the editable equivalent of this field will be a later index)\n\t\tif(this.index === 0 && this.viewport && this.viewport.isMobile())\n\t\t\tthis.editable = false;\n\n\t\tif (this.editable === undefined)\n\t\t\tthis.editable = this.field.updateable && this.quoteLineHasField(this.itemLabel);\n\n\t\tif (this.value === undefined)\n\t\t\tthis.value = '';\n\n\t\tthis.setDisplayIfRelationshipItem();\n\t\tthis.attachValueChangedCallback();\n\t\tthis.handleOriginalValues();\n\t\tthis.$.field.record = this;\n\t\tthis.$.field.md = this.field;\n\t}\n\n\tattachQuantityChangeCallback() {\n\t\tthis.addEventListener('value-changed', function (e) {\n\t\t\tthis.fire('sb-quantity-changed', {\n\t\t\t\tId: this.data.record.Id,\n\t\t\t\tbundleId: this.getBundleId(),\n\t\t\t\tchanged: true,\n\t\t\t\tinvalidQuantity: this.data.invalidQuantity,\n\t\t\t\tvalidQuantity: this.data.validQuantity,\n\t\t\t\tpath: e.path\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tattachValueChangedCallback() {\n\t\tthis.addEventListener('value-changed', this.syncValueChangeWithOptionConfiguration.bind(this));\n\t}\n\n\tgetBundleId() {\n\t\t// the option's parentProductKey is the unique identifier of its product if it's a cloned product\n\t\treturn this.data.parentProductKey || this.getFieldRecordValue('ConfiguredSKU__c');\n\t}\n\n\tgetFieldRecordValue(field) {\n\t\treturn this.data.record[this.prefix + field];\n\t}\n\n\tquoteLineHasField(field) {\n\t\treturn !!(this.model.quoteLineFields[field]);\n\t}\n\n\tsetItemLabel() {\n\t\tif (this.item.startsWith('record.'))\n\t\t\tthis.itemLabel = this.item.split('.')[1];\n\t\telse\n\t\t\tthis.itemLabel = this.item;\n\t}\n\n\tsyncValueChangeWithOptionConfiguration() {\n\t\t// sync the value change into the option's configuration.optionData if it exists\n\t\t// this is to handle toggling between products in a reconfigure scenario with a cloned product\n\t\tif(!this.data.configuration || this.data.configuration.length == 0)\n\t\t\treturn;\n\n\t\t// Do not support option configuration sync if the same option is selected more than once,\n\t\t// which is possible for options in an option selection method 'Add' feature (or dynamic feature).\n\t\t// Do not support because we cannot determine which of the duplicate selected options is being changed here.\n\t\t// For now it is OK we don't support as this is only needed for reconfigure with cloned products via a custom popup action,\n\t\t// which currently does not support option selection method 'Add' features (or dynamic features)\n\t\tif(this.data.configuration.length > 1)\n\t\t\treturn;\n\n\t\tlet optionData = this.data.configuration[0].optionData;\n\t\tif(!optionData)\n\t\t\treturn;\n\n\t\tlet parts = this.item.split('.');\n\t\tlet key = parts[parts.length -1];\n\t\tif(optionData[key] === undefined)\n\t\t\treturn;\n\n\t\toptionData[key] = this.value;\n\t}\n\n\thandleOriginalValues() {\n\t\tif(!this.data._transient_.original && this.data.record) {\n\t\t\tthis.data._transient_.original = {};\n\t\t\tthis.data._transient_.original.record = JSON.parse(JSON.stringify(this.data.record));\n\t\t}\n\n\t\tif(this.data._transient_.original) {\n\t\t\tif(!this.data._transient_.original.record.hasOwnProperty(this.item.split('.')[1]))\n\t\t\t\tthis.set('data._transient_.original.' + this.item, this.value);\n\t\t\tthis.$.field.originalValue = this.get('data._transient_.original.' + this.item);\n\t\t}\n\t}\n\n\tsetDisplayIfRelationshipItem() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, function(field) {\n\t\t\treturn this.get('data.' + field);\n\t\t}.bind(this));\n\n\t\tif(rfm.hasRelationship())\n\t\t\tthis.display = rfm.getRelationshipName();\n\t}\n\n\t_displayChanged() {\n\t\tlet rfm = new RelationshipFieldManager(this.item, function(field, value) {\n\t\t\tif(!value) return this.get('data.' + field);\n\t\t\telse this.set('data.' + field, value);\n\t\t}.bind(this));\n\t\trfm.addRelationshipName(this.value, this.display, this.field.referenceTo[0]);\n\t}\n\n\t// below functions are implemented to satisfy the implicit contract of a sb-field record\n\t getValue(name) { \n\t\treturn this.data.record[name];\n \t} \n\n\tsetValue(path, value) { \n\t\tthis.set('data.' + path, value); \n\t}\n\n\t  equals(optionCell) { \n\t\treturn this.data === optionCell.data; \n\t}\n}\n\nPolymer(OptionCell);","import {AppContext} from '../../../../common/core/AppContext.js';\nimport {ImageCellSizer} from 'common/layout/tables/ImageCellSizer.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {AssetUpgradeQuantityCalculator} from '../../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js';\n\nexport class ProductOptionTable {\n\n\tget behaviors() {\n\t\treturn [window.CommonBehaviors.DeviceBehavior];\n\t}\n\t\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-option-table';\n\t\tthis.properties = {\n\t\t\tfeatureId: String,\n\t\t\tmodel: Object, //ProductViewModel\n\t\t\tisClickSelection: Boolean,\n\t\t\tindex: String,\n\t\t\trouteSource: String,\n\t\t\toptions: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: 'initOptions(model, featureId, isClickSelection, fieldSet)'\n\t\t\t},\n\t\t\tshowAddOptionsButton: Boolean,\n\t\t\tmd: Object,\n\t\t\tfieldSet: Array,\n\t\t\tfeatureless: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'isOptionFeatureless(options)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(model)'\n\t\t\t},\n\t\t\tprimaryMobileCol: {\n\t\t\t\ttype: Array,\n\t\t\t\tcomputed: \"_getPrimaryMobileColumns(prefix, fieldSet, fieldSetName)\"\n\t\t\t},\n\t\t\tparentIdDataPath: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'setParentIdDataPath(model, prefix)'\n\t\t\t},\n\t\t\tdisabledStateMap: Object,\n\t\t\tconfigSearch: Object,\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tupgradeOptionButtonText: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: 'Show Available Upgrades'\n\t\t\t},\n\t\t\thasUpgradeOptions: Boolean,\n\t\t\theaderActions: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t};\n\t}\n\n\tget observers() { //TODO: Refactor these observers so that they can take advantage of looping through options once!\n\t\treturn [\n\t\t\t'setMetadataRequest(model, fieldSet, prefix)',\n\t\t\t'disabledStateMapChanged(disabledStateMap.*)',\n\t\t\t'setOptionsDisabledData(disabledStateMap, options)',\n\t\t\t'setUpgradeOptionClass(options)',\n\t\t\t'filterOptions(configSearch, options)',\n\t\t\t'setProductRulesActions(options, model.productRulesActions.*)',\n\t\t\t'_firePriceRules(options, model.optionDataByOptionIds.*)',\n\t\t\t'notify(model.optionNotifications, options)',\n\t\t\t'showOrHideAddOptionsButton(model, featureId, isClickSelection)',\n\t\t\t'setHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton)',\n\t\t\t'_setHeaderActions(options)',\n\t\t\t'_showUpgradeOptionIfSelectionMethodAdd(options, isClickSelection)',\n\t\t\t'setOptionIndex(options)'\n\t\t];\n\t}\n\n\tready() {\n\t\tthis.$.header.selectable = false;\n\t\tthis.handleSelectionChanged();\n\t\tthis.handleMetadataChanged();\n\t\tthis.handleDeleteOption();\n\t\tthis.handleConfigureOption();\n\t\tif(!this.viewport || !this.viewport.isMobile())\n\t\t\tthis.editFirstWhenSelected = 'sb-field';\n\t}\n\n\tattached() {\n\t\t// if product rule actions were processed before this component has been attached due to lazy rendering\n\t\t// then we will fire an event alerting upstream components of this situation\n\t\t// sb-product-feature-list will listen to this event to determine if the feature has any visible options\n\t\tif(this._actionsProcessed)\n\t\t\tthis.fire('sb-options-attached-after-actions', { featureId: this.featureId } );\n\t}\n\n\thandleSelectionChanged() {\n\t\tthis.addEventListener('selection-changed', function (e) {\n\t\t\tthis.model.setOptionSelected(e.detail.Id, e.detail.selected);\n\t\t\tthis.ifRadioSelectedClearOtherRadioSelections(e);\n\n\t\t\tlet optionIndex = e.detail.index != undefined ? e.detail.index : this.getOptionIndex(e.detail.Id);\n\n\t\t\tif(optionIndex < 0) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif(e.detail.selected === true && this.routeSource === 'Configurator') {\n\t\t\t\tthis._displayAvailableRowActions(optionIndex, false);\n\t\t\t\tthis.set(['options', optionIndex, 'selected'], e.detail.selected);\n\t\t\t} else {\n\t\t\t\tthis._displayAvailableRowActions(optionIndex, true);\n\t\t\t}\n\n\t\t\t//Undo Price Rules when Product Option is de-selected\n\t\t\tif(!e.detail.selected && e.detail.changed) {\n\t\t\t\tlet changedOption = this.model.originalDataByOptionIds[e.detail.Id];\n\n\t\t\t\tif(changedOption.priceRule) {\n\t\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Discount__c'], changedOption.discountRate);\n\t\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'DiscountAmount__c'], changedOption.discountAmount);\n\t\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'UnitPrice__c'], changedOption.unitPrice);\n\t\t\t\t\tthis.set(['options',optionIndex,'record',this.prefix + 'Quantity__c'], changedOption.quantity);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Only on user change, not on load.  e.detail.path gets defined on user selection\n\t\t\tif(this.routeSource === 'Configurator' && e.detail.path && (!!this.options[optionIndex].upgradedAssetId || !!this.options[optionIndex].sourceProductIds)) {\n\t\t\t\tthis._handleOptionUpgrades(e, optionIndex);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-quantity-changed', this._handleOptionUpgrades.bind(this));\n\n\t}\n\n\t_displayAvailableRowActions(index, actionsHidden) {\n\t\tfor(let i = 0; i < this.options[index]._transient_.rowActions.length; i++) {\n\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], actionsHidden);\n\n\t\t\tif(this.routeSource === 'OptionLookup') {\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'hidden'], actionsHidden);\n\t\t\t}\n\n\t\t\tif(this.options[index]._transient_.rowActions[i].title === 'Configure' && this.options[index].configurable !== true) {\n\t\t\t\tthis.set(['options', index, '_transient_.rowActions', i, 'invisible'], true);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleMetadataChanged() {\n\t\tthis.$.fieldMetaData.addEventListener('md-changed', function (e) {\n\t\t\tlet md = this.initFieldMetadata(e.detail.value.fieldsByObject);\n\t\t\tthis.rowClassMap = md.rowClassMap; // have to assign this to own property before md because of FireFox\n\t\t\tthis.md = md;\n\t\t}.bind(this));\n\t}\n\n\t_handleOptionUpgrades(e, optionIndex) {\n\t\tif(this.model.product.quoteType !== 'Amendment') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet option = this.options[optionIndex || this.getOptionIndex(e.detail.Id)];\n\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, this.options, option);\n\t\tlet assetUpgradeQauntityCalculator = new AssetUpgradeQuantityCalculator(optionUpgradeHandler);\n\n\t\tassetUpgradeQauntityCalculator.setQuantitiesByRatio();\n\n\t\tif(!optionUpgradeHandler.getSourceOption() && !optionUpgradeHandler.getUpgradeOption()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceOptionIndex = this.getOptionIndex(optionUpgradeHandler.getSourceOption().record.Id);\n\t\tlet upgradeOptionIndex = this.getOptionIndex(optionUpgradeHandler.getUpgradeOption().record.Id);\n\n\t\t// Debounce used to avoid race condition in field.js (this.set was being invoked while onChange event is still running)\n\t\tthis.debounce('Wait for function to finish', () => {\n\t\t\tlet sourceOption = optionUpgradeHandler.getSourceOption();\n\t\t\tlet upgradeOption = optionUpgradeHandler.getUpgradeOption();\n\n\t\t\tif(sourceOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex, sourceOption, true);\n\t\t\t} else if(upgradeOption.invalidQuantity) {\n\t\t\t\tthis._notifyQuantityChange(upgradeOptionIndex, sourceOptionIndex, upgradeOption, true);\n\t\t\t} else {\n\t\t\t\tthis._notifyQuantityChange(sourceOptionIndex, upgradeOptionIndex);\n\t\t\t}\n\n\t\t\tsourceOption.invalidQuantity = null;\n\t\t\tupgradeOption.invalidQuantity = null;\n\t\t}, 10);\n\t}\n\n\t_notifyQuantityChange(index1, index2, option, invalidQuantity) {\n\t\tif(invalidQuantity) {\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.invalidQuantity;\n\t\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t\t\toption.record[this.prefix + 'Quantity__c'] = option.validQuantity;\n\t\t}\n\n\t\tthis.notifyPath(['options', index2, 'record', this.prefix + 'Quantity__c']);\n\t\tthis.notifyPath(['options', index1, 'record', this.prefix + 'Quantity__c']);\n\t}\n\n\t_getPrimaryMobileColumns() {\n\t\tlet primaryMobileCols = [\"record.\" + this.prefix + \"ProductName__c\"];\n\t\t// if the current field set is a mobile field set then use its first column as its first primary column\n\t\tif(primaryMobileCols && primaryMobileCols.length > 0 && this.fieldSetName.endsWith('Phone'))\n\t\t\tprimaryMobileCols = [\"record.\" + this.fieldSet[0]];\n\n\t\treturn primaryMobileCols;\n\t}\n\n\tsetMetadataRequest() {\n\t\tlet mdFields = [];\n\t\tfor (let i = 0, l = this.fieldSet.length; i < l; i++) {\n\t\t\tmdFields.push('ProductOption__c.' + this.fieldSet[i]);\n\t\t\t//Requesting the same field on QuoteLine__c as this information determines if a field is editable on the configurator\n\t\t\tmdFields.push('QuoteLine__c.' + this.fieldSet[i]);\n\t\t}\n\t\t//checking if the array values are a match and returning\n\t\t//tabs will cause this code to be run twice when a flush is done, reproducible on the mobile configurator\n\t\tif(JSON.stringify(this.$.fieldMetaData.fields) === JSON.stringify(mdFields))\n\t\t\treturn;\n\t\tthis.$.fieldMetaData.fields = mdFields;\n\t}\n\n\tinitFieldMetadata(md) {\n\t\t//Handle the response from field metadata\n\t\tlet fieldLabelMap = {},\n\t\t\trecordKeys = [],\n\t\t\tfieldLabels = [],\n\t\t\tfieldDetails = {},\n\t\t\tlabelTypeMap = {},\n\t\t\titemTypeMap = {};\n\t\tfor (let i in md[this.prefix + 'ProductOption__c']) {\n\t\t\tlet mdItem = md[this.prefix + 'ProductOption__c'][i];\n\t\t\tif (mdItem.type.toLowerCase() === 'currency')\n\t\t\t\tmdItem.CurrencyIsoCode = this.model.currencyIsoCode;\n\t\t\tfieldLabels.push(mdItem.label);\n\t\t\trecordKeys.push('record.' + mdItem.name);\n\t\t\tfieldLabelMap[mdItem.name] = mdItem.label;\n\t\t\tfieldDetails['record.' + i] = mdItem;\n\n\t\t\tlet type = mdItem.type;\n\t\t\tif(!this._isMobile()) {\n\t\t\t\t// if the quantity field then lets treat as string for the purposes of table formatting\n\t\t\t\tlet isQuantity = i === (this.prefix + 'Quantity__c');\n\t\t\t\tif(isQuantity) type = 'string';\n\n\t\t\t\t// returns undefined if cell is not an image\n\t\t\t\tlet imageWidth = new ImageCellSizer(mdItem).getImageWidth(20);\n\t\t\t\t// append the image width to the type if defined as TableClassBuilder knows what to do with a type of format type:width\n\t\t\t\tif (imageWidth) type += ':' + imageWidth;\n\t\t\t}\n\n\t\t\tlabelTypeMap[mdItem.label.replace(/\\W/g, '')] = type;\n\t\t\titemTypeMap['record.' + i] = type;\n\t\t}\n\t\treturn {\n\t\t\trecordKeys: recordKeys,\n\t\t\tfieldLabels: fieldLabels,\n\t\t\tfieldLabelMap: fieldLabelMap,\n\t\t\tfieldDetails: fieldDetails,\n\t\t\tquoteLineFields: md[this.prefix + 'QuoteLine__c'],\n\t\t\theaderClassMap: new TableClassBuilder(Object.keys(labelTypeMap), 'Th', labelTypeMap).build(),\n\t\t\trowClassMap: new TableClassBuilder(recordKeys, 'Td', itemTypeMap, ['initial']).build()\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tif (!this.model.optionsByFeatureId[this.featureId])\n\t\t\treturn;\n\t\treturn this.model.getOptionsByFeatureId(this.featureId);\n\t}\n\n\tnotify(paths) {\n\t\tfor(let i = 0, l = this.options.length; i < l; i++ ) {\n\t\t\tfor(let path of paths)\n\t\t\t\tthis.notifyPath(`options.${i}.${path}`);\n\t\t}\n\t}\n\n\tgetOptionIndex(optionId) {\n\t\tlet index = -1,\n\t\t\ti = 0,\n\t\t\tlength = this.options.length;\n\t\twhile(index < 0 && i < length) {\n\t\t\tif (this.options[i].record.Id === optionId)\n\t\t\t\tindex = i;\n\t\t\ti++\n\t\t}\n\t\treturn index;\n\t}\n\n\tifRadioSelectedClearOtherRadioSelections(e) {\n\t\tif (!e.detail.selected)\n\t\t\treturn;\n\t\tlet root = Polymer.dom(e).rootTarget;\n\t\tif (root.selectionType !== 'radio')\n\t\t\treturn;\n\t\tlet rows = Polymer.dom(this.$.tbody).querySelectorAll('sb-table-row');\n\n\t\tif (!rows || rows.length == 0)\n\t\t\treturn;\n\t\tfor (let row of rows) {\n\t\t\tif (row.selectionType == 'radio' && row !== root) {\n\t\t\t\trow.$.row.fire('group-selected', {selected: false});\n\t\t\t\trow.selected = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetParentIdDataPath() {\n\t\treturn 'record.' + this.prefix + 'ConfiguredSKU__c';\n\t}\n\n\tnavigationChanged() {\n\t\tthis.reset();\n\t}\n\n\tsetOptionsDisabledData() {\n\t\tif(!this.options.length || !this.disabledStateMap || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tthis.options.forEach(function (option, idx) {\n\t\t\tif (this.optionShouldChange(option))\n\t\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}.bind(this));\n\t}\n\n\tdisabledStateMapChanged(newVal) {\n\t\tif(!this.options || !this.options.length || !Object.keys(this.disabledStateMap).length)\n\t\t\treturn;\n\n\t\tlet optionId = newVal.path.split('.')[1],\n\t\t\toption = this.model.optionsById[optionId],\n\t\t\tidx = this.options.findIndex(opt => { return opt.record.Id === optionId} );\n\n\t\tif (idx >= 0 && this.optionShouldChange(option)) {\n\t\t\tthis.changeOptionDisabled(option, idx);\n\t\t}\n\t}\n\n\toptionShouldChange(option) {\n\t\treturn option.disabledData && this.disabledStateMap[option.record.Id] !== option.disabledData.constrained;\n\t}\n\n\tchangeOptionDisabled(option, idx) {\n\t\tlet constrained = !!this.disabledStateMap[option.record.Id],\n\t\t\tdisabled = option.disabledData.disabled;\n\t\tthis.set(`options.${idx}.disabledData`, {'disabled': disabled, 'constrained': constrained});\n\t\tif (!this.isClickSelection && this.disabledStateMap[option.record.Id] == true)\n\t\t\tthis.deleteOption(option.record.Id, idx, true);\n\t}\n\n\treset() {\n\t\tPolymer._collections.delete(this.options);\n\t}\n\n\trouteToLookup() {\n\t\tlet queryParams = {\n\t\t\tqId: this.model.qId,\n\t\t\tpId: this.model.product.record.Id,\n\t\t\tfId: this.featureId\n\t\t};\n\t\tif (this.model.getFeature(this.featureId).optionSelectionMethod === 'Dynamic')\n\t\t\tqueryParams.path = ['product', 'dl'];\n\t\tthis.fire('add-option-clicked', queryParams);\n\t}\n\n\tisOptionFeatureless() {\n\t\tif (!this.options)\n\t\t\treturn;\n\t\tif (this.options.length === 0)\n\t\t\treturn 'featureless';\n\t\telse\n\t\t\treturn null;\n\t}\n\n\tisOptionSelected(option) {\n\t\tif (this.routeSource === 'OptionLookup')\n\t\t\treturn false;\n\t\treturn !!option.selected;\n\t}\n\n\thandleDeleteOption() {\n\t\tthis.addEventListener('delete-tapped', function (e) {\n\t\t\tthis.deleteOption(e.detail.Id, e.detail.index);\n\t\t}.bind(this));\n\t}\n\n\tdeleteOption(id, index, deleteMultiple) {\n\t\tlet copy = this.sameOptionAdded(id, index, true);\n\t\tif (!copy)\n\t\t\tthis.model.optionsById[id].selected = false;\n\n\t\tthis.fire('sb-option-deleted', this.options[index]);\n\t\tthis.splice('options', index, 1);\n\t\tthis.showOrHideAddOptionsButton();\n\t\tif(deleteMultiple && copy) this.deleteOption(copy.id, copy.index, true);\n\t}\n\n\tsameOptionAdded(optionId, index) {\n\t\tlet sameOption = null;\n\t\tfor (let [idx, option] of this.options.entries()) {\n\t\t\tif (idx === index)\n\t\t\t\tcontinue;\n\t\t\tif (option.record.Id === optionId) {\n\t\t\t\tsameOption = {'id': optionId, 'index': idx};\n\t\t\t\toption.index--;\n\t\t\t}\n\t\t}\n\t\treturn sameOption;\n\t}\n\n\thandleConfigureOption() {\n\t\tthis.addEventListener('configure-tapped', function (e) {\n\t\t\tlet index = this.isClickSelection ? null : e.detail.index;\n\t\t\t//When in an 'Add' feature, feature._transient_.optionConfigurations may contain distinct clones. For this reason, access optionConfigurations directly rather that this.options\n\t\t\tlet option = this.isClickSelection ? this.model.optionsById[e.detail.Id] : this.model.getFeature(this.featureId)._transient_.optionConfigurations[e.detail.index];\n\t\t\tlet tabIndex;\n\t\t\tif (this.model.product.record[this.prefix + 'OptionLayout__c'] === 'Tabs' || this.model.product.featureCategories.length > 0)\n\t\t\t\ttabIndex = this.getTabIndex();\n\t\t\tthis.fire('configure-option-tapped', {\n\t\t\t\taddedIndex: option.index || 0,\n\t\t\t\tindex: index,\n\t\t\t\toptionId: option.record.Id,\n\t\t\t\toptionalSKU: option.record[this.prefix + 'OptionalSKU__c'],\n\t\t\t\tproductId: this.model.product.record.Id,\n\t\t\t\ttabIndex: tabIndex\n\t\t\t});\n\t\t}.bind(this));\n\t}\n\n\tgetTabIndex() {\n\t\tlet categoryName;\n\t\tfor (let [idx, feature] of this.model.product.features.entries()) {\n\t\t\tif (feature.record.Id !== this.featureId)\n\t\t\t\tcontinue;\n\t\t\tif (this.model.product.featureCategories.length > 0) {\n\t\t\t\tcategoryName = feature.record[this.prefix + 'Category__c'];\n\t\t\t\tif (categoryName == null)\n\t\t\t\t\treturn this.model.product.featureCategories.length;\n\t\t\t\tbreak;\n\t\t\t} else\n\t\t\t\treturn idx;\n\t\t}\n\n\t\tfor (let [index, category] of this.model.product.featureCategories.entries()) {\n\t\t\tif (category === categoryName)\n\t\t\t\treturn index;\n\t\t}\n\t}\n\n\tfilterOptions() {\n\t\tlet _options = this.configSearch.setOptionVisibility(this.options);\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!this.options[i].hiddenByRule)\n\t\t\t\tthis.set('options.' + i + '.hidden', _options[i].hidden);\n\t\t}\n\t}\n\n\tsetOptionIndex() { // TODO: This can easily be combined with filterOptions, just need a big refactor. Setting property values will not hinder performance\n\t\tlet optionCount = {};\n\n\t\tfor (let i=0;i<this.options.length;i++) {\n\t\t\tif (!optionCount[this.options[i].record.Id])\n\t\t\t\toptionCount[this.options[i].record.Id] = 0;\n\t\t\tthis.set('options.' + i + '.index', optionCount[this.options[i].record.Id]);\n\n\t\t\tlet nodeId = '_' + this.options[i].record.Id + '_' + this.options[i].index;\n\t\t\tlet configured = this.model.product.configuration.configuredOptions && this.model.product.configuration.configuredOptions[nodeId];\n\t\t\tthis.set('options.' + i + '.configured', configured);\n\t\t\toptionCount[this.options[i].record.Id]++;\n\t\t}\n\t}\n\n\tsetProductRulesActions() {\n\t\tif (Object.keys(this.model.productRulesActions).length == 0 || !this.model.optionsByFeatureId[this.featureId])\n\t\t\treturn;\n\n\t\tif (this.isClickSelection == false)\n\t\t\tthis.setUnaddedOptionsRulesActions();\n\t\tif (this.options[0] !== undefined)\n\t\t\tthis.setDisplayedOptionsRulesActions();\n\n\t\tthis._actionsProcessed = true;\n\t}\n\n\tsetUnaddedOptionsRulesActions() {\n\t\tlet addedOptions = this.model.optionsByFeatureId[this.featureId];\n\t\tfor (let h = 0; h < addedOptions.length; h++) {\n\t\t\tlet option = addedOptions[h];\n\t\t\tif (this.model.productRulesActions.selectOptions[option.record.Id] && !this.sameOptionAdded(option.record.Id, h)) {\n\t\t\t\toption.selected = true;\n\t\t\t\toption.added = true;\n\t\t\t\tthis.push('options', option);\n\t\t\t\tthis.showOrHideAddOptionsButton();\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[option.record.Id]) {\n\t\t\t\toption.hidden = false;\n\t\t\t\toption.hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.hideOptions[option.record.Id]) {\n\t\t\t\toption.hidden = true;\n\t\t\t\toption.hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': true};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': true, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === true) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': false};\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[option.record.Id] === false) {\n\t\t\t\toption.disabledData = {'disabled': false, 'constrained': true};\n\t\t\t}\n\t\t}\n\t}\n\n\tsetDisplayedOptionsRulesActions() {\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif (this.isClickSelection && this.model.productRulesActions.selectOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.selected`, true);\n\t\t\t\tthis.fireOptionChangedByRule(true);\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.deselectOptions[this.options[i].record.Id]) {\n\t\t\t\tif (this.isClickSelection) {\n\t\t\t\t\tthis.set(`options.${i}.selected`, false);\n\t\t\t\t\tthis.fireOptionChangedByRule(false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteOption(this.options[i].record.Id, i);\n\t\t\t\t\tif (this.options[i] === undefined) return;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.hideOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, true);\n\t\t\t\tthis.options[i].hiddenByRule = true;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.showOptions[this.options[i].record.Id]) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t\tthis.options[i].hiddenByRule = false;\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': true});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.disableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': true, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === true) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': false});\n\t\t\t}\n\t\t\tif (this.model.productRulesActions.enableOptions[this.options[i].record.Id] === false) {\n\t\t\t\tthis.set(`options.${i}.disabledData`, {'disabled': false, 'constrained': true});\n\t\t\t}\n\t\t}\n\t}\n\n\tfireOptionChangedByRule(added) {\n\t\tif (this.viewport && !this.viewport.isMobile())\n\t\t\treturn;\n\n\t\tthis.fire('option-changed-by-rule', {\n\t\t\tadded: added\n\t\t});\n\t}\n\n\t_firePriceRules() {\n\t\tlet optionDataByOptionIds = this.model.optionDataByOptionIds;\n\t\tlet options = this.options;\n\n\t\tif (options != null) {\n\t\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\t\tlet optionId = options[i].optionId || options[i].record.Id;\n\n\t\t\t\tif(optionDataByOptionIds[optionId] != null) {\n\t\t\t\t\tlet priceActions = this._getPriceActions(options[i], optionId);\n\n\t\t\t\t\tfor(let priceAction in priceActions) {\n\t\t\t\t\t\tif(priceActions.hasOwnProperty(priceAction)) {\n\t\t\t\t\t\t\toptions[i].record[priceAction] = priceActions[priceAction];\n\t\t\t\t\t\t\tthis.notifyPath(['options', i, 'record', priceAction]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_getPriceActions(option, optionId) {\n\t\tlet priceActions = {};\n\t\tlet optionData = this.model.optionDataByOptionIds[optionId].optionData;\n\t\tlet listPrice = this.model.optionDataByOptionIds[optionId].listPrice || this.model.originalDataByOptionIds[optionId].unitPrice;\n\n\t\tfor(let priceAction in optionData) {\n\t\t\tif(optionData.hasOwnProperty(priceAction) && priceAction != 'attributes') {\n\t\t\t\tif(option.record[priceAction] != optionData[priceAction]) {\n\t\t\t\t\tpriceActions[priceAction] = optionData[priceAction];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._calculateUnitPrice(priceActions, optionData, listPrice);\n\n\t\treturn priceActions;\n\t}\n\n\t_calculateUnitPrice(priceActions, optionData, listPrice) {\n\t\tlet prefix = this.getPrefix();\n\t\tlet discountRate = optionData[prefix + 'Discount__c'];\n\t\tlet discountAmount = optionData[prefix + 'DiscountAmount__c'];\n\n\n\t\tif(discountRate) {\n\t\t\tpriceActions[prefix + 'UnitPrice__c'] = listPrice * ((100 - discountRate) / 100);\n\t\t} else if(discountAmount) {\n\t\t\tpriceActions[prefix + 'UnitPrice__c'] = listPrice - discountAmount;\n\t\t}\n\t}\n\n\tsetUpgradeOptionClass() {\n\t\tPolymer.dom(this.$.tbody).observeNodes(function () {\n\t\t\tlet upgradeOptions = Polymer.dom(this.$.tbody).node.querySelectorAll('#row[hidden]');\n\n\t\t\tfor(let i = 0; i < upgradeOptions.length; i++) {\n\t\t\t\tif (upgradeOptions[i].rowData.isUpgrade)\n\t\t\t\t\tthis.toggleClass('upgradeOption', true, upgradeOptions[i]);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\ttoggleUpgradeOptions() {\n\t\tlet options = this.options;\n\t\tthis.showUpgradeOptions = !this.showUpgradeOptions;\n\n\t\tif(this.showUpgradeOptions) {\n\t\t\tthis.upgradeOptionButtonText = 'Hide Available Upgrades';\n\t\t} else {\n\t\t\tthis.upgradeOptionButtonText = 'Show Available Upgrades';\n\t\t}\n\n\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\tif (options[i].isUpgrade === true) {\n\t\t\t\tif(this.showUpgradeOptions) {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.set('options.' + i +'.hidden', true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tshowOrHideAddOptionsButton() {\n\t\tthis.showAddOptionsButton = !this.isClickSelection && !this.model.maxOptionsMet(this.model.getFeature(this.featureId));\n\t}\n\n\tgetPrefix() {\n\t\treturn this.model.prefix;\n\t}\n\n\tsetHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton) {\n\t\tthis.hasUpgradeOptions = hasUpgradeOptions && !showAddOptionsButton;\n\t}\n\n\t_setHeaderActions() {\n\t\tif(this.routeSource === 'OptionLookup' || this.options.length === 0 || !this.options[0]._transient_.rowActions) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.headerActions = JSON.parse(JSON.stringify(this.options[0]._transient_.rowActions));\n\n\t\t\tfor(let i = this.headerActions.length -1; i >= 0; i--) {\n\t\t\t\tthis.headerActions[i].invisible = true;\n\t\t\t}\n\n\t\t\tif(!this.isClickSelection) {\n\t\t\t\tthis.headerActions[0].hidden = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Method needed since upgrade options are hidden on load by default\n\t_showUpgradeOptionIfSelectionMethodAdd() {\n\t\tif(this.isClickSelection) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < this.options.length; i++) {\n\t\t\tif(this.options[i].isUpgrade) {\n\t\t\t\tthis.set(`options.${i}.hidden`, false);\n\t\t\t}\n\t\t}\n\t}\n\n\t_isMobile() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n}\n\nPolymer(ProductOptionTable);","import {Page} from 'common/core/Page.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class DynamicLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-dynamic-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tquote: Object,\n\t\t\tmodel: Object,\n\t\t\tfeature: Object,\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\thiddenByGroup: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tdefaultFilters: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t},\n\t\t\thasInstructions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasInstructions(feature)'\n\t\t\t},\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelChanged(searchModel)'\n\t\t];\n\t}\n\n\tsearchModelChanged() {\n\t\tthis.deSelectAll();\n\t}\n\n\tready() {\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.drawer.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t}\n\n\tcancel() {\n\t\tthis.spinner = true;\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tadd() {\n\t\tlet featureOptionIds = [];\n\t\tfor (let key in this.selectedProducts) {\n\t\t\tfeatureOptionIds.push(this.ctx.params.fId + ':' + key);\n\t\t}\n\t\tthis.$.productLoader.featureOptionIds = featureOptionIds;\n\t\tthis.$.productLoader.ignoreCache = true;\n\t}\n\n\tconvertProductsToOptions (results) {\n\t\tfor (let key in results) {\n\t\t\tvar option = results[key];\n\t\t\toption.record[this.prefix + 'UnitPrice__c'] = this.selectedProducts[key].record.UnitPrice;\n\t\t\toption.isDynamicOption = true;\n\t\t\tthis.push('product.options', option);\n\t\t\tthis.push('feature._transient_.optionConfigurations', option);\n\t\t}\n\t\t//the last option will apply it's record values to any configuration attributes for the original bundle\n\t\tthis.syncConfigurationAttributesToProduct(option);\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tsyncConfigurationAttributesToProduct(product) {\n\t\t// 1: build a key map for any configuration attribute that has auto select set to true\n\t\t// 2: loop through those attributes and set the value to the value of the product record field value\n\t\tif(this.autoSelectAttributes === undefined) {\n\t\t\tthis.autoSelectAttributes = {};\n\t\t\tfor (let attribute of this.product.configurationAttributes)\n\t\t\t\tif (attribute.autoSelect === true && this.autoSelectAttributes[attribute.targetFieldName] === undefined)\n\t\t\t\t\tthis.autoSelectAttributes[attribute.targetFieldName] = true; //just storing keys\n\t\t}\n\n\t\tfor(let attribute in this.autoSelectAttributes)\n\t\t\tthis.product.configuration.configurationData[attribute] = product.record[attribute];\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.model.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'dl'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.$.productLoader.productIds = this.productIds;\n\t\t\tthis.$.productLoader.quote = this.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\n\t\tthis.$.productLoader.addEventListener('product-load-model-changed', function (e) {\n\t\t\tif (Object.keys(this.selectedProducts).length > 0)\n\t\t\t\treturn this.convertProductsToOptions(e.detail.value);\n\t\t\tthis.product = this.ctx.params.productIdx ? e.detail.value.configuredProducts[this.ctx.params.productIdx] : e.detail.value.configuredProducts[0];\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\t\tthis.model = new ProductViewModel(this.quote.record.Id, this.product, this.orgPrefix, this.isoCode, this.ctx.params.fId);\n\t\t\tthis.feature = this.model.getFeature(this.ctx.params.fId);\n\t\t\tif (this.feature === undefined) {\n\t\t\t\tthis.error = [\"Attempted to access a feature not associated with this bundle.\"];\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet filters = [];\n\t\t\tlet filtersLoaded = false;\n\t\t\tif (this.feature.searchFilters) {\n\t\t\t\tif (this.defaultFilters[this.feature.record.Id] != null)\n\t\t\t\t\tfiltersLoaded = true;\n\t\t\t\telse\n\t\t\t\t\tthis.defaultFilters[this.feature.record.Id] = [];\n\t\t\t\tfor (let searchFilter of this.feature.searchFilters) {\n\t\t\t\t\tif (searchFilter.valueObject === 'Configuration Attributes')\n\t\t\t\t\t\tsearchFilter.stringValue = this.product.configuration.configurationData[searchFilter.targetFieldName];\n\t\t\t\t\tfilters.push(JSON.stringify(searchFilter));\n\t\t\t\t\tif (!filtersLoaded)\n\t\t\t\t\t\tthis.defaultFilters[this.feature.record.Id].push(searchFilter);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.$.smLoadService.filters = filters;\n\t\t\tthis.$.smLoadService.fieldSet = this.feature.record[this.prefix + 'DynamicProductFilterFieldSet__c'];\n\t\t\tthis.$.smLoadService.quote = this.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\t\t\tlet layoutFieldSet = this.product.productFieldSets[this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c']];\n\t\t\tif (layoutFieldSet)\n\t\t\t\tsearchModel.resultFieldNames = layoutFieldSet;\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.';\n\t\t\tthis.searchModel = searchModel;\n\t\t\tthis.buildDelegator();\n\t\t}.bind(this));\n\t}\n\n\tbuildDelegator() {\n\t\tlet searcher = new Searcher(this.searchModel);\n\t\tsearcher.dynamicSearchFilters = this.defaultFilters[this.feature.record.Id] ? this.defaultFilters[this.feature.record.Id] : [];\n\t\tsearcher.dynamicFieldSet = this.feature.record[this.prefix + 'DynamicProductLookupFieldSet__c'];\n\t\tthis.searcher = searcher;\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.panelHeader = 'Product Filter';\n\t\tthis.$.drawer.$.drawer.togglePanel();\n\t\tthis.refocus();\n\t}\n\n\trefocus() {\n\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tthis.$.clearfilter.focus();\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blurred so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.runService();\n\t\tthis.$.drawer.$.drawer.closeDrawer();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let selectedProductId of orderedSelectedProductIds)\n\t\t\torderedSelectedProducts.push(this.selectedProducts[selectedProductId]);\n\t\treturn orderedSelectedProducts;\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.$.drawer.selected === 'main') {\n\t\t\tthis.fire('iron-signal', {name: 'sb-panel-closed'});\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tget orgPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t}\n\n\tsetHasInstructions() {\n\t\treturn !!this.feature.instructionsText || !!this.feature.additionalInstructions;\n\t}\n}\n\nPolymer(DynamicLookup);","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductViewModel} from '../../viewmodel/ProductViewModel.js';\nimport {OptionConstraintsHandler} from '../../../resources/optionConstraints/OptionConstraintsHandler.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class OptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-option-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\ttopLevelBundle: Object, // ConfiguredProduct\n\t\t\tcurrentProductModel: Object, //ProductViewModel\n\t\t\tfeature: Object,\n\t\t\tdisabledStateMap: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\toptionConstraintsHandler: Object, //OptionConstraintsHandler\n\t\t\theaderSubtitle: String,\n\t\t\tselectedOptions: Object,\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\thasUpgradeOptions: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'setHasUpgradeOptions(feature)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tvalidationMessages: Array,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis._handleLineEditorModelResponse();\n\t\tthis._handleProductLoadResponse();\n\t\tthis.handleOptionConfiguratorResponse();\n\t\tthis.addEventListener('selection-changed', this._handleOptionSelection);\n\t}\n\n\tadd() {\n\t\tthis.validationMessages = [];\n\t\tif (this._validateMaximumOptionsNotExceeded()) {\n\t\t\tthis.validationMessages = [\"Too many options selected.\"];\n\t\t\treturn;\n\t\t}\n\t\tthis._addSelected();\n\t\tthis._routeToConfig();\n\t}\n\n\tcancel() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tthis.currentProductModel.optionsById[key].added = false;\n\t\t\tthis.currentProductModel.optionsById[key].selected = false;\n\t\t}\n\t\tthis._routeToConfig();\n\t}\n\n\t_handleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.$.productLoad.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t\tthis.currencyIsoCode = e.detail.value.quote.record.CurrencyIsoCode || null;\n\t\t}.bind(this));\n\t}\n\n\t_handleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tlet products = e.detail && e.detail.value ? e.detail.value.configuredProducts : null,\n\t\t\t\tidx = this.ctx.params && this.ctx.params.productIdx ? this.ctx.params.productIdx : 0,\n\t\t\t\tproduct = products ? products[idx] : e.detail.value;\n\t\t\tif (!product.rulesProcessed) {\n\t\t\t\tlet processor = new RuleProcessor(product.configuration, product);\n\t\t\t\tprocessor.initProductRulesActions(this.optionId === '' ? 'load' : 'reconfigure');\n\t\t\t}\n\t\t\tthis.topLevelBundle = product;\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.$.optionConfigure.product = product;\n\t\t\t// pass in fId and ONLY render map for fID;\n\t\t\tthis.setCurrentProductModel(product);\n\t\t}.bind(this));\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) { //possibly just listen to service change\n\t\t\tthis.setCurrentProductModel(e.detail.value.configuredProducts[0]);\n\t\t}.bind(this));\n\t}\n\n\tsetCurrentProductModel(product) {\n\t\t// pass in fId and ONLY render map for fID;\n\t\tthis.currentProductModel = new ProductViewModel(this.$.productLoad.quote.record.Id, product, this.app.org.prefix, this.currencyIsoCode, this.ctx.params.fId);\n\t\tthis.feature = this.currentProductModel.getFeature(this.ctx.params.fId);\n\t\tif (this.feature === undefined) {\n\t\t\tthis.validationMessages = [\"Attempted to access a feature not associated with this bundle.\"];\n\t\t\treturn;\n\t\t}\n\t\tthis.selectedOptions = {};\n\t\tthis.optionConstraintsHandler = new OptionConstraintsHandler(this.currentProductModel.product, this.currentProductModel.prefix);\n\t\tthis.$.optionTable.fieldSetName = \"OptionLookup\";\n\t\tthis.$.optionTable.fieldSet = this.currentProductModel.product.optionFieldSets[this.$.optionTable.fieldSetName];\n\t\tthis.$.optionTable.displayDelete = false;\n\t\tthis._createConstraintsHoverMessages();\n\t\tthis._fireSelectionStatesForOtherFeatures();\n\t}\n\n\t_handleOptionSelection(e) {\n\t\tif (e && e.detail) {\n\t\t\tthis._toggleOptionSelection(e.detail.Id, e.detail.selected);\n\t\t\tthis._handleOptionConstraints(e.detail.Id, e.detail.selected);\n\t\t}\n\t}\n\n\t_fireSelectionStatesForOtherFeatures() {\n\t\tfor (let featureId of Object.keys(this.currentProductModel.featureIdsWithSelectionMethodClick)) {\n\t\t\tfor (let option of this.currentProductModel.optionsByFeatureId[featureId])\n\t\t\t\tthis._handleOptionConstraints(option.record.Id, option.selected);\n\t\t}\n\t}\n\n\t_toggleOptionSelection(optionId, selected) {\n\t\tif (!selected && this.selectedOptions[optionId]) {\n\t\t\tdelete this.selectedOptions[optionId];\n\t\t} else if (selected && !this.selectedOptions[optionId]) {\n\t\t\tthis.selectedOptions[optionId] = this.currentProductModel.getOption(optionId);\n\t\t}\n\t}\n\n\t_handleOptionConstraints(optionId, selected) {\n\t\tlet addedOption = this.feature._transient_.optionConfigurations.find(function(option) { return option.record.Id === optionId }),\n\t\t\tpreviouslySelected = addedOption && addedOption.selected,\n\t\t\tdisabledStateChanges = this.optionConstraintsHandler.handleOptionConstraints(optionId, selected || previouslySelected);\n\n\t\tif (disabledStateChanges) {\n\t\t\tdisabledStateChanges.forEach( change => {\n\t\t\t\tthis.set(`disabledStateMap.${change.optionId}`, change.disabledState);\n\t\t\t});\n\t\t}\n\t}\n\n\t_addSelected() {\n\t\tfor (let key in this.selectedOptions) {\n\t\t\tlet productOption = this.currentProductModel.optionsById[key];\n\t\t\tlet clonedOption = JSON.parse(JSON.stringify(this.currentProductModel.optionsById[key]));\n\t\t\tthis.currentProductModel.initOptionActions(clonedOption, true);\n\t\t\t// TODO: I am not able to get these properties to stick when I enter PVM again.\n\t\t\tclonedOption.addedManually = true; //differentiates copies of required options from originally added options\n\t\t\tclonedOption.index = this.feature._transient_.optionConfigurations.filter( option => { return option.record.Id === key; }).length;\n\t\t\tclonedOption.configured = false;\n\t\t\tthis.currentProductModel.setOptionDisabledData(clonedOption);\n\t\t\tthis.push('feature._transient_.optionConfigurations', clonedOption);\n\t\t\tthis.currentProductModel.optionsById[key].added = true;\n\t\t\tthis.currentProductModel.optionsById[key].selected = true;\n\t\t}\n\t}\n\n\t_validateMaximumOptionsNotExceeded() {\n\t\treturn this.feature._transient_.optionConfigurations.length + Object.keys(this.selectedOptions).length > this.feature.record[this.prefix + 'MaxOptionCount__c'];\n\t}\n\n\t_routeToConfig() {\n\t\tthis.selectedOptions = {};\n\t\tlet queryParams = this._createQueryParams();\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\t_createQueryParams() {\n\t\tlet queryParams = {qId: this.currentProductModel ? this.currentProductModel.qId : this.ctx.params.qId},\n\t\t\tparams = this.ctx.params;\n\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\tif (params.oId) {\n\t\t\tqueryParams.oId = params.oId;\n\t\t\tqueryParams.origin = 'ol'\n\t\t}\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\tif (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\t\tif(params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.optionLookupObjects = [this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tsetHasUpgradeOptions() {\n\t\treturn this.currentProductModel.getHasUpgradeOptions(this.feature);\n\t}\n\n\t_createConstraintsHoverMessages() {\n\t\tthis.currentProductModel.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained);\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n}\n\nPolymer(OptionLookup);","import {Page} from '../../../../common/core/Page.js';\nimport {RuleProcessor} from '../../../resources/rules/RuleProcessor.js';\nimport {ProductReconfigurer} from 'products/resources/reconfigure/ProductReconfigurer.js';\nimport {OptionUpgradeHandler} from 'products/resources/optionUpgrades/OptionUpgradeHandler.js';\nimport {NestedOptionsModel} from '../../../resources/model/nestedOptions/NestedOptionsModel.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class ProductConfig extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-config';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tlineEditorModel: Object,\n\t\t\tproductSelectionModel: Object,\n\t\t\ttopLevelBundle: Object,\n\t\t\tcurrentTarget: Object,\n\t\t\tproductIndex: Number,\n\t\t\theaderSubtitle: String, // from LineEditorModel, should be Quote Number\n\t\t\thasMultipleBundles: Boolean,\n\t\t\tisClassic: Boolean,\n\t\t\tsearchValuesByFilter: Object,\n\t\t\tsearchFilters: Array,\n\t\t\tvalidationMessages: Array,\n\t\t\theaderTitle: String,\n\t\t\tisMobileAndHasMultipleBundles: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false,\n\t\t\t\tcomputed: \"_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles)\"\n\t\t\t},\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getProductIds(ctx)'\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getLineKey(ctx)'\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tcomputed: 'getGroupKey(ctx)'\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tcomputed: 'getIgnoreCache(ctx)'\n\t\t\t},\n\t\t\tprefix: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getPrefix(app.org)'\n\t\t\t},\n\t\t\toptionId: {\n\t\t\t\ttype: String,\n\t\t\t\tcomputed: 'getOptionId(ctx)'\n\t\t\t},\n\t\t\tspinner: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpreventPreLoadObjects: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.handleLineEditorModelResponse();\n\t\tthis.handleProductLoadResponse();\n\t\tthis.handleOptionSaveResponse();\n\t\tthis.handleProductRulesInvokerResponse();\n\t\tthis.handleCustomActionsCollapsed();\n\t\tthis.handleOnAddOptionClick();\n\t\tthis.handleBundlePanelClick();\n\t\tthis.handleChangeEvents();\n\t\tthis.handleBundleNameChange();\n\t\tthis.handleExternalConfiguration();\n\t\tthis.handleConfigureOptionEvent();\n\t\tthis.handleOptionConfiguratorResponse();\n\t}\n\n\tattached() {\n\t\tif(!this.preventPreLoadObjects)\n\t\t\tthis.preLoadObjects();\n\t}\n\n\thandleLineEditorModelResponse() {\n\t\tthis.$.lineEditorRead.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.isoCode = this.lineEditorModel.quote.record.CurrencyIsoCode || null;\n\t\t\tthis.$.productLoad.quote = this.$.optionSave.quote = this.$.productRulesInvoke.quote = this.$.optionConfigure.quote = e.detail.value.quote;\n\t\t\tthis.headerSubtitle = e.detail.value.headerSubtitle;\n\t\t}.bind(this));\n\t}\n\n\thandleProductLoadResponse() {\n\t\tthis.$.productLoad.addEventListener('product-load-model-changed', function (e) {\n\t\t\tlet model = this.handleProductConfigurationInitializer(e.detail.value);\n\t\t\t// If a user enters the Configurator by reconfiguring a quote line, and that line has not been saved in a quote, we have to return the\n\t\t\t// user to the QLE. We do not cache the unsaved quote line, so it would error out.\n\t\t\tif(model.returnToQuote) {\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', {qId: this.lineEditorModel.quote.record.Id }, ['quote', 'le'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [model.returnToQuote];\n\t\t\t}\n\n\t\t\tif (this.optionId !== '')\n\t\t\t\treturn this.setOptionConfigurationDetails(model);\n\t\t\tif(this.loadedModelIsReconfigure(model))\n\t\t\t\tnew ProductReconfigurer(model.configuredProducts[0], this.lineEditorModel.quote.record[this.prefix + 'Type__c']).reconfigure();\n\t\t\tfor (let prod of model.configuredProducts) {\n\t\t\t\tif (!prod.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(prod.configuration, prod);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\t\t\t\tif (prod.configuration != null && prod.nestedOptionModel == null) {\n\t\t\t\t\tprod.nestedOptionModel = new NestedOptionsModel(prod.configuration);\n\t\t\t\t}\n\t\t\t\tprod.configuration.configuredOptions = prod.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t}\n\t\t\tthis.productSelectionModel = undefined;\n\t\t\tthis.productSelectionModel = model;\n\t\t\tthis.hasMultipleBundles = (this.productSelectionModel.configuredProducts.length > 1);\n\t\t\tthis.isClassic = (this.hasMultipleBundles && this.lineEditorModel.settings.multipleBundlesView === 'Classic');\n\t\t\tthis.currentTarget = this.productSelectionModel;\n\t\t\t//initialize option configurations for all products\n\t\t\tfor (let i = 0; i < this.productSelectionModel.configuredProducts.length; i++)\n\t\t\t\tthis.productIndex = i;\n\t\t\tthis.productIndex = this.getProductIndex();\n\t\t\t//remove invalid fields from the search filter field set\n\t\t\tthis.searchFilters = this.productSelectionModel.configuredProducts[0].optionFieldSets.SearchFilters; //TODO: Andrew should this only refer to configuredProducts[0]?\n\t\t\tlet filterMap = {};\n\t\t\tif (this.searchFilters && !this.productSelectionModel.searchValuesByFilter) {\n\t\t\t\tfor (let i = 0, numFilters = this.searchFilters.length; i < numFilters; i++) {\n\t\t\t\t\tfilterMap[this.searchFilters[i]] = null;\n\t\t\t\t}\n\t\t\t\t//filter keymap added to PSM to persist across bundles\n\t\t\t\tthis.productSelectionModel.searchValuesByFilter = filterMap;\n\t\t\t}\n\t\t\tthis.$.bundles.searchValuesByFilter = this.productSelectionModel.searchValuesByFilter;\n\t\t\tthis.$.bundles.searchFilters = this.searchFilters;\n\t\t\t//must do this after all data is set\n\t\t\tthis.checkForExternalConfiguration();\n\t\t}.bind(this));\n\t}\n\n\thandleOptionSaveResponse() {\n\t\tthis.$.optionSave.addEventListener('psm-response-changed', function (e) {\n\t\t\tthis.validationMessages = null;\n\t\t\tlet response = e.detail.value;\n\t\t\tlet ruleProcessor = new RuleProcessor(response);\n\t\t\truleProcessor.initValidationMessages();\n\t\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\t\t\tif (this.validationMessages.length > 0) {\n\t\t\t\tthis.spinner = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//check for product alert rules\n\t\t\tif (response.guidedMessages && response.guidedMessages.length > 0) {\n\t\t\t\tthis.$.productAlerts.cancelCB = null;\n\t\t\t\tthis.$.productAlerts.displayContinueButton = true;\n\t\t\t\tthis.$.productAlerts.continueCB = this.afterSaveNavigate.bind(this, response, ruleProcessor);\n\t\t\t\tthis.spinner = false;\n\t\t\t\tthis.$.productAlerts.alerts = response.guidedMessages;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// no validation or alert rules encountered, so lets complete our after save navigation\n\t\t\tthis.afterSaveNavigate(response, ruleProcessor);\n\t\t}.bind(this));\n\t}\n\n\tafterSaveNavigate(response, ruleProcessor) {\n\t\tlet optionId = 'none',\n\t\t\ttabIndex;\n\t\tif (this.optionId !== '') {\n\t\t\tlet latestData = this.topLevelBundle.nestedOptionModel.getLastFromPath();\n\t\t\ttabIndex = latestData.tabIndex;\n\t\t\toptionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU() || 'none';\n\t\t\truleProcessor.initDescendantLevelRules(this.topLevelBundle);\n\t\t}\n\t\tlet redirectUrl = this.ctx.params ? this.ctx.params.redirectUrl : null,\n\t\t\tpathParams = this.createPathParams(redirectUrl),\n\t\t\tqueryParams;\n\n\t\tif(this.optionId !== '')\n\t\t\tqueryParams = this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex);\n\t\telse {\n\t\t\tqueryParams = {qId: response.quote.record.Id};\n\t\t\tif(this.ctx.params.groupKey != null)\n\t\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\t\tif(this.ctx.params.aId && pathParams[0] !== 'quote')\n\t\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\t}\n\n\t\tif (response.quote)\n\t\t\tthis.lineEditorModel.quote = response.quote;\n\t\tthis.nav('#', queryParams, pathParams, false);\n\t}\n\n\thandleProductRulesInvokerResponse() {\n\t\tthis.$.productRulesInvoke.addEventListener('config-response-changed', function (e) {\n\t\t\tlet response = e.detail.value;\n\t\t\tlet productIndex = this.currentTarget.configuredProducts.findIndex( product => {\n\t\t\t\t// in case of cloned object use the productKey instead of id (unless no key then use the id)\n\t\t\t\tlet productKey = product.productKey || product.record.Id;\n\t\t\t\treturn productKey === response.configuredProductKey;\n\t\t\t});\n\t\t\tlet currentProduct = this.currentTarget.configuredProducts[productIndex];\n\t\t\tlet ruleProcessor = new RuleProcessor(response, currentProduct);\n\t\t\truleProcessor.init();\n\t\t\tthis.validationMessages = ruleProcessor.getValidationMessages();\n\t\t\tresponse.productRulesActions = ruleProcessor.getProductRulesActions();\n\t\t\tresponse.optionDataByOptionIds = ruleProcessor.getOptionDataByOptionIds();\n\t\t\t//W-3652536: response from the server does not have the updated configuration attribute values\n\t\t\t//always using the configuration.configurationData values from the client\n\t\t\tif(currentProduct.configuration !== undefined && currentProduct.configuration.configurationData !== undefined)\n\t\t\t\tresponse.configurationData = currentProduct.configuration.configurationData;\n            this.$.bundles.set(`configuredProducts.${productIndex}.configuration`, response);\n\t\t}.bind(this));\n\t}\n\n\thandleCustomActionsCollapsed() {\n\t\tthis.changeAllActions(this.$.customActions.buttonsCollapsed);\n\t\tthis.$.customActions.addEventListener('buttons-collapsed-changed', function (e) {\n\t\t\tlet val = e.detail.value;\n\t\t\tthis.changeAllActions(val);\n\t\t}.bind(this));\n\t}\n\n\thandleOnAddOptionClick() {\n\t\tlet tabIndex;\n\t\t// Must have the most up to date tabIndex so the proper feature gets updated.\n\t\tthis.addEventListener('selected-page-changed', function (e) {\n\t\t\ttabIndex = e.detail;\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('add-option-clicked', function (e) {\n\t\t\tlet query = this.optionId === '' ? e.detail : Object.assign({}, e.detail, { oId: this.optionId });\n\t\t\tlet index;\n\t\t\tif (query.path && this.optionId === '')\n\t\t\t\tindex = this.getProductIndex(e.detail.pId);\n\t\t\tlet queryParams = this.createQueryParams(query, tabIndex),\n\t\t\t\tpath = query.path != null ? query.path : ['product', 'ol'];\n\t\t\tif (index)\n\t\t\t\tqueryParams.productIdx = index;\n\t\t\tthis.nav('#', queryParams, path, false);\n\t\t}.bind(this));\n\t}\n\n\thandleBundlePanelClick() {\n\t\tthis.addEventListener('bundle-panel-clicked', function (e) {\n\t\t\tlet queryParams = (this.createQueryParams(this.ctx.params));\n\t\t\tqueryParams.productIdx = e.detail;\n\t\t\tqueryParams.open = 1;\n\t\t\tif (queryParams.tab)\n\t\t\t\tdelete queryParams.tab;\n\t\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t\t}.bind(this));\n\t}\n\n\thandleChangeEvents() {\n\t\tthis.addEventListener('selection-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Selection');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-quantity-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Quantity Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-config-attribute-changed', function(e) {\n\t\t\tthis.handleChangeEvent(e, 'On Attribute Change');\n\t\t}.bind(this));\n\n\t\tthis.addEventListener('sb-option-deleted', function(e) {\n\t\t\tlet prod = this.topLevelBundle || this.productSelectionModel.configuredProducts[this.productIndex];\n\t\t\tif (prod.nestedOptionModel)\n\t\t\t\tprod.nestedOptionModel.remove(e.detail);\n\t\t}.bind(this));\n\t}\n\n\thandleBundleNameChange() {\n\t\tif (!this.isMobileViewport()) {\n\t\t\tthis.headerTitle = 'Configure Products';\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addEventListener('bundle-name-changed', function(e) {\n\t\t\tthis.headerTitle = e.detail.name;\n\t\t}.bind(this));\n\t}\n\n\thandleExternalConfiguration() {\n\t\tthis.addEventListener('sb-close-popup', function(e) {\n\t\t\tif (this.productSelectionModel.configuredProducts.length !== 1)\n\t\t\t\treturn;\n\n\t\t\tif(!e.detail.redirect || !e.detail.redirect.auto)\n\t\t\t\treturn;\n\n\t\t\tif (e.detail.redirect.save) this.save();\n\t\t\telse this.cancel();\n\t\t});\n\t}\n\n\thandleProductConfigurationInitializer(model) {\n\t\tif (this.isReconfigure(model))\n\t\t\treturn model;\n\t\t// Applies changes made to the data model from Quote Process record's Product Configuration Initializer\n\t\tfor (let c_product of model.configuredProducts) {\n\t\t\tlet configuration = c_product.configuration; //PCI changes are reflect in this object\n\t\t\tfor (let o_config of configuration.optionConfigurations) {\n\t\t\t\tlet optionId = o_config.optionData.Id; //option ID of an option that has been affected by PCI\n\t\t\t\tfor (let option of c_product.options) {\n\t\t\t\t\tif (option.record.Id === optionId)\n\t\t\t\t\t\tfor (let data in o_config.optionData)\n\t\t\t\t\t\t\tif (option.record[data] && option.record[data] != o_config.optionData[data])\n\t\t\t\t\t\t\t\toption.record[data] = o_config.optionData[data];\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn model;\n\t}\n\n\tsave() {\n\t\tif (this.configurationAttributesValid() === false) {\n\t\t\tthis.validationMessages = [this.i18n.l('Please review required configuration attributes') + this.getConfigurationAttributeMissingFeaturesMessage()];\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validationMessages = null;\n\t\tif (this.optionId !== '') {\n\t\t\tlet configuredProduct = this.prepareProductForServer(this.currentTarget.configuredProducts[0]);\n\t\t\tif (this.validationMessages)\n\t\t\t\treturn;\n\t\t\tthis.spinner = true;\n\t\t\tthis.$.optionSave.configuration = undefined; //makes certain the observer fires\n\t\t\treturn this.$.optionSave.configuration = configuredProduct.configuration;\n\t\t}\n\t\t// Two use cases here.\n\t\t// 1. \tIf reconfigure then selectedProducts map is nil and all products to save are configured products.\n\t\t// 2. \tIf initial configuration then the selectedProducts map is not empty, contains both configured products\n\t\t//\t\t& selected standard products, and its object values contain an index whose order needs to be maintained upon save.\n\t\tlet addedProducts = this.isReconfigure(this.productSelectionModel) ? this.getConfiguredProductsToSave() : this.getSelectedProductsToSave();\n\t\t// Do not return early when you call the addProducts function and find a validation message\n\t\t// it will mess up the product and give you an error when you configure an option\n\t\tif (this.validationMessages)\n\t\t\treturn;\n\t\tthis.spinner = true;\n\t\tthis.$.optionSave.products = undefined; //makes certain the observer fires\n\t\tthis.$.optionSave.products = addedProducts;\n\t}\n\n\tcancel() {\n\t\tthis.spinner = true;\n\t\tif (this.optionId === '')\n\t\t\treturn this.nav('#', {qId: this.lineEditorModel.quote.record.Id}, ['quote', 'le'], false);\n\n\t\tthis.topLevelBundle.nestedOptionModel.cancel();\n\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\tgetConfiguredProductsToSave() {\n\t\tlet productsToSave = [];\n\t\tthis.productSelectionModel.configuredProducts.forEach( product => {\n\t\t\tproductsToSave.push(this.prepareProductForServer(product))\n\t\t});\n\t\treturn productsToSave;\n\t}\n\n\tgetSelectedProductsToSave() {\n\t\tlet configuredProducts = this.productSelectionModel.configuredProducts;\n\t\tlet configuredProductsById = {};\n\n\t\t// create map of configured products by product Id taking into account that we could have more then one\n\t\t// reconfigured product per product Id if the product was cloned by a popup custom action\n\t\tfor(let configuredProduct of configuredProducts) {\n\t\t\tlet productToSave = this.prepareProductForServer(configuredProduct);\n\t\t\tlet productId = configuredProduct.record.Id;\n\t\t\tlet configuredProducts = configuredProductsById[productId];\n\t\t\tif (!configuredProducts)\n\t\t\t\tconfiguredProducts = [];\n\t\t\tconfiguredProducts.push(productToSave);\n\t\t\tconfiguredProductsById[productId] = configuredProducts;\n\t\t}\n\n\t\t// to preserve order, build an ordered selected product id array from the object using the values' index\n\t\tlet selectedProducts = this.productSelectionModel.selectedProducts;\n\t\tlet orderedSelectedProductIds = Object.keys(selectedProducts).sort(function(id1, id2) {\n\t\t\treturn selectedProducts[id1].index - selectedProducts[id2].index;\n\t\t});\n\n\t\t//loop through the ordered selectedProductIds array to build the ordered productToSave array\n\t\tlet productsToSave = [];\n\t\tfor(let selectedProductId of orderedSelectedProductIds) {\n\t\t\tlet selectedProduct = selectedProducts[selectedProductId];\n\t\t\tlet configuredProducts = configuredProductsById[selectedProductId];\n\t\t\tif(configuredProducts)\n\t\t\t\tproductsToSave = productsToSave.concat(configuredProducts);\n\t\t\telse if(!selectedProduct.invalid)\n\t\t\t\tproductsToSave.push(selectedProduct);\n\t\t}\n\t\treturn productsToSave;\n\t}\n\n\tcheckForExternalConfiguration() {\n\t\tlet product = this.productSelectionModel.configuredProducts[this.productIndex],\n\t\t\texternalKey = this.prefix + 'ExternallyConfigurable__c',\n\t\t\texternalURL = this.lineEditorModel.settings.externalConfiguratorUrl;\n\n\t\tif (product.record[externalKey] && !product.visitedExternal && !this.isClassic && externalURL !== null) {\n\t\t\tproduct.visitedExternal = true;\n\t\t\tthis.$.customActions.handlePopup(externalURL, true);\n\t\t}\n\t}\n\n\thandleChangeEvent(e, eventContext) {\n\t\tif (e && e.detail && e.detail.bundleId && e.detail.changed && e.detail.path) {\n\t\t\tlet product = this.getProductById(e.detail.bundleId);\n\t\t\tthis.handleApplyImmediatelyProductRules(product, e.detail, eventContext);\n\t\t}\n\n\t\tif(eventContext === 'On Quantity Change') {\n\t\t\tthis.validationMessages = null;\n\t\t\tif(e.detail.invalidQuantity > 0) {\n\t\t\t\tlet errorMessage = this.i18n.l('Exceeded maximum quantity available. Value has been reduced to {0}', [e.detail.validQuantity]);\n\t\t\t\tthis.validationMessages = [{\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\tmsg: errorMessage\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\thandleApplyImmediatelyProductRules(product, detail, eventContext) {\n\t\tif (!product || !this.isAppliedImmediately(product, detail, eventContext))\n\t\t\treturn;\n\n\t\tthis.debounce('ApplyImmediatelyProductRules', function () {\n\t\t\tthis.$.productRulesInvoke.product = undefined;\n\t\t\tthis._updateProductConfigurationHiddenOptions(product);\n\t\t\tproduct = this.prepareProductForServer(product, true);\n\t\t\tthis.$.productRulesInvoke.upgradeAssetId = product.upgradedAssetId || null;\n\t\t\tthis.$.productRulesInvoke.product = product;\n\t\t}, 250);\n\t}\n\n\t_updateProductConfigurationHiddenOptions(product) {\n\t\tlet hiddenOptionIds = product.configuration.hiddenOptionIds || [];\n\t\tfor(let option of product.options) {\n\t\t\tlet optionIsHidden = option.hiddenByRule;\n\t\t\tlet optionWasHiddenIndex = hiddenOptionIds.indexOf(option.record.Id);\n\t\t\tlet optionWasHidden = optionWasHiddenIndex !== -1;\n\n\t\t\tif(optionIsHidden && !optionWasHidden)\n\t\t\t\thiddenOptionIds.push(option.record.Id);\n\n\t\t\tif(!optionIsHidden && optionWasHidden)\n\t\t\t\thiddenOptionIds.splice(optionWasHiddenIndex, 1);\n\t\t}\n\t\tproduct.configuration.hiddenOptionIds = hiddenOptionIds;\n\t}\n\n\tisAppliedImmediately(product, detail, eventContext) {\n\t\tlet appliedImmediately = this.prefix + 'AppliedImmediately__c',\n\t\t\tcontext = this.prefix + 'AppliedImmediatelyContext__c',\n\t\t\titem, applyImmediatelyContext;\n\n\t\tif (eventContext === 'On Attribute Change') {\n\t\t\titem = product.configurationAttributes.find( attribute => { return attribute.myId === detail.Id; });\n\t\t\treturn item.appliedImmediately;\n\t\t} else {\n\t\t\titem = product.options.find( option => { return option.record.Id === detail.Id; });\n\t\t\tapplyImmediatelyContext = item.record[context];\n\t\t\tif (applyImmediatelyContext === 'Always' || applyImmediatelyContext === eventContext || (applyImmediatelyContext === undefined && eventContext === 'On Selection'))\n\t\t\t\treturn item.record[appliedImmediately];\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleConfigureOptionEvent() {\n\t\tthis.addEventListener('configure-option-tapped', function(e) {\n\t\t\tlet product = this.prepareProductForNestedConfigure(e.detail);\n\t\t\tlet queryParams = (this.createQueryParams({ oId: product.nestedOptionModel.getLastFromPath().optionalSKU, ignoreCache: false }));\n\t\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t\t}.bind(this));\n\t}\n\n\tprepareProductForNestedConfigure(nested) {\n\t\tlet product;\n\t\tif (this.optionId === '') {\n\t\t\tlet index = this.productSelectionModel.currentIndex = this.getProductIndex(nested.productId);\n\t\t\tproduct = this.productSelectionModel.configuredProducts[index];\n\t\t} else {\n\t\t\tproduct = this.topLevelBundle;\n\t\t}\n\t\tproduct.nestedOptionModel = product.nestedOptionModel || new NestedOptionsModel();\n\t\tproduct.nestedOptionModel.addToPath(nested.optionId, nested.optionalSKU, nested.addedIndex, nested.tabIndex);\n\t\treturn product\n\t}\n\n\thandleOptionConfiguratorResponse() {\n\t\tthis.$.optionConfigure.addEventListener('option-configurator-response-changed', function(e) {\n\t\t\tthis.currentTarget = e.detail.value;\n\t\t\tlet nestedProduct = this.currentTarget.configuredProducts[0];\n\n\t\t\tif (this.ctx.params.oId && nestedProduct.options.length == 0 && nestedProduct.configurationAttributes.length == 0 && !this.hasDynamicFeature(nestedProduct)) {\n\t\t\t\tlet tabIndex = this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex;\n\t\t\t\tlet optionId = this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU();\n\t\t\t\tlet queryParams = optionId ? this.createQueryParams({ oId: optionId, ignoreCache: false }, tabIndex) :\n\t\t\t\t\tthis.createQueryParams({ qId: this.lineEditorModel.quote.record.Id }, tabIndex);\n\n\t\t\t\tthis.$.productAlerts.displayContinueButton = false;\n\t\t\t\tthis.$.productAlerts.cancelCB = function() {\n\t\t\t\t\treturn this.nav('#', queryParams, ['product', 'pc'], false);\n\t\t\t\t}.bind(this);\n\t\t\t\treturn this.$.productAlerts.alerts = [this.i18n.l('This product has no options and configurations. To add this product, add options/configurations or change Configuration Type to not be Required.')];\n\t\t\t} else {\n\t\t\t\tif (!nestedProduct.rulesProcessed) {\n\t\t\t\t\tlet processor = new RuleProcessor(nestedProduct.configuration, nestedProduct);\n\t\t\t\t\tprocessor.initProductRulesActions(true);\n\t\t\t\t}\n\n\t\t\t\tif (this.topLevelBundle.nestedOptionModel) {\n\t\t\t\t\tif (this.topLevelBundle.nestedOptionModel.descendLevel) {\n\t\t\t\t\t\tlet configuration = this.topLevelBundle.nestedOptionModel.configure(nestedProduct.configuration);\n\t\t\t\t\t\tnew ProductReconfigurer(nestedProduct).reconfigure(configuration);\n\t\t\t\t\t\tif (this.ctx.params.tab)\n\t\t\t\t\t\t\tthis.ctx.params.tab = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnestedProduct.configuration = this.topLevelBundle.nestedOptionModel.getCurrentLevel();\n\t\t\t\t\t\tnestedProduct.configuration.configuredOptions = this.topLevelBundle.nestedOptionModel.getConfiguredOptionsFromPath();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet filters = this.topLevelBundle.optionFieldSets.SearchFilters;\n\t\t\t\tlet searchValuesByFilter = {};\n\t\t\t\tfor (let filter of filters) {\n\t\t\t\t\tsearchValuesByFilter[filter] = null;\n\t\t\t\t}\n\t\t\t\tthis.productIndex = 0;\n\t\t\t\tthis.$.bundles.searchValuesByFilter = searchValuesByFilter;\n\t\t\t\tthis.$.bundles.searchFilters = filters;\n\t\t\t\tthis.$.bundles.set(`configuredProducts`, this.currentTarget.configuredProducts);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetProductById(id) {\n\t\treturn this.currentTarget.configuredProducts.find( product => {\n\t\t\t// product key is the unique identifier of a product if a cloned product\n\t\t\tlet productId = product.productKey || product.record.Id;\n\t\t\treturn productId === id;\n\t\t});\n\t}\n\n\tgetProductIndex(id) {\n\t\tif (id) {\n\t\t\tfor (var i=0;i<this.productSelectionModel.configuredProducts.length;i++) {\n\t\t\t\tif (this.productSelectionModel.configuredProducts[i].record.Id === id)\n\t\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.ctx.params || !this.ctx.params.productIdx)\n\t\t\treturn 0;\n\n\t\tlet productIdx = +this.ctx.params.productIdx;\n\t\tif (Number.isNaN(productIdx) || productIdx < 0 || productIdx >= this.currentTarget.configuredProducts.length)\n\t\t\treturn 0;\n\n\t\treturn productIdx;\n\t}\n\n\thasDynamicFeature(product) {\n\t\tfor (let feature of product.features)\n\t\t\tif (feature.record[this.prefix + 'OptionSelectionMethod__c'] === 'Dynamic')\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\tchangeAllActions(buttonsCollapsed) {\n\t\tif (buttonsCollapsed)\n\t\t\tthis.$$('#allActions').classList.add(\"actionsCollapsed\");\n\t\telse\n\t\t\tthis.$$('#allActions').classList.remove(\"actionsCollapsed\");\n\t}\n\n\tprepareProductForServer(configuredProduct, applyImmediately) {\n\t\tlet minimalProduct = { record:{}},\n\t\t\tnestedOptionModel = this.topLevelBundle ? this.topLevelBundle.nestedOptionModel : configuredProduct.nestedOptionModel;\n\t\tminimalProduct.upgradedAssetId = configuredProduct.upgradedAssetId; //the asset being upgraded when configuring from asset upgrade\n\t\tlet selectedProducts = this.getSelectedOptions(configuredProduct, applyImmediately, nestedOptionModel);\n\t\tminimalProduct.configuration = nestedOptionModel.save(selectedProducts, applyImmediately);\n\t\tminimalProduct.configuration.configurationData = configuredProduct.configuration.configurationData;\n\t\tminimalProduct.configuration.configuredProductId = minimalProduct.record.Id = configuredProduct.record.Id;\n\t\treturn minimalProduct;\n\t}\n\n\tgetSelectedOptions(configuredProduct, skipValidations, nestedOptionModel) {\n\t\tvar selectedOptionList = [];\n\t\tfor (let feature of configuredProduct.features) {\n\t\t\tfor (let [index, option] of feature._transient_.optionConfigurations.entries()) {\n\t\t\t\tif (option.selected) {\n\t\t\t\t\tlet product = this.optionId ? this.topLevelBundle : configuredProduct;\n\t\t\t\t\tif (!skipValidations && option.configurationRequired && option.configured !== true)\n\t\t\t\t\t\tthis.validationMessages = [this.i18n.l('Some or all options require further configuration. Look for configuration icon next to options that must be configured.')];\n\t\t\t\t\tif (option.isUpgrade) {\n\t\t\t\t\t\tlet optionUpgradeHandler = new OptionUpgradeHandler(this.prefix, configuredProduct.options, option);\n\t\t\t\t\t\toptionUpgradeHandler.setUpgradedAssetId();\n\t\t\t\t\t}\n\t\t\t\t\tlet clonedOption = JSON.parse(JSON.stringify(option));\n\t\t\t\t\tthis.buildOptionForLineEditor(clonedOption, selectedOptionList);\n\t\t\t\t}\n\t\t\t\telse if (nestedOptionModel) {\n\t\t\t\t\tnestedOptionModel.remove(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selectedOptionList;\n\t}\n\n\tbuildOptionForLineEditor(clonedOption, array) {\n\t\t// Ascending/Descending Product Rules requires building the nested configurations whenever you save at each level\n\t\tclonedOption.optionConfigurations = clonedOption.optionConfigurations || [];\n\t\tclonedOption.optionId = clonedOption.record.Id;\n\t\tclonedOption.optionData = clonedOption.record;\n\t\tif(clonedOption.configurationData === undefined)\n\t\t\tclonedOption.configurationData = {};\n\t\tclonedOption.isDynamicOption = clonedOption.isDynamicOption || clonedOption.isUpgrade;\n\t\tdelete clonedOption.record;\n\t\tarray.push(clonedOption);\n\t}\n\n\tcreateQueryParams(queryParams, tabIndex) {\n\t\tlet params = this.ctx.params;\n\t\tif (!params)\n\t\t\treturn queryParams;\n\n\t\tif (params.pId)\n\t\t\tqueryParams.pId = params.pId;\n\t\telse\n\t\t\tqueryParams.pId = this.getAllProductIds();\n\n\t\tif (params.redirectUrl)\n\t\t\tqueryParams.redirectUrl = params.redirectUrl;\n\n\t\tif (queryParams.oId) {\n\t\t\tqueryParams.qId = params.qId;\n\t\t\tif (queryParams.oId === 'none')\n\t\t\t\tdelete queryParams.oId;\n\t\t}\n\n\t\tif (params.productIdx)\n\t\t\tqueryParams.productIdx = params.productIdx;\n\t\telse if (params.pId != null && typeof params.pId !== 'string' && params.pId.length > 1)\n\t\t\tqueryParams.productIdx = 0;\n\n\t\tif (params.lineKey)\n\t\t\tqueryParams.lineKey = params.lineKey;\n\n\t\tif (queryParams.ignoreCache == null && params.ignoreCache)\n\t\t\tqueryParams.ignoreCache = false;\n\n\t\tif (tabIndex || tabIndex == 0)\n\t\t\tqueryParams.tab = tabIndex;\n\t\telse if (params.tab)\n\t\t\tqueryParams.tab = params.tab;\n\n\t\tif (params.groupKey)\n\t\t\tqueryParams.groupKey = params.groupKey;\n\n\t\tif (params.aId)\n\t\t\tqueryParams.aId = params.aId;\n\n\t\treturn queryParams;\n\t}\n\n\tgetAllProductIds() {\n\t\tlet ids = [];\n\t\tfor(let product of this.currentTarget.configuredProducts)\n\t\t\tids.push(product.record.Id);\n\t\treturn ids.join();\n\t}\n\n\tcreatePathParams(redirectUrl) {\n\t\tif (this.optionId !== '')\n\t\t\treturn ['product', 'pc'];\n\t\treturn redirectUrl === 'ProductLookup' ? ['product', 'lookup'] : ['quote', 'le'];\n\t}\n\n\ttoggle() {\n\t\tif (this.viewport.isMobile() && this.hasMultipleBundles)\n\t\t\tthis.$.bundles.toggle();\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\t_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles) {\n\t\treturn viewport.isMobile() && hasMultipleBundles;\n\t}\n\n\tgetRequiredConfigurationAttributes() {\n\t\tif (this.requiredConfigAttributes)\n\t\t\treturn this.requiredConfigAttributes;\n\n\t\tlet configuredProducts = this.currentTarget.configuredProducts,\n\t\t\trequiredConfigAttributes = {};\n\n\t\t// loop through each product being configured and store by the product index\n\t\t// an array of unique target fields that map to the product's required configuration attributes\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigAttributes = configuredProducts[i].configurationAttributes;\n\t\t\tlet requiredProductConfigAttributes = {};\n\t\t\t// loop through all configuration attributes for this product to store unique target fields for any required configuration attributes\n\t\t\tfor (let j = 0, ll = productConfigAttributes.length; j < ll; j++) {\n\t\t\t\tlet productConfigAttribute = productConfigAttributes[j];\n\t\t\t\t// ensure configuration attribute is required, and the required attribute's target field has not already been set\n\t\t\t\tif (productConfigAttribute.required === true && Object.keys(requiredProductConfigAttributes).indexOf(productConfigAttribute.targetFieldName) === -1)\n\t\t\t\t\trequiredProductConfigAttributes[productConfigAttribute.targetFieldName] = productConfigAttribute;\n\t\t\t}\n\t\t\trequiredConfigAttributes[i] = requiredProductConfigAttributes;\n\t\t}\n\t\tthis.requiredConfigAttributes = requiredConfigAttributes;\n\t\treturn this.requiredConfigAttributes;\n\t}\n\n\tconfigurationAttributesValid() {\n\t\t// required configurations is a map by product index\n\t\t// whose value is an array of unique target fields that map to that product's required configuration attributes\n\t\tlet requiredConfigurations = this.getRequiredConfigurationAttributes();\n\t\tlet missingAttributes = {};\n\t\t// loop through each product being configured and check if its configuration data\n\t\t// has a non nil value for all of its required configuration attributes' target fields\n\t\tlet configuredProducts = this.currentTarget.configuredProducts;\n\t\tfor (let i = 0, l = configuredProducts.length; i < l; i++) {\n\t\t\tlet productConfigData = configuredProducts[i].configuration.configurationData;\n\t\t\tlet productRequiredConfigAttributes = requiredConfigurations[i];\n\t\t\t// loop through all the target fields that map to this product's required configuration attributes to check if the value has been set\n\t\t\tfor (let attr in productRequiredConfigAttributes) {\n\t\t\t\t// if the required configuration attribute does not have a non nil value on the product's configuration data, then we are not valid\n\t\t\t\tif(!this.requiredConfigurationAttributeValid(productConfigData[attr]))\n\t\t\t\t\tmissingAttributes[attr] = true;\n\t\t\t}\n\t\t}\n\t\tthis.requiredAttributeMissingValue = missingAttributes;\n\t\treturn Object.keys(missingAttributes).length === 0; // no keys means no missing required attributes\n\t}\n\n\t/**\n\t * @returns {string} return a string of comma separated feature names\n\t */\n\tgetConfigurationAttributeMissingFeaturesMessage() {\n\t\tlet featuresWithRequiredMissingAttributes = {};\n\t\tif (this.requiredAttributeMissingValue === undefined)\n\t\t\tthis.getRequiredConfigurationAttributes();\n\n\t\tfor(let attrs in this.requiredConfigAttributes) {\n\t\t\tfor (let attr in this.requiredConfigAttributes[attrs]) {\n\t\t\t\tif(this.requiredAttributeMissingValue[attr] !== true)\n\t\t\t\t\tcontinue;\n\t\t\t\tlet featureName = this.getFeatureNameFromId(this.requiredConfigAttributes[attrs][attr].featureId);\n\t\t\t\tif(featureName === undefined)\n\t\t\t\t\tcontinue;\n\t\t\t\tfeaturesWithRequiredMissingAttributes[featureName] = undefined; //storing as an object so we don't have duplicate feature names\n\t\t\t}\n\t\t}\n\t\tlet featureNames = Object.keys(featuresWithRequiredMissingAttributes);\n\t\tif(featureNames.length === 0)\n\t\t\treturn ''; //no feature config attributes\n\n\t\treturn ' in the following features: ' + featureNames; //TODO: localize?\n\t}\n\n\t/**\n\t * Returns the name of a feature given it's ID\n\t * @param id a feature id\n\t * @returns {string} return a string of the feature name\n\t */\n\tgetFeatureNameFromId(id) {\n\t\tif(id === undefined)\n\t\t\treturn;\n\n\t\tfor(let prod of this.currentTarget.configuredProducts)\n\t\t\tfor(let feat of prod.features)\n\t\t\t\tif(feat.record.Id === id)\n\t\t\t\t\treturn feat.record.Name;\n\t}\n\n\trequiredConfigurationAttributeValid(value) {\n\t\treturn !this.isNil(value);\n\t}\n\n\tsearch() {\n\t\tthis.$.bundles.toggleSearch();\n\t}\n\n\tsetOptionConfigurationDetails(model) {\n\t\tthis.topLevelBundle = model.currentIndex ? model.configuredProducts[model.currentIndex] : model.configuredProducts[0];\n\t\tif (this.topLevelBundle.nestedOptionModel == null) { // if you accessed this page directly without going through the topLevelBundle, sends you to topLevel if you bypassed\n\t\t\tdelete this.ctx.params.oId;\n\t\t\treturn this.nav('#', this.ctx.params, ['product', 'pc'], false);\n\t\t}\n\n\t\tlet config = this.topLevelBundle.nestedOptionModel.getCurrentLevel();\n\t\tif (this.topLevelBundle.nestedOptionModel && config && config.configured) // do not set configuration for server if it hasn't been saved in the front end\n\t\t\tthis.$.optionConfigure.configuration = config;\n\t\tif (this.topLevelBundle.nestedOptionModel)\n\t\t\tthis.$.optionConfigure.ignoreCache = this.ctx.params.origin === 'ol' ? false : this.topLevelBundle.nestedOptionModel.descendLevel;\n\t\telse\n\t\t\tthis.$.optionConfigure.ignoreCache = true;\n\t\tthis.$.optionConfigure.product = undefined; //makes certain the observer fires\n\t\tthis.$.optionConfigure.product = this.topLevelBundle;\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.configuratorObjects = [this.prefix + 'DiscountSchedule__c', this.prefix + 'ProductOption__c', this.prefix + 'QuoteLine__c'];\n\t}\n\n\tgetProductIds() {\n\t\treturn this.ctx.params ? (this.ctx.params.pId || '') : '';\n\t}\n\n\tgetLineKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.lineKey || -1)) : -1;\n\t}\n\n\tgetGroupKey() {\n\t\treturn this.ctx.params ? (parseInt(this.ctx.params.groupKey || -1)) : -1;\n\t}\n\n\tgetIgnoreCache() {\n\t\treturn this.ctx.params ? this.ctx.params.ignoreCache === 'true' : false;\n\t}\n\n\tgetPrefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tgetOptionId() {\n\t\treturn this.ctx.params ? (this.ctx.params.oId || '') : '';\n\t}\n\n\tisNil(value) {\n\t\treturn value == null || value === '';\n\t}\n\n\tloadedModelIsReconfigure(model) {\n\t\treturn !model.quote && model.configuredProducts.length == 1;\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.validationMessages = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n\n\tisReconfigure(model) {\n\t\treturn !(model.selectedProducts);\n\t}\n}\nPolymer(ProductConfig);","export class One {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-one';\n\t\tthis.properties = {\n\t\t\tstring: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tobject: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {string: ''}\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['objectNotify(object.*)'];\n\t}\n\n\tobjectNotify(e){\n\tthis.$.sbTwo.set(e.path, e.value);\n\t}\n}\n\nPolymer(One);\n","export class Three {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-three';\n\t\tthis.properties = {\n\t\t\tstring: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tobject: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer(Three);\n","export class Two {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-two';\n\t\tthis.properties = {\n\t\t\tstring: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\tobject: {\n\t\t\t\ttype: Object\n\t\t\t}\n\t\t}\n\t}\n}\n\nPolymer(Two);\n","import {ConfigTree} from 'products/resources/tree/ConfigTree.js';\n\nexport class NestedOptionsModel {\n\tconstructor(configuration, isReconfigure) {\n\t\tthis.init(configuration, isReconfigure);\n\t}\n\n\tinit(configuration, isReconfigure) {\n\t\tthis.path = [];\n\t\tthis.descendLevel = false; // Boolean: Identifies if the user is moving into or out of a nested configuration\n\t\tthis.configTree = new ConfigTree(configuration); //manages nested configuration\n\t\tthis._setConfiguredOptionsObject(isReconfigure); // Map of Path to configured nodeIds\n\t}\n\n\tconfigure(obj) {\n\t\tlet data = this.getLastFromPath(),\n\t\t\tparent = this._getPreviousLevel();\n\t\tobj.index = obj.index || data.index;\n\t\tobj.optionId = obj.optionId || data.optionId;\n\t\tthis._appendSubtree(obj, parent, false);\n\t\tobj.staged = true;\n\t\tobj.configuredOptions = this.getConfiguredOptionsFromPath();\n\t\tthis.descendLevel = false;\n\t\treturn obj;\n\t}\n\n\tsave(optionsToAdd = [], applyImmediately) {\n\t\tlet currentLevel = this.getCurrentLevel();\n\t\toptionsToAdd.forEach( option => {\n\t\t\tthis._appendSubtree(option, currentLevel, true);\n\t\t});\n\t\tif (!applyImmediately)\n\t\t\tthis._setConfigured(currentLevel);\n\t\treturn currentLevel;\n\t}\n\n\tremove(option) {\n\t\tlet parent = this.getCurrentLevel();\n\t\tif (!parent.getChildren || parent.getChildren().length < 1)\n\t\t\treturn;\n\t\toption.optionId = option.record ? option.record.Id : option.optionId;\n\t\toption.index = option.index || 0;\n\t\tthis._removeSubtree(option, this.getCurrentLevel());\n\t}\n\n\tcancel() {\n\t\tlet currentLevel = this.getCurrentLevel(),\n\t\t\tchildren = currentLevel.getChildren(),\n\t\t\ti = 0;\n\t\twhile (i < children.length) {\n\t\t\tif (children[i].staged)\n\t\t\t\tthis._removeConfiguration(currentLevel, i, children[i].nodeId);\n\t\t\telse\n\t\t\t\ti++;\n\t\t}\n\t}\n\n\thandleDescendantRules(configPath, configsToAdd, hiddenOptionIds, disabledOptionIds) {\n\t\tlet level = this.configTree.getFromPath(this.path.concat(configPath)), existingConfigs;\n\t\tif (!level)\n\t\t\treturn;\n\n\t\texistingConfigs = level.getChildren();\n\t\tconfigsToAdd.forEach( config => {\n\t\t\tconfig.index = config.index || 0;\n\t\t\tlet existingConfig = existingConfigs.find( existing => {\n\t\t\t\treturn this._buildId(config) === existing.nodeId;\n\t\t\t});\n\t\t\tif (existingConfig === undefined) {\n\t\t\t\tthis.configTree.buildSubtree(config);\n\t\t\t\texistingConfigs.push(config);\n\t\t\t}\n\t\t});\n\t\texistingConfigs.forEach( config => {\n\t\t\tlet configToAdd = configsToAdd.find( configToAdd => {\n\t\t\t\treturn config.nodeId === this._buildId(configToAdd);\n\t\t\t});\n\t\t\tif (configToAdd === undefined)\n\t\t\t\tthis._removeSubtree(config, level);\n\t\t});\n\t\tlevel.hiddenOptionIds = hiddenOptionIds;\n\t\tlevel.disabledOptionIds = disabledOptionIds;\n\t}\n\n\tgetCurrentLevel() {\n\t\treturn this.configTree.getFromPath(this.path);\n\t}\n\n\taddToPath(id, sku, index, tabIndex) {\n\t\tthis.path.push({ optionId: id, optionalSKU: sku, index: index, tabIndex: tabIndex });\n\t\tthis.descendLevel = true;\n\t}\n\n\tpopFromPathAndGetNextSKU() {\n\t\tthis.path.pop();\n\t\tthis.descendLevel = false;\n\t\tlet optionInfo = this.getLastFromPath();\n\t\treturn optionInfo ? optionInfo.optionalSKU : optionInfo;\n\t}\n\n\tgetLastFromPath() {\n\t\treturn this.path[this.path.length-1];\n\t}\n\n\tgetConfiguredOptionsFromPath() {\n\t\treturn this.configuredOptions[this._buildPathString(true)] || {};\n\t}\n\n\t_getPreviousLevel() {\n\t\treturn this.configTree.getFromPath(this.path.slice(0, this.path.length-1));\n\t}\n\n\t_setConfiguredOptionsObject(isReconfigure) {\n\t\tthis.configuredOptions = {};\n\t\tif (!isReconfigure)\n\t\t\treturn;\n\t\tthis._addConfigsToConfigurationObject(this.configTree.root, []); // on reconfigure, flag every configuration in tree as configured\n\t\tthis.configTree.root.configuredOptions = this.getConfiguredOptionsFromPath();\n\t}\n\n\t_addConfigsToConfigurationObject(configuration, path) {\n\t\tconfiguration.getChildren().forEach( nestedConfig => {\n\t\t\tlet obj = {'optionId': nestedConfig.optionId, 'index': nestedConfig.index};\n\t\t\tthis._addConfigsToConfigurationObject(nestedConfig, path.concat([obj]));\n\t\t});\n\t\tthis._setConfigured(configuration, path);\n\t}\n\n\t_setConfigured(configuration, path) {\n\t\tlet key = this._buildPathString(false, path);\n\t\tconfiguration.configured = true;\n\t\tif (key) {\n\t\t\tthis.configuredOptions[key] = this.configuredOptions[key] || {};\n\t\t\tthis.configuredOptions[key][configuration.nodeId] = true;\n\t\t}\n\t}\n\n\t_appendSubtree(obj, parent, onSave) {\n\t\tlet existingObj = this._findOnLevel(obj, parent);\n\t\tif (existingObj) {\n\t\t\tif (onSave)\n\t\t\t\tdelete existingObj.staged;\n\t\t\telse // double-nested configurations only loaded on configure of nested config\n\t\t\t\tif (obj.optionConfigurations.length > 0) {\n\t\t\t\t\tlet indices = {};\n\t\t\t\t\tobj.optionConfigurations.forEach( nestedConfig => {\n\t\t\t\t\t\tindices[nestedConfig.optionId] = indices[nestedConfig.optionId] === undefined ? 0: indices[nestedConfig.optionId] + 1;\n\t\t\t\t\t\tnestedConfig.index = indices[nestedConfig.optionId];\n\t\t\t\t\t\tthis._appendSubtree(nestedConfig, existingObj, false);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\texistingObj.optionData = obj.optionData;\n\t\t\texistingObj.externalConfigurationData = obj.externalConfigurationData;\n\t\t\treturn;\n\t\t}\n\t\tif (onSave) {\n\t\t\tthis._addIndexProperty(obj, parent);\n\t\t}\n\t\tthis.configTree.buildSubtree(obj);\n\t\tparent.getChildren().push(obj);\n\t}\n\n\t_removeSubtree(child, parent) {\n\t\tlet childIndex = this._getChildIndexAndAdjustIndices(child.optionId, child.index, parent.getChildren());\n\t\tif (childIndex >= 0) {\n\t\t\tthis._removeConfiguration(parent, childIndex, this._buildId(child));\n\t\t}\n\t}\n\n\t_removeConfiguration(parent, index, childId) {\n\t\tlet key = this._buildPathString(true);\n\t\tparent.getChildren().splice(index, 1);\n\t\tif (key && this.configuredOptions[key] && this.configuredOptions[key][childId] && !this._findOnLevel(childId, parent)) {\n\t\t\tdelete this.configuredOptions[key][childId];\n\t\t}\n\t}\n\n\t_findOnLevel(idProperties, parent) {\n\t\tlet id = idProperties.constructor === String ? idProperties : this._buildId(idProperties);\n\t\treturn parent.getChildren().find( child => {\n\t\t\treturn child.nodeId === id;\n\t\t});\n\t}\n\n\t_addIndexProperty(obj, parent) {\n\t\tlet i = obj.index || 0;\n\t\twhile (this._findOnLevel({'optionId': obj.optionId, 'index': i}, parent)) {\n\t\t\ti++;\n\t\t}\n\t\tobj.index = i;\n\t}\n\n\t_getChildIndexAndAdjustIndices(optionId, index, children) {\n\t\tlet i = 0,\n\t\t\tchildIndex = -1,\n\t\t\tid = this._buildId({'optionId': optionId, 'index': index});\n\t\tfor (let child of children) {\n\t\t\tif (child.nodeId === id)\n\t\t\t\tchildIndex = i;\n\t\t\telse if (child.optionId === optionId && child.index > index)\n\t\t\t\tthis._alterIndexPropertyAndNodeId(child);\n\t\t\ti++;\n\t\t}\n\t\treturn childIndex;\n\t}\n\n\t_alterIndexPropertyAndNodeId(obj) {\n\t\tlet prevId = obj.nodeId;\n\t\tobj.index--;\n\t\tobj.nodeId = this._buildId(obj);\n\n\t\tlet key = this._buildPathString(true);\n\t\tif (key && this.configuredOptions[key]) {\n\t\t\tthis.configuredOptions[key][obj.nodeId] = true;\n\t\t\tdelete this.configuredOptions[key][prevId];\n\t\t}\n\t}\n\n\t_buildId(obj) {\n\t\treturn '_' + obj.optionId + '_' + obj.index;\n\t}\n\n\t_buildPathString(includeLast, path = this.path) {\n\t\tlet string = this.configTree.root.nodeId,\n\t\t\tn = includeLast ? 0 : 1;\n\t\tfor (let i = 0; i < path.length - n; i++) {\n\t\t\tstring += ('-' + this._buildId(path[i]));\n\t\t}\n\t\treturn string;\n\t}\n}","import {Util} from '../../../../common/Util.js';\nimport {ServiceClient} from 'common/data/client/ServiceClient.js';\nimport {AppContext} from 'common/core/AppContext.js';\nimport {LookupNameMapper} from 'common/forms/sb-lookup/map/LookupNameMapper.js';\n\nexport class Suggester {\n\tconstructor(prefix, searchModel, quoteProcess) {\n\t\tthis.prefix = prefix;\n\t\tthis.searchModel = searchModel;\n\t\tthis.searchFilterData = {};\n\t\tthis.filterContext = quoteProcess;\n\t}\n\n\tbuildFields(fields) {\n\t\tlet gsfields = [];\n\t\tfor (let field of fields) {\n\t\t\tgsfields.push(field.replace('Product2','ProcessInput__c'));\n\t\t}\n\t\treturn gsfields;\n\t}\n\n\tgetSearchTable() {\n\t\treturn this.prefix + 'ProcessInput__c';\n\t}\n\n\tgetGroupKey(filter) {\n\t\treturn filter.record.Id;\n\t}\n\n\tsetDefaultFilterValues(group, searchFilterModel) {\n\t\tlet searchFilterData = {};\n\t\tlet promises = [];\n\t\tfor (let id of group) {\n\t\t\tfor (let process of this.searchModel.quoteProcess.inputs) {\n\t\t\t\tif (process.record.Id === id) {\n\t\t\t\t\tif (!this.searchModel.processInputValues[id]) {\n\t\t\t\t\t\t//do nothing here; just skip code in following else if\n\t\t\t\t\t}\n\t\t\t\t\telse if (searchFilterModel && this.isLookupType(searchFilterModel[id].model.type) && this.searchModel.processInputValues[id][this.prefix + 'Value__c'])\n\t\t\t\t\t\tpromises.push(this.queryLookupFilterName(this.searchModel.processInputValues[id][this.prefix + 'Value__c'], searchFilterModel[id].model.referenceTo[0]));\n\t\t\t\t\tlet value = null;\n\t\t\t\t\tif (this.searchModel.processInputValues[id])\n\t\t\t\t\t\tvalue = this.searchModel.processInputValues[id][this.prefix + 'Value__c'] || null;\n\t\t\t\t\telse\n\t\t\t\t\t\tvalue = process.record[process.record[this.prefix + 'InputField__c']] || null;\n\t\t\t\t\tsearchFilterData[id] = {value: value, hidden: false, field: process.targetFieldName};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(function(resolve) {\n\t\t\tif(promises.length === 0) {\n\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\tresolve(searchFilterData);\n\t\t\t} else {\n\t\t\t\tPromise.all(promises).then(function (responses) {\n\t\t\t\t\tfor(let response of responses) {\n\t\t\t\t\t\tlet record = response.records[0];\n\t\t\t\t\t\tif (!record)\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tlet name = new LookupNameMapper(record.attributes.type).getNameField();\n\t\t\t\t\t\tfor(let id in searchFilterData) {\n\t\t\t\t\t\t\tlet searchFilter = searchFilterData[id];\n\t\t\t\t\t\t\tif (!searchFilter.value)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\tif(searchFilter.value.substring(0, 15) === record.Id.substring(0, 15)) {\n\t\t\t\t\t\t\t\tsearchFilter.label = record[name];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.searchFilterData = searchFilterData;\n\t\t\t\t\tthis.evaluateProcessInputConditions();\n\t\t\t\t\tresolve(searchFilterData);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tgetFilterContext() {\n\t\tlet quoteProcess = JSON.parse(JSON.stringify(this.filterContext));\n\t\tfor (let input of quoteProcess.inputs) {\n\t\t\tif (this.searchFilterData[input.record.Id].hidden) {\n\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\tinput.hidden = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.searchFilterData[input.record.Id]) {\n\t\t\t\tif (this.searchFilterData[input.record.Id].value === '')\n\t\t\t\t\tinput.record[input.targetFieldName] = null;\n\t\t\t\telse\n\t\t\t\t\tinput.record[input.targetFieldName] = this.searchFilterData[input.record.Id].value;\n\t\t\t}\n\t\t}\n\n\t\tlet length = quoteProcess.inputs.length;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tif (quoteProcess.inputs[i].hidden)\n\t\t\t{\n\t\t\t\tquoteProcess.inputs.splice(i, 1);\n\t\t\t\tlength--;\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn quoteProcess;\n\t}\n\n\tgetAdditionalProperties() {\n\t\treturn null;\n\t}\n\n\tevaluateProcessInputConditions() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.searchFilterData));\n\t\tfor (let input of this.filterContext.inputs) {\n\t\t\tlet numPass = 0;\n\t\t\tif(input.conditions.length === 0) {\n\t\t\t\tsearchFilterData[input.record.Id].hidden = false;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (let condition of input.conditions) {\n\t\t\t\tlet masterProcessInput = condition[this.prefix + 'MasterProcessInput__c'];\n\t\t\t\tlet masterProcessInputValue = searchFilterData[masterProcessInput].value;\n\t\t\t\tif (Util.arithmeticOperatorConversion(masterProcessInputValue, condition[this.prefix + 'Value__c'], condition[this.prefix + 'Operator__c']))\n\t\t\t\t\tnumPass++;\n\t\t\t}\n\t\t\tif (input.record[this.prefix + 'ConditionsMet__c'] === 'All')\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass === input.conditions.length);\n\t\t\telse\n\t\t\t\tsearchFilterData[input.record.Id].hidden = !(numPass > 0);\n\t\t}\n\t\tthis.searchFilterData = searchFilterData;\n\t\treturn searchFilterData;\n\t}\n\n\trunOnLoad() {\n\t\tlet Ids = [];\n\t\tfor (let input of this.searchModel.quoteProcess.inputs) {\n\t\t\tIds.push(input.record.Id);\n\t\t}\n\t\tthis.setDefaultFilterValues(Ids);\n\t}\n\n\tisLookupType(type) {\n\t\treturn type === 'reference' || type === 'id';\n\t}\n\n\tqueryLookupFilterName(id, tableName) {\n\t\tlet name = new LookupNameMapper(tableName).getNameField();\n\t\tlet _id = id ? `'${id}'` : null;\n\t\treturn new ServiceClient().query((`SELECT Id, ${name} FROM ${tableName} WHERE Id = `).concat(_id));\n\t}\n}","import {Page} from 'common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {Suggester} from 'products/selection/filter/sb-suggester/Suggester.js';\nimport {PageContainer} from 'common/core/sb-page-container/PageContainer.js';\nimport {LocalizeFields} from 'products/localization/LocalizeFields.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class ProductLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\tredirectUrl: String,\n\t\t\thiddenByGroup: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: Boolean,\n\t\t\tquote: Object,\n\t\t\tinternal: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tviewport: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: function () {\n\t\t\t\t\treturn PageContainer.getViewport();\n\t\t\t\t}\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget observers() {\n\t\treturn [\n\t\t\t'searchModelChanged(searchModel)',\n\t\t\t'modal(quote, modalActive)',\n\t\t\t'handleValueChanged(searchFilterData.*)'\n\t\t];\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t};\n\t}\n\n\tmodal() {\n\t\tif (!this.modalActive && this.hasQuoteProcess) {\n\t\t\tthis.$.selectionSaver.save({uid: this.quote.record.Id, model: {modalActive: true}});\n\t\t\tthis.toggleClass('modaloverflow', true, this);\n\t\t\tthis.$.modal.show = true;\n\t\t} else {\n\t\t\tif (!this.hasQuoteProcess) {\n\t\t\t\tthis.toggleClass('panel-actions', false, this.$$('#gslayout'));\n\t\t\t\tthis.toggleClass('panel-actions', true, this.$$('#pflayout'));\n\t\t\t}\n\t\t\tthis.panelSuggester = this.suggester;\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\t}\n\t\tthis.refocus();\n\t}\n\n\tsearchModelChanged() {\n\t\tthis.handleAutoSelect();\n\t\tthis.deSelectAll();\n\t\tthis.setUsePagination();\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis.handleClearSelected();\n\t\tthis.handleScrollEvent();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t\tthis.handlePaginationChanged();\n\t\tthis.$.lookupLayout.additionalFields = ['PricebookEntry.UnitPrice'];\n\t\tthis.$.modal.addEventListener('sb-gs-modal-close', this.closeDialog.bind(this));\n\t\tthis.$.drawer.$.drawer.addEventListener('transitionend', this.refocus.bind(this));\n\t\tthis.$.modal.addEventListener('filter-item-value-changed', this.handleLabelChanged.bind(this));\n\t\tthis.addEventListener('iron-deselect', this.handleDrawerClosed.bind(this));\n\t}\n\n\thandleTransientCache() {\n\t\t//TODO: run the filter on initial searchModel retrieval, don't need 2 server requests for a searchModel on page load\n\t\t//this applies a previously cached filter when returning to the page\n\t\tthis.$.selectionReader.read({uid: this.quote.record.Id}).then(function (response) {\n\t\t\tthis.lastSubmit = response ? response.lastSubmit : null;\n\t\t\tthis.modalActive = response ? response.modalActive : false;\n\t\t\tif (this.lastSubmit === 'gs') {\n\t\t\t\tthis.suggester.runOnLoad();\n\t\t\t\tthis.runSuggester();\n\t\t\t}\n\t\t\telse if (this.lastSubmit === 'pf') {\n\t\t\t\tthis.searcher.runOnLoad(response.filterValues);\n\t\t\t\tthis.runSearcher();\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = e.detail.value.quote;\n\t\t\tthis.inputField = this.prefix + 'InputField__c'; //handle record property for guided selling inputs\n\t\t\tthis.localizer = new LocalizeFields(this.prefix);\n\t\t\tlet quoteProcessId = this.quote.record[this.prefix + 'QuoteProcessId__c'] ? this.quote.record[this.prefix + 'QuoteProcessId__c'] : null;\n\t\t\tthis.hasQuoteProcess = (quoteProcessId !== null);\n\t\t\t//this loads either the guided selling or product filter panel when the page loads\n\t\t\tif (this.hasQuoteProcess === true)\n\t\t\t\tthis.toggleClass('panel-actions', true, this.$$('#gslayout'));\n\t\t\telse\n\t\t\t\tthis.toggleClass('panel-actions', true, this.$$('#pflayout'));\n\t\t\tif (this.ctx.params.aId)\n\t\t\t\tthis.$.smLoadService.actionId = this.ctx.params.aId;\n\t\t\tthis.$.smLoadService.processId = quoteProcessId;\n\t\t\tthis.$.smLoadService.quote = this.$.smSelectService.quote = this.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tlet searchModel = this.localizer.localizeSearchModel(e.detail.value);\n\t\t\tthis.$.lookupLayout.groupByField = searchModel.productResultsGroupFieldName; //Setting for allowing the product results to be grouped by a column\n\t\t\tthis.$.lookupLayout.fieldPrefix = searchModel.targetObjectName + '.'; //todo add good comment here\n\t\t\tthis.quoteProcess = searchModel.quoteProcess; //detach quoteProcess from the searchModel so it isn't overwritten by null when service returns\n\t\t\tthis.searchModel = searchModel;\n\t\t\tthis.buildDelegator();\n\t\t\tthis.handleTransientCache();\n\t\t}.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tthis.lineEditorModel.quote = e.detail.value.quote;\n\t\t\tif (e.detail.value.configuredProducts.length == 0) {\n\t\t\t\tthis.handleNonConfigurableProducts(e);\n\t\t\t}\n\t\t\tif (e.detail.value.configuredProducts.length > 0) {\n\t\t\t\tthis.handleConfigurableProducts(e);\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\thandleNonConfigurableProducts(e) {\n\t\tif (this.redirectUrl === 'LineEditor') {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t\telse if (this.redirectUrl === 'ProductLookup') {\n\t\t\tthis.$.smSelectService.quote = e.detail.value.quote;\n\t\t\tthis.deSelectAll();\n\t\t\tthis.navigateToSelf();\n\t\t\tthis.spinner = false;\n\t\t}\n\t}\n\n\thandleConfigurableProducts(e) {\n\t\tlet queryParams = {};\n\t\te.detail.value.selectedProducts = this.selectedProducts;\n\t\tlet configProductIds = this.getConfigProductIds(e);\n\t\tqueryParams.qId = e.detail.value.quote.record.Id;\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tqueryParams.groupKey = this.ctx.params.groupKey;\n\t\tif(this.ctx.params.aId !== undefined)\n\t\t\tqueryParams.aId = this.ctx.params.aId;\n\t\tqueryParams.pId = configProductIds;\n\t\tqueryParams.redirectUrl = this.redirectUrl;\n\t\tqueryParams.open = 0;\n\t\tthis.nav('#', queryParams, ['product', 'pc'], false);\n\t}\n\n\thandleLabelChanged(e) {\n\t\tif(this.searchFilterData) // only defined in a guided selling use case\n\t\t\tthis.searchFilterData[e.detail.item].label = e.detail.value;\n\t}\n\n\tbuildDelegator() {\n\t\tif (this.hasQuoteProcess) {\n\t\t\tthis.suggester = new Suggester(this.prefix, this.searchModel, this.quoteProcess);\n\t\t}\n\t\tif (!this.searcher)\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t}\n\n\thandleValueChanged() {\n\t\tif (this.internal)\n\t\t\treturn;\n\t\tthis.internal = true;\n\t\tthis.updateSearchFilterData();\n\t\tthis.internal = false;\n\t}\n\n\tupdateSearchFilterData() {\n\t\tthis.suggester.searchFilterData = this.searchFilterData;\n\t\tlet searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t\tthis.searchFilterData = searchFilterData;\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.panelHeader = 'Product Filter';\n\t\tif (this.$$('.panel-actions').id === 'pflayout' || this.$.drawer.$.drawer.selected === 'main')\n\t\t\tthis.$.drawer.$.drawer.togglePanel();\n\t\tthis.toggleClass('panel-actions', false, this.$$('#gslayout'));\n\t\tthis.toggleClass('panel-actions', true, this.$$('#pflayout'));\n\t\tthis.refocus();\n\t}\n\n\ttoggleGuidedSelling() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.panelHeader = 'Guided Selling';\n\t\tif (this.$$('.panel-actions').id === 'gslayout' || this.$.drawer.$.drawer.selected === 'main')\n\t\t\tthis.$.drawer.$.drawer.togglePanel();\n\t\tthis.toggleClass('panel-actions', false, this.$$('#pflayout'));\n\t\tthis.toggleClass('panel-actions', true, this.$$('#gslayout'));\n\t\tthis.refocus();\n\t}\n\n\trefocus() {\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.modalGroup.focusFirstField();\n\t\telse if (this.$$('.panel-actions').id === 'gslayout')\n\t\t\tthis.$.gs.focusFirstField();\n\t\telse if (this.$$('.panel-actions').id === 'pflayout')\n\t\t\tthis.$.pf.focusFirstField();\n\t}\n\n\treverseFocus() {\n\t\tif (this.$.modal.show)\n\t\t\tthis.$.suggest.focus();\n\t\telse if (this.$$('.panel-actions').id === 'gslayout')\n\t\t\tthis.$.cleargs.focus();\n\t\telse if (this.$$('.panel-actions').id === 'pflayout')\n\t\t\tthis.$.clearfilter.focus();\n\t}\n\n\tcloseDialog() {\n\t\tthis.toggleClass('modaloverflow', false, this);\n\t\t//build guided selling panel\n\t\tthis.panelSuggester = this.suggester;\n\t\tif (!this.panelGroupItems)\n\t\t\tthis.panelGroupItems = this.groupItems;\n\t\tthis.$.modal.show = false;\n\t}\n\n\tsuggestClicked() {\n\t\tthis.suggest = true;\n\t\tthis.runSuggester();\n\t}\n\n\trunSuggester() {\n\t\t//focusing onto the button blurs the group fields to run the value-changed flow\n\t\tthis.$$('#suggest').focus();\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'gs';\n\t\tthis.closeDialog();\n\t\tthis.$.gs.runService();\n\t\tthis.$.drawer.$.drawer.closeDrawer();\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.saveCache();\n\t\tthis.lastSubmit = 'pf';\n\t\tthis.$.pf.actionId = this.ctx.params.aId;\n\t\tthis.$.pf.runService();\n\t\tthis.$.drawer.$.drawer.closeDrawer();\n\t}\n\n\tsaveCache() {\n\t\tthis.$.selectionSaver.save({\n\t\t\tuid: this.quote.record.Id, model: {\n\t\t\t\tmodalActive: true,\n\t\t\t\tlastSubmit: this.$$('.panel-actions').id.substring(0, 2),\n\t\t\t\tfilterValues: this.searcher.searchFilterData\n\t\t\t}\n\t\t});\n\t}\n\n\thandleScrollEvent() {\n\t\tthis.previous = 0;\n\t\tlet drawer = this.$$('#lookupLayout');\n\t\tdrawer.addEventListener('scroll', function () {\n\t\t\tif (!this.usePagination || this.isMobileViewport() === false)\n\t\t\t\treturn;\n\t\t\tlet current = drawer.scrollTop;\n\t\t\tif (current < 0)\n\t\t\t\treturn; // ignores Safari scroll bounce at top of scroll area\n\t\t\tlet offset = drawer.offsetHeight;\n\t\t\tlet scrollHeight = drawer.scrollHeight;\n\t\t\tif ((current + offset) >= scrollHeight)\n\t\t\t\treturn; // ignores Safari scroll bounce at bottom of the scroll area\n\t\t\tlet direction = this.previous < current ? 'down' : 'up';\n\t\t\tthis.previous = current;\n\t\t\tthis.paginationBar = this.paginationBar || this.$$('sb-pagination');\n\t\t\tthis.toggleClass('hide', direction === 'down', this.paginationBar);\n\t\t}.bind(this));\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tthis.redirectUrl = 'LineEditor';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToLineEditor();\n\t\t}\n\t}\n\n\tonSelectMore() {\n\t\tthis.redirectUrl = 'ProductLookup';\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0) {\n\t\t\tthis.spinner = true;\n\t\t\tif (this.quoteProcess)\n\t\t\t\tthis.$.smSelectService.quoteProcess = this.suggester.getFilterContext();\n\t\t\tthis.$.smSelectService.selectedProductList = this.getOrderedSelectedProducts();\n\t\t} else {\n\t\t\tthis.navigateToSelf();\n\t\t}\n\t}\n\n\tgetOrderedSelectedProducts() {\n\t\tlet orderedSelectedProductIds = Object.keys(this.selectedProducts).sort(function (id1, id2) {\n\t\t\treturn this.selectedProducts[id1].index - this.selectedProducts[id2].index;\n\t\t}.bind(this));\n\n\t\tlet orderedSelectedProducts = [];\n\t\tfor (let selectedProductId of orderedSelectedProductIds) {\n\t\t\t// UnitPrice is added to avoid looping through all the pricebook entries, but we do not need the information in the server.\n\t\t\tdelete this.selectedProducts[selectedProductId].record.UnitPrice;\n\t\t\torderedSelectedProducts.push(this.selectedProducts[selectedProductId]);\n\t\t}\n\t\treturn orderedSelectedProducts;\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tthis.nav('#', {'qId': this.quote.record.Id}, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tthis.nav('#', {'qId': this.quote.record.Id}, ['quote', 'le'], false);\n\t}\n\n\tnavigateToSelf() {\n\t\tlet actionIdQueryString = this.ctx.params.aId ? ('&aId=' + this.ctx.params.aId) : '';\n\t\tthis.fire('iron-signal', {\n\t\t\tname: 'sb-navigation-changed', data: {\n\t\t\t\turl: '#', location: '#/product/lookup?qId=' + this.quote.record.Id + actionIdQueryString\n\t\t\t}\n\t\t});\n\t\tthis.$.plSelectMore.blur();\n\t}\n\n\tnavToFavorites() {\n\t\tlet params = {qId: this.quote.record.Id};\n\t\tif (this.ctx.params.groupKey !== undefined)\n\t\t\tparams.groupKey = this.ctx.params.groupKey;\n\t\tif (this.ctx.params.aId !== undefined)\n\t\t\tparams.aId = this.ctx.params.aId;\n\t\tthis.nav('#', params, ['favorite', 'lookup'], false);\n\t}\n\n\thandlePaginationChanged() {\n\t\t//this is what calls the backend to get updated pagination data\n\t\t//if you have applied a filter it will use the filter service to retrieve the pagination results with the filter\n\t\tthis.addEventListener('pagination-changed', function (e) {\n\t\t\tif (this.lastSubmit === 'gs')\n\t\t\t\tthis.$.gs.runService(null, null, e.detail.page);\n\t\t\telse\n\t\t\t\tthis.$.pf.runService(null, null, e.detail.page);\n\t\t}.bind(this));\n\t}\n\n\tsetUsePagination() {\n\t\tif (!this.searchModel.resultLimit || this.searchModel.totalCount === undefined)\n\t\t\treturn;\n\n\t\tthis.hasTotalCount = true;\n\t\tthis.resultLimit = this.searchModel.resultLimit;\n\t\tthis.totalCount = this.searchModel.totalCount;\n\t\tthis.usePagination = this.resultLimit < this.totalCount;\n\t\tthis.pageIndex = undefined;\n\t\tthis.pageIndex = 0;\n\t}\n\n\thandleAutoSelect() {\n\t\tif (this.suggest && this.quoteProcess && this.quoteProcess.record[this.prefix + 'ProductAutoSelected__c'] && this.searchModel.results.length === 1)\n\t\t{\n\t\t\tlet result = this.searchModel.results[0];\n\t\t\tthis.selectedProducts[result.record.Product2Id] = {\n\t\t\t\trecord: {Id: result.record.Product2Id, attributes: result.record.attributes, UnitPrice: result.record.UnitPrice},\n\t\t\t\tinvalid: false\n\t\t\t};\n\t\t\tthis.suggest = false;\n\t\t\tthis.onSelect();\n\t\t}\n\t}\n\n\thandleClearSelected() {\n\t\tthis.addEventListener('suggestion-loaded', function () {\n\t\t\tthis.deSelectAll();\n\t\t}.bind(this));\n\t}\n\n\thandleDrawerScroll() {\n\t\tthis.addEventListener('filter-drawer-scroll', function (e) {\n\t\t\tif (!this.usePagination || this.isMobileViewport() === false)\n\t\t\t\treturn;\n\t\t\tlet direction = e.detail.direction;\n\t\t\tthis.paginationBar = this.paginationBar || this.$$('sb-pagination');\n\t\t\tthis.toggleClass('hidden', direction === 'down', this.paginationBar);\n\t\t}.bind(this));\n\t}\n\n\thandleDrawerClosed() {\n\t\tif (this.$.drawer.$.drawer.selected === 'main') {\n\t\t\tthis.fire('iron-signal', {name: 'sb-panel-closed'});\n\t\t}\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearGSFields() {\n\t\tlet searchFilterData = JSON.parse(JSON.stringify(this.suggester.searchFilterData));\n\t\tfor (let value in searchFilterData) {\n\t\t\tsearchFilterData[value].value = null;\n\t\t}\n\t\tthis.suggester.searchFilterData = searchFilterData;\n\t\tthis.searchFilterData = this.suggester.evaluateProcessInputConditions();\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.pf.enterCallback = this.runSearcher.bind(this);\n\t\tthis.$.gs.enterCallback = this.runSuggester.bind(this);\n\t\tthis.$.modalGroup.enterCallback = this.runSuggester.bind(this);\n\t}\n\n\t//we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.lookupObjects = ['Product2', 'PricebookEntry', this.prefix + 'ProcessInput__c'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tisMobileViewport() {\n\t\treturn this.viewport && this.viewport.isMobile();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n}\n\nPolymer(ProductLookup);","import {Page} from '../../../../common/core/Page.js';\nimport {FieldSetHandler} from 'common/layout/fields/FieldSetHandler.js';\nimport {TableClassBuilder} from 'common/layout/tables/TableClassBuilder.js';\nimport {Searcher} from 'common/filter/searcher/Searcher.js';\nimport {ErrorFormatter} from 'common/data/format/ErrorFormatter.js';\n\nexport class SubscriptionLookup extends Page {\n\n\tget behaviors() {\n\t\treturn [sb.common.core.Page, window.CommonBehaviors.DeviceBehavior, window.CommonBehaviors.LookupBehavior];\n\t}\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-subscription-lookup';\n\t\tthis.properties = Polymer.Base.extend({\n\t\t\tselectedProducts: {\n\t\t\t\ttype: Object,\n\t\t\t\tvalue: {}\n\t\t\t},\n\t\t\tlineEditorModel: Object,\n\t\t\ttotalCount: String,\n\t\t\thasTotalCount: String,\n\t\t\terrors: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: [],\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: []\n\t\t\t}\n\t\t}, Page.properties);\n\t}\n\n\tget listeners() {\n\t\treturn {\n\t\t\t'errors-changed': 'clearStackTrace'\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.preLoadObjects();\n\t\tthis.handleSelectButtonClickedServerResponseAndNavigation();\n\t}\n\n\thandleProductsLoadServerResponse() {\n\t\tthis.$.qo.addEventListener('line-editor-model-changed', function (e) {\n\t\t\tthis.lineEditorModel = e.detail.value;\n\t\t\tthis.quote = this.$.smLoadService.quote = this.$.smSelectService.quote = e.detail.value.quote;\n\t\t}.bind(this));\n\n\t\tthis.$.smLoadService.addEventListener('search-model-changed', function (e) {\n\t\t\tthis.searchModel = e.detail.value;\n\t\t\tthis.primaryMobileColumn = this.searchModel.resultFieldNames[0]; //the first column will be used for the primary mobile column\n\t\t\tthis.searcher = new Searcher(this.searchModel);\n\t\t\tthis.hasTotalCount = (this.searchModel.totalCount > 0);\n\t\t\tthis.totalCount = this.searchModel.totalCount;\n\t\t}.bind(this));\n\t}\n\n\thandleSelectButtonClickedServerResponseAndNavigation() {\n\t\t// listen for the results of addProducts and navigate to the correct route\n\t\tthis.$.smSelectService.addEventListener('result-changed', function (e) {\n\t\t\tthis.lineEditorModel.quote = e.detail.value;\n\t\t\tthis.navigateToLineEditor();\n\t\t}.bind(this));\n\t}\n\n\ttoggleFilter() {\n\t\tthis.$$('sb-page-header')._closeMenu();\n\t\tthis.$.drawer.$.drawer.togglePanel();\n\t}\n\n\tremoveFilter() {\n\t\tthis.$$('.actions').removeChild(this.$$('#fb'));\n\t}\n\n\tgetConfigProductIds(e) {\n\t\tlet productIds = [];\n\t\tfor (let product of e.detail.value.configuredProducts) {\n\t\t\tproductIds.push(product.record.Id)\n\t\t}\n\t\treturn productIds.join(',');\n\t}\n\n\tdeSelectAll() {\n\t\tthis.$.lookupLayout.deSelectAll();\n\t}\n\n\tonSelect() {\n\t\tthis.spinner = true;\n\t\tif (this.selectedProducts && Object.keys(this.selectedProducts).length > 0)\n\t\t\tthis.$.smSelectService.selectedProducts = this.selectedProducts;\n\t\telse\n\t\t\tthis.navigateToLineEditor();\n\t}\n\n\tonCancel() {\n\t\tthis.spinner = true;\n\t\tthis.nav('#', {'qId': this.lineEditorModel.quote.record.Id}, ['quote', 'le'], false);\n\t}\n\n\tnavigateToLineEditor() {\n\t\tthis.nav('#', {'qId': this.lineEditorModel.quote.record.Id}, ['quote', 'le'], false);\n\t}\n\n\trunSearcher() {\n\t\t//this focus code makes sure the field is blured so that the value is available in the model\n\t\tthis.$$('#submit').focus();\n\t\tthis.$.sf.runService();\n\t\tthis.$.drawer.$.drawer.closeDrawer();\n\t}\n\n\t////we request a describe on these objects on load anticipating the data will be used later\n\tpreLoadObjects() {\n\t\tthis.subscriptionLookupObjects = [this.prefix + 'Subscription__c', 'Contract'];\n\t}\n\n\tget prefix() {\n\t\treturn this.app.org.prefix ? this.app.org.prefix + '__' : '';\n\t}\n\n\tbindFilterEnterCallBacks() {\n\t\t//for when the enter key is pressed, we provide a callback to the filter component\n\t\tthis.$.sf.enterCallback = this.runSearcher.bind(this);\n\t}\n\n\tclearFilterFields() {\n\t\tthis.filterData = this.searcher.clearFields();\n\t}\n\n\tclearStackTrace() {\n\t\tif (!this.errors[0])\n\t\t\treturn;\n\t\tthis.error = new ErrorFormatter(this.errors).truncate();\n\t\tthis.spinner = false;\n\t}\n}\n\nPolymer(SubscriptionLookup);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class OptionConfigurator {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-configure';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\toptionId: String,\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t},\n\t\t\tconfiguration: Object,\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\toptionConfiguratorResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['load(quote, product, optionId, ignoreCache)'];\n\t}\n\n\tready() {\n\t\tlet service = this.$.service;\n\t\tservice.addEventListener('response-changed', function(e) {\n\t\t\tthis.optionConfiguratorResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tservice.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tthis.$.service.uid = this.optionId;\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\t\tthis.$.service.context = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.add('optionId', this.optionId)\n\t\t\t//.add('lineItemKey', null) // integer of lineItem\n\t\t\t.add('featureOptionalSKUs', [])\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.addObject('parentProduct', this.serverProduct)\n\t\t\t.build();\n\t}\n\n\t/**\n\t * Returns a simplified ProductVO to overcome the input too long error\n\t * @returns {Object}\n\t */\n\tget serverProduct() {\n\t\tlet serverProduct = {};\n\t\tserverProduct.configurationAttributes = this.product.configurationAttributes;\n\t\tserverProduct.inheritedConfigurationAttributes = this.product.inheritedConfigurationAttributes;\n\t\tif(this.product.configuration === undefined)\n\t\t\treturn serverProduct;\n\n\t\tserverProduct.configuration = {\n\t\t\tconfigurationData: this.product.configuration.configurationData,\n\t\t\tinheritedConfigurationData: this.product.configuration.inheritedConfigurationData\n\t\t};\n\n\t\treturn serverProduct;\n\t}\n}\nPolymer(OptionConfigurator);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class OptionSaver {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-option-save';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproducts: Array,\n\t\t\tconfiguration : Object,\n\t\t\tupgradeAssetId: String, //TODO: support UpgradeAssetId\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tpsmResponse: { // is either a ProductSelectionModel or a ConfigurationVO depending on which method is called\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tbackground: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\tcache: String //provides the ability to cache to response\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['update(quote, products)', 'updateConfiguration(quote, configuration)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.psmResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tupdate() {\n\t\tif(this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\n\t\tlet builder = new DataBuilder().addQuote('quote', this.quote);\n\t\tbuilder.addObject('products', this.products)\n\t\tif (this.groupKey != null && this.groupKey >= 0)\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\n\t\tthis.$.service.model = builder.build();\n\t}\n\n\tupdateConfiguration() {\n\t\tif(this.cache !== undefined)\n\t\t\tthis.$.service.uid = this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.warningCallback = function(e) {\n\t\t\tlet messages = e.detail.value.validationMessages;\n\t\t\tconsole.log(messages);\n\t\t};\n\t\tthis.$.service.model = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote)\n\t\t\t.addObject('configuration', this.configuration)\n\t\t\t.add('upgradeAssetId', null)\n\t\t\t.build();\n\t}\n}\nPolymer(OptionSaver);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class ProductLoader {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-pc-product-load';\n\t\tthis.properties = {\n\t\t\tproductIds: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: ''\n\t\t\t},\n\t\t\tlineKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfeatureOptionIds: {\n\t\t\t\ttype: Array,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tgroupKey: {\n\t\t\t\ttype: Number,\n\t\t\t\tvalue: -1\n\t\t\t},\n\t\t\tfieldSet: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\tquote: Object,\n\t\t\tproduct: { //primarily used for test, may look to remove this in the future\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tproductLoadModel: {\n\t\t\t\ttype: Object,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tignoreCache: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['load(quote, productIds, lineKey, ignoreCache)']\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.featureOptionIds = null;\n\t\t\tthis.productLoadModel = e.detail && e.detail.value ? e.detail.value : null;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tload() {\n\t\tif (this.lineKey != null && this.lineKey >= 0 && this.lineKey > this.quote.nextKey)\n\t\t\treturn this.productLoadModel = { returnToQuote: 'The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it.' };\n\n\t\tvar products = [];\n\t\tvar pIds = this.productIds.split(',');\n\t\tpIds.forEach(function (pId) {\n\t\t\tproducts.push({record: {Id: pId}});\n\t\t});\n\t\tthis.$.service.context = undefined;\n\t\tthis.$.service.uid = this.featureOptionIds ? 'dynamic' : this.quote.record.Id.substring(0, 15);\n\t\tthis.$.service.ignoreCache = this.ignoreCache;\n\n\t\tlet builder = new DataBuilder().addQuote('quote', this.quote);\n\n\t\tif (this.lineKey != null && this.lineKey >= 0)\n\t\t\tbuilder.add('lineKey', this.lineKey);\n\t\telse if (this.featureOptionIds != null)\n\t\t\tbuilder.add('featureOptionIds', this.featureOptionIds).add('fieldSet', this.fieldSet);\n\t\telse\n\t\t\tbuilder.addObject('products', products);\n\n\t\tif (this.groupKey != null && this.groupKey >= 0)\n\t\t\tbuilder.add('groupKey', this.groupKey);\n\n\t\tthis.$.service.context = builder.build();\n\t}\n}\nPolymer(ProductLoader);","import {DataBuilder} from 'common/data/format/DataBuilder.js';\n\nexport class ProductRulesInvoker {\n\n\tbeforeRegister() {\n\t\tthis.is = 'sb-product-rules-invoke';\n\t\tthis.properties = {\n\t\t\tquote: Object,\n\t\t\tproduct: Object,\n\t\t\tupgradeAssetId: {\n\t\t\t\ttype: String,\n\t\t\t\tvalue: null\n\t\t\t},\n\t\t\terror: {\n\t\t\t\ttype: Array,\n\t\t\t\tnotify: true\n\t\t\t},\n\t\t\tconfigResponse: {\n\t\t\t\ttype: String,\n\t\t\t\tnotify: true\n\t\t\t}\n\t\t}\n\t}\n\n\tget observers() {\n\t\treturn ['update(quote, product)'];\n\t}\n\n\tready() {\n\t\tthis.$.service.addEventListener('response-changed', function(e) {\n\t\t\tthis.configResponse = e.detail.value;\n\t\t}.bind(this));\n\t\tthis.$.service.addEventListener('error-changed', function(e) {\n\t\t\tif (e.detail.value) {\n\t\t\t\tif(e.detail.value.validations)\n\t\t\t\t\tthis.error = e.detail.value.validations;\n\t\t\t\telse\n\t\t\t\t\tthis.error = [e.detail.value.message];\n\t\t\t}\n\t\t\tconsole.log(e.detail);\n\t\t}.bind(this));\n\t}\n\n\tupdate() {\n\t\t// in case this product is a cloned product, set the configuration key to product's key (or if not set simply set to the configuredProductId)\n\t\tthis.product.configuration.configuredProductKey = this.product.productKey || this.product.configuration.configuredProductId;\n\t\tthis.$.service.model = new DataBuilder()\n\t\t\t.addQuote('quote', this.quote, true)\n\t\t\t.addObject('configuration', this.product.configuration)\n\t\t\t.add('upgradeAssetId', this.upgradeAssetId)\n\t\t\t.build();\n\t}\n}\nPolymer(ProductRulesInvoker);"]}